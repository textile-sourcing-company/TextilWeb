@{
    ViewBag.Title = "Solicitud/Reembolso/Rendición de Gastos";
    ViewBag.Modulo = "Finanzas";
    Layout = "~/Views/Plantillas/_Layout.cshtml";
}

<link href="~/Libs/Bootstrap-toggle/bootstrap4-toggle.css" rel="stylesheet" />


<div id="solgasr" class="container-fluid">

    <ul class="nav nav-tabs nav-justified md-tabs indigo" id="myTabJust" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="solicitud-tab-just" data-toggle="tab" href="#solicitud-just" role="tab" aria-controls="solicitud-just"
               aria-selected="true">Con Solicitud</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" id="sinsolicitud-tab-just" data-toggle="tab" href="#sinsolicitud-just" role="tab" aria-controls="sinsolicitud-just"
               aria-selected="false">Sin Solicitud - Reembolso - Transferencia</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" id="rendicion-tab-just" data-toggle="tab" href="#rendicion-just" role="tab" aria-controls="rendicion-just"
               aria-selected="false">Rendición</a>
        </li>

    </ul>



    <div class="tab-content card pt-1" id="myTabContentJust">

        <div class="tab-pane fade show active" id="solicitud-just" role="tabpanel" aria-labelledby="solicitud-tab-just">

            <div id="solgas" class="container-fluid">

                <div class="card" style="border-bottom: 3px solid #2874A6;">
                    <div class="row m-2">

                        <div class="col-12 col-sm-3 col-md-3 col-lg-2 col-xl-2 p-1">
                            <label for="sidtxtcodigo">Código Solicitud</label>
                            <input class="form-control form-control-sm" type="text" id="sidtxtcodigo" placeholder="Buscar" maxlength="10">
                        </div>

                        <div class="col-12 col-sm-3 col-md-3 col-lg-2 col-xl-2 p-1">
                            <label for="siddttFechaHora">Fecha Emisión</label>
                            <input class="form-control form-control-sm" type="text" id="siddttFechaHora" disabled>
                        </div>

                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 p-1">
                            <label for="sidusuario">Usuario</label>
                            <input class="form-control form-control-sm" type="text" id="sidusuario" disabled>
                        </div>


                        <div class="col-12 col-sm-4 col-md-4 col-lg-4 col-xl-4 p-1 card sestado-solicitud">
                            <label style="text-align: center; color: #7F8C8D; font-size: 16px;">Estado Solicitud</label>
                            <div class="d-flex justify-content-center align-content-center">
                                <div id="sestado-icon"></div>
                                <h5 id="sestado-desc">-</h5>
                            </div>
                        </div>


                        <div class="col-12 col-sm-4 col-md-4 col-lg-4 col-xl-2 p-1">
                            <label for="sidCbxTipo">Tipo</label>
                            <select class="form-control form-control-sm" id="sidCbxTipo"></select>
                        </div>

                        <div class="col-12 col-sm-4 col-md-4 col-lg-4 col-xl-1 p-1">
                            <label for="sidCbxSede">Sede</label>
                            <select class="form-control form-control-sm" id="sidCbxSede" disabled></select>
                        </div>

                        <div class="col-12 col-sm-3 col-md-3 col-lg-4 col-xl-1 p-1">
                            <label for="sidCbxTipoMod">Moneda</label>
                            <select class="form-control form-control-sm" id="sidCbxTipoMod" disabled></select>
                        </div>



                        <div class="col-12 col-sm-9 col-md-9 col-lg-5 col-xl-3 p-1">
                            <label for="sidtxtaobs">Motivo Glosa / Descripción Solicitud</label>
                            <input type="text" class="form-control form-control-sm" placeholder="Ingrese una descripción de Solicitud" id="sidtxtaobs" maxlength="300" />
                        </div>

                        <div class="col-12 col-sm-12 col-md-12 col-lg-5 col-xl-3 p-1">
                            <label for="">Buscar Colaborador - SOFYA (Beneficiario)</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <button type="button" id="sbtnBuscarColaborador" class="btn btn-warning btn-sm"><i class="fas fa-search"></i></button>
                                </div>
                                <input type="text" class="form-control form-control-sm" placeholder="Colaborador" id="stxtcolaborador" aria-label="Username" disabled>
                            </div>
                        </div>

                        <div class="col-12 col-sm-12 col-md-12 col-lg-2 col-xl-2 p-1">
                            <label for="sdtpFechaAplicacion">Fecha Aplicación:</label>
                            <input type="date" class="form-control form-control-sm" id="sdtpFechaAplicacion" />
                        </div>




                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 p-2 d-flex justify-content-between flex-wrap" id="cont-cardd">

                            <div class="row col-12 col-sm-7 col-md-7 col-lg-8 col-xl-9 cbtn-acciones">

                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-4 sbtnacciones1">
                                    <button id="sbtnNuevo" type="button" class="btn btn-success btn-sm col-5 col-sm-5 col-md-5 col-lg-5"><i class="fas fa-file"></i> Nuevo</button>
                                    <button id="sbtnBuscarCodigo" type="button" class="btn btn-primary btn-sm col-5 col-sm-5 col-md-5 col-lg-5"><i class="fas fa-search"></i> Buscar</button>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-8 sbtnacciones2">
                                    <button id="sbtnAnularSolicitud" type="button" class="btn btn-danger btn-sm col-12 col-sm-12 col-md-12 col-lg-12 col-xl-4"><i class="fas fa-ban"></i> Anular Solicitud</button>
                                    <button id="sbtnGuardarCabecera" type="button" class="btn btn-success btn-sm col-12 col-sm-12 col-md-12 col-lg-12 col-xl-4"><i class="fas fa-save"></i> Generar Solicitud</button>
                                    <button id="sbtnAgregarDetalle" type="button" data-toggle="modal" data-target="#modalSolicitudDetalle" class="btn btn-warning btn-sm col-12 col-sm-12 col-md-12 col-lg-12 col-xl-4"><i class="fas fa-plus"></i> Agregar Detalle</button>
                                </div>

                            </div>


                            <div class="col-12 col-sm-4 col-md-4 col-lg-3 col-xl-3 sckpi-total d-flex justify-content-between">

                                <div class="sckpi-item">
                                    <h5 id="skpi-cantidad">0</h5>
                                    <span>Cantidad</span>
                                </div>

                                <div class="sckpi-item">
                                    <h5 id="skpi-total">0</h5>
                                    <span>Total</span>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="card card-body mt-2">

                    <table class="table table-sm table-striped dt-responsive table-bordered table-hover nowrap" id="stblDetalle" style="width: 100%">
                        <thead class="thead-light">
                            <tr>
                                <th class="all"></th>
                                <th class="ocultar-columna">idSolicitud</th>
                                <th>Codigo</th>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Estados</th>
                                <th>Centro de Costo</th>
                                <th class="all th-concepto">Concepto</th>
                                <th>Moneda</th>
                                <th class="all">Valor</th>
                                <th class="all">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="stblDetalleContent"></tbody>
                    </table>

                </div>

                <div class="modal fade" id="smodalSolDetInsertar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <div class="row">
                                    <div class="col-12 col-sm-6 col-md-6 col-lg-2 col-xl-2">
                                        <label for="sidmcodigo">Codigo:</label>
                                        <input type="text" class="form-control form-control-sm" id="sidmcodigo" readonly>
                                    </div>
                                    <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                        <label for="sidmCbxConcepCab">Concepto:</label>
                                        <select class="form-control form-control-sm" id="sidmCbxConcepCab"></select>
                                    </div>
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
                                        <label for="sidmCbxCeCo">Centro de Costo:</label>
                                        <select class="form-control form-control-sm" id="sidmCbxCeCo" disabled></select>
                                    </div>
                                </div>


                                <div class="row p-2 mt-1 d-flex flex-row justify-content-between">

                                    <div class="card col-12 col-sm-9 col-md-9 col-lg-9 p-2 d-flex flex-row justify-content-start">
                                        <div class="d-flex justify-content-center align-items-center">
                                            <input type='checkbox' id="sseleccionar-todo" class="form-control form-control-sm">
                                        </div>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <div class="ml-2">Seleccionar Todo</div>
                                        </div>
                                    </div>

                                    <div class="card col-12 col-sm-3 col-md-3 col-lg-2 p-2">
                                        <div class="d-flex flex-column justify-content-center align-content-center">
                                            <div class="scant-sum-total-det" id="sum-total-det">0.00</div>
                                            <div class="ssubt-sum-total-det">Total</div>
                                        </div>
                                    </div>

                                </div>


                                <div class="contendor-cpto-detalle">
                                    <div class="concepto-detalle">
                                        <div class="col">
                                            <ul class="list-group">

                                                <li class="list-group-item">
                                                    <div class="row">
                                                        <div class="col-1">
                                                            <h6>Marcar</h6>
                                                        </div>
                                                        <div class="col-2">
                                                            <h6>Concepto</h6>
                                                        </div>
                                                        <div class="col-1">
                                                            <h6>Monto</h6>
                                                        </div>
                                                        <div class="col-2">
                                                            <h6>Observación</h6>
                                                        </div>
                                                        <div class="col-3">
                                                            <h6>Consideracion</h6>
                                                        </div>
                                                        <div class="col-2">
                                                            <h6>Días</h6>
                                                        </div>
                                                        <div class="col-1">
                                                            <h6>Total</h6>
                                                        </div>
                                                    </div>
                                                </li>

                                                <li class="list-group-item" id="sdetalleConceptoInsertarEditar">
                                                </li>

                                            </ul>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            <div class="modal-footer">
                                <button id="sbtnCancelar" type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                <button id="sbtnGuardarDetalle" type="button" class="btn btn-primary btn-sm">Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="smodalSolDetVisualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <form>
                                    <div class="row">
                                        <div class="col-2">
                                            <label for="sidmdCodigo">Codigo:</label>
                                            <input type="text" class="form-control form-control-sm" id="sidmdCodigo" readonly>
                                        </div>
                                        <div class="col-4">
                                            <label for="sidmdConcepCab">Concepto:</label>
                                            <input class="form-control form-control-sm" id="sidmdConcepCab" readonly>
                                        </div>

                                        <div class="col-6">
                                            <label for="sidmdCeCo">Centro de Costo:</label>
                                            <input class="form-control form-control-sm" id="sidmdCeCo" disabled>
                                        </div>
                                    </div>


                                    <div class="container-fluid mt-4">

                                        <div class="contendor-cpto-detalle">

                                            <div class="concepto-detalle">

                                                <div class="col">
                                                    <ul class="list-group">

                                                        <li class="list-group-item">
                                                            <div class="row">

                                                                <div class="col-2">
                                                                    <h6>Concepto</h6>
                                                                </div>
                                                                <div class="col-1">
                                                                    <h6>Monto</h6>
                                                                </div>

                                                                <div class="col-4">
                                                                    <h6>Observacion</h6>
                                                                </div>

                                                                <div class="col-5">
                                                                    <h6>Consideracion</h6>
                                                                </div>

                                                            </div>
                                                        </li>

                                                        <li class="list-group-item" id="sdetalleConceptoVisualizar">
                                                        </li>

                                                    </ul>
                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                </form>


                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">OK</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade bd-example-modal-lg" id="smodalColaboradorSofya" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Buscar Colaborador - SOFYA</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <div class="form-group">
                                    <input type="text" class="form-control form-control-sm" id="sidBusquedaColaborador" placeholder="Buscar Colaborador <Presionar Enter>">
                                </div>

                                <table class="table table-sm table-bordered table-hover display nowrap" id="stblColaborador">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Codigo SOFYA</th>
                                            <th>Colaborador</th>
                                            <th>Seleecionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stblColaboradorContent"></tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <div class="tab-pane fade" id="sinsolicitud-just" role="tabpanel" aria-labelledby="sinsolicitud-tab-just">

            <div id="rsolrem" class="container-fluid">

                <div class="container-fluid">

                    <div class="card" style="border-bottom: 3px solid #239B56;">

                        <div class="row m-2">

                            <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 p-1">
                                <label for="ridtxtcodigo">Código</label>
                                <input class="form-control form-control-sm" type="text" id="ridtxtcodigo" placeholder="Buscar" maxlength="10">
                            </div>

                            <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 p-1">
                                <label for="ridCbxSede">Sede</label>
                                <select class="form-control form-control-sm" id="ridCbxSede"></select>
                            </div>

                            <div class="col-12 col-sm-6 col-md-6 col-lg-2 col-xl-2 p-1">
                                <label for="ridCbxTipo">Tipo</label>
                                <select class="form-control form-control-sm" id="ridCbxTipo" disabled></select>
                            </div>

                            <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 p-1">
                                <label for="riddttFechaHora">Fecha</label>
                                <input class="form-control form-control-sm" type="text" id="riddttFechaHora" disabled>
                            </div>

                            <div class="col-12 col-sm-4 col-md-4 col-lg-4 col-xl-4 p-1 card restado-solicitud">
                                <label style="text-align: center; color: #7F8C8D; font-size: 16px;">Estado Reembolso</label>
                                <div class="d-flex justify-content-center align-content-center">
                                    <div id="restado-icon"></div>
                                    <h5 id="restado-desc">-</h5>
                                </div>
                            </div>

                            <div class="col-6 col-sm-12 col-md-12 col-lg-2 col-xl-2 p-1">
                                <label for="ridCbxTipoMod">Tipo de Moneda</label>
                                <select class="form-control form-control-sm" id="ridCbxTipoMod"></select>
                            </div>


                            <div class="col-12 col-sm-12 col-md-12 col-lg-4 col-xl-4 p-1">
                                <label for="ridtxtaobs">Motivo Glosa / Descripción Solicitud</label>
                                <input type="text" class="form-control form-control-sm" placeholder="Ingrese una descripción / glosa" id="ridtxtaobs" maxlength="300" />
                            </div>

                            <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3 p-1">
                                <label for="">Buscar Colaborador - SOFYA</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <button type="button" id="rbtnBuscarColaborador" class="btn btn-warning btn-sm"><i class="fas fa-search"></i></button>
                                    </div>
                                    <input type="text" class="form-control form-control-sm" placeholder="Colaborador" id="rtxtcolaborador" aria-label="Username" disabled>
                                </div>
                            </div>

                            <div class="col-12 col-sm-12 col-md-4 col-lg-3 col-xl-3 p-1">
                                <label for="rcbxCeCo1">Centro de Costo:</label>
                                <select class="form-control form-control-sm" id="rcbxCeCo1" disabled></select>
                            </div>

                            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 p-2 d-flex justify-content-between flex-wrap">

                                <div class="col-12 col-sm-12 col-md-12 col-lg-9 col-xl-9 d-flex justify-content-between flex-wrap cbtn-acciones">

                                    <div class="col-12 col-sm-4 col-md-4 col-lg-4 col-xl-4">
                                        <button id="rbtnNuevo" type="button" class="btn btn-primary btn-sm col-5 col-sm-5 col-md-5"><i class="fas fa-file"></i> Nuevo</button>
                                        <button id="rbtnBuscarCodigo" type="button" class="btn btn-primary btn-sm col-5 col-sm-5 col-md-5"><i class="fas fa-search"></i> Buscar</button>
                                    </div>
                                    <div class="col-12 col-sm-8 col-md-8 col-lg-6 col-xl-6">
                                        <button id="rbtnAnularSolicitud" type="button" class="btn btn-danger btn-sm col-12 col-sm-5 col-md-5"><i class="fas fa-ban"></i> Anular Solicitud</button>
                                        <button id="rbtnGenerarComprobante" type="button" class="btn btn-success btn-sm col-12 col-sm-6 col-md-6"><i class="fas fa-save"></i> Registrar Comprobante</button>
                                    </div>

                                </div>

                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3 ckpi-total d-flex justify-content-between">

                                    <div class="rckpi-item">
                                        <h5 id="rkpi-cantidad">0</h5>
                                        <span>Cantidad</span>
                                    </div>

                                    <div class="rckpi-item">
                                        <h5 id="rkpi-total">0</h5>
                                        <span>Total</span>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="card card-body mt-1">

                        <table class="table table-sm table-striped dt-responsive table-bordered table-hover nowrap" id="rtblDetalle" style="width: 100%">
                            <thead class="thead-light">
                                <tr>
                                    <th class="all"></th>
                                    <th class="ocultar-columna">id</th>
                                    <th class="">Serie Número</th>
                                    <th>Centro de Costo</th>
                                    <th class="all">Concepto</th>
                                    <th class="all">Total</th>
                                    <th style="text-align: center">Eliminar cpte</th>
                                    <th style="text-align: center">Editar cpte</th>
                                    <th>PDF</th>
                                    @*<th>Acciones</th>*@
                                </tr>
                            </thead>
                            <tbody id="rtblDetalleContent"></tbody>
                        </table>

                    </div>

                    <div>
                        <hr />
                    </div>

                    <div class="container-fluid mb-2">
                        <div class="row d-flex justify-content-lg-between">
                            <div>
                                <button type="button" id="rbtnVerRegistrados" class="btn btn-primary btn-sm"><i class='fas fa-eye'></i>  Ver Registrados</button>
                            </div>
                            @*<div>
                                    <button type="button" id="btnRegistrarcomprobante" class="btn btn-primary btn-sm">Registrar Comprobante</button>
                                </div>*@
                        </div>
                    </div>


                </div>

                <div class="modal fade" id="rmodalSolDetInsertar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">


                                <div class="row">
                                    <div class="col-2">
                                        <label for="ridmcodigo">Codigo:</label>
                                        <input type="text" class="form-control form-control-sm" getid="ridmcodigo" readonly>
                                    </div>
                                    <div class="col-4">
                                        <label for="ridmCbxConcepCab">Concepto:</label>
                                        <select class="form-control form-control-sm" id="ridmCbxConcepCab"></select>
                                    </div>

                                    <div class="col-6">
                                        <label for="ridmCbxCeCo">Centro de Costo:</label>
                                        <select class="form-control form-control-sm" id="ridmCbxCeCo"></select>
                                    </div>
                                </div>


                                <div class="row p-2 mt-1 d-flex flex-row justify-content-between">

                                    <div class="card col-9 p-2 d-flex flex-row justify-content-start">
                                        <div class="d-flex justify-content-center align-items-center">
                                            <input type='checkbox' id="rseleccionar-todo" class="form-control form-control-sm">
                                        </div>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <div class="ml-2">Seleccionar Todo</div>
                                        </div>
                                    </div>

                                    <div class="card col-2 p-2">
                                        <div class="d-flex flex-column justify-content-center align-content-center">
                                            <div class="rcant-sum-total-det" id="sum-total-det">0.00</div>
                                            <div class="rsubt-sum-total-det">Total</div>
                                        </div>
                                    </div>

                                </div>


                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col">
                                            <ul class="list-group">

                                                <li class="list-group-item">
                                                    <div class="row">
                                                        <div class="col-1">
                                                            <h6>Marcar</h6>
                                                        </div>
                                                        <div class="col-2">
                                                            <h6>Concepto</h6>
                                                        </div>
                                                        <div class="col-1">
                                                            <h6>Monto</h6>
                                                        </div>
                                                        <div class="col-7">
                                                            <h6>Consideracion</h6>
                                                        </div>
                                                        <div class="col-1">
                                                            <h6>Días</h6>
                                                        </div>
                                                    </div>
                                                </li>

                                                <li class="list-group-item" id="rdetalleConceptoInsertarEditar">
                                                </li>

                                            </ul>
                                        </div>
                                    </div>

                                </div>


                            </div>
                            <div class="modal-footer">
                                <button id="rbtnCancelar" type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                <button id="rbtnGuardarDetalle" type="button" class="btn btn-primary btn-sm">Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="rmodalSolDetVisualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <form>
                                    <div class="row">
                                        <div class="col-2">
                                            <label for="ridmdCodigo">Codigo:</label>
                                            <input type="text" class="form-control form-control-sm" id="ridmdCodigo" readonly>
                                        </div>
                                        <div class="col-4">
                                            <label for="ridmdConcepCab">Concepto:</label>
                                            <input class="form-control form-control-sm" id="ridmdConcepCab" readonly>
                                        </div>

                                        <div class="col-6">
                                            <label for="ridmdCeCo">Centro de Costo:</label>
                                            <input class="form-control form-control-sm" id="ridmdCeCo">
                                        </div>
                                    </div>


                                    <div class="container-fluid mt-4">

                                        <div class="row">
                                            <div class="col">
                                                <ul class="list-group">

                                                    <li class="list-group-item">
                                                        <div class="row">
                                                            <div class="col-2">
                                                                <h6>Concepto</h6>
                                                            </div>
                                                            <div class="col-1">
                                                                <h6>Monto</h6>
                                                            </div>

                                                            <div class="col-8">
                                                                <h6>Consideracion</h6>
                                                            </div>
                                                            <div class="col-1">
                                                                <h6>Marcar</h6>
                                                            </div>
                                                        </div>
                                                    </li>

                                                    <li class="list-group-item" id="rdetalleConceptoVisualizar">
                                                    </li>

                                                </ul>
                                            </div>
                                        </div>

                                    </div>

                                </form>


                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">OK</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade bd-example-modal-lg" id="rmodalColaboradorSofya" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Buscar Colaborador - SOFYA</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <div class="form-group">
                                    <input type="text" class="form-control form-control-sm" id="ridBusquedaColaborador" placeholder="Buscar Colaborador <Presionar Enter>">
                                </div>

                                <table class="table table-sm table-bordered table-hover display nowrap" id="rtblColaborador" style="width: 100%">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Codigo SOFYA</th>
                                            <th>Colaborador</th>
                                            <th>Seleecionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rtblColaboradorContent"></tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="rregComprobModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Registro de Comprobante</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <ul class="nav nav-tabs nav-justified md-tabs indigo" id="rtabRendicionGastos" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active rctabRegComp" data-id="1" id="rfacturaboleta-tab" data-toggle="tab" href="#rsg-facturaboleta" role="tab" aria-controls="firma-just"
                                           aria-selected="true">Factura / Boleta</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link rctabRegComp" data-id="2" id="rplanillamovilidad-tab" data-toggle="tab" href="#rsg-planillamovilidad" role="tab" aria-controls="aprobadas-just"
                                           aria-selected="false">Planilla de Movilidad</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link rctabRegComp" data-id="3" id="rdeclaracionjur-tab" data-toggle="tab" href="#rsg-declaracionjur" role="tab" aria-controls="aprobadas-just"
                                           aria-selected="false">Declaración Jurada</a>
                                    </li>
                                </ul>


                                <div class="tab-content card pt-1">

                                    @*    **********************          FACTURA Y BOLETA        **********************  *@

                                    <div class="tab-pane fade show active" id="rsg-facturaboleta" role="tabpanel" aria-labelledby="rfacturaboleta-tab">

                                        @Html.Partial("Finanzas/remRendFacturaBoleta")

                                    </div>

                                    @*    **********************          PLANILLA DE MOVILIDAD        **********************  *@

                                    <div class="tab-pane fade" id="rsg-planillamovilidad" role="tabpanel" aria-labelledby="rplanillamovilidad-tab">

                                        @Html.Partial("Finanzas/remRendPlanillaMovilidad")

                                    </div>

                                    @*    **********************          DECLARACION JURADA        **********************  *@

                                    <div class="tab-pane fade" id="rsg-declaracionjur" role="tabpanel" aria-labelledby="rdeclaracionjur-tab">

                                        @Html.Partial("Finanzas/remRendDeclaracionJurada")

                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <span class="btn btn-sm btn-secondary" id="rbtnCancelarComprobante" data-dismiss="modal">Cancelar</span>
                                <span class="btn btn-sm btn-primary" id="rbtnGuardarComprobante">Guardar</span>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal fade" id="rproveedorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Registro de proveedor</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="rtxtTipoPersonaModal">Tipo Persona</label>
                                                <select class="form-control form-control-sm" id="rtxtTipoPersonaModal" disabled>
                                                    <option value="J" selected>Jurídica</option>
                                                </select>
                                            </div>

                                            <div class="col-6">
                                                <label for="rtxtPaisModal">Pais:</label>
                                                <input type="text" class="form-control form-control-sm" id="rtxtPaisModal" value="Perú" readonly>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="rtxtRUCModal" class="col-form-label">RUC:</label>
                                        <input type="text" class="form-control" id="rtxtRUCModal" maxlength="15">
                                    </div>

                                    <div class="form-group">
                                        <label for="rtxtRSModal" class="col-form-label">Razon Social:</label>
                                        <input type="text" class="form-control" id="rtxtRSModal" maxlength="140">
                                    </div>

                                    <div class="form-group">
                                        <label for="rtxtDireccionModal" class="col-form-label">Dirección:</label>
                                        <textarea class="form-control" id="rtxtDireccionModal" maxlength="340"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary btn-sm" id="rbtnRegistrarProveedor">Registrar</button>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

        </div>

        <div class="tab-pane fade" id="rendicion-just" role="tabpanel" aria-labelledby="rendicion-tab-just">

            <div class="rendgas container-fluid">


                <div class="container-fluid card">

                    <div class="mt-3 ml-2">
                        <div class="row header-rendicion">
                            <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6 mt-1 d-flex flex-row">
                                <button type="button" id="zbtnBuscarPendiente" class="btn btn-warning btn-sm">Buscar Pendientes</button>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6 mt-1 d-flex flex-row-reverse zindicador">
                                <div class="row d-flex flex-row">
                                    <div id="zestado-icon"></div>
                                    <h5 id="zestado-desc"></h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <div class="row m-1">

                        <div class="col-6 col-sm-6 col-md-4 col-lg-2 col-xl-2 p-1">
                            <label for="ztxtCodigo">Código:</label>
                            <input class="form-control form-control-sm" id="ztxtCodigo" disabled>
                        </div>
                        <div class="col-6 col-sm-6 col-md-4 col-lg-2 col-xl-2 p-1">
                            <label for="ztxtFecha">Fecha</label>
                            <input class="form-control form-control-sm" type="text" id="ztxtFecha" disabled>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4 col-lg-5 col-xl-5 p-1">
                            <label for="ztxtUsuario">Usuario:</label>
                            <input class="form-control form-control-sm" id="ztxtUsuario" disabled>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4 col-lg-3 col-xl-3 p-1">
                            <label for="ztxtTipo">Tipo:</label>
                            <input class="form-control form-control-sm" id="ztxtTipo" disabled>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4 col-lg-6 col-xl-3 p-1">
                            <label for="ztxtCeCo">Centro de Costo:</label>
                            <input class="form-control form-control-sm" id="ztxtCeCo" disabled>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4 col-lg-6 col-xl-4 p-1">
                            <label for="ztxtColaborador">Colaborador</label>
                            <input class="form-control form-control-sm" type="text" id="ztxtColaborador" disabled>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4 col-lg-9 col-xl-4 p-1">
                            <label for="ztxtGlosa">Glosa Solicitud</label>
                            <input class="form-control form-control-sm" type="text" id="ztxtGlosa" disabled>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4 col-lg-3 col-xl-1 p-1">
                            <label for="ztxtTotalSol">Total:</label>
                            <input class="form-control form-control-sm" type="text" id="ztxtTotalSol" disabled>
                        </div>

                    </div>


                    <div>
                        <hr />
                    </div>

                    <div class="container-fluid mt-2">
                        <table class="table table-sm table-bordered  table-striped dt-responsive table-hover nowrap" id="ztblSolicitud" style="width: 100%;">
                            <thead class="thead-light">
                                <tr>
                                    <th class="all"></th>
                                    <th class="ocultar-columna">idSolicitud</th>
                                    <th class="ocultar-columna">Secuencia</th>
                                    <th class="all">Documento</th>
                                    <th>Tipo</th>
                                    <th>Concepto</th>
                                    <th>Detallle</th>

                                    <th>Cant. Dias</th>
                                    <th>Valor Unitario</th>
                                    <th>Total Solicitado</th>
                                    <th>Total Entregado</th>
                                    <th class="all">Total Rendido</th>
                                    <th>Exceso / Devolución</th>

                                    <th class="all" style="text-align: center">REGISTRO</th>
                                </tr>
                            </thead>
                            <tbody id="ztblSolicitudContent"></tbody>
                        </table>
                    </div>

                    <div>
                        <hr />
                    </div>

                    <div class="container-fluid mb-2">
                        <div class="row d-flex justify-content-lg-between">
                            <button type="button" id="zbtnVerRegistrados" class="btn btn-primary btn-sm"><i class='fas fa-eye'></i>  Ver Registrados</button>
                        </div>
                    </div>


                </div>

                <div class="modal fade" id="zproveedorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Registro de proveedor</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="ztxtTipoPersonaModal">Tipo Persona</label>
                                                <select class="form-control form-control-sm" id="ztxtTipoPersonaModal" disabled>
                                                    <option value="J" selected>Jurídica</option>
                                                </select>
                                            </div>

                                            <div class="col-6">
                                                <label for="ztxtPaisModal">Pais:</label>
                                                <input type="text" class="form-control form-control-sm" id="ztxtPaisModal" value="Perú" readonly>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="ztxtRUCModal" class="col-form-label">RUC:</label>
                                        <input type="text" class="form-control" id="ztxtRUCModal" maxlength="15" disabled>
                                    </div>

                                    <div class="form-group">
                                        <label for="ztxtRSModal" class="col-form-label">Razon Social:</label>
                                        <input type="text" class="form-control" id="ztxtRSModal" maxlength="140">
                                    </div>

                                    <div class="form-group">
                                        <label for="ztxtDireccionModal" class="col-form-label">Dirección:</label>
                                        <textarea class="form-control" id="ztxtDireccionModal" maxlength="340"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary btn-sm" id="zbtnRegistrarProveedor">Registrar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="zmodalSolicitudesPendientes" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Solicitudes Pendientes de Rendición</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="contenedor-detalle">
                                    <table class="table table-sm table-bordered table-hover nowrap" id="ztblDetallePendiente" style="width: 100%">
                                        <thead class="thead-light">
                                            <tr>
                                                <th class="ocultar-columna">IdSolicitud</th>
                                                <th>Fecha</th>
                                                <th>Codigo</th>
                                                <th style="min-width: 200px;">Colaborador</th>
                                                <th>Glosa</th>
                                                <th>Total</th>
                                                <th style="text-align: center">Seleccionar</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ztblDetallePendienteContent"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="zregComprobModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Registro de Comprobante</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <ul class="nav nav-tabs nav-justified md-tabs indigo" id="ztabRendicionGastos" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active zctabRegComp" data-id="1" id="zfacturaboleta-tab" data-toggle="tab" href="#zsg-facturaboleta" role="tab" aria-controls="firma-just"
                                           aria-selected="true">Factura / Boleta</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link zctabRegComp" data-id="2" id="zplanillamovilidad-tab" data-toggle="tab" href="#zsg-planillamovilidad" role="tab" aria-controls="aprobadas-just"
                                           aria-selected="false">Planilla de Movilidad</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link zctabRegComp" data-id="3" id="zdeclaracionjur-tab" data-toggle="tab" href="#zsg-declaracionjur" role="tab" aria-controls="aprobadas-just"
                                           aria-selected="false">Declaración Jurada</a>
                                    </li>
                                </ul>

                                <div class="tab-content card pt-1">

                                    <div class="tab-pane fade show active" id="zsg-facturaboleta" role="tabpanel" aria-labelledby="zfacturaboleta-tab">
                                        @Html.Partial("Finanzas/rendRendFacturaBoleta")
                                    </div>
                                    <div class="tab-pane fade" id="zsg-planillamovilidad" role="tabpanel" aria-labelledby="zplanillamovilidad-tab">
                                        @Html.Partial("Finanzas/rendRendPlanillaMovilidad")
                                    </div>
                                    <div class="tab-pane fade" id="zsg-declaracionjur" role="tabpanel" aria-labelledby="zdeclaracionjur-tab">
                                        @Html.Partial("Finanzas/rendRendDeclaracionJurada")
                                    </div>

                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-sm btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-sm btn-primary btn-sm" id="zbtnGuardarComprobante">Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="zregistrarDevModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">

                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Monto Devolución</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-12">
                                            <input type="email" class="form-control" id="ztxtMontoDevolucion" placeholder="Ingrese monto de devolución">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-sm btn-primary" id="zbtnGuardarDevolucion">Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="zdetComprobantesModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">

                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Comprobante Registrados</h5>
                            </div>
                            <div class="modal-body">
                                <div class="container-fluid">

                                    <table class="table table-sm table-bordered" id="ztblCptesRegistrados" style="width: 100%">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Serie Numero</th>
                                                <th>Proveedor</th>
                                                <th>Total</th>
                                                <th>Impresión</th>
                                                <th>Editar</th>
                                                <th>Eliminar</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ztblCptesRegistradosCont"></tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>



<style>




    #smodalSolDetInsertar .scant-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 18px;
    }


    #smodalSolDetInsertar .ssubt-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 14px;
    }

    #solgas .concepto-detalle {
        width: 890px;
        /*height: 500px;*/
        /*overflow: scroll;*/
        /*background-color: aquamarine;*/
    }

    #solgas .sbtnacciones2 button {
        /*max-width: 150px;*/
        max-height: 30px;
    }



    #solgasr label {
        font-family: 'Roboto', sans-serif;
    }

    #modalSolicitudDetalle input, select, span, label {
        font-family: 'Roboto', sans-serif;
    }

    #solgasr .sidtxtcodigo-ok {
        background-color: #82E0AA !important;
    }


    #solgasr table .ocultar-columna {
        display: none;
    }


    #solgasr .cbtn-acciones {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #solgasr .sckpi-total {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #solgasr .sckpi-item {
        background-color: #EBEDEF;
        width: 45%;
        margin: auto;
        padding: 4px;
        border-radius: 3px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }


    #solgasr .skpi-cantidad {
    }

    #solgasr #tblHistorial th {
        font-family: 'Roboto', sans-serif !important;
    }

    #solgasr #tblHistorial td {
        font-family: 'Roboto', sans-serif !important;
        font-weight: 600;
    }

    #solgasr #stblDetalle th {
        font-family: 'Roboto', sans-serif !important;
    }

    #solgasr #stblDetalle td {
        font-family: 'Roboto', sans-serif !important;
    }

    #solgasr #sestado-desc {
        margin-right: 8px;
    }

    #modalSolicitudDetalle #idmConcepDetConsid {
        height: 100px !important;
    }


    #solgasr .icon-pendiente::after {
        content: url(../../Public/icon-pend.png);
    }

    #solgasr .icon-liberado::after {
        content: url(../../Public/icon-libe.png);
    }

    #solgasr .icon-aprobado::after {
        content: url(../../Public/icon-apro.png);
    }

    #solgasr .icon-rechazado::after {
        content: url(../../Public/icon-rech.png);
    }



    #solgasr .desc-est-pendiente {
        color: #616A6B;
    }

    #solgasr .desc-est-liberado {
        color: #F1C40F;
    }

    #solgasr .desc-est-aprobado {
        color: #28B463;
    }

    #solgasr .desc-est-rechazado {
        color: #C0392B;
    }


    #solgasr #listDetalleConcept p {
        font-size: 13px !important;
        border: 1px solid #E5E8E8 !important;
        padding: 4px !important;
    }


    input[type="checkbox"] {
        position: relative;
        width: 2.2em;
        height: 2.2em;
        color: #000;
        border: 1px solid #D5D8DC;
        border-radius: 4px;
        appearance: none;
        outline: 0;
        cursor: pointer;
        transition: background 175ms cubic-bezier(0.1, 0.1, 0.25, 1);
    }

        input[type="checkbox"]::before {
            position: absolute;
            content: '';
            display: block;
            top: 3px;
            left: 8px;
            width: 10px;
            height: 16px;
            border-style: solid;
            border-color: #ffffff;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            opacity: 0;
        }


        input[type="checkbox"]:checked {
            color: #ffffff;
            border-color: #28B463;
            background: #28B463;
        }


        input[type="checkbox"]:before {
            opacity: 1;
        }


    #solgasr .sestado-solicitud {
        color: #28B463;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        padding: 5px;
        border-radius: 5px;
    }




    #rmodalSolDetInsertar .rcant-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 18px;
    }


    #rmodalSolDetInsertar .rsubt-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 14px;
    }



    #rsolrem label {
        font-family: 'Roboto', sans-serif;
    }

    #modalSolicitudDetalle input, select, span, label {
        font-family: 'Roboto', sans-serif;
    }

    #rsolrem .ridtxtcodigo-ok {
        background-color: #82E0AA !important;
    }


    #rsolrem table .ocultar-columna {
        display: none;
    }


    #rsolrem .cbtn-acciones {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #rsolrem .ckpi-total {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #rsolrem .rckpi-item {
        background-color: #EBEDEF;
        width: 45%;
        margin: auto;
        padding: 4px;
        border-radius: 3px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }


    #rsolrem .rkpi-cantidad {
    }

    #rsolrem #rtblHistorial th {
        font-family: 'Roboto', sans-serif !important;
    }

    #rsolrem #rtblHistorial td {
        font-family: 'Roboto', sans-serif !important;
        font-weight: 600;
    }

    #rsolrem #rtblDetalle th {
        font-family: 'Roboto', sans-serif !important;
    }

    #rsolrem #rtblDetalle td {
        font-family: 'Roboto', sans-serif !important;
    }

    #rsolrem .estado-solicitud {
        padding: 10px;
        border: 1px solid #000000;
        border-radius: 5px;
    }

    #rsolrem #restado-desc {
        margin-right: 8px;
    }

    #modalSolicitudDetalle #idmConcepDetConsid {
        height: 100px !important;
    }


    #rsolrem .icon-pendiente::after {
        content: url(../../Public/icon-pend.png);
    }

    #rsolrem .icon-liberado::after {
        content: url(../../Public/icon-libe.png);
    }

    #rsolrem .icon-aprobado::after {
        content: url(../../Public/icon-apro.png);
    }

    #rsolrem .icon-rechazado::after {
        content: url(../../Public/icon-rech.png);
    }



    #rsolrem .desc-est-pendiente {
        color: #616A6B;
    }

    #rsolrem .desc-est-liberado {
        color: #F1C40F;
    }

    #rsolrem .desc-est-aprobado {
        color: #28B463;
    }

    #rsolrem .desc-est-rechazado {
        color: #C0392B;
    }



    #solgasr .restado-solicitud {
        color: #28B463;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        padding: 5px;
        border-radius: 5px;
    }





    #rsolrem #listDetalleConcept p {
        font-size: 13px !important;
        border: 1px solid #E5E8E8 !important;
        padding: 4px !important;
    }

    #rregComprobModal span.btn {
        cursor: pointer;
    }

    input[type="checkbox"] {
        position: relative;
        width: 2.2em;
        height: 2.2em;
        color: #000;
        border: 1px solid #D5D8DC;
        border-radius: 4px;
        appearance: none;
        outline: 0;
        cursor: pointer;
        transition: background 175ms cubic-bezier(0.1, 0.1, 0.25, 1);
    }

        input[type="checkbox"]::before {
            position: absolute;
            content: '';
            display: block;
            top: 3px;
            left: 8px;
            width: 10px;
            height: 16px;
            border-style: solid;
            border-color: #ffffff;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            opacity: 0;
        }


        input[type="checkbox"]:checked {
            color: #ffffff;
            border-color: #28B463;
            background: #28B463;
        }


        input[type="checkbox"]:before {
            opacity: 1;
        }

    input.seleccion {
    }


    #rregComprobModal .kpi-modal-monto1 {
        text-align: center;
        background-color: #D5D8DC;
    }

    #rregComprobModal .kpi-modal-monto2 {
        text-align: center;
        background-color: #D5D8DC;
    }

    #rregComprobModal .kpi-modal-monto3 {
        text-align: center;
        background-color: #D5D8DC;
    }

    #rregComprobModal .kpi-modal-monto3 {
        text-align: center;
        background-color: #D5D8DC;
    }

    #rregComprobModal #rrembsumtotal {
        border: 3px solid #2874A6;
        border-radius: 6px;
        padding: 8px;
    }




    /*rendicion de Gastos*/
    .rendgas label {
        font-family: 'Roboto', sans-serif;
    }

    .rendgas input, select, span, label {
        font-family: 'Roboto', sans-serif;
    }



    .rendgas table th.ocultar-columna {
        display: none !important;
    }

    .rendgas table tr.ocultar-columna {
        display: none !important;
    }

    .rendgas table td.ocultar-columna {
        display: none !important;
    }

    .rendgas #zestado-desc {
        margin-right: 8px;
    }

    .rendgas #zregComprobModal .kpi-modal-monto1 {
        text-align: center;
        background-color: #D5D8DC;
    }

    .rendgas #zregComprobModal .kpi-modal-monto2 {
        text-align: center;
        background-color: #D5D8DC;
    }

    .rendgas #zregComprobModal .kpi-modal-monto3 {
        text-align: center;
        background-color: #D5D8DC;
    }



    .rendgas a.disabled {
        pointer-events: none;
        color: #ccc;
    }


    .rendgas #editComprobModal .kpi-modal-monto1 {
        text-align: center;
        background-color: #D5D8DC;
    }

    .rendgas #editComprobModal .kpi-modal-monto2 {
        text-align: center;
        background-color: #D5D8DC;
    }

    .rendgas #editComprobModal .kpi-modal-monto3 {
        text-align: center;
        background-color: #D5D8DC;
    }

    .rendgas #editComprobModal #zlist-comprobantes {
        background-color: #F2F4F4
    }


    .rendgas #editComprobModal #btnImprimirPDF {
        background-color: #AF1204;
        color: #fff;
    }

    .rendgas #zrendsumtotal {
        border: 3px solid #2874A6;
        border-radius: 6px;
        padding: 8px;
    }




    .rendgas .icon-pendiente::after {
        content: url(../../../../Public/icon-pend.png);
    }

    .rendgas .icon-liberado::after {
        content: url(../../../../Public/icon-libe.png);
    }

    .rendgas .icon-aprobado::after {
        content: url(../../../../Public/icon-apro.png);
    }

    .rendgas .icon-rechazado::after {
        content: url(../../../../Public/icon-rech.png);
    }

    .rendgas .icon-rend-completa::after {
        content: url(../../../../Public/icon-apro.png);
    }

    .rendgas .icon-rend-incompleta::after {
        content: url(../../../../Public/icon-libe.png);
    }



    .rendgas .desc-est-pendiente {
        color: #616A6B;
    }

    .rendgas .desc-est-liberado {
        color: #F1C40F;
    }

    .rendgas .desc-est-aprobado {
        color: #28B463;
    }

    .rendgas .desc-est-rechazado {
        color: #C0392B;
    }

    .rendgas .desc-est-rend-completa {
        color: #28B463;
    }

    .rendgas .desc-est-rend-incompleta {
        color: #F1C40F;
    }

    .modal {
        overflow-y: auto !important;
    }



    .switch {
        position: relative;
        display: inline-block;
        width: 70px;
        height: 31px;
    }


    @@media (min-width: 320px) and (max-width: 479.98px) {
        #solgas .cbtn-acciones {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

            #solgas .cbtn-acciones .sbtnacciones1 {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            #solgas .cbtn-acciones .sbtnacciones2 {
                margin-top: 10px;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

                #solgas .cbtn-acciones .sbtnacciones2 button {
                    margin: 0px;
                    margin-top: 3px !important;
                    width: 100%;
                }

        #solgas .contendor-cpto-detalle {
            /*width: 450px;*/
            overflow: scroll;
        }

        #solgas #stblDetalle .th-concepto {
            max-width: 40px;
            overflow: hidden;
        }

        #rsolrem .cbtn-acciones #rbtnAnularSolicitud {
            margin-top: 3px;
        }

        #rsolrem .cbtn-acciones #rbtnGenerarComprobante {
            margin-top: 3px;
        }
    }

    @@media (min-width: 480px) and (max-width: 767.98px) {

        #solgas .cbtn-acciones {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

            #solgas .cbtn-acciones .sbtnacciones1 {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            #solgas .cbtn-acciones .sbtnacciones2 {
                margin-top: 10px;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

                #solgas .cbtn-acciones .sbtnacciones2 button {
                    margin: 0px;
                    margin-top: 3px !important;
                    width: 100%;
                }


        #solgas .contendor-cpto-detalle {
            /*width: 450px;*/
            overflow: scroll;
        }

        #solgas #stblDetalle .th-concepto {
            max-width: 40px;
            overflow: hidden;
        }


        .rendgas .header-rendicion {
            display: flex;
            justify-content: space-between;
        }
    }


    @@media (min-width: 768px) and (max-width: 991.98px) {

        #solgas .cbtn-acciones {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

            #solgas .cbtn-acciones .sbtnacciones1 {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }


            #solgas .cbtn-acciones .sbtnacciones2 {
                margin-top: 10px;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

                #solgas .cbtn-acciones .sbtnacciones2 button {
                    margin: 0px;
                    margin-top: 3px !important;
                    width: 100%;
                }


        #solgas .contendor-cpto-detalle {
            /*width: 450px;*/
            overflow: scroll;
        }

        #solgas #stblDetalle .th-concepto {
            max-width: 40px;
            overflow: hidden;
        }

        #rsolrem card {
            background-color: coral;
        }

        .rendgas .header-rendicion {
            display: flex;
            justify-content: space-between;
        }
    }

    @@media (min-width: 992px) and (max-width: 1199.98px) {

        #solgas .cbtn-acciones {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

            #solgas .cbtn-acciones .sbtnacciones1 {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            #solgas .cbtn-acciones .sbtnacciones2 {
                margin-top: 10px;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }

                #solgas .cbtn-acciones .sbtnacciones2 button {
                    margin: 0px;
                    margin-top: 3px !important;
                    width: 100%;
                }

        #solgas .contendor-cpto-detalle {
            /*width: 450px;*/
            overflow: scroll;
        }

        #solgas #stblDetalle .th-concepto {
            max-width: 40px;
            overflow: hidden;
        }


        #rsolrem card {
            background-color: yellow;
        }

        .rendgas .header-rendicion {
            display: flex;
            justify-content: space-between;
        }
    }

    @@media (min-width: 1200px) {

        #solgas .cbtn-acciones {
        }

            #solgas .cbtn-acciones .sbtnacciones2 {
                display: flex;
                flex-direction: row;
                justify-content: flex-end;
            }

                #solgas .cbtn-acciones .sbtnacciones2 button {
                    margin: 0px;
                    margin-left: 3px !important;
                }

        #solgas .contendor-cpto-detalle {
            /*width: 450px;*/
            overflow: scroll;
        }

        #solgas #stblDetalle .th-concepto {
            max-width: 40px;
            overflow: hidden;
        }

        .rendgas .header-rendicion {
            display: flex;
            justify-content: space-between;
        }
    }
</style>


@section scripts {

    <script src="~/Admin/js/Finanzas/Rendiciones/moment.js"></script>
    <script src="~/Libs/Bootstrap-toggle/bootstrap4-toggle.js"></script>


    <script>

        const USUARIO = "@Request.RequestContext.HttpContext.Session["usuario"]";
        const USUARIO_COMPLETO = "@Request.RequestContext.HttpContext.Session["usuario"]" + " - " + "@Request.RequestContext.HttpContext.Session["nombre"]";
        const PORCENTAJE_IGV = 18;


        // CON SOLICITUD

        const sNIVEL_INTERFAZ = 10;
        var sswitchInsertarEditar = 0; // 1: Insertar, 2: Editar

        var svIdSolicitud = 0;
        var svCodigo = "";
        var svIdTipoMod = 0;
        var svCodCeCo = 0;
        var svIdConcepCab = 0;
        var svIdConcepDet = 0;
        var svIdTipo = 0;
        var svCodSede = '';

        var svChecked = false;

        var sdiasArray = [];
        var sentidadEditar = {};
        var sdiasArrayEditar = [];
        var sconceptoDetArray = [];
        var stipoMonedaArray = [];

        var ssumTotalDetalle = 0;

        var svCodColSofya = "";
        var ssvcolaboradorSofya = "";

        var svctpava_bnfcol = "";
        var svcanvar_bnfcol = "";
        var svcolaborador = "";

        var stiposAnulacionCabArray = [];
        var sTipoRegistroCabDet = "C";



        // Sin Solicitud : REEMBOLSO

        const rNIVEL_INTERFAZ = 10;
        var rswitchInsertarEditar = 0; // 1: Insertar, 2: Editar

        var rvIdSolicitud = 0;
        var rvIdRendCompte = 0;
        var rvCodTipoComprobante = 0;
        var rvIdTipoMod = 0;
        var rvSimboloMoneda = "";
        var rvCodCeCo = 0;
        var rvCeCo = "";
        var rvIdTipo = 0;

        var rvTotalSolicitado1 = 0;
        var rvTotalSolicitado2 = 0;
        var rvTotalSolicitado3 = 0;

        var rvIdConceptoCab1 = 0;
        var rvIdConceptoCab2 = 0;
        var rrvIdConceptoCab3 = 0;

        var rvIdConceptoDet1 = 0;
        var rvIdConceptoDet2 = 0;
        var rvIdConceptoDet3 = 0;

        var rvConceptoDet1 = "";
        var rvConceptoDet2 = "";
        var rvConceptoDet3 = "";

        var rvChecked = false;

        var rdiasArray = [];
        var rentidadEditar = {};
        var rdiasArrayEditar = [];
        var rtipoMonedaArray = [];

        var rsumTotalDetalle = 0;

        var rvCodColSofya = "";
        var rvColaboradorSofya = "";

        var rvctpava_bnfcol = "";
        var rvcanvar_bnfcol = "";
        var rvcolaborador = "";

        var rvCodSede = "";

        var rsolicitudCabCreada = {};
        var riDetalle1 = 0;
        var riDetalle2 = 0;
        var riDetalle3 = 0;

        var riSecuencia1 = 0;
        var riSecuencia2 = 0;
        var riSecuencia3 = 0;

        var rproveedor = {};
        var rdetalleArray = [];
        var rdetalleArray3 = [];
        var rdetPlaMovdetPlaMov = {};

        var rdetComprobanteArray1 = [];
        var rdetComprobanteArray2 = [];
        var rdetComprobanteArray3 = [];

        var rconceptoDetalleArray1 = [];
        var rconceptoDetalleArray2 = [];
        var rconceptoDetalleArray3 = [];

        var rrconceptoCabeceraArray1 = [];
        var rrconceptoCabeceraArray2 = [];
        var rrconceptoCabeceraArray3 = [];

        var rconceptoCabArray1 = [];
        var rconceptoCabArray2 = [];
        var rconceptoCabArray3 = [];

        var rtabSeleccionado = 1; // 1: Factura y Boleta, 2: Planilla Movilidad, 3: Planilla de Movilidada

        var rTIPO_REGISTRO = "";
        var detalleSolicitudArrayResult = [];
        var rtiposComprobantesArray = [];
        var rswitch = false;

        // RENDICION DE GASTOS

        var zvTipoComprobante1 = [];

        var zsolicitudSeleccionada = {};
        var zvIdSolicitud = 0;
        var zvCeCo = 0;
        var zvIdRendCompte = 0;

        var ziDetalle1 = 0;
        var ziDetalle2 = 0;
        var ziDetalle3 = 0;

        var zproveedor = {};
        var zdetalleArray = [];
        var zdetalleArray3 = [];
        var zdetPlaMov = {};

        var zdetComprobanteArray1 = [];
        var zdetComprobanteArray2 = [];
        var zdetComprobanteArray3 = [];

        var ztabSeleccionado = 1; // 1: Factura y Boleta, 2: Planilla Movilidad, 3: Planilla de Movilidada

        var zlistaComptesIdTipoComp = 0;

        var zidsolicitud_dev = 0;
        var zidsecuencia_dev = 0;

        var zTIPO_REGISTRO = "";
        var ztiposComprobantesArray = [];

        var zswitch = false;


        $(document).ready(function () {

            Inicializar();

        });


        function Inicializar() {

            let now = new Date();

            // CON SOLICITUD

            let parametros = { nivelInterfaz: sNIVEL_INTERFAZ };
            sgetPermisosXCeCo(parametros);

            sgetDias();
            sgetTiposAnulacionCabecera();
            sgetSede();

            slimpiarCabecera();

            document.getElementById("sidtxtcodigo").focus();
            $("#sdtpFechaAplicacion").val(FormatoFecha(now,"-"));

            document.getElementById("sbtnAgregarDetalle").disabled = true;
            $("#sbtnAgregarDetalle").removeClass("btn-warning");
            $("#sbtnAgregarDetalle").addClass("btn-secondary");

            document.getElementById("sbtnGuardarCabecera").disabled = true;
            $("#sbtnGuardarCabecera").removeClass("btn-success");
            $("#sbtnGuardarCabecera").addClass("btn-secondary");

            document.getElementById("sbtnAnularSolicitud").disabled = true;
            $("#sbtnAnularSolicitud").removeClass("btn-danger");
            $("#sbtnAnularSolicitud").addClass("btn-secondary");

            document.getElementById("sbtnBuscarCodigo").disabled = true;
            $("#sbtnBuscarCodigo").removeClass("btn-primary");
            $("#sbtnBuscarCodigo").addClass("btn-secondary");


            document.getElementById("sidCbxTipo").disabled = true;
            document.getElementById("sidCbxTipoMod").disabled = true;
            document.getElementById("sidtxtaobs").disabled = true;
            document.getElementById("sdtpFechaAplicacion").disabled = true;
            document.getElementById("sbtnBuscarColaborador").disabled = true;



            // REEMBOLSO - SIN SOLICITUD

            let sparametros = { nivelInterfaz: rNIVEL_INTERFAZ };


            rvIdSolicitud = 0;

            let tabla = $("#rtblDetalle").DataTable();
            tabla.destroy();
            var tr = "";
            $("#rtblDetalleContent").html(tr);
            $("#rtblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                }
            );

            $("#restado-desc").text("");

            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-aprobado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-pendiente");

            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-aprobado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-pendiente");

            document.getElementById("ridtxtcodigo").disabled = false;
            document.getElementById("ridtxtcodigo").focus();

            document.getElementById("ridCbxSede").disabled = true;
            document.getElementById("ridCbxTipo").disabled = true;
            document.getElementById("ridCbxTipoMod").disabled = true;
            document.getElementById("ridtxtaobs").disabled = true;
            document.getElementById("rcbxCeCo1").disabled = true;


            $("#ridtxtcodigo").val("");
            $("#riddttFechaHora").val(new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().substring(0, 19).toString());

            document.getElementById("rbtnBuscarCodigo").disabled = true;
            $("#rbtnBuscarCodigo").removeClass("btn-primary");
            $("#rbtnBuscarCodigo").addClass("btn-secondary");

            document.getElementById("rbtnAnularSolicitud").disabled = true;
            $("#rbtnAnularSolicitud").removeClass("btn-danger");
            $("#rbtnAnularSolicitud").addClass("btn-secondary");

            document.getElementById("rbtnGenerarComprobante").disabled = true;
            $("#rbtnGenerarComprobante").removeClass("btn-success");
            $("#rbtnGenerarComprobante").addClass("btn-secondary");


            rlimpiarCabecera();

            rgetTipos();
            rgetPermisosXCeCo(sparametros);
            rgetUnidadesMedida();
            rgetPeriodos();
            rgetSede();

            document.getElementById("ridtxtcodigo").disabled = false;
            document.getElementById("ridtxtcodigo").focus();



            // RENDICION DE GASTOS

            zgetTipoComprobantes();
            zgetTipoMoneda();
            zgetUnidadesMedida();
            zgetPeriodos();

            $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
            $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
            $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");

            $("#ztxtCodigoModal3").val("0");
            $("#ztxtNumPlanillaModal2").val("0");
        }




        // *******  SOLICITUD DE GASTOS   *********

        // Funcionalidades.

        function svalidacionCabecera() {

            var respuesta = false;

            if (svIdSolicitud == 0) {

                if ($("#sidtxtcodigo").val().trim() != "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'No puede generar una solicitud nueva',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else if (svIdTipoMod == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione un Tipo de Moneda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#sidtxtaobs").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción de la solicitud por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (svIdTipo == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione el tipo de Solicitud, por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (svctpava_bnfcol == "" || svctpava_bnfcol == null || typeof (svctpava_bnfcol) == "undefined") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Registre el colaborador beneficierio',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (svCodSede == "" || svCodSede == null || typeof (svCodSede) == "undefined") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione la sede por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }

            }
            else {
                respuesta = true;
            }

            return respuesta;
        }

        function svalidacionDetalle() {

            let respuesta = true;
            let isFalseLoop = false;
            let cantConceptpDetArray = 0;


            cantConceptpDetArray = sconceptoDetArray.filter(x => x.isChecked == true).length;

            if (cantConceptpDetArray == 0 || cantConceptpDetArray == null || typeof (cantConceptpDetArray) == "undefined") {

                Swal.fire({
                    title: 'Seleccione un concepto, por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

                return false;
            }
            else if (svCodCeCo == 0 || svCodCeCo == null) {

                Swal.fire({
                    title: 'Seleccione un centro de costo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

                return false;
            }

            $("#sdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {

                let valorIngresado = $(obj).val();
                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                let nombreID = obj.id;
                let idConceptoDet = $(obj).attr("data-idconceptodet");

                let estaSeleccionado = sconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);


                if (typeof (estaSeleccionado) != "undefined") {

                    if (valorIngresado.toString().trim() == "" || valorIngresado == null || typeof (valorIngresado) == "undefined" || valorIngresado.toString().trim() == "0") {
                        Swal.fire({
                            title: 'Ingrese el monto por favor',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById(nombreID).focus();
                        isFalseLoop = true;
                        return false;

                    }
                    else if (parseFloat(valorIngresado) < 0) {

                        Swal.fire({
                            title: 'El monto ingresado no debe ser negativo',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById(nombreID).focus();
                        isFalseLoop = true;
                        return false;
                    }
                    else if (svIdTipoMod == 1) {

                        if (parseFloat(valorIngresado) > valorMaximoS) {
                            isFalseLoop = true;

                            $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                            //$("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString() + "").val(0);

                            valorActual = 0;


                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            return false;
                        }
                    }
                    else if (svIdTipoMod == 2) {
                        // DOLAR
                        if (parseFloat(valorIngresado) > valorMaximoD) {
                            isFalseLoop = true;

                            $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                            //$("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD.toString(),
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            return false;
                        }

                    }
                }

            });


            // Descripción obligatoria
            $("#sdetalleConceptoInsertarEditar input.cobsobligatorio").each(function (i, obj) {
                let obsIngresado = $(this).val();

                if (obsIngresado == "" || obsIngresado == null || typeof (obsIngresado) == "undefined") {
                    Swal.fire({
                        title: 'Debe ingresar una descripción para lo solicitado',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    isFalseLoop = true;
                    return false;
                }
            });



            if (isFalseLoop) {
                respuesta = false;
            }
            else {
                respuesta = true;
            }

            return respuesta;

        }

        function sgetTiposAnulacionCabecera() {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_TiposAnulacionCabecera',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    stiposAnulacionCabArray = data.lista;

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }


        // Listados.

        function sgetSede() {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_Sedes',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    $("#sidCbxSede").empty();
                    $.each(data.lista, function () {
                        $("#sidCbxSede").append($("<option/>").val(this.codSede).text(this.sede));
                    });
                    $("#sidCbxSede").val("C");
                    svCodSede = "C";

                    sgetTipoDeMoneda();
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sgetPermisosXCeCo(parametros) {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_PermisosXCeCo',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: parametros,
                success: function (data) {

                    let primerValorBool = true;
                    let primerValor = 0;

                    $("#sidmCbxCeCo").empty();

                    $.each(data.lista, function () {

                        if (primerValorBool) {
                            primerValor = this.codCeCo;
                            primerValorBool = false;
                        }

                        $("#sidmCbxCeCo").append($("<option/>").val(this.codCeCo).text(this.descripcion));
                    });

                    svCodCeCo = primerValor;
                    $("#sidmCbxCeCo").val(svCodCeCo);
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sgetConceptoCab(idSolicitud, idTipo) {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_ConceptoCab',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idSolicitud: idSolicitud, idTipo: idTipo },
                success: function (data) {

                    let primerValorBool = true;
                    let primerValor = 0;

                    $("#sidmCbxConcepCab").empty();

                    $.each(data.lista, function () {

                        if (primerValorBool) {
                            primerValor = this.idConceptoCab;
                            primerValorBool = false;
                        }

                        $("#sidmCbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                    });

                    svIdConcepCab = primerValor;
                    $("#sidmCbxConcepCab").val(primerValor);

                    sgetConceptoDet(svIdConcepCab);
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sgetDias() {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_Dias',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    sdiasArray = [];

                    $.each(data.lista, function () {
                        sdiasArray.push({ codDia: this.codDia, dia: this.dia });
                    });
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sgetTipoDeMoneda() {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_TiposDeMoneda',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    stipoMonedaArray = [];
                    stipoMonedaArray = data.lista;

                    $("#sidCbxTipoMod").empty();
                    $.each(data.lista, function () {
                        $("#sidCbxTipoMod").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    });
                    $("#sidCbxTipoMod").val(1);

                    svIdTipoMod = 1;

                    sgetTipos();
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sgetTipos() {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_Tipos',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    let primerValorBool = true;
                    let primerValor = 0;

                    $("#sidCbxTipo").empty();

                    $.each(data.lista, function () {

                        if (primerValorBool) {
                            primerValor = this.idTipo;
                            primerValorBool = false;
                        }
                        $("#sidCbxTipo").append($("<option/>").val(this.idTipo).text(this.tipo));
                    });
                    svIdTipo = primerValor;
                    $("#sidCbxTipo").val(primerValor);


                    // Definir la sede
                    if (svIdTipo == 1) {
                        $("#sidCbxSede").val("C");
                        svCodSede = "C";
                        document.getElementById("sidCbxSede").disabled = true;
                    }
                    else if (svIdTipo == 2) {
                        $("#sidCbxSede").val("L");
                        svCodSede = "L";
                        document.getElementById("sidCbxSede").disabled = true;
                    }
                    else {
                        document.getElementById("sidCbxSede").disabled = false;
                    }

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sgetListaDetalle(pidSolicitud) {

            $.ajax({
                type: "GET",
                url: '/finanzas/RG_SolicitudDet',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idSolicitud: pidSolicitud },
                success: function (data) {

                    if (data.isRedirect) {
                        window.location.href = data.redirectUrl;
                    }
                    else {
                        sgenerarTablaDetalle(data.lista);
                        sconceptoDetArray = [];
                    }
                },
                failure: function () {

                    Swal.fire({
                        icon: 'error',
                        title: 'Error al mostrar datos',
                        text: 'Textile Sourcing Company',
                        showConfirmButton: false,
                        timer: 2500,
                    });

                }
            });
        }

        function sajaxConceptoEdit(idSolicitud) {
            return $.ajax({
                type: "GET",
                url: "/Finanzas/RG_ConceptoCabEdit",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idSolicitud: idSolicitud }
            });
        }

        function sajaxDetalleEditar(idSolicitud, idConceptoCab) {
            return $.ajax({
                type: "GET",
                url: "/Finanzas/RG_DetalleEditar",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab }
            });
        }



        // Eventos Click

        $("#sbtnCancelar").click(function () {
            document.getElementById("sidmCbxCeCo").focus();
        });

        $("#sbtnGuardarCabecera").click(function () {

            $.ajax({
                url: "/finanzas/RG_TienePendienteRend",
                type: "GET",
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        if (resultado.estado == "N") {

                            if (svalidacionCabecera()) {

                                sswitchInsertarEditar = 1; // 1: Insertar

                                let codigoGenerado = $("#sidtxtcodigo").val();
                                let idTipo = $("#sidCbxTipo").val();

                                sgetConceptoCab(0, parseInt(idTipo));

                                $("#sidmcodigo").val(codigoGenerado);
                                document.getElementById("sidmCbxConcepCab").disabled = false;

                                $('#smodalSolDetInsertar').modal('show');
                            }
                        }
                        else {
                            Swal.fire({
                                title: 'Tiene rendiciones Pendientes',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });
                        }
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        });

        $("#sbtnGuardarCabecera_old").click(function () {

            if (svalidacionCabecera()) {

                let parametro = {
                    'opcion': 1,
                    'idSolicitud': 0,
                    'codigo': 0,
                    'idEmpresa': 1,
                    'idEstado': 10,
                    'idAnulado': 0,
                    'idTipoMod': svIdTipoMod,
                    'observacion': $("#sidtxtaobs").val().trim(),

                    'codCeCo': svCodCeCo,
                    'idConceptoDet': svIdConcepDet,
                    'valor': 0,
                    'secuencia': 0,
                    'usuario': USUARIO,
                    'usuarioCompleto': USUARIO_COMPLETO,
                    'nivelInterfaz': 0,
                    'idTipo': svIdTipo,
                    'seleccionadoDet': 0,
                    'idConceptoCab': 0,

                    'cantDias': 0,
                    'montoSolicitado': 0,
                    'observacionDet': '',
                    'ctpava_bnf': svctpava_bnfcol,
                    'canvar_bnf': svcanvar_bnfcol,
                    'colaborador': svcolaborador,

                    'codSede': svCodSede
                }

                $.ajax({
                    url: "/finanzas/RG_SetRendicionGastos",
                    type: "post",
                    data: parametro,
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            if (resultado.status.idResponse > 0) {
                                svIdSolicitud = resultado.status.idResponse;
                                svCodigo = resultado.responseEntity.codigo;

                                $("#siddttFechaHora").val(resultado.responseEntity.fechaEmision);
                                $("#sidtxtcodigo").val(resultado.responseEntity.codigo);
                                $("#sidtxtcodigo").addClass("sidtxtcodigo-ok");

                                document.getElementById("sidtxtcodigo").disabled = false;
                                document.getElementById("sidCbxTipo").disabled = true;
                                document.getElementById("sidCbxTipoMod").disabled = true;
                                document.getElementById("sidtxtaobs").disabled = true;
                                document.getElementById("sdtpFechaAplicacion").disabled = true;
                                document.getElementById("sbtnBuscarColaborador").disabled = true;

                                smensajePrincipal(true, resultado.status.statusResponse);
                                sestadoSolicitud(svIdSolicitud);

                                $("#sbtnGuardarCabecera").removeClass("btn-success");
                                $("#sbtnGuardarCabecera").addClass("btn-secondary");
                                document.getElementById("sbtnGuardarCabecera").disabled = true;

                                $("#sbtnAnularSolicitud").removeClass("btn-secondary");
                                $("#sbtnAnularSolicitud").addClass("btn-danger");
                                document.getElementById("sbtnAnularSolicitud").disabled = false;

                                $("#sbtnAgregarDetalle").removeClass("btn-secondary");
                                $("#sbtnAgregarDetalle").addClass("btn-warning");
                                document.getElementById("sbtnAgregarDetalle").disabled = false;
                                document.getElementById("sbtnAgregarDetalle").focus();

                                $("#sbtnNuevo").removeClass("btn-success");
                                $("#sbtnNuevo").addClass("btn-secondary");
                                document.getElementById("sbtnNuevo").disabled = true;


                                // Si to ha sido correcto mostrar registrar el detalle.


                            }
                            else {
                                smensajePrincipal(false, "Ocurrio un problema");
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });


            }
        });

        function sestadoSolicitud(pIdSolicitud) {
            $.ajax({
                url: "/finanzas/RG_estadoSolicitud",
                type: "GET",
                data: { idSolicitud: pIdSolicitud },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        $("#sestado-desc").text(resultado.entidad.estado);
                        sindicadorEstado(resultado.entidad.idEstado);
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                }
            });
        }



        $("#sbtnAgregarDetalle").click(function () {
            if (svalidarAgregarDetalle()) {
                sswitchInsertarEditar = 1; // 1: Insertar

                let codigoGenerado = $("#sidtxtcodigo").val();
                let idTipo = $("#sidCbxTipo").val();

                sgetConceptoCab(svIdSolicitud, idTipo);

                $("#sidmcodigo").val(codigoGenerado);
                document.getElementById("sidmCbxConcepCab").disabled = false;

                $('#smodalSolDetInsertar').modal('show');
            }
        });

        function svalidarAgregarDetalle() {
            let respuesta = false;
            let codigoGenerado = $("#sidtxtcodigo").val();

            if (svIdTipoMod == 0) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe seleccionar el tipo de Moneda',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            //else if (codigoGenerado == "" || codigoGenerado == null || typeof (codigoGenerado) == "undefined") {
            //    respuesta = false;
            //    Swal.fire({
            //        title: 'Debe Generar la cabecera de la Solicitud para continuar',
            //        text: "Textile Sourcing Company",
            //        icon: 'warning',
            //        showConfirmButton: true,
            //        confirmButtonColor: '#3085d6',
            //        confirmButtonText: 'Ok'
            //    });

            //}
            else {
                respuesta = true;
            }

            return respuesta;
        }

        $("#sbtnGuardarDetalle").click(function () {

            if (svIdSolicitud == 0) {
                sGuardarCabecera();
            }
            else {
                sGuardarDetalle();
            }

        });

        function sGuardarCabecera() {

            let parametro = {};

            if (svalidacionCabecera()) {

                if (svalidacionDetalle()) {

                    $("#sdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
                        let idConceptoDet = $(obj).attr("data-idconceptodet");
                        let estaSeleccionado = sconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);
                        if (typeof (estaSeleccionado) != "undefined") {
                            for (var i = 0; i < sconceptoDetArray.length; i++) {
                                if (sconceptoDetArray[i].isChecked == true && sconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                                    sconceptoDetArray[i].montoSolicitado = parseFloat($("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val());
                                    sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                                }
                            }
                        }
                    });

                    if (sswitchInsertarEditar == 1) {
                        // Insertar
                        sconceptoDetArray = sconceptoDetArray.filter(x => x.isChecked == true);
                    }


                    parametro = {

                        'opcion': 1,
                        'idSolicitud': 0,
                        'codigo': 0,
                        'idEmpresa': 1,
                        'idEstado': 0,
                        'idAnulado': 0,
                        'idTipoMod': svIdTipoMod,
                        'observacion': $("#sidtxtaobs").val().trim(),
                        'codCeCo': svCodCeCo,
                        'idConceptoDet': svIdConcepDet,
                        'valor': 0,
                        'usuario': USUARIO,
                        'usuarioCompleto': USUARIO_COMPLETO,
                        'nivelInterfaz': sNIVEL_INTERFAZ,
                        'idTipo': svIdTipo,
                        'seleccionadoDet': 0,
                        'idConceptoCab': 0,
                        'cantDias': 0,
                        'montoSolicitado': 0,
                        'observacionDet': '',
                        'ctpava_bnf': svctpava_bnfcol,
                        'canvar_bnf': svcanvar_bnfcol,
                        'colaborador': svcolaborador,
                        'codSede': svCodSede,
                        'fechaAplicacion': FormatoFecha($("#sdtpFechaAplicacion").val(),""),

                        'conceptoDetArray': sconceptoDetArray
                    }


                    $.ajax({
                        url: "/finanzas/RG_SetRendicionGastos",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.status.idResponse > 0) {

                                    svIdSolicitud = resultado.status.idResponse;
                                    svCodigo = resultado.responseEntity.codigo;

                                    $("#siddttFechaHora").val(resultado.responseEntity.fechaEmision);
                                    $("#sidtxtcodigo").val(resultado.responseEntity.codigo);
                                    $("#sidtxtcodigo").addClass("sidtxtcodigo-ok");

                                    document.getElementById("sidtxtcodigo").disabled = false;
                                    document.getElementById("sidCbxTipo").disabled = true;
                                    document.getElementById("sidCbxTipoMod").disabled = true;
                                    document.getElementById("sidtxtaobs").disabled = true;
                                    document.getElementById("sdtpFechaAplicacion").disabled = true;
                                    document.getElementById("sbtnBuscarColaborador").disabled = true;

                                    $("#sbtnGuardarCabecera").removeClass("btn-success");
                                    $("#sbtnGuardarCabecera").addClass("btn-secondary");
                                    document.getElementById("sbtnGuardarCabecera").disabled = true;

                                    $("#sbtnAnularSolicitud").removeClass("btn-secondary");
                                    $("#sbtnAnularSolicitud").addClass("btn-danger");
                                    document.getElementById("sbtnAnularSolicitud").disabled = false;

                                    $("#sbtnAgregarDetalle").removeClass("btn-secondary");
                                    $("#sbtnAgregarDetalle").addClass("btn-warning");
                                    document.getElementById("sbtnAgregarDetalle").disabled = false;
                                    document.getElementById("sbtnAgregarDetalle").focus();

                                    $("#sbtnNuevo").removeClass("btn-secondary");
                                    $("#sbtnNuevo").addClass("btn-success");
                                    document.getElementById("sbtnNuevo").disabled = false;

                                    $('#smodalSolDetInsertar').modal('hide');

                                    sconceptoDetArray = [];
                                    sestadoSolicitud(svIdSolicitud);
                                    sgetListaDetalle(svIdSolicitud);
                                    smensajePrincipal(true, resultado.status.statusResponse);
                                }
                                else {
                                    smensajePrincipal(false, resultado.status.statusResponse);
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }
            }
        }

        function sGuardarDetalle() {

            if (svalidacionDetalle()) {

                $("#sdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
                    let idConceptoDet = $(obj).attr("data-idconceptodet");
                    let estaSeleccionado = sconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);
                    if (typeof (estaSeleccionado) != "undefined") {
                        for (var i = 0; i < sconceptoDetArray.length; i++) {
                            if (sconceptoDetArray[i].isChecked == true && sconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                                sconceptoDetArray[i].montoSolicitado = parseFloat($("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val());
                                sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                            }
                        }
                    }
                });

                if (sswitchInsertarEditar == 1) {
                    // Insertar
                    sconceptoDetArray = sconceptoDetArray.filter(x => x.isChecked == true);
                }

                let parametro = {
                    'opcion': 2,
                    'idSolicitud': svIdSolicitud,
                    'codigo': 0,
                    'idEmpresa': 1,
                    'idEstado': 1,
                    'idAnulado': 0,
                    'idTipoMod': 0,
                    'observacion': '',
                    'codCeCo': svCodCeCo,
                    'idConceptoDet': svIdConcepDet,
                    'valor': $("#sidmvalor").val(),
                    'secuencia': 0,
                    'usuario': USUARIO,
                    'usuarioCompleto': USUARIO_COMPLETO,
                    'nivelInterfaz': 0,
                    'idTipo': parseInt($("#sidCbxTipo").val()),
                    'conceptoDetArray': sconceptoDetArray
                }



                $.ajax({
                    url: "/finanzas/RG_SetRendicionGastosDetalle",
                    type: "post",
                    data: parametro,
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {

                            $('#smodalSolDetInsertar').modal('hide');

                            if (resultado.status.idResponse > 0) {
                                smensajePrincipal(true, "Actualizando Detalle");
                            }
                            else {
                                smensajePrincipal(false, "Ocurrio un problema al agregar el motivo");
                            }

                            // Habilitar boton nuevo.
                            $("#sbtnNuevo").removeClass("btn-secondary");
                            $("#sbtnNuevo").addClass("btn-success");
                            document.getElementById("sbtnNuevo").disabled = false;

                            sgetListaDetalle(svIdSolicitud);
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });
            }

        }


        $("#sbtnNuevo").click(function () {
            sresetControles();

            $("#sidtxtcodigo").val("0");
            document.getElementById("sidtxtcodigo").disabled = true;
            document.getElementById("sidCbxTipo").focus();

            svalidarSedeYMonXTipo();
        });


        $("#stblDetalle").on('click', '.solicitudDetalleItem', function () {

            let idSolicitud = $(this).attr("data-idsolicitud");
            let idConceptoCab = $(this).attr("data-idconceptoCab");

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_SolicitudDetalle',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab },
                success: function (data) {

                    if (data.isRedirect) {
                        window.location.href = data.redirectUrl;
                    }
                    else {

                        let detHTML = "";
                        let checkeHTML = "";

                        $("#sdetalleConceptoVisualizar").empty();

                        $("#sidmdCodigo").val(data.entidad.codigo);
                        $("#sidmdConcepCab").val(data.entidad.conceptoCab);
                        $("#sidmdCeCo").val(data.entidad.ceco);


                        $.each(data.entidad.conceptoDetalle, function () {

                            detHTML += "<div class='row mt-1'>";

                            detHTML = detHTML + checkeHTML;

                            detHTML = detHTML + "<div class='col-2'>"
                                + "      <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                                + "</div>"
                                + "<div class='col-1'>"
                                + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + formatoNumero(this.montoSolicitado) + "</p>"
                                + "</div>"
                                + "<div class='col-4'>"
                                + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.observacionDet + "</p>"
                                + "</div>"
                                + "<div class='col-5'>"
                                + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                                + "</div> ";

                            detHTML = detHTML + "</div>";

                        });

                        $("#sdetalleConceptoVisualizar").html(detHTML);
                        $('#smodalSolDetVisualizar').modal('show');
                    }
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        });

        $("#stblDetalle").on('click', '.solicitudEditarItem', function () {

            let idSolicitud = $(this).attr("data-idsolicitud");
            let idConceptoCab = $(this).attr("data-idconceptoCab");

            svIdConcepCab = idConceptoCab
            sswitchInsertarEditar = 2; // 2: Editar

            $.when(sajaxConceptoEdit(idSolicitud), sajaxDetalleEditar(idSolicitud, idConceptoCab)).done(function (dataConcepto, dataDetalle) {

                sentidadEditar = {};

                if (dataConcepto.isRedirect) {
                    window.location.href = dataConcepto[0].redirectUrl;
                }
                else {

                    let detHTML = "";
                    let cbxDiasHTML = "";
                    let cantChecked = 0;
                    let primerLoopCbxDia = true;
                    let cantDiaSeleccionado = 0;
                    let cbxCantCptoHTML = "";

                    sdiasArrayEditar = [];
                    sentidadEditar = dataDetalle[0].entidad;
                    svCodCeCo = dataDetalle[0].entidad.codCeCo;
                    svIdSolicitud = dataDetalle[0].entidad.idSolicitud;

                    $("#sdetalleConceptoInsertarEditar").empty();


                    // Concepto
                    $("#sidmCbxConcepCab").empty();
                    $.each(dataConcepto[0].lista, function (i, objCab) {
                        $("#sidmCbxConcepCab").append($("<option/>").val(objCab.idConceptoCab).text(objCab.conceptoCab));
                    });


                    // Detalle

                    $.each(dataDetalle[0].entidad.conceptoDetalle, function (i, objDet) {

                        cbxDiasHTML = "";

                        $.each(sdiasArray, function (i, objDia) {
                            if (objDet.tieneDias == "S") {
                                if (objDia.codDia.toString() != "0") {
                                    if (primerLoopCbxDia) {
                                        cbxDiasHTML += "<option value='" + objDia.codDia + "' selected>" + objDia.dia + "</option>";
                                        cantDiaSeleccionado = objDia.codDia;
                                    }
                                    else {
                                        cbxDiasHTML += "<option value='" + objDia.codDia + "'>" + objDia.dia + "</option>";
                                    }
                                }
                            }
                            else if (objDet.tieneDias == "N") {
                                cbxDiasHTML = "<option value='1' selected>(SIN DIAS)</option>";
                                cantDiaSeleccionado = 1;
                            }
                        });


                        detHTML += "<div class='row mt-1'>";

                        if (objDet.existe == 0) {
                            checkeHTML = "<div class='col-1'>"
                                + "     <input type='checkbox' class='cseleccion'  data-tienedias='" + objDet.tieneDias + "'  data-id=" + objDet.idConceptoDet + " data-valor=" + objDet.montoSolicitado + " >"
                                + "</div>";

                            sconceptoDetArray.push({ idConceptoDet: objDet.idConceptoDet, seleccionadoDet: 0, codCeCo: svCodCeCo, isChecked: false, cantDias: objDet.cantDias, montoSolicitado: objDet.montoSolicitado, observacionDet: objDet.observacionDet });
                        }
                        else {
                            checkeHTML = "<div class='col-1'>"
                                + "     <input type='checkbox' class='cseleccion' data-id=" + objDet.idConceptoDet + " data-valor=" + objDet.montoSolicitado + "  checked='checked'>"
                                + "</div>";

                            sconceptoDetArray.push({ idConceptoDet: objDet.idConceptoDet, seleccionadoDet: 1, codCeCo: svCodCeCo, isChecked: true, cantDias: objDet.cantDias, montoSolicitado: objDet.montoSolicitado, observacionDet: objDet.observacionDet });

                            ssumTotalDetalle = ssumTotalDetalle + parseFloat(objDet.montoSolicitado * objDet.cantDias);
                            cantChecked++;
                        }

                        detHTML = detHTML + checkeHTML;

                        detHTML = detHTML
                            + "<div class='col-2'>"
                            + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + objDet.conceptoDet + "</p>"
                            + "</div>"

                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + objDet.idConceptoDet + "' min='0' data-valor-maxs = '" + objDet.montoMaximoS + "' data-valor-maxd = '" + objDet.montoMaximoD + "'  data-idconceptodet='" + objDet.idConceptoDet + "' value='" + objDet.montoSolicitado + "'>"
                            + "</div>"

                            + "<div class='col-2'>"
                            + "     <input class='form-control form-control-sm " + ((objDet.obligatorio == "N") ? " cobsnormal " : " cobsobligatorio ") + "' type='text' id='txtObsDet" + objDet.idConceptoDet + "' data-idconceptodet='" + objDet.idConceptoDet + "' value='" + objDet.observacionDet + "'>"
                            + "</div>"

                            + "<div class='col-3'>"
                            + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + objDet.consideracion + "</p>"
                            + "</div> "
                            + "<div class='col-2'>"


                        if (objDet.idConceptoDet == 1000) {
                            // 6: Pasaje interprovincial
                            cbxCantCptoHTML = "<select class='form-control form-control-sm cdias cbxDias" + objDet.idConceptoDet + "' data-valor-maxs = '" + objDet.montoMaximoS + "' data-valor-maxd = '" + objDet.montoMaximoD + "' data-id=" + objDet.idConceptoDet + "" + ((objDet.existe == 0 || objDet.tieneDias == 'N') ? " disabled " : " ") + ">"
                                + "<option value='1'>Un Viaje</option>"
                                + "<option value='2'>Dos Viajes</option>"
                                + "</select>";
                        }
                        else {
                            cbxCantCptoHTML = "<select class='form-control form-control-sm cdias cbxDias" + objDet.idConceptoDet + "' data-valor-maxs = '" + objDet.montoMaximoS + "' data-valor-maxd = '" + objDet.montoMaximoD + "' data-id=" + objDet.idConceptoDet + "" + ((objDet.existe == 0 || objDet.tieneDias == 'N') ? " disabled " : " ") + ">"
                                + cbxDiasHTML
                                + "</select>";
                        }

                        detHTML = detHTML + cbxCantCptoHTML;

                        cbxFinHtml = "</div>"
                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm txtTotalPed" + objDet.idConceptoDet + "' type='text' disabled>"
                            + "</div>"
                            + "</div>";

                        detHTML = detHTML + cbxFinHtml;


                        sdiasArrayEditar.push({ idConceptoDet: objDet.idConceptoDet, cantDias: objDet.cantDias });

                    });

                    if (cantChecked == dataDetalle[0].entidad.conceptoDetalle.length) {
                        $("#sseleccionar-todo").prop("checked", true);
                    }


                    let codigoGenerado = $("#sidtxtcodigo").val();

                    $("#sidmcodigo").val(codigoGenerado);
                    $("#sidmCbxConcepCab").val(sentidadEditar.idConceptoCab);
                    $("#sidmCbxCeCo").val(sentidadEditar.codCeCo);
                    svCodCeCo = sentidadEditar.codCeCo;

                    $("#sum-total-det").text(formatoNumero(ssumTotalDetalle * cantDiaSeleccionado));
                    $("#sdetalleConceptoInsertarEditar").html(detHTML);
                    $('#smodalSolDetInsertar').modal('show');

                }

            });

        });

        $("#stblDetalle").on('click', '.solicitudEliminarItem', function () {

            let idsolcitud = $(this).attr("data-idsolicitud");
            let idconceptocab = $(this).attr("data-idconceptocab");

            MostrarCarga("Eliminando registro...");

            Swal.fire({
                title: '¿Esta seguro de eliminar el registro?',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si',
                cancelButtonText: 'No'
            }).then((result) => {

                if (result.value) {

                    let parametro = {
                        'opcion': 3,
                        'idSolicitud': idsolcitud,
                        'codigo': 0,
                        'idEmpresa': 1,
                        'idEstado': 1,
                        'idAnulado': 0,
                        'idTipoMod': svIdTipoMod,
                        'observacion': '',

                        'codCeCo': svCodCeCo,
                        'idConceptoDet': svIdConcepDet,
                        'valor': 0,
                        'secuencia': 0,
                        'usuario': USUARIO,
                        'usuarioCompleto': USUARIO_COMPLETO,
                        'nivelInterfaz': 0,
                        'idTipo': svIdTipo,
                        'seleccionadoDet': 0,
                        'idConceptoCab': idconceptocab,
                        'observacionDet': "",
                        'ctpava_bnf': "",
                        'canvar_bnf': "",
                        'colaborador': ""
                    }


                    $.ajax({
                        url: "/finanzas/RG_EliminarSolicitud",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {
                            console.log(resultado);

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.status.idResponse > 0) {
                                    smensajePrincipal(true, "Item Eliminado Correctamente");
                                }
                                else {
                                    smensajePrincipal(false, "Ocurrio un problema");
                                }

                                sgetListaDetalle(svIdSolicitud);

                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                    sgetListaDetalle(svIdSolicitud);
                }
            })

        });

        $("#sbtnBuscar").click(function () {

            let fechaIni = $('#idfechaInicio').val();
            let fechaFin = $('#idfechaFin').val();

            if (fechaIni == null ||
                fechaFin == null ||
                typeof (fechaIni) == "undefined" ||
                typeof (fechaFin) == "undefined" ||
                fechaIni.trim() == "" ||
                fechaFin.trim() == "") {

                Swal.fire('Seleccione la fecha, por favor')
            }
            else {

                var datos =
                {
                    'fechaInicio': fechaIni,
                    'fechaFin': fechaFin
                }

                $.ajax({
                    type: "GET",
                    url: '/finanzas/RG_BuscarHistorial',
                    contentType: "application/json; charset=utf-8",
                    data: datos,
                    dataType: "json",
                    success: function (data) {

                        let tabla = $("#tblHistorial").DataTable();

                        tabla.destroy();
                        var tr = "";

                        data.lista.forEach((obj) => {

                            tr += "<tr> "
                                + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.codigo + "</td>"
                                + " <td> " + obj.observacion + "</td>"
                                + " <td> " + obj.estado + "</td>"
                                + " <td> " + obj.tipo + "</td>"
                                + " <td> " + obj.nivelAprob + "</td>"
                                + " <td> " + obj.moneda + "</td>"
                                + " <td> " + formatoNumero(obj.valor) + "</td>"
                                + "</tr>";
                        });

                        $("#tblHistorialContent").html(tr);


                        $("#tblHistorial").DataTable(
                            {
                                dom: 'Bfrtip',
                                buttons: [
                                    'copy', 'excel', 'pdf', 'print'
                                ],
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                            });

                    },
                    failure: function () {
                        console.error('error al cargar los periodos');
                    }
                });

            }

        });

        $("#sbtnBuscarCodigo").click(function () {
            slimpiarCabecera();


            document.getElementById("sbtnBuscarCodigo").disabled = true;
            $("#sbtnBuscarCodigo").removeClass("btn-primary");
            $("#sbtnBuscarCodigo").addClass("btn-secondary");

            document.getElementById("sidCbxTipo").disabled = true;
            document.getElementById("sidCbxTipoMod").disabled = true;
            document.getElementById("sidtxtaobs").disabled = true;
            document.getElementById("sdtpFechaAplicacion").disabled = true;
            document.getElementById("sbtnBuscarColaborador").disabled = true;

            svIdSolicitud = 0;
            $("#sidtxtcodigo").val("");

            $("#sbtnGuardarCabecera").removeClass("btn-success");
            $("#sbtnGuardarCabecera").addClass("btn-secondary");
            document.getElementById("sbtnGuardarCabecera").disabled = true;

            $("#sbtnAnularSolicitud").removeClass("btn-danger");
            $("#sbtnAnularSolicitud").addClass("btn-secondary");
            document.getElementById("sbtnAnularSolicitud").disabled = true;

            $("#sbtnAgregarDetalle").removeClass("btn-warning");
            $("#sbtnAgregarDetalle").addClass("btn-secondary");
            document.getElementById("sbtnAgregarDetalle").disabled = true;


            $("#sbtnNuevo").removeClass("btn-secondary");
            $("#sbtnNuevo").addClass("btn-success");
            document.getElementById("sbtnNuevo").disabled = false;

            let tabla = $("#stblDetalle").DataTable();
            tabla.destroy();
            var tr = "";
            $("#stblDetalleContent").html(tr);
            $("#stblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                }
            );

            $("#sestado-desc").text("");

            $("#sestado-icon").removeClass("icon-liberado");
            $("#sestado-icon").removeClass("icon-aprobado");
            $("#sestado-icon").removeClass("icon-rechazado");
            $("#sestado-icon").removeClass("icon-pendiente");

            $("#sestado-desc").removeClass("desc-est-liberado");
            $("#sestado-desc").removeClass("desc-est-aprobado");
            $("#sestado-desc").removeClass("desc-est-rechazado");
            $("#sestado-desc").removeClass("desc-est-pendiente");

            document.getElementById("sidtxtcodigo").disabled = false;
            document.getElementById("sidtxtcodigo").focus();
        });

        $("#sbtnAnularSolicitud").click(function () {
            var options = {};

            $.map(stiposAnulacionCabArray,
                function (o) {
                    options[o.id] = o.name;
                });

            Swal.fire({
                title: 'Seleccione el motivo de la Anulación de solicitud',
                icon: 'info',
                input: 'select',
                inputOptions: options,
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Ok'

            }).then((result) => {

                if (result.value) {

                    let parametro = {
                        'opcion': 8,
                        'opcionTipoAprob': 0,
                        'idSolicitud': parseInt(svIdSolicitud),
                        'secuencia': 0,
                        'valorEntrega': 0,
                        'usuario': USUARIO,
                        'nivelInterfaz': sNIVEL_INTERFAZ,
                        'idAnulado': parseInt(result.value),
                        'idAnuladoDet': 0
                    };

                    $.ajax({
                        url: "/finanzas/RG_AnularSolicitud",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.status.idResponse > 0) {
                                    smensajePrincipal(true, resultado.status.statusResponse);
                                }
                                else {
                                    smensajePrincipal(false, resultado.status.statusResponse);
                                }

                                document.getElementById("sbtnAgregarDetalle").disabled = true;
                                $("#sbtnAgregarDetalle").removeClass("btn-warning");
                                $("#sbtnAgregarDetalle").addClass("btn-secondary");

                                $("#sbtnGuardarCabecera").removeClass("btn-success");
                                $("#sbtnGuardarCabecera").addClass("btn-secondary");
                                document.getElementById("sbtnGuardarCabecera").disabled = true;

                                $("#sbtnAnularSolicitud").addClass("btn-secondary");
                                $("#sbtnAnularSolicitud").removeClass("btn-danger");
                                document.getElementById("sbtnAnularSolicitud").disabled = true;

                                $("#sbtnNuevo").addClass("btn-success");
                                $("#sbtnNuevo").removeClass("btn-secondary");
                                document.getElementById("sbtnNuevo").disabled = false;

                                $("#sbtnBuscarCodigo").addClass("btn-primary");
                                $("#sbtnBuscarCodigo").removeClass("btn-secondary");
                                document.getElementById("sbtnBuscarCodigo").disabled = true;

                                MostrarCarga("Actualizando...");
                                slistarBusquedaXCodigo(svCodigo);
                                sconceptoDetArray = [];
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }

            });

        });



        // Otros Eventos

        $('#sidCbxTipoMod').change(function () {
            var $option = $(this).find('option:selected');
            svIdTipoMod = parseInt($option.val());
        });

        $('#sidCbxSede').change(function () {
            var $option = $(this).find('option:selected');
            svCodSede = $option.val();
        });

        $('#sidmCbxCeCo').change(function () {
            var $option = $(this).find('option:selected');
            svCodCeCo = parseInt($option.val());
            for (var i = 0; i < sconceptoDetArray.length; i++) {
                sconceptoDetArray[i].codCeCo = svCodCeCo;
            }
        });

        $('#idmCbxConcepDet').change(function () {
            let $option = $(this).find('option:selected');
            let consideracion = $option.attr("data-consideracion");

            svIdConcepDet = $option.val().toString();

            $("#idmConcepDetConsid").text(consideracion);
        });

        $('#sidCbxTipo').change(function () {

            var $option = $(this).find('option:selected');
            svIdTipo = parseInt($option.val());

            svalidarSedeYMonXTipo();
        });

        function svalidarSedeYMonXTipo() {

            let v_tipo = $("#sidCbxTipo").val();

            if (v_tipo != null && v_tipo != "" && typeof (v_tipo) != "undefined") {

                // Definir el tipo de moneda
                if (v_tipo.toString() == "1" || v_tipo.toString() == "2") {
                    $("#sidCbxTipoMod").val(1);
                    svIdTipoMod = $("#sidCbxTipoMod").val();

                    document.getElementById("sidCbxTipoMod").disabled = true;
                }
                else if (v_tipo.toString() == "3") {
                    document.getElementById("sidCbxTipoMod").disabled = false;
                }

                // Definir la sede
                if (v_tipo.toString() == "1") {
                    $("#sidCbxSede").val("C");
                    svCodSede = "C";
                    document.getElementById("sidCbxSede").disabled = true;
                }
                else if (v_tipo.toString() == "2") {
                    $("#sidCbxSede").val("L");
                    svCodSede = "L";
                    document.getElementById("sidCbxSede").disabled = true;
                }
                else {
                    document.getElementById("sidCbxSede").disabled = false;
                }


            }

        }

        $('#sidtxtcodigo').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            if (keycode == '13') {

                let codigo = $("#sidtxtcodigo").val().trim();

                if (codigo == "") {
                    Swal.fire({
                        title: 'Ingrese un código',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            document.getElementById("sidtxtcodigo").focus();
                        }
                    });
                }
                else if (codigo.length < 10 || codigo.length > 10) {
                    Swal.fire({
                        title: 'Ingrese un código',
                        title: 'Ingrese un código valido por favor',
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            document.getElementById("sidtxtcodigo").focus();
                        }
                    });
                }
                else {

                    MostrarCarga("Buscando...");

                    slistarBusquedaXCodigo(codigo);
                }

            }
        });


        function sresetControles() {
            slimpiarCabecera();


            document.getElementById("sbtnAnularSolicitud").disabled = true;
            $("#sbtnAnularSolicitud").removeClass("btn-danger");
            $("#sbtnAnularSolicitud").addClass("btn-secondary");

            document.getElementById("sbtnBuscarCodigo").disabled = false;
            $("#sbtnBuscarCodigo").removeClass("btn-secondary");
            $("#sbtnBuscarCodigo").addClass("btn-primary");

            document.getElementById("sidCbxTipo").disabled = false;
            document.getElementById("sidtxtaobs").disabled = false;
            document.getElementById("sdtpFechaAplicacion").disabled = false;
            document.getElementById("sbtnBuscarColaborador").disabled = false;

            $("#sidusuario").val(USUARIO_COMPLETO);

            let now = new Date();
            $("#siddttFechaHora").val(new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().substring(0, 19).toString());

            document.getElementById("sbtnGuardarCabecera").disabled = false;
            $("#sbtnGuardarCabecera").removeClass("btn-secondary");
            $("#sbtnGuardarCabecera").addClass("btn-success");

            document.getElementById("sbtnAgregarDetalle").disabled = true;
            $("#sbtnAgregarDetalle").removeClass("btn-warning");
            $("#sbtnAgregarDetalle").addClass("btn-secondary");

            $("#skpi-cantidad").text("0");
            $("#skpi-total").text("0");

            sconceptoDetArray = [];
            let tabla = $("#stblDetalle").DataTable();
            tabla.destroy();
            var tr = "";
            $("#stblDetalleContent").html(tr);
            $("#stblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                }
            );
            $("#sestado-desc").text("");

            $("#sestado-icon").removeClass("icon-liberado");
            $("#sestado-icon").removeClass("icon-aprobado");
            $("#sestado-icon").removeClass("icon-rechazado");
            $("#sestado-icon").removeClass("icon-pendiente");

            $("#sestado-desc").removeClass("desc-est-liberado");
            $("#sestado-desc").removeClass("desc-est-aprobado");
            $("#sestado-desc").removeClass("desc-est-rechazado");
            $("#sestado-desc").removeClass("desc-est-pendiente");

        }

        function slimpiarCabecera() {
            let now = new Date();

            svIdSolicitud = 0;

            $("#siddttFechaHora").val("");
            $("#sidtxtcodigo").val("");
            $("#sidtxtcodigo").removeClass("sidtxtcodigo-ok");
            $("#sidCbxTipoMod").val(1);
            $("#sidtxtaobs").val("");
            $("#sdtpFechaAplicacion").val(FormatoFecha(now,"-"));
            $("#sidusuario").val("");
            $("#stxtcolaborador").val("");

            svctpava_bnfcol = "";
            svcanvar_bnfcol = "";
            $("#stxtcolaborador").val("");
        }

        function slimpiarDetalle() {

            $("#sidmcodigo").val("");
            $("#sidmCbxConcepCab").val("0");

            $("#idmCbxConcepDet").val(0);
            $("#idmConcepDetConsid").text("");

            $("#sidmCbxConcepCab").prop("disabled", false);
            //$("#sidmCbxCeCo").val(0);
            $("#idmCbxDias").val(1);
            $("#sum-total-det").text("0.00");

            $("#sseleccionar-todo").prop("checked", false);

            $("#sdetalleConceptoInsertarEditar").empty();
            $("#listDetalleConcept").empty();

            sconceptoDetArray = [];
            ssumTotalDetalle = 0;
        }

        function sgenerarTablaDetalle(lista, idEstado) {

            let vTotal = 0;
            let tabla = $("#stblDetalle").DataTable();
            tabla.destroy();
            var tr = "";
            lista.forEach((obj) => {

                vTotal = vTotal + obj.valor;

                tr += "<tr> "
                    + " <td> </td> "
                    + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td> "
                    + " <td>" + obj.codigo + "</td> "
                    + " <td>" + obj.fecha + "</td>"
                    + " <td>" + obj.tipo + "</td>"
                    + " <td>" + obj.estados + "</td>"
                    + " <td>" + obj.ceco + "</td> "
                    + " <td class='th-concepto'>" + obj.conceptoCab + "</td>"
                    + " <td>" + obj.tipoMoneda + "</td> "
                    + " <td>" + formatoNumero(obj.valor) + "</td> "
                    + " <td class='text-center'>"
                    + "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-primary solicitudDetalleItem'><i class='fas fa-eye'></i></button>"
                    + "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-success ml-1 solicitudEditarItem' " + obj.disabledhtml + "><i class='fas fa-edit'></i></button>"
                    + "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-danger ml-1 solicitudEliminarItem' " + obj.disabledhtml + "><i class='fas fa-trash'></i></button>"
                    + " </td>"
                    + "</tr>";
            });


            $("#skpi-cantidad").text(lista.length.toString());
            $("#skpi-total").text(formatoNumero(vTotal).toString());

            $("#stblDetalleContent").html(tr);

            $("#stblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                }
            );

            tabla.columns.adjust().draw();
        }

        function slistarBusquedaXCodigo(codigo) {

            $.ajax({
                url: "/finanzas/RG_SolicitudXCodigo",
                type: "GET",
                data: { 'codigo': codigo, 'tipoInterfaz': 'CONSOLICITUD' },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        if (resultado.entidad.idSolicitud > 0) {

                            svIdSolicitud = resultado.entidad.idSolicitud;
                            svCodigo = resultado.entidad.codigo;
                            svIdTipoMod = resultado.entidad.idTipoMod;

                            $("#sidtxtcodigo").val(resultado.entidad.codigo);
                            $("#sidtxtcodigo").addClass("sidtxtcodigo-ok");
                            $("#siddttFechaHora").val(resultado.entidad.fecha);
                            $("#sidusuario").val(resultado.entidad.usuSolicitante);
                            $("#sidCbxTipo").val(resultado.entidad.idTipo);
                            $("#sidCbxTipoMod").val(resultado.entidad.idTipoMod);
                            $("#sidtxtaobs").val(resultado.entidad.observacion);
                            $("#sdtpFechaAplicacion").val(resultado.entidad.fechaAplicacion);

                            svctpava_bnfcol = resultado.entidad.ctpava_bnf;
                            svcanvar_bnfcol = resultado.entidad.canvar_bnf;
                            svcolaborador = resultado.entidad.colaborador;

                            $("#stxtcolaborador").val(resultado.entidad.colaborador);

                            $("#sestado-desc").text(resultado.entidad.estado);

                            sindicadorEstado(resultado.entidad.idEstado);

                            $("#sbtnGuardarCabecera").removeClass("btn-success");
                            $("#sbtnGuardarCabecera").addClass("btn-secondary");
                            document.getElementById("sbtnGuardarCabecera").disabled = true;


                            // Si tiene estado mayor a 0, tiene aprobación
                            if (resultado.entidad.idEstado > 10) {
                                document.getElementById("sbtnAgregarDetalle").disabled = true;
                                $("#sbtnAgregarDetalle").removeClass("btn-warning");
                                $("#sbtnAgregarDetalle").addClass("btn-secondary");

                                $("#sbtnAnularSolicitud").removeClass("btn-danger");
                                $("#sbtnAnularSolicitud").addClass("btn-secondary");
                                document.getElementById("sbtnAnularSolicitud").disabled = true;
                            }
                            else {

                                $("#sbtnAgregarDetalle").removeClass("btn-secondary");
                                $("#sbtnAgregarDetalle").addClass("btn-warning");
                                document.getElementById("sbtnAgregarDetalle").disabled = false;
                                document.getElementById("sbtnAgregarDetalle").focus();

                                $("#sbtnAnularSolicitud").removeClass("btn-secondary");
                                $("#sbtnAnularSolicitud").addClass("btn-danger");
                                document.getElementById("sbtnAnularSolicitud").disabled = false;
                            }

                            if (resultado.entidad.listaDetalle.length > 0) {
                                sgenerarTablaDetalle(resultado.entidad.listaDetalle, resultado.entidad.idEstado);
                            }
                            else {

                                let tabla = $("#stblDetalle").DataTable();
                                tabla.destroy();
                                var tr = "";
                                $("#stblDetalleContent").html(tr);
                                $("#stblDetalle").DataTable(
                                    {
                                        'language': { 'url': '/libs/datatables/spanish.json' },
                                        lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                                    }
                                );

                                $("#skpi-cantidad").text("0");
                                $("#skpi-total").text("0");

                                ssumTotalDetalle = 0;
                            }

                            smensajePrincipal(true, "Mostrando Solicitud");
                        }
                        else {
                            smensajePrincipal(false, "Solicitud no encontrada");

                            sresetControles();

                            $("#sidtxtcodigo").val("");
                            document.getElementById("sidtxtcodigo").disabled = false;
                            document.getElementById("sidCbxTipo").disabled = true;
                            document.getElementById("sidCbxTipoMod").disabled = true;
                            document.getElementById("sidtxtaobs").disabled = true;
                            document.getElementById("sdtpFechaAplicacion").disabled = true;
                            document.getElementById("sbtnBuscarColaborador").disabled = true;

                            document.getElementById("sbtnGuardarCabecera").disabled = true;
                            $("#sbtnGuardarCabecera").removeClass("btn-success");
                            $("#sbtnGuardarCabecera").addClass("btn-secondary");

                            document.getElementById("sbtnBuscarCodigo").disabled = true;
                            $("#sbtnBuscarCodigo").removeClass("btn-primary");
                            $("#sbtnBuscarCodigo").addClass("btn-secondary");

                            document.getElementById("sidtxtcodigo").focus();
                        }
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });

        }

        $('#sdetalleConceptoInsertarEditar').on('click', '.cseleccion', function (e) {

            let inputCheck = $(this);
            let idConceptoDet = $(this).attr("data-id");
            let tienedias = $(this).attr("data-tienedias");
            let valorPre = "";
            let valor = 0;

            if (inputCheck.is(":checked")) {


                for (var i = 0; i < sconceptoDetArray.length; i++) {
                    if (sconceptoDetArray[i].idConceptoDet == idConceptoDet) {

                        sconceptoDetArray[i].seleccionadoDet = 1;
                        sconceptoDetArray[i].isChecked = true;

                        if (tienedias == "S") {
                            $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                        }
                        else if (tienedias == "N") {
                            $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                        }


                        valorPre = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                        if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                            valor = 0;
                        }
                        else {
                            valor = parseFloat(valorPre);
                        }

                        $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val((valor * parseFloat(sconceptoDetArray[i].cantDias)));
                        ssumTotalDetalle = ssumTotalDetalle + (valor * parseFloat(sconceptoDetArray[i].cantDias));
                    }
                }

            } else {
                for (var i = 0; i < sconceptoDetArray.length; i++) {


                    if (sconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        sconceptoDetArray[i].seleccionadoDet = 0;
                        sconceptoDetArray[i].isChecked = false;
                        sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();

                        valorPre = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                        if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                            valor = 0;
                        }
                        else {
                            valor = parseFloat(valorPre);
                        }

                        $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val("0");
                        ssumTotalDetalle = ssumTotalDetalle - valor * parseFloat(sconceptoDetArray[i].cantDias);
                    }
                }

                if (tienedias == "S") {
                    $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                }
                else if (tienedias == "N") {
                    $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                }
            }

            if (sconceptoDetArray.filter(x => x.isChecked == true).length == sconceptoDetArray.length) {
                $("#sseleccionar-todo").prop("checked", true);
            }
            else {
                $("#sseleccionar-todo").prop("checked", false);
            }

            $("#sum-total-det").text(formatoNumero(ssumTotalDetalle));
        });

        $('#smodalSolDetInsertar').on('click', '#sseleccionar-todo', function (e) {
            let idConceptoDet = 0;
            var inputCheck = $(this);
            var tieneDias = "";
            ssumTotalDetalle = 0;

            let valorPre = "";
            let valor = 0;

            if (inputCheck.is(":checked")) {

                let valorXConceptDet = 0;

                $("#sdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                    idConceptoDet = $(this).attr("data-id");
                    tieneDias = $(this).attr("data-tienedias");
                    valorXConceptDet = 0;
                    // kkkkk
                    if (sconceptoDetArray[i].idConceptoDet == idConceptoDet) {

                        sconceptoDetArray[i].seleccionadoDet = 1;
                        sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                    }

                    sconceptoDetArray[i].isChecked = true;

                    valorPre = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valor = 0;
                    }
                    else {
                        valor = parseFloat(valorPre);
                    }

                    $(this).prop("checked", true);

                    // Servicio y Otros
                    if (tieneDias == "N") {
                        $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                    }
                    else if (tieneDias == "S") {
                        $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                    }


                    $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val(parseFloat(valor) * sconceptoDetArray[i].cantDias);
                    valorXConceptDet = parseFloat(valor) * sconceptoDetArray[i].cantDias;

                    ssumTotalDetalle = ssumTotalDetalle + valorXConceptDet;
                });

            } else {
                $("#sdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                    idConceptoDet = $(this).attr("data-id");

                    if (sconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        sconceptoDetArray[i].seleccionadoDet = 0;
                        sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                    }

                    sconceptoDetArray[i].isChecked = false;
                    $(this).prop("checked", false);


                    if (tieneDias == "N") {
                        $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                    }
                    else if (tieneDias == "S") {
                        $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                    }


                    $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val("0");
                    ssumTotalDetalle = 0;
                });
            }

            $("#sum-total-det").text(formatoNumero(ssumTotalDetalle));
        });

        $('#sidmCbxConcepCab').change(function () {
            var $option = $(this).find('option:selected');
            svIdConcepCab = $option.val().toString();

            if (svIdConcepCab != 0 && svIdConcepCab != null && typeof (svIdConcepCab) != "undefined") {

                ssumTotalDetalle = 0;
                sconceptoDetArray = [];

                $("#sum-total-det").text(formatoNumero(ssumTotalDetalle));
                sgetConceptoDet(svIdConcepCab);

            }
        });

        $('#sdetalleConceptoInsertarEditar').on('change', '.cdias', function (e) {

            ssumTotalDetalle = 0;

            $("#sdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {

                let valorPre = "";
                let valorActual = 0;

                let idConceptoDetCheckbox = $(obj).attr("data-id");
                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                if (sconceptoDetArray[i].isChecked == true) {

                    sconceptoDetArray[i].seleccionadoDet = 1;
                    sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    sconceptoDetArray[i].montoSolicitado = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();

                    valorPre = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valorActual = 0;
                    }
                    else {
                        valorActual = parseFloat(valorPre);
                    }

                    // SOLES
                    if (svIdTipoMod == 1) {

                        if (valorActual > parseFloat(valorMaximoS)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        ssumTotalDetalle = ssumTotalDetalle + (valorActual * parseFloat(sconceptoDetArray[i].cantDias));
                        $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(sconceptoDetArray[i].cantDias)));

                    }
                    else if (svIdTipoMod == 2) {
                        // DOLAR

                        if (valorActual > parseFloat(valorMaximoD)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD.toString(),
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        ssumTotalDetalle = ssumTotalDetalle + (valorActual * parseFloat(sconceptoDetArray[i].cantDias));
                        $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(sconceptoDetArray[i].cantDias)));
                    }
                }
                else {

                    sconceptoDetArray[i].seleccionadoDet = 0;
                    sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();
                }
            });

            $("#sum-total-det").text(formatoNumero(ssumTotalDetalle));

        });

        $('#smodalSolDetInsertar').on('shown.bs.modal', function (e) {

            let idConceptoDet = 0;
            let primerCantDias = 0;
            let primerLoopCbxDia = true;

            if (sswitchInsertarEditar == 2) {

                $("#sdetalleConceptoInsertarEditar .cdias").each(function (i, obj) {

                    $("#sidmCbxConcepCab").prop("disabled", true);
                    idConceptoDet = $(obj).attr("data-id");

                    $.each(sdiasArray, function () {
                        if (primerLoopCbxDia) {
                            primerCantDias = this.codDia;
                        }
                        primerLoopCbxDia = false;
                    });

                    let dias = sdiasArrayEditar.find(x => x.idConceptoDet == idConceptoDet).cantDias;

                    if (dias > 0) {
                        $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(dias);

                    }
                    else {
                        $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(primerCantDias);
                    }

                });


                sactualizarTotales();
            }

        });

        $("#sdetalleConceptoInsertarEditar").on("keyup", ".cmontosolicitar", function () {

            if ($(this).val().trim() != "" && $(this).val().trim() != "0") {
                ssumTotalDetalle = 0;

                $("#sdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {

                    idConceptoDet = $(obj).attr("data-idconceptodet");

                    for (var j = 0; j < sconceptoDetArray.length; j++) {

                        if (sconceptoDetArray[j].idConceptoDet.toString() == idConceptoDet && sconceptoDetArray[j].isChecked == true) {

                            let valorMaximoS = $(obj).attr("data-valor-maxs");
                            let valorMaximoD = $(obj).attr("data-valor-maxd");
                            let cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                            let valorActual = 0;


                            if ($(obj).val() == null || typeof ($(obj).val()) == "undefined" || $(obj).val().trim() == "") {
                                valorActual = 0;
                            }
                            else {
                                valorActual = parseFloat($(obj).val());
                            }

                            // SOLES
                            if (svIdTipoMod == 1) {
                                if (valorActual > parseFloat(valorMaximoS)) {

                                    $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                    valorActual = 0;

                                    Swal.fire({
                                        title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                                        text: "Textile Sourcing Company",
                                        icon: 'warning',
                                        showConfirmButton: true,
                                        confirmButtonColor: '#3085d6',
                                        confirmButtonText: 'Ok'
                                    });

                                    document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                                }

                            }
                            else if (svIdTipoMod == 2) {
                                // DOLAR

                                if (valorActual > parseFloat(valorMaximoD)) {

                                    $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                    valorActual = 0;

                                    Swal.fire({
                                        title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD.toString(),
                                        text: "Textile Sourcing Company",
                                        icon: 'warning',
                                        showConfirmButton: true,
                                        confirmButtonColor: '#3085d6',
                                        confirmButtonText: 'Ok'
                                    });

                                    document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                                }
                            }

                            ssumTotalDetalle = ssumTotalDetalle + (valorActual * parseFloat(cantDias));
                            $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val((valorActual * parseFloat(cantDias)));

                            $("#sum-total-det").text(formatoNumero(ssumTotalDetalle));
                        }

                    }
                });

            }
        });

        $("#sbtnBuscarColaborador").click(function () {
            $("#smodalColaboradorSofya").modal("show");
        });

        $('#sidBusquedaColaborador').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            let filtro = $("#sidBusquedaColaborador").val();

            if (keycode == '13') {

                if (filtro == "") {
                    Swal.fire({
                        title: 'Ingrese el filtro para la busqueda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            document.getElementById("sidBusquedaColaborador").focus();
                        }
                    });
                }
                else {

                    $.ajax({
                        url: "/finanzas/RG_ColaboradorSofya",
                        type: "GET",
                        data: { 'filtro': filtro, 'nivelInterfaz': sNIVEL_INTERFAZ },
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                let tabla = $("#stblColaborador").DataTable();

                                tabla.destroy();
                                var tr = "";

                                resultado.lista.forEach((obj) => {

                                    tr += "<tr> "
                                        + " <td> " + obj.codsofya + "</td>"
                                        + " <td> " + obj.colaborador + "</td>"
                                        + " <td class='text-center'>"
                                        + "     <button data-ctpava='" + obj.ctpava + "' data-canvar='" + obj.canvar + "' data-codsofya='" + obj.codsofya + "' data-colaborador='" + obj.colaborador + "' data-toggle='collapse' data-codceco = '" + obj.codceco + "'  class='btn btn-sm btn-success cseleccionar ml-1'><i class='fas fa-check'></i></button>"
                                        + "</td>"
                                        + "</tr>";
                                });

                                $("#stblColaboradorContent").html(tr);

                                $("#stblColaborador").DataTable(
                                    {
                                        searching: false,
                                        paging: false,
                                        info: false,
                                        "scrollY": "250px",
                                        "scrollCollapse": true,
                                        'language': { 'url': '/libs/datatables/spanish.json' },
                                        lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                                    });

                                tabla.columns.adjust().draw();

                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }

            }
        });

        $('#stblColaborador').on('click', '.cseleccionar', function (e) {

            svCodColSofya = $(this).attr("data-codsofya");
            ssvcolaboradorSofya = $(this).attr("data-colaborador");
            svctpava_bnfcol = $(this).attr("data-ctpava");
            svcanvar_bnfcol = $(this).attr("data-canvar");
            svCodCeCo = $(this).attr("data-codceco");

            $("#sidmCbxCeCo").val(svCodCeCo);
            svcolaborador = $.trim(ssvcolaboradorSofya);
            $("#stxtcolaborador").val($.trim(ssvcolaboradorSofya));

            $("#smodalColaboradorSofya").modal("hide");
            document.getElementById("sidmCbxCeCo").disabled = true;

        });

        function smensajePrincipal(estado, mensaje) {
            if (estado == true) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: mensaje
                });

            }
            else if (estado == false) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'error',
                    title: mensaje
                });

            }
        }


        // Funciones Generales

        function formatoNumero(x) {
            x = x.toFixed(2);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function sgetConceptoDet(idConceptoCab) {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_ConceptoDetalleInsertar',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idConceptoCab: idConceptoCab },
                success: function (data) {

                    $("#sdetalleConceptoInsertarEditar").empty();

                    let detHTML = "";
                    let cbxDiasHTML = "";
                    let cbxCantCptoHTML = "";
                    let cbxFinHtml = "";

                    let primerLoopCbxDia = true;
                    let cantDiaSeleccionado = 0;
                    sconceptoDetArray = [];


                    $.each(data.lista, function (i, obj) {

                        cbxDiasHTML = "";

                        $.each(sdiasArray, function (i, objDia) {

                            if (obj.tieneDias == "S") {
                                if (objDia.codDia.toString() != "0") {
                                    if (primerLoopCbxDia) {
                                        cbxDiasHTML += "<option value='" + objDia.codDia + "' selected>" + objDia.dia + "</option>";
                                        cantDiaSeleccionado = objDia.codDia;
                                    }
                                    else {
                                        cbxDiasHTML += "<option value='" + objDia.codDia + "'>" + objDia.dia + "</option>";
                                    }
                                }
                            }
                            else if (obj.tieneDias == "N") {
                                cbxDiasHTML = "<option value='1' selected>(SIN DIAS)</option>";
                                cantDiaSeleccionado = 1;
                            }

                            primerLoopCbxDia = false;
                        });



                        detHTML += "<div class='row mt-1'>"
                            + "<div class='col-1'>"
                            + "     <input type='checkbox' class='cseleccion' data-tienedias='" + obj.tieneDias + "' data-id=" + obj.idConceptoDet + " data-valor=" + obj.montoMaximo + "  data-valor-maxs = '" + obj.montoMaximoS + "' data-valor-maxd='" + obj.montoMaximoD + "'  >"
                            + "</div>"
                            + "<div class='col-2'>"
                            + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + obj.conceptoDet + "</p>"
                            + "</div>"
                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + obj.idConceptoDet + "' min='0' max='" + obj.montoMaximo + "' data-idconceptodet='" + obj.idConceptoDet + "' data-valor-maxs = '" + obj.montoMaximoS + "' data-valor-maxd='" + obj.montoMaximoD + "'>"
                            + "</div>"
                            + "<div class='col-2'>"
                            + "     <input class='form-control form-control-sm " + ((obj.obligatorio == "N") ? " cobsnormal " : " cobsobligatorio ") + "' type='text' id='txtObsDet" + obj.idConceptoDet + "' data-idconceptodet='" + obj.idConceptoDet + "'>"
                            + "</div>"
                            + "<div class='col-3'>"
                            + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + obj.consideracion + "</p>"
                            + "</div>"
                            + "<div class='col-2'>";


                        if (this.idConceptoDet == 1000) {
                            // 6: Pasaje interprovincial
                            cbxCantCptoHTML = "<select class='form-control form-control-sm cdias cbxDias" + obj.idConceptoDet + "' data-id=" + obj.idConceptoDet + " data-valor-maxs = '" + obj.montoMaximoS + "' data-valor-maxd='" + obj.montoMaximoD + "' disabled>"
                                + "<option value='1'>Un Viaje</option>"
                                + "<option value='2'>Dos Viajes</option>"
                                + "</select>";
                        }
                        else {
                            cbxCantCptoHTML = "<select class='form-control form-control-sm cdias cbxDias" + obj.idConceptoDet + "' data-id=" + obj.idConceptoDet + " data-valor-maxs = '" + obj.montoMaximoS + "' data-valor-maxd='" + obj.montoMaximoD + "'  " + ((obj.tieneDias == 'N') ? " disabled " : " ") + ">"
                                + cbxDiasHTML
                                + "</select>";
                        }

                        detHTML = detHTML + cbxCantCptoHTML;

                        cbxFinHtml = "</div>"
                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm txtTotalPed" + obj.idConceptoDet + "' type='text' disabled>"
                            + "</div>"
                            + "</div>";

                        detHTML = detHTML + cbxFinHtml;

                        //ssumTotalDetalle = ssumTotalDetalle + parseFloat(this.montoMaximo);
                        ssumTotalDetalle = 0;
                        sconceptoDetArray.push({ idConceptoDet: obj.idConceptoDet, seleccionadoDet: 1, codCeCo: svCodCeCo, isChecked: false, cantDias: cantDiaSeleccionado, montoSolicitado: 0, observacionDet: obj.observacionDet });
                    });

                    $("#sseleccionar-todo").prop("checked", false);
                    $("#sdetalleConceptoInsertarEditar").html(detHTML);
                    $("#sum-total-det").text(formatoNumero(ssumTotalDetalle * cantDiaSeleccionado));

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function sactualizarTotales() {

            ssumTotalDetalle = 0;

            $("#sdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {

                let valorPre = "";
                let valorActual = 0;

                let idConceptoDetCheckbox = $(obj).attr("data-id");
                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                if (sconceptoDetArray[i].isChecked == true) {

                    sconceptoDetArray[i].seleccionadoDet = 1;
                    sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    sconceptoDetArray[i].montoSolicitado = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();

                    valorPre = $("#sdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valorActual = 0;
                    }
                    else {
                        valorActual = parseFloat(valorPre);
                    }

                    // SOLES
                    if (svIdTipoMod == 1) {

                        if (valorActual > parseFloat(valorMaximoS)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        ssumTotalDetalle = ssumTotalDetalle + (valorActual * parseFloat(sconceptoDetArray[i].cantDias));
                        $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(sconceptoDetArray[i].cantDias)));

                    }
                    else if (svIdTipoMod == 2) {
                        // DOLAR

                        if (valorActual > parseFloat(valorMaximoD)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD.toString(),
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        ssumTotalDetalle = ssumTotalDetalle + (valorActual * parseFloat(sconceptoDetArray[i].cantDias));
                        $("#sdetalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(sconceptoDetArray[i].cantDias)));
                    }
                }
                else {

                    sconceptoDetArray[i].seleccionadoDet = 0;
                    sconceptoDetArray[i].cantDias = $("#sdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    sconceptoDetArray[i].observacionDet = $("#sdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();
                }
            });

            $("#sum-total-det").text(formatoNumero(ssumTotalDetalle));
        }


        function sindicadorEstado(idEstado) {

            if (idEstado == 10) {
                // Pendiente
                $("#sestado-icon").removeClass("icon-liberado");
                $("#sestado-icon").removeClass("icon-aprobado");
                $("#sestado-icon").removeClass("icon-rechazado");
                $("#sestado-icon").addClass("icon-pendiente");

                $("#sestado-desc").removeClass("desc-est-liberado");
                $("#sestado-desc").removeClass("desc-est-aprobado");
                $("#sestado-desc").removeClass("desc-est-rechazado");
                $("#sestado-desc").addClass("desc-est-pendiente");

            }
            else if (idEstado == 15) {
                // Liberado
                $("#sestado-icon").removeClass("icon-pendiente");
                $("#sestado-icon").removeClass("icon-aprobado");
                $("#sestado-icon").removeClass("icon-rechazado");
                $("#sestado-icon").addClass("icon-liberado");

                $("#sestado-desc").removeClass("desc-est-pendiente");
                $("#sestado-desc").removeClass("desc-est-aprobado");
                $("#sestado-desc").removeClass("desc-est-rechazado");
                $("#sestado-desc").addClass("desc-est-liberado");

            }
            else if (idEstado == 20 || idEstado == 25) {
                // Aprobado Total
                $("#sestado-icon").removeClass("icon-pendiente");
                $("#sestado-icon").removeClass("icon-liberado");
                $("#sestado-icon").removeClass("icon-rechazado");
                $("#sestado-icon").addClass("icon-aprobado");

                $("#sestado-desc").removeClass("desc-est-pendiente");
                $("#sestado-desc").removeClass("desc-est-liberado");
                $("#sestado-desc").removeClass("desc-est-rechazado");
                $("#sestado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 21) {
                // Aprobado Parcial
                $("#sestado-icon").removeClass("icon-pendiente");
                $("#sestado-icon").removeClass("icon-liberado");
                $("#sestado-icon").removeClass("icon-rechazado");
                $("#sestado-icon").addClass("icon-aprobado");

                $("#sestado-desc").removeClass("desc-est-pendiente");
                $("#sestado-desc").removeClass("desc-est-liberado");
                $("#sestado-desc").removeClass("desc-est-rechazado");
                $("#sestado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 16 || idEstado == 22 || idEstado == 30) {
                // Rechazado
                $("#sestado-icon").removeClass("icon-pendiente");
                $("#sestado-icon").removeClass("icon-liberado");
                $("#sestado-icon").removeClass("icon-aprobado");
                $("#sestado-icon").addClass("icon-rechazado");

                $("#sestado-desc").removeClass("desc-est-pendiente");
                $("#sestado-desc").removeClass("desc-est-liberado");
                $("#sestado-desc").removeClass("desc-est-aprobado");
                $("#sestado-desc").addClass("desc-est-rechazado");
            }
        }



        // REEMBOLSO


    // Funcionalidades.

    function rlimpiarCabecera() {
        let now = new Date();

        $("#riddttFechaHora").val("");
        $("#ridtxtcodigo").val("");
        $("#ridtxtcodigo").removeClass("ridtxtcodigo-ok");
        $("#ridCbxTipo").val(4);
        $("#ridCbxTipoMod").val(1);
        $("#ridtxtaobs").val("");
    }

    function rvalidacionCabecera() {
        var respuesta = false;

        if (rvIdTipoMod == 0) {
            respuesta = false;

            Swal.fire({
                title: 'Seleccione un Tipo de Moneda',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else if ($("#ridtxtaobs").val().trim() == "") {
            respuesta = false;

            Swal.fire({
                title: 'Ingrese una descripción de la solicitud por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else if (rvIdTipo == 0) {
            respuesta = false;

            Swal.fire({
                title: 'Seleccione el tipo de Solicitud, por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else if (rvctpava_bnfcol == "" || rvctpava_bnfcol == null || typeof (rvctpava_bnfcol) == "undefined") {
            respuesta = false;

            Swal.fire({
                title: 'Registre el colaborador beneficierio',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }

        else if (rvCodSede == "" || rvCodSede == null || typeof (rvCodSede) == "undefined") {
            respuesta = false;

            Swal.fire({
                title: 'Seleccione una Sede',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else {
            respuesta = true;
        }

        return respuesta;
    }

    function rvalidacionDetalle() {
        let respuesta = true;
        let isFalseLoop = false;
        let cantConceptpDetArray = 0;

        cantConceptpDetArray = rconceptoDetArray.filter(x => x.isChecked == true).length;

        if (rvIdSolicitud == 0) {

            Swal.fire({
                title: 'Debe generar el codigo de solicitud para continuar',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'

            });

            return false;
        }
        else if (cantConceptpDetArray == 0 || cantConceptpDetArray == null || typeof (cantConceptpDetArray) == "undefined") {

            Swal.fire({
                title: 'Seleccione un concepto, por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });

            return false;
        }
        else if (rvCodCeCo == 0 || rvCodCeCo == null) {

            Swal.fire({
                title: 'Seleccione un centro de costo',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });

            return false;
        }

        $("#rdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {

            let valorIngresado = $(obj).val();
            let valorMaximoS = $(obj).attr("data-valor-maxs");
            let valorMaximoD = $(obj).attr("data-valor-maxd");

            let nombreID = obj.id;
            let idConceptoDet = $(obj).attr("data-idconceptodet");

            let estaSeleccionado = rconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);


            if (typeof (estaSeleccionado) != "undefined") {

                if (valorIngresado.toString().trim() == "" || valorIngresado == null || typeof (valorIngresado) == "undefined" || valorIngresado.toString().trim() == "0") {
                    Swal.fire({
                        title: 'Ingrese el monto por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    document.getElementById(nombreID).focus();
                    isFalseLoop = true;
                    return false;

                }

                else if (parseFloat(valorIngresado) < 0) {

                    Swal.fire({
                        title: 'El monto ingresado no debe ser negativo',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    document.getElementById(nombreID).focus();
                    isFalseLoop = true;
                    return false;
                }

                else if (vIdTipoMod == 1) {

                    if (parseFloat(valorIngresado) > valorMaximoS) {
                        isFalseLoop = true;

                        $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                        valorActual = 0;

                        Swal.fire({
                            title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();

                        return false;
                    }
                }
                else if (vIdTipoMod == 2) {
                    // DOLAR
                    if (parseFloat(valorIngresado) > valorMaximoD) {
                        isFalseLoop = true;

                        $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                        valorActual = 0;

                        Swal.fire({
                            title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                        return false;
                    }
                }
            }

        });

        // Servicio
        if (rvIdConcepCab == "5") {
            $("#rdetalleConceptoInsertarEditar input.cobsdet").each(function (i, obj) {
                let obsIngresado = $(this).val();

                if (obsIngresado == "" || obsIngresado == null || typeof (obsIngresado) == "undefined") {
                    Swal.fire({
                        title: 'Debe ingresar una descripción para el tipo de Solicitud',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    isFalseLoop = true;
                    return false;
                }
            });
        }


        if (isFalseLoop) {
            respuesta = false;
        }
        else {
            respuesta = true;
        }

        return respuesta;

    }

    function rsetPeriodo() {

        let fechaFormato = new Date();

        let month = '' + (fechaFormato.getMonth() + 1);
        let year = fechaFormato.getFullYear();

        if (month.length < 2) { month = '0' + month; }

        $("#rcbxPeriodoModal1").val("" + [year, month].join('-'));
        $("#rcbxPeriodoModal2").val("" + [year, month].join('-'));
        $("#rcbxPeriodoModal3").val("" + [year, month].join('-'));

        document.getElementById("rcbxPeriodoModal1").disabled = true;
        document.getElementById("rcbxPeriodoModal2").disabled = true;
        document.getElementById("rcbxPeriodoModal3").disabled = true;
    }


    // Listados.

    function rgetPermisosXCeCo(parametros) {
        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_PermisosXCeCo',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: parametros,
            success: function (data) {
                let primerValorBool = true;

                $("#rcbxCeCo1").empty();

                $.each(data.lista, function () {
                    if (primerValorBool) {
                        rvCodCeCo = this.codCeCo;
                        rvCeCo = this.descripcion;

                        primerValorBool = false;
                    }
                    $("#rcbxCeCo1").append($("<option/>").val(this.codCeCo).text(this.descripcion));
                });

                $("#rcbxCeCo1").val(rvCodCeCo);
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rconceptoCabXTipo(pIdTipo, pIdConceptoDet) {

        let firstConceptoCab = 0;
        let firstLoop = true;
        let conceptoArray = [];

        let v_codConceptoCab = 0;
        let v_cantidadDetalle = 0;

        let newrdetalleArray = [];


        if (pIdConceptoDet > 0) {

            $("#cbxConcepCab").empty();

            v_codConceptoCab = conceptordetalleArray.filter(x => x.idConceptoDet == pIdConceptoDet).idConceptoCab;

            v_cantidadDetalle = conceptordetalleArray.filter(x => x.idConcepDet != pIdConceptoDet).length;

            if (v_cantidadDetalle > 0) {
                $("#cbxConcepCab").val(v_codConceptoCab);
                newrdetalleArray = conceptordetalleArray.filter(x => x.idConcepDet != pIdConceptoDet);
            }
            else {
                newCabeceraArray = rconceptoCabeceraArray.filter(x => x.idConcepCab != v_codConceptoCab);
                newrdetalleArray = conceptordetalleArray.filter(x => x.idConcepDet != pIdConceptoDet);
            }

            rllenarCbxDetalle(newrdetalleArray);

            $.each(conceptoArray, function () {
                if (firstLoop) {
                    firstConceptoCab = this.idConceptoCab;

                    firstLoop = false;
                }
                $("#cbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
            });

            rvIdConcepCab = firstConceptoCab;

            $("#cbxConcepCab").val(firstConceptoCab);
            rgetConceptoDet(firstConceptoCab);
        }
    }


    function rgetTipoDeMoneda() {
        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_TiposDeMoneda',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                rtipoMonedaArray = data.lista;

                $("#ridCbxTipoMod").empty();
                $("#rcbxMonedaModal1").empty();
                $("#rcbxMonedaModal2").empty();
                $("#rcbxMonedaModal3").empty();

                $.each(data.lista, function () {

                    $("#ridCbxTipoMod").append($("<option/>").val(this.idTipoMod).text(this.descripcion));

                    $("#rcbxMonedaModal1").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    $("#rcbxMonedaModal2").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    $("#rcbxMonedaModal3").append($("<option/>").val(this.idTipoMod).text(this.descripcion));

                });

                $("#ridCbxTipoMod").val(1);
                $("#rcbxMonedaModal1").val(1);
                $("#rcbxMonedaModal2").val(1);
                $("#rcbxMonedaModal3").val(1);

                rvSimboloMoneda = rtipoMonedaArray.find(x => x.idTipoMod == 1).simbolo;
                rvIdTipoMod = 1;

                rgetTipoComprobantes();
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rgetTipos() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_TiposAprobGstsFnzs',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                $("#ridCbxTipo").empty();
                $.each(data.lista, function () {
                    $("#ridCbxTipo").append($("<option/>").val(this.idTipo).text(this.tipo));
                });

                $("#ridCbxTipo").val(4);
                rvIdTipo = 4;

                rgetTipoDeMoneda();
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rgetUnidadesMedida() {
        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_UnidadesMedida',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#rcbxUM1").empty();
                $.each(data.lista, function () {
                    $("#rcbxUM1").append($("<option/>").val(this.codum).text(this.um));
                });
                $("#rcbxUM1").val("UN");
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rgetPeriodos() {
        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_Periodos',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#rcbxPeriodoModal1").empty();
                $("#rcbxPeriodoModal2").empty();
                $("#rcbxPeriodoModal3").empty();

                $.each(data.lista, function () {
                    $("#rcbxPeriodoModal1").append($("<option/>").val(this.periodo).text(this.periodo));
                    $("#rcbxPeriodoModal2").append($("<option/>").val(this.periodo).text(this.periodo));
                    $("#rcbxPeriodoModal3").append($("<option/>").val(this.periodo).text(this.periodo));
                });

                rsetPeriodo();
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rgetSede() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_Sedes',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
                $("#ridCbxSede").empty();
                $.each(data.lista, function () {
                    $("#ridCbxSede").append($("<option/>").val(this.codSede).text(this.sede));
                });
                $("#ridCbxSede").val("C");
                rvCodSede = "C";
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });

    }

    function rresetControles() {

        document.getElementById("ridCbxSede").disabled = false;
        document.getElementById("ridCbxTipoMod").disabled = false;
        document.getElementById("ridtxtaobs").disabled = false;
        document.getElementById("rcbxCeCo1").disabled = true;

        $("#ridusuario").val(USUARIO_COMPLETO);

        let now = new Date();
        $("#riddttFechaHora").val(new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().substring(0, 19).toString());

        $("#rkpi-cantidad").text("0");
        $("#rkpi-total").text("0");

        let tabla = $("#rtblDetalle").DataTable();
        tabla.destroy();
        var tr = "";
        $("#rtblDetalleContent").html(tr);
        $("#rtblDetalle").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            }
        );
        $("#restado-desc").text("");

        $("#restado-icon").removeClass("icon-liberado");
        $("#restado-icon").removeClass("icon-aprobado");
        $("#restado-icon").removeClass("icon-rechazado");
        $("#restado-icon").removeClass("icon-pendiente");

        $("#restado-desc").removeClass("desc-est-liberado");
        $("#restado-desc").removeClass("desc-est-aprobado");
        $("#restado-desc").removeClass("desc-est-rechazado");
        $("#restado-desc").removeClass("desc-est-pendiente");

        rvCodColSofya = "";
        rvColaboradorSofya = "";
        rvctpava_bnfcol = "";
        rvcanvar_bnfcol = "";
        rvcolaborador = "";

        $("#rtxtcolaborador").val("");

    }

    function rajaxConceptoEdit(idSolicitud) {
        return $.ajax({
            type: "GET",
            url: "/Finanzas/RG_ConceptoCabEdit",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: { idSolicitud: idSolicitud }
        });
    }

    function rajaxDetalleEditar(idSolicitud, idConceptoCab) {
        return $.ajax({
            type: "GET",
            url: "/Finanzas/RG_DetalleEditar",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab }
        });
    }


    // Eventos Click

    $("#rbtnCancelar").click(function () {
        document.getElementById("ridmCbxCeCo").focus();
    });

    $("#rbtnGenerarComprobante").click(function () {


        $.ajax({
            url: "/finanzas/RG_TienePendienteRend",
            type: "GET",
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {
                    if (resultado.estado == "N") {

                        if (rvalidacionCabecera()) {

                            $("#rtxtCeCoModal1").val(rvCeCo);
                            $("#rtxtCeCoModal2").val(rvCeCo);
                            $("#rtxtCeCoModal3").val(rvCeCo);


                            if (rvIdSolicitud > 0) {

                                // Si ya existe una solicitud.
                                rlimpiarControlModal(1);
                                rlimpiarControlModal(2);
                                rlimpiarControlModal(3);

                                $("#rfacturaboleta-tab").removeClass("disabled");
                                $("#rplanillamovilidad-tab").removeClass("disabled");
                                $("#rdeclaracionjur-tab").removeClass("disabled");

                                $("#rregComprobModal .nav-tabs #rfacturaboleta-tab").tab('show');
                                rtabSeleccionado = 1;

                                rTIPO_REGISTRO = "INSERTAR";

                                rconceptoCabXTipo(rvIdTipo, 0);
                                $("#rregComprobModal").modal("show");
                            }
                            else {

                                let parametro = {
                                    'opcion': 1,
                                    'idSolicitud': 0,
                                    'codigo': 0,
                                    'idEmpresa': 1,
                                    'idEstado': 10,
                                    'idAnulado': 0,
                                    'idTipoMod': rvIdTipoMod,
                                    'observacion': $("#ridtxtaobs").val().trim(),

                                    'codCeCo': rvCodCeCo,
                                    'idConceptoDet': 0,
                                    'valor': 0,
                                    'secuencia': 0,
                                    'usuario': USUARIO,
                                    'usuarioCompleto': USUARIO_COMPLETO,
                                    'nivelInterfaz': 0,
                                    'idTipo': rvIdTipo,
                                    'seleccionadoDet': 0,
                                    'idConceptoCab': 0,

                                    'cantDias': 0,
                                    'montoSolicitado': 0,
                                    'observacionDet': '',
                                    'ctpava_bnf': rvctpava_bnfcol,
                                    'canvar_bnf': rvcanvar_bnfcol,
                                    'colaborador': rvcolaborador,

                                    'codSede': rvCodSede
                                }



                                $.ajax({
                                    url: "/finanzas/RG_SetRendicionGastos",
                                    type: "post",
                                    data: parametro,
                                    dataType: "json",
                                    success: function (resultado) {

                                        if (resultado.isRedirect) {
                                            window.location.href = resultado.redirectUrl;
                                        }
                                        else {

                                            if (resultado.status.idResponse > 0) {

                                                rvIdSolicitud = resultado.status.idResponse;
                                                rsolicitudCabCreada = resultado.responseEntity;

                                                $("#riddttFechaHora").val(resultado.responseEntity.fechaEmision);
                                                $("#ridtxtcodigo").val(resultado.responseEntity.codigo);
                                                $("#ridtxtcodigo").addClass("ridtxtcodigo-ok");

                                                document.getElementById("ridCbxSede").disabled = true;
                                                document.getElementById("ridtxtcodigo").disabled = true;
                                                document.getElementById("ridCbxTipo").disabled = true;
                                                document.getElementById("ridCbxTipoMod").disabled = true;
                                                document.getElementById("ridtxtaobs").disabled = true;
                                                document.getElementById("rcbxCeCo1").disabled = true;
                                                document.getElementById("rbtnBuscarColaborador").disabled = true;


                                                // MOSTRAR MODAL DE REGISTRO DE COMPROBANTE.

                                                let valorRestante = 0;

                                                rlimpiarControlModal(1);
                                                rlimpiarControlModal(2);
                                                rlimpiarControlModal(3);


                                                // Factura y boleta
                                                $("#rfacturaboleta-tab").removeClass("disabled");
                                                $("#rplanillamovilidad-tab").removeClass("disabled");
                                                $("#rdeclaracionjur-tab").removeClass("disabled");

                                                $("#rregComprobModal .nav-tabs #rfacturaboleta-tab").tab('show');

                                                rTIPO_REGISTRO = "INSERTAR";

                                                $("#rtxtCeCoModal1").val(rvCeCo);
                                                $("#rtxtCeCoModal2").val(rvCeCo);
                                                $("#rtxtCeCoModal3").val(rvCeCo);


                                                $("#rcbxMonedaModal1").val(rsolicitudCabCreada.idTipoMod);
                                                $("#rcbxMonedaModal2").val(rsolicitudCabCreada.idTipoMod);
                                                $("#rcbxMonedaModal3").val(rsolicitudCabCreada.idTipoMod);

                                                $("#rtxtDNIModal2").val(rsolicitudCabCreada.canvar_bnf);
                                                $("#rtxtDNIModal3").val(rsolicitudCabCreada.canvar_bnf);
                                                $("#rtxtApeNomModal2").val(rsolicitudCabCreada.colaborador);
                                                $("#rtxtApeNomModal3").val(rsolicitudCabCreada.colaborador);

                                                $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
                                                $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                                                $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");

                                                rconceptoCabXTipo(rvIdTipo, 0);

                                                $("#rbtnAnularSolicitud").removeClass("btn-secondary");
                                                $("#rbtnAnularSolicitud").addClass("btn-danger");
                                                document.getElementById("rbtnAnularSolicitud").disabled = false;

                                                $("#rregComprobModal").modal("show");


                                                rindicadorEstado(resultado.responseEntity.idEstado);
                                                $("#restado-desc").text(resultado.responseEntity.estado);

                                            }
                                            else {
                                                rmensajePrincipal(false, "Ocurrio un problema");
                                            }
                                        }
                                    },
                                    error: function (xhr, ajaxOptions, thrownError) {

                                    }
                                });

                            }

                        }



                    }
                    else {
                        Swal.fire({
                            title: 'Tiene rendiciones Pendientes',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });




    });

    function rvalidarAgregarDetalle() {
        let respuesta = false;
        let codigoGenerado = $("#ridtxtcodigo").val();

        if (vIdTipoMod == 0) {
            respuesta = false;

            Swal.fire({
                title: 'Debe seleccionar el tipo de Moneda',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });

        }
        else if (codigoGenerado == "" || codigoGenerado == null || typeof (codigoGenerado) == "undefined") {
            respuesta = false;
            Swal.fire({
                title: 'Debe Generar la cabecera de la Solicitud para continuar',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });

        }
        else {
            respuesta = true;
        }

        return respuesta;
    }

    $("#rbtnGuardarDetalle").click(function () {

        if (rvalidacionDetalle()) {

            $("#rdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
                let idConceptoDet = $(obj).attr("data-idconceptodet");
                let estaSeleccionado = rconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);
                if (typeof (estaSeleccionado) != "undefined") {
                    for (var i = 0; i < rconceptoDetArray.length; i++) {
                        if (rconceptoDetArray[i].isChecked == true && rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                            rconceptoDetArray[i].montoSolicitado = parseFloat($("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val());
                            rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                        }
                    }
                }
            });

            rconceptoDetArray = rconceptoDetArray.filter(x => x.isChecked == true);

            let parametro = {
                'opcion': 2,
                'idSolicitud': rvIdSolicitud,
                'codigo': 0,
                'idEmpresa': 1,
                'idEstado': 1,
                'idAnulado': 0,
                'idTipoMod': 0,
                'observacion': '',
                'codCeCo': rvCodCeCo,
                'idConceptoDet': rvIdConcepDet,
                'valor': $("#sidmvalor").val(),
                'secuencia': 0,
                'usuario': USUARIO,
                'usuarioCompleto': USUARIO_COMPLETO,
                'nivelInterfaz': 0,
                'idTipo': 0,
                'conceptoDetArray': rconceptoDetArray
            }

            $.ajax({
                url: "/finanzas/RG_SetRendicionGastosDet",
                type: "post",
                data: parametro,
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {

                        $('#rmodalSolDetInsertar').modal('hide');

                        if (resultado.status.idResponse > 0) {
                            rmensajePrincipal(true, "Actualizando Detalle");
                        }
                        else {
                            rmensajePrincipal(false, "Ocurrio un problema al agregar el motivo");
                        }

                        rgetListaDetalle(rvIdSolicitud);
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        }
    });


    $("#rbtnNuevo").click(function () {

        var tieneData = 'NO';
        var table = $('#rtblDetalle').DataTable();


        if (table.data().count()) {
            tieneData = 'SI';
        }
        else {
            tieneData = 'NO';
        }


        if (rvIdSolicitud > 0 && tieneData == 'NO') {

            Swal.fire({
                title: 'El registro de reembolso no tiene detalle, ¿Desea continuar?',
                text: 'Textile Sourcing Company',
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Ok'

            }).then((result) => {

                if (result.value) {
                    rvIdSolicitud = 0;
                    rsolicitudCabCreada = {};

                    rlimpiarControlModal(1);
                    rlimpiarControlModal(2);
                    rlimpiarControlModal(3);

                    rlimpiarCabecera();
                    rresetControles();

                    document.getElementById("rbtnBuscarCodigo").disabled = false;
                    $("#rbtnBuscarCodigo").removeClass("btn-secondary");
                    $("#rbtnBuscarCodigo").addClass("btn-primary");


                    document.getElementById("rbtnGenerarComprobante").disabled = false;
                    $("#rbtnGenerarComprobante").removeClass("btn-secondary");
                    $("#rbtnGenerarComprobante").addClass("btn-success");

                    document.getElementById("rbtnBuscarColaborador").disabled = false;
                    document.getElementById("ridtxtcodigo").disabled = true;
                    document.getElementById("ridCbxSede").focus();
                    $("#ridtxtcodigo").val("0");
                }
            });
        }
        else {
            rvIdSolicitud = 0;
            rsolicitudCabCreada = {};

            rlimpiarControlModal(1);
            rlimpiarControlModal(2);
            rlimpiarControlModal(3);

            rlimpiarCabecera();
            rresetControles();

            document.getElementById("rbtnBuscarCodigo").disabled = false;
            $("#rbtnBuscarCodigo").removeClass("btn-secondary");
            $("#rbtnBuscarCodigo").addClass("btn-primary");


            document.getElementById("rbtnGenerarComprobante").disabled = false;
            $("#rbtnGenerarComprobante").removeClass("btn-secondary");
            $("#rbtnGenerarComprobante").addClass("btn-success");

            document.getElementById("rbtnBuscarColaborador").disabled = false;
            document.getElementById("ridtxtcodigo").disabled = true;
            document.getElementById("ridCbxSede").focus();
            $("#ridtxtcodigo").val("0");
        }

    });

    $("#rtblDetalle").on('click', '.solicitudDetalleItem', function () {

        let idSolicitud = $(this).attr("data-idsolicitud");
        let idConceptoCab = $(this).attr("data-idconceptoCab");

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_SolicitudDetalle',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab },
            success: function (data) {

                if (data.isRedirect) {
                    window.location.href = data.redirectUrl;
                }
                else {

                    let detHTML = "";
                    let checkeHTML = "";

                    $("#rdetalleConceptoVisualizar").empty();

                    $("#ridmdCodigo").val(data.entidad.codigo);
                    $("#ridmdConcepCab").val(data.entidad.conceptoCab);
                    $("#ridmdCeCo").val(data.entidad.ceco);


                    $.each(data.entidad.conceptoDetalle, function () {

                        detHTML += "<div class='row mt-1'>";

                        //if (this.existe == 0) {
                        //    checkeHTML = "<div class='col-1'>"
                        //        + "     <input type='checkbox' class='cseleccion' data-idConceptoDet=" + this.idConceptoDet + " disabled>"
                        //        + "</div>";
                        //}
                        //else {
                        //    checkeHTML = "<div class='col-1'>"
                        //        + "     <input type='checkbox' class='cseleccion' data-idConceptoDet=" + this.idConceptoDet + " readonly checked='checked'>"
                        //        + "</div>";
                        //}

                        detHTML = detHTML + checkeHTML;

                        detHTML = detHTML + "<div class='col-2'>"
                            + "      <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                            + "</div>"
                            + "<div class='col-1'>"
                            + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + formatoNumero(this.montoSolicitado) + "</p>"
                            + "</div>"
                            + "<div class='col-4'>"
                            + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.observacionDet + "</p>"
                            + "</div>"
                            + "<div class='col-4'>"
                            + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                            + "</div> ";

                        detHTML = detHTML + "</div>";

                    });

                    $("#rdetalleConceptoVisualizar").html(detHTML);
                    $('#rmodalSolDetVisualizar').modal('show');
                }
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    });

    $("#rtblDetalle").on('click', '.solicitudRendirItem', function () {
        $("#rregComprobModal").modal("show");
    });

    $("#rtblDetalle").on('click', '.solicitudEditarItem', function () {

        let idSolicitud = $(this).attr("data-idsolicitud");
        let idConceptoCab = $(this).attr("data-idconceptoCab");
        rswitchInsertarEditar = 2; // 2: Editar

        $.when(rajaxConceptoEdit(idSolicitud), rajaxDetalleEditar(idSolicitud, idConceptoCab)).done(function (dataConcepto, dataDetalle) {

            rentidadEditar = {};

            if (dataConcepto.isRedirect) {
                window.location.href = dataConcepto[0].redirectUrl;
            }
            else {

                let detHTML = "";
                let cbxDiasHTML = "";
                let cantChecked = 0;
                let primerLoopCbxDia = true;
                let cantDiaSeleccionado = 0;

                rdiasArrayEditar = [];
                rentidadEditar = dataDetalle[0].entidad;
                rvCodCeCo = dataDetalle[0].entidad.codCeCo;
                rvIdSolicitud = dataDetalle[0].entidad.idSolicitud;

                $("#rdetalleConceptoInsertarEditar").empty();


                // Concepto
                $("#ridmCbxConcepCab").empty();
                $.each(dataConcepto[0].lista, function () {
                    $("#ridmCbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                });


                // Detalle
                $.each(rdiasArray, function () {

                    //if (primerLoopCbxDia) {
                    //    cbxDiasHTML += "<option value='" + this.codDia + "' selected>" + this.dia + "</option>";
                    //    cantDiaSeleccionado = this.codDia;
                    //}
                    //else {
                    //    cbxDiasHTML += "<option value='" + this.codDia + "'>" + this.dia + "</option>";
                    //}


                    if (objDet.tieneDias == "S") {
                        if (objDia.codDia.toString() != "0") {
                            if (primerLoopCbxDia) {
                                cbxDiasHTML += "<option value='" + objDia.codDia + "' selected>" + objDia.dia + "</option>";
                                cantDiaSeleccionado = objDia.codDia;

                                primerLoopCbxDia = false;
                            }
                            else {
                                cbxDiasHTML += "<option value='" + objDia.codDia + "'>" + objDia.dia + "</option>";
                            }
                        }
                    }
                    else if (objDet.tieneDias == "N") {
                        cbxDiasHTML = "<option value='1' selected>(SIN DIAS)</option>";
                        cantDiaSeleccionado = 1;
                    }

                });



                $.each(dataDetalle[0].entidad.conceptoDetalle, function () {

                    detHTML += "<div class='row mt-1'>";
                    // editarrr
                    if (this.existe == 0) {
                        checkeHTML = "<div class='col-1'>"
                            + "     <input type='checkbox' class='cseleccion' data-tienedias='" + obj.tieneDias + "'  data-id=" + this.idConceptoDet + " data-valor=" + this.montoSolicitado + " >"
                            + "</div>";
                        rconceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 0, codCeCo: rvCodCeCo, isChecked: false, cantDias: this.cantDias, montoSolicitado: this.montoSolicitado, observacionDet: this.observacionDet });
                    }
                    else {
                        checkeHTML = "<div class='col-1'>"
                            + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoSolicitado + "  checked='checked'>"
                            + "</div>";
                        rconceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 1, codCeCo: rvCodCeCo, isChecked: true, cantDias: this.cantDias, montoSolicitado: this.montoSolicitado, observacionDet: this.observacionDet });

                        rsumTotalDetalle = rsumTotalDetalle + parseFloat(this.montoSolicitado * this.cantDias);
                        cantChecked++;
                    }

                    detHTML = detHTML + checkeHTML;

                    detHTML = detHTML
                        + "<div class='col-2'>"
                        + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                        + "</div>"

                        + "<div class='col-1'>"
                        + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + this.idConceptoDet + "' min='0' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd = '" + this.montoMaximoD + "'  data-idconceptodet='" + this.idConceptoDet + "' value='" + this.montoSolicitado + "'>"
                        + "</div>"

                        + "<div class='col-2'>"
                        + "     <input class='form-control form-control-sm cobsdet' type='text' id='txtObsDet" + this.idConceptoDet + "' data-idconceptodet='" + this.idConceptoDet + "' value='" + this.observacionDet + "'>"
                        + "</div>"

                        + "<div class='col-5'>"
                        + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                        + "</div> "

                        + "<div class='col-1'>"
                        + "   <select class='form-control form-control-sm cdias cbxDias" + this.idConceptoDet + "' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd = '" + this.montoMaximoD + "' data-id=" + this.idConceptoDet + "" + ((this.existe == 0 || obj.tieneDias == 'N') ? " disabled " : " ") + ">"
                        + cbxDiasHTML
                        + "</select>"

                        + "</div>"
                        + "</div>"


                    rdiasArrayEditar.push({ idConceptoDet: this.idConceptoDet, cantDias: this.cantDias });

                });

                if (cantChecked == dataDetalle[0].entidad.conceptoDetalle.length) {
                    $("#rseleccionar-todo").prop("checked", true);
                }


                let codigoGenerado = $("#ridtxtcodigo").val();

                $("#ridmcodigo").val(codigoGenerado);
                $("#ridmCbxConcepCab").val(rentidadEditar.idConceptoCab);
                $("#ridmCbxCeCo").val(rentidadEditar.codCeCo);

                rvCodCeCo = rentidadEditar.codCeCo;

                $("#sum-total-det").text(formatoNumero(rsumTotalDetalle * cantDiaSeleccionado));
                $("#rdetalleConceptoInsertarEditar").html(detHTML);
                $('#rmodalSolDetInsertar').modal('show');
            }

        });

    });

    $("#rtblDetalle").on('click', '.solicitudEliminarItem', function () {

        let idsolcitud = $(this).attr("data-idsolicitud");
        let idconceptocab = $(this).attr("data-idconceptocab");

        MostrarCarga("Eliminando registro...");

        Swal.fire({
            title: '¿Esta seguro de eliminar el registro?',
            text: "Textile Sourcing Company",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si',
            cancelButtonText: 'No'
        }).then((result) => {

            if (result.value) {

                let parametro = {
                    'opcion': 3,
                    'idSolicitud': idsolcitud,
                    'codigo': 0,
                    'idEmpresa': 1,
                    'idEstado': 1,
                    'idAnulado': 0,
                    'idTipoMod': rvIdTipoMod,
                    'observacion': '',

                    'codCeCo': rvCodCeCo,
                    'idConceptoDet': rvIdConcepDet,
                    'valor': 0,
                    'secuencia': 0,
                    'usuario': USUARIO,
                    'usuarioCompleto': USUARIO_COMPLETO,
                    'nivelInterfaz': 0,
                    'idTipo': rvIdTipo,
                    'seleccionadoDet': 0,
                    'idConceptoCab': idconceptocab,
                    'observacionDet': "",
                    'ctpava_bnf': "",
                    'canvar_bnf': "",
                    'colaborador': ""
                }


                $.ajax({
                    url: "/finanzas/RG_EliminarSolicitud",
                    type: "post",
                    data: parametro,
                    dataType: "json",
                    success: function (resultado) {
                        console.log(resultado);

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            if (resultado.status.idResponse > 0) {
                                rmensajePrincipal(true, "Item Eliminado Correctamente");
                            }
                            else {
                                rmensajePrincipal(false, "Ocurrio un problema");
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

                rgetListaDetalle(rvIdSolicitud);
            }
        })

    });

    $("#rbtnBuscar").click(function () {

        let fechaIni = $('#idfechaInicio').val();
        let fechaFin = $('#idfechaFin').val();

        if (fechaIni == null ||
            fechaFin == null ||
            typeof (fechaIni) == "undefined" ||
            typeof (fechaFin) == "undefined" ||
            fechaIni.trim() == "" ||
            fechaFin.trim() == "") {

            Swal.fire('Seleccione la fecha, por favor')
        }
        else {

            var datos =
            {
                'fechaInicio': fechaIni,
                'fechaFin': fechaFin
            }

            $.ajax({
                type: "GET",
                url: '/finanzas/RG_BuscarHistorial',
                contentType: "application/json; charset=utf-8",
                data: datos,
                dataType: "json",
                success: function (data) {

                    let tabla = $("#rtblHistorial").DataTable();

                    tabla.destroy();
                    var tr = "";

                    data.lista.forEach((obj) => {

                        tr += "<tr> "
                            + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                            + " <td> " + obj.fecha + "</td>"
                            + " <td> " + obj.codigo + "</td>"
                            + " <td> " + obj.observacion + "</td>"
                            + " <td> " + obj.estado + "</td>"
                            + " <td> " + obj.tipo + "</td>"
                            + " <td> " + obj.nivelAprob + "</td>"
                            + " <td> " + obj.moneda + "</td>"
                            + " <td> " + formatoNumero(obj.valor) + "</td>"
                            + "</tr>";
                    });

                    $("#rtblHistorialContent").html(tr);


                    $("#rtblHistorial").DataTable(
                        {
                            dom: 'Bfrtip',
                            buttons: [
                                'copy', 'excel', 'pdf', 'print'
                            ],
                            'language': { 'url': '/libs/datatables/spanish.json' },
                            lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                        });

                },
                failure: function () {
                    console.error('error al cargar los periodos');
                }
            });

        }

    });

    $("#rbtnBuscarCodigo").click(function () {
        rlimpiarCabecera();

        document.getElementById("ridCbxSede").disabled = true;
        document.getElementById("ridCbxTipo").disabled = true;
        document.getElementById("ridCbxTipoMod").disabled = true;
        document.getElementById("ridtxtaobs").disabled = true;
        document.getElementById("rcbxCeCo1").disabled = true;

        rvIdSolicitud = 0;
        $("#ridtxtcodigo").val("");

        let tabla = $("#rtblDetalle").DataTable();
        tabla.destroy();
        var tr = "";
        $("#rtblDetalleContent").html(tr);
        $("#rtblDetalle").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            }
        );

        $("#restado-desc").text("");

        $("#restado-icon").removeClass("icon-liberado");
        $("#restado-icon").removeClass("icon-aprobado");
        $("#restado-icon").removeClass("icon-rechazado");
        $("#restado-icon").removeClass("icon-pendiente");

        $("#restado-desc").removeClass("desc-est-liberado");
        $("#restado-desc").removeClass("desc-est-aprobado");
        $("#restado-desc").removeClass("desc-est-rechazado");
        $("#restado-desc").removeClass("desc-est-pendiente");

        document.getElementById("ridtxtcodigo").disabled = false;
        document.getElementById("ridtxtcodigo").focus();
    });



    // Otros Eventos

    $('#ridCbxTipoMod').change(function () {
        var $option = $(this).find('option:selected');
        rvIdTipoMod = parseInt($option.val());
        rvSimboloMoneda = rtipoMonedaArray.find(x => x.idTipoMod == rvIdTipoMod).simbolo;
    });

    $('#ridCbxSede').change(function () {
        var $option = $(this).find('option:selected');
        rvCodSede = $option.val();
    });

    $('#rcbxCeCo1').change(function () {
        var $option = $(this).find('option:selected');

        rvCodCeCo = parseInt($option.val());
        rCodCeCo = $option.text();
    });

    $('#ridCbxTipo').change(function () {
        var $option = $(this).find('option:selected');
        rvIdTipo = parseInt($option.val());

        if (rvIdTipo == 1 || rvIdTipo == 2) {
            $("#ridCbxTipoMod").val(1);
            rvIdTipoMod = $("#ridCbxTipoMod").val();
            rvSimboloMoneda = rtipoMonedaArray.find(x => x.idTipoMod == 1).simbolo;

            document.getElementById("ridCbxTipoMod").disabled = true;
        }
        else if (rvIdTipo == 3) {
            document.getElementById("ridCbxTipoMod").disabled = false;
        }
    });

    $('#ridtxtcodigo').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {

            let codigo = $("#ridtxtcodigo").val().trim();

            if (codigo == "") {
                Swal.fire({
                    title: 'Ingrese un código',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("ridtxtcodigo").focus();
                    }
                });
            }
            else if (codigo.length < 10 || codigo.length > 10) {
                Swal.fire({
                    title: 'Ingrese un código',
                    title: 'Ingrese un código valido por favor',
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("ridtxtcodigo").focus();
                    }
                });
            }
            else {

                MostrarCarga("Buscando...");


                $.ajax({
                    url: "/finanzas/RG_SolicitudXCodigo",
                    type: "GET",
                    data: { 'codigo': codigo, 'tipoInterfaz':'SINSOLICITUD' },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            if (resultado.entidad.idSolicitud > 0) {

                                rvIdSolicitud = resultado.entidad.idSolicitud;
                                rsolicitudCabCreada = resultado.entidad;

                                $("#ridtxtcodigo").val(resultado.entidad.codigo);
                                $("#ridtxtcodigo").addClass("ridtxtcodigo-ok");
                                $("#riddttFechaHora").val(resultado.entidad.fecha);
                                $("#ridusuario").val(resultado.entidad.usuSolicitante);
                                $("#ridCbxTipo").val(resultado.entidad.idTipo);
                                $("#ridCbxTipoMod").val(resultado.entidad.idTipoMod);

                                $("#ridtxtaobs").val(resultado.entidad.observacion);
                                $("#restado-desc").text(resultado.entidad.estado);

                                rvctpava_bnfcol = resultado.entidad.ctpava_bnf;
                                rvcanvar_bnfcol = resultado.entidad.canvar_bnf;
                                rvcolaborador = resultado.entidad.colaborador;

                                $("#rtxtcolaborador").val(resultado.entidad.colaborador);

                                $("#restado-icon").removeClass("icon-liberado");
                                $("#restado-icon").removeClass("icon-aprobado");
                                $("#restado-icon").removeClass("icon-rechazado");
                                $("#restado-icon").addClass("icon-pendiente");

                                $("#restado-desc").removeClass("desc-est-liberado");
                                $("#restado-desc").removeClass("desc-est-aprobado");
                                $("#restado-desc").removeClass("desc-est-rechazado");
                                $("#restado-desc").addClass("desc-est-pendiente");


                                rgetListaDetalle(rvIdSolicitud);

                                rmensajePrincipal(true, "Mostrando Solicitud");


                                // Si tiene estado mayor a 0, tiene aprobación
                                if (resultado.entidad.idEstado > 10 || resultado.entidad.idAnulado > 0) {

                                    $("#rbtnGenerarComprobante").addClass("btn-secondary");
                                    $("#rbtnGenerarComprobante").removeClass("btn-success");
                                    document.getElementById("rbtnGenerarComprobante").disabled = true;

                                    $("#rbtnAnularSolicitud").removeClass("btn-danger");
                                    $("#rbtnAnularSolicitud").addClass("btn-secondary");
                                    document.getElementById("rbtnAnularSolicitud").disabled = true;

                                }
                                else {

                                    $("#rbtnGenerarComprobante").addClass("btn-success");
                                    $("#rbtnGenerarComprobante").removeClass("btn-secondary");
                                    document.getElementById("rbtnGenerarComprobante").disabled = false;

                                    $("#rbtnAnularSolicitud").removeClass("btn-secondary");
                                    $("#rbtnAnularSolicitud").addClass("btn-danger");
                                    document.getElementById("rbtnAnularSolicitud").disabled = false;

                                }

                            }
                            else {
                                rmensajePrincipal(false, "Solicitud no encontrada");

                                rlimpiarCabecera();
                                rresetControles();

                                $("#ridtxtcodigo").val("");
                                document.getElementById("ridCbxSede").disabled = false;
                                document.getElementById("ridtxtcodigo").disabled = false;
                                document.getElementById("ridCbxTipo").disabled = true;
                                document.getElementById("ridCbxTipoMod").disabled = true;
                                document.getElementById("ridtxtaobs").disabled = true;
                                document.getElementById("rcbxCeCo1").disabled = true;


                                document.getElementById("rbtnBuscarCodigo").disabled = true;
                                $("#rbtnBuscarCodigo").removeClass("btn-primary");
                                $("#rbtnBuscarCodigo").addClass("btn-secondary");

                                document.getElementById("ridtxtcodigo").focus();
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

            }

        }
    });

    function rgetConceptoCab() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_ConceptoCabReembolso',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                let firstConceptoCab = 0;
                let firstLoop = true;

                $("#rcbxConcepCabModal1").empty();
                $("#rcbxConcepCabModal2").empty();
                $("#rcbxConcepCabModal3").empty();

                rconceptoCabeceraArray = data.lista;

                rconceptoCabArray1 = rconceptoCabeceraArray.filter(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal1").val()));
                rconceptoCabArray2 = rconceptoCabeceraArray.filter(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal2").val()));
                rconceptoCabArray3 = rconceptoCabeceraArray.filter(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal3").val()));


                firstConceptoCab = 0;
                firstLoop = true;
                $.each(rconceptoCabArray1, function () {
                    if (firstLoop) {
                        firstConceptoCab = this.idConceptoCab;
                        firstLoop = false;
                    }
                    $("#rcbxConcepCabModal1").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                });
                rvIdConceptoCab1 = firstConceptoCab;


                firstConceptoCab = 0;
                firstLoop = true;
                $.each(rconceptoCabArray2, function () {
                    if (firstLoop) {
                        firstConceptoCab = this.idConceptoCab;
                        firstLoop = false;
                    }
                    $("#rcbxConcepCabModal2").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                });
                rvIdConceptoCab2 = firstConceptoCab;


                firstConceptoCab = 0;
                firstLoop = true;
                $.each(rconceptoCabArray3, function () {
                    if (firstLoop) {
                        firstConceptoCab = this.idConceptoCab;
                        firstLoop = false;
                    }
                    $("#rcbxConcepCabModal3").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                });
                rvIdConceptoCab3 = firstConceptoCab;


                $("#rcbxConcepCabModal1").val(rvIdConceptoCab1);
                $("#rcbxConcepCabModal2").val(rvIdConceptoCab2);
                $("#rcbxConcepCabModal3").val(rvIdConceptoCab3);

                rgetConceptoDet(parseInt($("#rcbxTipoCpbteCompModal1").val()), rvIdConceptoCab1);
                rgetConceptoDet(parseInt($("#rcbxTipoCpbteCompModal2").val()), rvIdConceptoCab2);
                rgetConceptoDet(parseInt($("#rcbxTipoCpbteCompModal3").val()), rvIdConceptoCab3);

            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    $('#rdetalleConceptoInsertarEditar').on('click', '.cseleccion', function (e) {

        let inputCheck = $(this);
        let idConceptoDet = $(this).attr("data-id");
        let tienedias = $(this).attr("data-tienedias");
        let valorPre = "";
        let valor = 0;

        if (inputCheck.is(":checked")) {
            // hhhhh

            for (var i = 0; i < rconceptoDetArray.length; i++) {
                if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {

                    rconceptoDetArray[i].seleccionadoDet = 1;
                    rconceptoDetArray[i].isChecked = true;

                    if (tienedias == "S") {
                        $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                    }
                    else if (tienedias == "N") {
                        $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                    }


                    valorPre = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valor = 0;
                    }
                    else {
                        valor = parseFloat(valorPre);
                    }

                    rsumTotalDetalle = rsumTotalDetalle + (valor * parseFloat(rconceptoDetArray[i].cantDias));
                }
            }

        } else {
            for (var i = 0; i < rconceptoDetArray.length; i++) {
                if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                    rconceptoDetArray[i].seleccionadoDet = 0;
                    rconceptoDetArray[i].isChecked = false;
                    rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                    rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();

                    valorPre = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valor = 0;
                    }
                    else {
                        valor = parseFloat(valorPre);
                    }

                    rsumTotalDetalle = rsumTotalDetalle - valor * parseFloat(rconceptoDetArray[i].cantDias);
                }
            }



            if (tienedias == "S") {
                $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
            }
            else if (tienedias == "N") {
                $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
            }

        }

        if (rconceptoDetArray.filter(x => x.isChecked == true).length == rconceptoDetArray.length) {
            $("#rseleccionar-todo").prop("checked", true);
        }
        else {
            $("#rseleccionar-todo").prop("checked", false);
        }

        $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));
    });

    $('#rmodalSolDetInsertar').on('click', '#rseleccionar-todo', function (e) {
        let idConceptoDet = 0;
        var inputCheck = $(this);
        rsumTotalDetalle = 0;

        if (inputCheck.is(":checked")) {

            let valorXConceptDet = 0;

            $("#rdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                let valor = $(this).attr("data-valor");
                idConceptoDet = $(this).attr("data-id");
                valorXConceptDet = 0;

                if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                    rconceptoDetArray[i].seleccionadoDet = 1;
                    rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                }

                rconceptoDetArray[i].isChecked = true;

                $(this).prop("checked", true);
                $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);

                valorXConceptDet = parseFloat(valor) * rconceptoDetArray[i].cantDias;

                rsumTotalDetalle = rsumTotalDetalle + valorXConceptDet;
            });

        } else {
            $("#rdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                idConceptoDet = $(this).attr("data-id");

                if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                    rconceptoDetArray[i].seleccionadoDet = 0;
                    rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                }

                rconceptoDetArray[i].isChecked = false;
                $(this).prop("checked", false);
                $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);

                rsumTotalDetalle = 0;
            });
        }

        $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));
    });

    $('#rcbxConcepCabModal1').change(function () {
        var $option = $(this).find('option:selected');
        rvIdConceptoCab1 = $option.val().toString();

        if (rvIdConceptoCab1 != 0 && rvIdConceptoCab1 != null && typeof (rvIdConceptoCab1) != "undefined") {
            rconceptoDetalleArray1 = [];

            rgetConceptoDet($("#rcbxTipoCpbteCompModal1").val(), rvIdConceptoCab1);
        }
    });

    $('#rcbxConcepCabModal2').change(function () {
        var $option = $(this).find('option:selected');
        rvIdConceptoCab2 = $option.val().toString();

        if (rvIdConceptoCab2 != 0 && rvIdConceptoCab2 != null && typeof (rvIdConceptoCab2) != "undefined") {
            rconceptoDetalleArray2 = [];

            rgetConceptoDet($("#rcbxTipoCpbteCompModal2").val(), rvIdConceptoCab2);
        }
    });

    $('#rcbxConcepCabModal3').change(function () {

        var $option = $(this).find('option:selected');
        rvIdConceptoCab3 = $option.val().toString();

        if (rvIdConceptoCab3 != 0 && rvIdConceptoCab3 != null && typeof (rvIdConceptoCab3) != "undefined") {
            rconceptoDetalleArray3 = [];

            rgetConceptoDet($("#rcbxTipoCpbteCompModal3").val(), rvIdConceptoCab3);
        }
    });

    $('#rcbxConcepDetModal1').change(function () {
        var $option = $(this).find('option:selected');
        rvIdConceptoDet1 = $option.val().toString();

        ractualizarTotalSolicitado(parseInt($("#rcbxTipoCpbteCompModal1").val()), rvIdConceptoDet1);
        rseleccionarConsideracion(parseInt($("#rcbxTipoCpbteCompModal1").val()), rvIdConceptoDet1);
    });

    $('#rcbxConcepDetModal2').change(function () {
        var $option = $(this).find('option:selected');
        rvIdConceptoDet2 = $option.val().toString();

        ractualizarTotalSolicitado(parseInt($("#rcbxTipoCpbteCompModal2").val()), rvIdConceptoDet2);
        rseleccionarConsideracion(parseInt($("#rcbxTipoCpbteCompModal2").val()), rvIdConceptoDet2);
    });

    $('#rcbxConcepDetModal3').change(function () {
        var $option = $(this).find('option:selected');
        rvIdConceptoDet3 = $option.val().toString();

        ractualizarTotalSolicitado(parseInt($("#rcbxTipoCpbteCompModal3").val()), rvIdConceptoDet3);
        rseleccionarConsideracion(parseInt($("#rcbxTipoCpbteCompModal3").val()), rvIdConceptoDet3);
    });


    function rgetConceptoDet(pTipoCpte, idConceptoCab) {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_ConceptoDetalle',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: {
                idConceptoCab: idConceptoCab,
                idTipoComp: pTipoCpte
            },
            success: function (data) {

                if (pTipoCpte == 1 || pTipoCpte == 2) {
                    // Factura y boleta
                    rconceptoDetalleArray1 = data.lista;
                    rllenarCbxDetalle(pTipoCpte, data.lista);
                }
                else if (pTipoCpte == 3) {
                    // Planilla de Movilidad
                    rconceptoDetalleArray2 = data.lista;
                    rllenarCbxDetalle(pTipoCpte, rconceptoDetalleArray2);

                }
                else if (pTipoCpte == 4) {
                    // Declaracion Jurada.
                    rconceptoDetalleArray3 = data.lista;
                    rllenarCbxDetalle(pTipoCpte, data.lista);
                }

            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rllenarCbxDetalle(pTipoCpte, lista) {

        let firstIdConceptoDet = 0;
        let firstConceptoDet = 0;

        let primerValorBool = true;
        let existeConceptoDetalle = false;



        if (pTipoCpte == 1 || pTipoCpte == 2) {

            // Factura y Boleta

            $("#rcbxConcepDetModal1").empty();

            $.each(lista, function () {
                existeConceptoDetalle = false;

                if (primerValorBool) {
                    firstIdConceptoDet = this.idConceptoDet;
                    firstConceptoDet = this.conceptoDet;

                    primerValorBool = false;
                }

                //for (var i = 0; i < rdetComprobanteArray1.length; i++) {
                //    if (rdetComprobanteArray1[i].idConcepDet == this.idConceptoDet) {
                //        existeConceptoDetalle = true;
                //    }
                //}

                //if (!existeConceptoDetalle) {

                if (this.idConceptoDet != 25) {

                    $("#rcbxConcepDetModal1").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));

                }



                //}
            });

            $("#rcbxConcepDetModal1").val(firstIdConceptoDet);

            rvIdConceptoDet1 = firstIdConceptoDet;
            rvConceptoDet1 = firstConceptoDet;

            ractualizarTotalSolicitado(pTipoCpte, firstIdConceptoDet);
            rseleccionarConsideracion(pTipoCpte, firstIdConceptoDet);

        }
        else if (pTipoCpte == 3) {

            // Planilla de Movilidad
            $("#rcbxConcepDetModal2").empty();

            $.each(lista, function () {
                existeConceptoDetalle = false;

                if (this.idConceptoDet != 22 && this.idConceptoDet != 23 && this.idConceptoDet != 24) {

                    if (primerValorBool) {
                        firstIdConceptoDet = this.idConceptoDet;
                        firstConceptoDet = this.conceptoDet;

                        primerValorBool = false;
                    }

                    for (var i = 0; i < rdetComprobanteArray2.length; i++) {

                        if (rdetComprobanteArray2[i].idConcepDet == this.idConceptoDet) {
                            existeConceptoDetalle = true;
                        }
                    }

                    if (!existeConceptoDetalle) {

                            $("#rcbxConcepDetModal2").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));
                    }

                    }
            });


            $("#rcbxConcepDetModal2").val(firstIdConceptoDet);

            rvIdConceptoDet2 = firstIdConceptoDet;
            rvConceptoDet2 = firstConceptoDet;

            ractualizarTotalSolicitado(pTipoCpte, rvIdConceptoDet2);
            rseleccionarConsideracion(pTipoCpte, rvIdConceptoDet2);


        }
        else if (pTipoCpte == 4) {

            // Declaracion Jurada.
            $("#rcbxConcepDetModal3").empty();

            $.each(lista, function () {
                existeConceptoDetalle = false;

                if (primerValorBool) {
                    firstIdConceptoDet = this.idConceptoDet;
                    firstConceptoDet = this.conceptoDet;

                    primerValorBool = false;
                }

                for (var i = 0; i < rdetComprobanteArray3.length; i++) {
                    if (rdetComprobanteArray3[i].idConcepDet == this.idConceptoDet) {
                        existeConceptoDetalle = true;
                    }
                }

                if (!existeConceptoDetalle) {
                    $("#rcbxConcepDetModal3").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));
                }
            });

            $("#rcbxConcepDetModal3").val(firstIdConceptoDet);

            rvIdConceptoDet3 = firstIdConceptoDet;
            rvConceptoDet3 = firstConceptoDet;

            ractualizarTotalSolicitado(pTipoCpte, rvIdConceptoDet3);
            rseleccionarConsideracion(pTipoCpte, rvIdConceptoDet3);
        }


    }

    function ractualizarTotalSolicitado(pTipoCpte, pIdConceptoDet) {

        if (pTipoCpte == 1 || pTipoCpte == 2) {
            // Factura y Boleta
            if (rvIdTipoMod == 1) {
                rvTotalSolicitado1 = rconceptoDetalleArray1.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoS;
            }
            else if (rvIdTipoMod == 2) {
                rvTotalSolicitado1 = rconceptoDetalleArray1.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoD;
            }
            //$("#ridMontoSolicitadoModal1").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado1));
        }
        else if (pTipoCpte == 3) {
            // Planilla de Movilidad
            if (rvIdTipoMod == 1) {
                rvTotalSolicitado2 = rconceptoDetalleArray2.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoS;
            }
            else if (rvIdTipoMod == 2) {
                rvTotalSolicitado2 = rconceptoDetalleArray2.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoD;
            }
            //$("#ridMontoSolicitadoModal2").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado2));
        }
        else if (pTipoCpte == 4) {
            // Planilla de Movilidad
            if (rvIdTipoMod == 1) {
                rvTotalSolicitado3 = rconceptoDetalleArray3.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoS;
            }
            else if (rvIdTipoMod == 2) {
                rvTotalSolicitado3 = rconceptoDetalleArray3.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoD;
            }
            //$("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3));
        }

    }

    function rseleccionarConsideracion(pTipoCpte, pIdConceptoDet) {

        let consideracion = "";

        if (pTipoCpte == 1 || pTipoCpte == 2) {
            // Factura y Boleta
            consideracion = rconceptoDetalleArray1.find(x => x.idConceptoDet == pIdConceptoDet).consideracion;
            $("#rtxtConsideracionModal1").val(consideracion);
        }
        else if (pTipoCpte == 3) {
            // Planilla de Movilidad
            consideracion = rconceptoDetalleArray2.find(x => x.idConceptoDet == pIdConceptoDet).consideracion;
            $("#rtxtConsideracionModal2").val(consideracion);
        }
        else if (pTipoCpte == 4) {
            // Declaracion Jurada
            consideracion = rconceptoDetalleArray3.find(x => x.idConceptoDet == pIdConceptoDet).consideracion;
            $("#rtxtConsideracionModal3").val(consideracion);
        }

    }

    $('#rcbxConcepDet').change(function () {

        let $option = $(this).find('option:selected');
        rvIdConcepDet = $option.val();
        rvConcepDet = $option.text();

        ractualizarTotalSolicitado(rvIdConcepDet, 1);
        rseleccionarConsideracion(rvIdConcepDet);

    });

    $('#rdetalleConceptoInsertarEditar').on('change', '.cdias', function (e) {

        rsumTotalDetalle = 0;

        $("#rdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {

            let valorPre = "";
            let valorActual = 0;

            let idConceptoDetCheckbox = $(obj).attr("data-id");
            let valorMaximoS = $(obj).attr("data-valor-maxs");
            let valorMaximoD = $(obj).attr("data-valor-maxd");

            if (rconceptoDetArray[i].isChecked == true) {

                rconceptoDetArray[i].seleccionadoDet = 1;
                rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                rconceptoDetArray[i].montoSolicitado = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();


                valorPre = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                    valorActual = 0;
                }
                else {
                    valorActual = parseFloat(valorPre);
                }

                // SOLES
                if (vIdTipoMod == 1) {

                    if (valorActual > parseFloat(valorMaximoS)) {

                        $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                        valorActual = 0;

                        Swal.fire({
                            title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                    }

                    rsumTotalDetalle = rsumTotalDetalle + (valorActual * parseFloat(rconceptoDetArray[i].cantDias));
                }
                else if (vIdTipoMod == 2) {
                    // DOLAR

                    if (valorActual > parseFloat(valorMaximoD)) {

                        $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                        valorActual = 0;

                        Swal.fire({
                            title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD.toString(),
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                    }

                    rsumTotalDetalle = rsumTotalDetalle + (valorActual * parseFloat(rconceptoDetArray[i].cantDias));
                }
            }
            else {

                rconceptoDetArray[i].seleccionadoDet = 0;
                rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();
            }
        });

        $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));

    });

    $('#rmodalSolDetInsertar').on('shown.bs.modal', function (e) {

        let idConceptoDet = 0;
        let primerCantDias = 0;
        let primerLoopCbxDia = true;

        if (rswitchInsertarEditar == 2) {
            $("#rdetalleConceptoInsertarEditar .cdias").each(function (i, obj) {

                idConceptoDet = $(this).attr("data-id");
                $("#ridmCbxConcepCab").prop("disabled", true);

                $.each(rdiasArray, function () {
                    if (primerLoopCbxDia) {
                        primerCantDias = this.codDia;
                    }
                    primerLoopCbxDia = false;
                });

                let dias = rdiasArrayEditar.find(x => x.idConceptoDet == idConceptoDet).cantDias;

                if (dias > 0) {
                    $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(dias);
                }
                else {
                    $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(primerCantDias);
                }
            });
        }

    });

    $('#ridBusquedaColaborador').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        let filtro = $("#ridBusquedaColaborador").val();

        if (keycode == '13') {

            if (filtro == "") {
                Swal.fire({
                    title: 'Ingrese el filtro para la busqueda',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("ridBusquedaColaborador").focus();
                    }
                });
            }
            else {

                $.ajax({
                    url: "/finanzas/RG_ColaboradorSofya",
                    type: "GET",
                    data: { 'filtro': filtro, 'nivelInterfaz': sNIVEL_INTERFAZ },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            let tabla = $("#rtblColaborador").DataTable();

                            tabla.destroy();
                            var tr = "";

                            resultado.lista.forEach((obj) => {

                                tr += "<tr> "
                                    + " <td> " + obj.codsofya + "</td>"
                                    + " <td> " + obj.colaborador + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-ctpava='" + obj.ctpava + "' data-canvar='" + obj.canvar + "' data-codceco=" + obj.codceco + " data-codsofya='" + obj.codsofya + "' data-colaborador='" + obj.colaborador + "' data-toggle='collapse' class='btn btn-sm btn-success cseleccionar ml-1'><i class='fas fa-check'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            });

                            $("#rtblColaboradorContent").html(tr);

                            $("#rtblColaborador").DataTable(
                                {
                                    searching: false,
                                    paging: false,
                                    info: false,
                                    "scrollY": "250px",
                                    "scrollCollapse": true,
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
                                });
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

            }

        }
    });

    $('#rtblColaborador').on('click', '.cseleccionar', function (e) {

        rvCodColSofya = $(this).attr("data-codsofya");
        rvColaboradorSofya = $(this).attr("data-colaborador");
        rvctpava_bnfcol = $(this).attr("data-ctpava");
        rvcanvar_bnfcol = $(this).attr("data-canvar");
        rvCodCeCo = $(this).attr("data-codceco");

        rvcolaborador = $.trim(rvColaboradorSofya);

        $("#rtxtcolaborador").val($.trim(rvColaboradorSofya));

        $("#rtxtDNIModal2").val(rvcanvar_bnfcol);
        $("#rtxtDNIModal3").val(rvcanvar_bnfcol);
        $("#rtxtApeNomModal2").val(rvcolaborador);
        $("#rtxtApeNomModal3").val(rvcolaborador);

        $("#rcbxCeCo1").val(rvCodCeCo);
        rvCeCo = $("#rcbxCeCo1 option:selected").text();

        $("#rmodalColaboradorSofya").modal("hide");
    });

    $("#rbtnBuscarColaborador").click(function () {
        $("#rmodalColaboradorSofya").modal("show");
    });

    $("#rbtnAnularSolicitud").click(function () {

        if (rvIdSolicitud > 0) {

            var options = {};

            $.map(stiposAnulacionCabArray,
                function (o) {
                    options[o.id] = o.name;
                });

            Swal.fire({
                title: 'Seleccione el motivo de la Anulación de solicitud',
                icon: 'info',
                input: 'select',
                inputOptions: options,
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Ok'

            }).then((result) => {

                if (result.value) {

                    let parametro = {
                        'opcion': 8,
                        'opcionTipoAprob': 0,
                        'idSolicitud': parseInt(rvIdSolicitud),
                        'secuencia': 0,
                        'valorEntrega': 0,
                        'usuario': USUARIO,
                        'nivelInterfaz': rNIVEL_INTERFAZ,
                        'idAnulado': parseInt(result.value),
                        'idAnuladoDet': 0
                    };

                    $.ajax({
                        url: "/finanzas/RG_AnularSolicitud",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {

                                if (resultado.status.idResponse > 0) {
                                    rmensajePrincipal(true, resultado.status.statusResponse);


                                    rindicadorEstado(resultado.status.idResponse);
                                    $("#restado-desc").text(resultado.status.statusResponse);

                                }
                                else {
                                    rmensajePrincipal(false, resultado.status.statusResponse);
                                }


                                $("#rbtnAnularSolicitud").removeClass("btn-danger");
                                $("#rbtnAnularSolicitud").addClass("btn-secondary");
                                document.getElementById("rbtnAnularSolicitud").disabled = true;

                                $("#rbtnGenerarComprobante").removeClass("btn-success");
                                $("#rbtnGenerarComprobante").addClass("btn-secondary");
                                document.getElementById("rbtnGenerarComprobante").disabled = true;

                                rconceptoDetArray = [];
                                rgetListaDetalle(rvIdSolicitud);

                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }

            });

        }
        else {
            Swal.fire({
                title: 'No existe solicitud para anular',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }


    });




    // Funciones Generales

    function formatoNumero(x) {
        x = x.toFixed(2);
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function rmensajePrincipal(estado, mensaje) {
        if (estado == true) {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'success',
                title: mensaje
            });

        }
        else if (estado == false) {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'error',
                title: mensaje
            });

        }
    }

    $("#rdetalleConceptoInsertarEditar").on("keyup", ".cmontosolicitar", function () {

        rsumTotalDetalle = 0;

        $("#rdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
            idConceptoDet = $(obj).attr("data-idconceptodet");

            let valorMaximoS = $(obj).attr("data-valor-maxs");
            let valorMaximoD = $(obj).attr("data-valor-maxd");

            if (rconceptoDetArray[i].idConceptoDet == idConceptoDet && rconceptoDetArray[i].isChecked == true) {
                let valorActual = 0;
                let cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();


                if ($(obj).val() == null || typeof ($(obj).val()) == "undefined" || $(obj).val().trim() == "") {
                    valorActual = 0;
                }
                else {
                    valorActual = parseFloat($(obj).val());
                }


                // SOLES
                if (vIdTipoMod == 1) {
                    if (valorActual > parseFloat(valorMaximoS)) {

                        $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                        valorActual = 0;

                        Swal.fire({
                            title: 'El monto ingresado no puede ser mayor al máximo permitido por día S/.' + valorMaximoS.toString(),
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                    }

                }
                else if (vIdTipoMod == 2) {
                    // DOLAR

                    if (valorActual > parseFloat(valorMaximoD)) {

                        $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                        valorActual = 0;

                        Swal.fire({
                            title: 'El monto ingresado no puede ser mayor al máximo permitido por día U$ ' + valorMaximoD.toString(),
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                        document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                    }
                }

                rsumTotalDetalle = rsumTotalDetalle + (valorActual * parseFloat(cantDias));
            }
        });

        $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));
    });

    $("#rtabRendicionGastos").on("click", ".rctabRegComp", function () {
        let index = $(this).attr("data-id");
        rtabSeleccionado = parseInt(index);
    });

    $('.rcfecha').change(function () {

        var inputDate = new Date(this.value);
        var today = new Date();

        if (inputDate > today) {


            $(this).val(FormatoFecha(today, "-"));

            Swal.fire({
                title: 'La fecha no puede ser mayor a la fecha Actual',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }

    });

    $("#rtblDetalleContent").on('click', '.seleccion', function () {

        let idsolicitud = $(this).attr("data-idsolicitud");
        let secuencia = $(this).attr("data-secuencia");
        let valor = $(this).attr("data-valor");
        let total = $(this).attr("data-total");
        let codceco = $(this).attr("data-codceco");
        let ceco = $(this).attr("data-ceco");
        let totalRestante = $(this).attr("data-restante");

        if ($(this).prop("checked")) {
            rdetalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), total: parseFloat(total), codceco: codceco, ceco: ceco, totalrestante: parseFloat(totalRestante) });

        } else {

            for (var i = 0; i < rdetalleArray.length; i++) {
                if (rdetalleArray[i].idsolicitud == idsolicitud && rdetalleArray[i].secuencia == secuencia) {
                    rdetalleArray.splice(i, 1);
                }
            }
        }
    });


    function restadoSolicitud(pIdSolicitud) {
        $.ajax({
            url: "/finanzas/RG_restadoSolicitud",
            type: "GET",
            data: { idSolicitud: pIdSolicitud },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {
                    $("#restado-desc").text(resultado.entidad.estado);
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    }

    function rgetTipoComprobantes() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_TipoComprobantes',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                let primerValorBool = true;

                rtiposComprobantesArray = data.lista;

                $("#rcbxTipoCpbteCompModal1").empty();
                $("#rcbxTipoCpbteCompModal2").empty();
                $("#rcbxTipoCpbteCompModal3").empty();

                $.each(data.lista, function () {
                    if (primerValorBool) {
                        rvCodTipoComprobante = this.idTipoComp;
                    }

                    if (this.idTipoComp == 1 || this.idTipoComp == 2) {
                        $("#rcbxTipoCpbteCompModal1").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                    }
                    else if (this.idTipoComp == 3) {
                        $("#rcbxTipoCpbteCompModal2").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                    }
                    else if (this.idTipoComp == 4) {
                        $("#rcbxTipoCpbteCompModal3").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                    }

                    primerValorBool = false;
                });

                rcambioTipoCpte(rvCodTipoComprobante);

                $("#rcbxTipoCpbteCompModal1").val(rvCodTipoComprobante);
                $("#rcbxTipoCpbteCompModal2").val(3); // Planilla de Movilidad
                $("#rcbxTipoCpbteCompModal3").val(4); // Declaracion Jurada

                document.getElementById("rcbxTipoCpbteCompModal2").disabled = true;
                document.getElementById("rcbxTipoCpbteCompModal3").disabled = true;

                rgetConceptoCab();

            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function rgetTipoMoneda() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_TiposDeMoneda',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#rcbxMonedaModal1").empty();
                $("#rcbxMonedaModal2").empty();
                $("#rcbxMonedaModal3").empty();

                $.each(data.lista, function () {
                    $("#rcbxMonedaModal1").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                });
                $.each(data.lista, function () {
                    $("#rcbxMonedaModal2").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                });
                $.each(data.lista, function () {
                    $("#rcbxMonedaModal3").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                });

                $("#rcbxMonedaModal1").val(0);
                $("#rcbxMonedaModal2").val(0);
                $("#rcbxMonedaModal3").val(0);
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    $('#rtxtDNIModal2').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {
            let dni = $("#rtxtDNIModal2").val().trim();
            rbusquedaXDNI(dni, rtabSeleccionado)
        }
    });

    $('#rtxtDNIModal3').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {
            let dni = $("#rtxtDNIModal3").val().trim();
            rbusquedaXDNI(dni, rtabSeleccionado)
        }
    });

    $('#rmodalSolDetInsertar').on('hidden.bs.modal', function (e) {
        $("#rtxtRUCModal").val("");
        $("#rtxtRSModal").val("");
        $("#rtxtDireccionModal").val("");
    });

    $("#rbtnAgregarMotivo1").click(function () {
        
        if (rvalidacionDetCmpbte(rtabSeleccionado)) {

            //let cantidad = parseFloat($("#txtCantidad1").val());
            let cantidad = 1;
            let valorUnitarioTotal = parseFloat($("#rtxtValorUnitarioTotal1").val());
            let valorUnitario = 0;

            if ($("#rcbxTipoCpbteCompModal1").val().trim() == "1") {
                if (rswitch) {
                    valorUnitario = (valorUnitarioTotal) / ((PORCENTAJE_IGV / 100) + 1);
                }
                else {
                    valorUnitario = (valorUnitarioTotal);
                }
            }
            else if ($("#rcbxTipoCpbteCompModal1").val().trim() == "2") {
                valorUnitario = (valorUnitarioTotal);
            }


            let total = (cantidad * valorUnitarioTotal);

            const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                return acc += item.totalrestante
            }, 0);

            const sumAgregadosDet = rdetComprobanteArray1.reduce((acc, item) => {
                return acc += item.total;
            }, 0);


            riDetalle1++;

            var now = new Date();

            rdetComprobanteArray1.push({
                idSolicitud: rvIdSolicitud,
                idConcepCab: rvIdConceptoCab1,
                idConcepDet: rvIdConceptoDet1,
                conceptoDet: rvConceptoDet1,
                iDetalle: riDetalle1,
                fecha: FormatoFecha(now, "/"),
                fechaBD: FormatoFecha(now, ""),
                detalle1: ($("#rcbxTipoCpbteCompModal1").val().trim() == "1" ? $("#rtxtDescripcion1").val() : $("#rtxtObsCompModal1").val()),
                detalle2: "",
                codum: $("#rcbxUM1").val(),
                valorunit: valorUnitario,
                cantidad: cantidad,
                total: total,
                seccion: 1,
                codCeCo: rvCodCeCo,
                idTipo: rvIdTipo
            });


            let tabla = $("#rtblFacturaBoleta").DataTable();

            tabla.destroy();
            var tr = "";

            rdetComprobanteArray1.forEach((obj) => {

                tr += "<tr> "
                    + " <td> </td>"
                    + " <td> " + obj.codum + "</td>"
                    + " <td> " + obj.conceptoDet + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    //+ " <td> " + obj.cantidad + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td> " + formatoNumero(obj.total) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });

            $("#rtblFacturaBoletaContent").html(tr);

            $("#rtblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                });


            const importeTotal = rdetComprobanteArray1.reduce((acc, item) => {
                return acc += (item.valorunit * item.cantidad);
            }, 0);


            if ($("#rcbxTipoCpbteCompModal1").val().trim() == "1") {
                // FACTURA
                $("#ridimportetotal1").val(formatoNumero(importeTotal));

                if (rswitch) {
                    $("#ridigv1").val(formatoNumero(importeTotal * (PORCENTAJE_IGV / 100)));
                    $("#ridtotal1").val(formatoNumero(importeTotal + (importeTotal * (PORCENTAJE_IGV / 100))));
                }
                else {
                    $("#ridigv1").val("0");
                    $("#ridtotal1").val(formatoNumero(importeTotal));
                }


                $("#rtxtDescripcion1").val("");
                //$("#txtCantidad1").val("");
                $("#rtxtValorUnitarioTotal1").val("");

                document.getElementById("rcbxUM1").focus = true;
            }
            else if ($("#rcbxTipoCpbteCompModal1").val().trim() == "2") {
                // BOLETA
                $("#ridimportetotal1").val(formatoNumero(importeTotal));
                $("#ridigv1").val(0);
                $("#ridtotal1").val(formatoNumero(importeTotal));

                $("#rcbxUM1").val("UN");
                $("#rtxtDescripcion1").val("");
                //$("#txtCantidad1").val("1");
                $("#rtxtValorUnitarioTotal1").val("");

                document.getElementById("rtxtValorUnitarioTotal1").focus = true;
            }


            const totalDetalle = rdetComprobanteArray1.reduce((acc, item) => {

                //if (item.idConcepDet == rvIdConcepDet) {
                acc += item.total;
                //}
                return acc;
            }, 0);

            // Descontar del monto maximo del Item de detalle.
            //const consumidoXDetalle = rdetComprobanteArray1.reduce((acc, item) => {
            //    if (item.idConcepDet == rvIdConcepDet) {
            //        acc += item.total;
            //    }
            //    return acc;
            //}, 0);


            document.getElementById("rcbxConcepCabModal1").disabled = true;
            document.getElementById("rcbxConcepDetModal1").disabled = true;
            document.getElementById("rtxtObservacionModal1").disabled = true;

            //$("#ridMontoSolicitadoModal1").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado1 - totalDetalle));
            //$("#ridMontoSolicitadoModal1").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado1));
        }

    });

    var rdetCpteArrayValid2 = [];
    var ri2 = 0;

    $("#rbtnAgregarMotivo2").click(function () {

        if (rvalidacionDetCmpbte(rtabSeleccionado)) {

            let importeIngresado = parseFloat($("#rtxtImporteModal2").val());

            riDetalle2++;
            ri2++;

            let v2_maximoS = 0;
            let v2_maximoD = 0;
            let estadoValidacion = false;
            let valorSigaLoop = true;

            // validar el monto maximo
            rdetCpteArrayValid2.push({ id: riDetalle2, fecha: $("#rtxtFechaModalDet2").val(), monto: parseFloat($("#rtxtImporteModal2").val()) });

            v2_TipoMod = $("#rcbxMonedaModal2").val();

            v2_maximoS = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal2").val())).maximoSoles;
            v2_maximoD = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal2").val())).maximoDolar;


            var result = [];
            var sumXFecha = 0;

            rdetCpteArrayValid2.reduce(function (res, value) {
                if (!res[value.fecha]) {
                    res[value.fecha] = { fecha: value.fecha, monto: 0 };
                    result.push(res[value.fecha])
                }
                res[value.fecha].monto += value.monto;
                return res;
            }, {});

            for (var i = 0; i < result.length; i++) {

                if (valorSigaLoop) {

                    sumXFecha = result[i].monto;

                    if (v2_TipoMod == "1") {
                        // Soles.
                        if (sumXFecha > v2_maximoS) {
                            estadoValidacion = false;

                            Swal.fire({
                                title: 'El monto máximo permitido es S/.' + v2_maximoS,
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            for (var i = 0; i < rdetCpteArrayValid2.length; i++) {
                                if (rdetCpteArrayValid2[i].id == riDetalle2) {
                                    rdetCpteArrayValid2.splice(i, 1);
                                }
                            }
                            $("#rtxtImporteModal2").val("");
                            valorSigaLoop = false;
                        }
                        else {
                            estadoValidacion = true;
                        }
                    }
                    else if (v2_TipoMod == "2") {
                        // Dolar
                        if (sumXFecha > v2_maximoD) {
                            estadoValidacion = false;

                            Swal.fire({
                                title: 'El monto máximo permitido es U$.' + v2_maximoD,
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            for (var i = 0; i < rdetCpteArrayValid2.length; i++) {
                                if (rdetCpteArrayValid2[i].id == riDetalle2) {
                                    rdetCpteArrayValid2.splice(i, 1);
                                }
                            }

                            $("#rtxtImporteModal2").val("");

                            valorSigaLoop = false;
                        }
                        else {
                            estadoValidacion = true;
                        }
                    }
                    else {
                        estadoValidacion = true;
                    }
                }
            }

            if (estadoValidacion) {

                rdetComprobanteArray2.push({
                    idSolicitud: rvIdSolicitud,
                    idConcepCab: rvIdConceptoCab2,
                    idConcepDet: rvIdConceptoDet2,
                    conceptoDet: rvConceptoDet2,
                    observacionDet: $("#rtxtObservacionModal2").val(),
                    iDetalle: riDetalle2,
                    fecha: FormatoFecha($("#rtxtFechaModalDet2").val(), "/"),
                    fechaBD: FormatoFecha($("#rtxtFechaModalDet2").val(), ""),
                    detalle1: $("#rtxtOrgDstModal2").val(),
                    detalle2: $("#rtxtMotivoModal2").val(),
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#rtxtImporteModal2").val()),
                    cantidad: 1,
                    total: parseFloat($("#rtxtImporteModal2").val()),
                    seccion: 1,
                    codCeCo: rvCodCeCo,
                    idTipo: rvIdTipo
                });

                let tabla = $("#rtblPlanillaMovilidad").DataTable();

                tabla.destroy();
                var tr = "";

                rdetComprobanteArray2.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> </td>"
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + obj.detalle2 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#rtblPlanillaMovilidadContent").html(tr);

                $("#rtblPlanillaMovilidad").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    });

                $("#rtxtOrgDstModal2").val("");
                $("#rtxtMotivoModal2").val("");
                $("#rtxtImporteModal2").val("");

                document.getElementById("rtxtOrgDstModal2").focus = true;

                document.getElementById("rcbxConcepCabModal2").disabled = true;
                document.getElementById("rcbxConcepDetModal2").disabled = true;
                document.getElementById("rtxtObservacionModal2").disabled = true;

                const sumAgregadosDet = rdetComprobanteArray2.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);

                $("#rrembsumtotal").text("Suma Total: " + rvSimboloMoneda + "" + formatoNumero(sumAgregadosDet));

            }
        }
    });


    $("#rbtnAgregarMotivo3_1").click(function () {

        if (rvalidacionDetCmpbte(rtabSeleccionado)) {

            let respuesta = false;
            let importeIngresado = parseFloat($("#rtxtMontoDet3_1").val());

            if (importeIngresado == "0" || importeIngresado == "" || typeof (importeIngresado) == "undefined" || isNaN(importeIngresado)) {

                Swal.fire({
                    title: 'Ingrese un monto',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (parseFloat(importeIngresado) <= 0) {

                Swal.fire({
                    title: 'Ingrese un monto positivo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            else {

                let sumTotal3 = 0;
                let v3_TipoMod = $("#rcbxMonedaModal3").val();
                let v3_maximoS = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal3").val())).maximoSoles;
                let v3_maximoD = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal3").val())).maximoDolar;

                // Validar si excede el monto maximo.
                if (v3_TipoMod.toString() == 1) {

                    // Soles.
                    if (rdetComprobanteArray3.length > 0) {
                        sumTotal3 = rdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#rtxtMontoDet3_1").val());
                    }

                    if (parseFloat(sumTotal3) > v3_maximoS) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es S/.' + v3_maximoS,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }

                }
                else if (v3_TipoMod.toString() == 2) {

                    // Dolar.
                    if (rdetComprobanteArray2.length > 0) {
                        sumTotal3 = rdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#rtxtMontoDet3_1").val());
                    }


                    if (parseFloat(sumTotal3) > v3_maximoD) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es U$ ' + v3_maximoD,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }


                // Paso la validacion.
                if (respuesta) {

                    const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
                        return acc += (item.valorunit * item.cantidad);
                    }, 0);

                    riDetalle3++;

                    rdetComprobanteArray3.push({
                        idSolicitud: rvIdSolicitud,
                        idConcepCab: rvIdConceptoCab3,
                        idConcepDet: rvIdConceptoDet3,
                        conceptoDet: rvConceptoDet3,
                        iDetalle: riDetalle3,
                        fecha: FormatoFecha($("#rtxtFechaModalDet3_1").val(), "-"),
                        fechaBD: FormatoFecha($("#rtxtFechaModalDet3_1").val(), ""),
                        detalle1: $("#rcbxMonedaModal3 option:selected").text(),
                        detalle2: "",
                        codum: "UN", // UNIDAD
                        valorunit: parseFloat($("#rtxtMontoDet3_1").val()),
                        cantidad: 1,
                        total: parseFloat($("#rtxtMontoDet3_1").val()),
                        seccion: 1,
                        codCeCo: rvCodCeCo,
                        idTipo: rvIdTipo
                    });

                    let tabla = $("#rtblDeclaracionJurada3_1").DataTable();

                    tabla.destroy();
                    var tr = "";

                    rdetComprobanteArray3.forEach((obj) => {
                        if (obj.seccion == 1) {

                            tr += "<tr> "
                                + " <td> </td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        }
                    });

                    $("#rtblDeclaracionJuradaContent3_1").html(tr);

                    $("#rtblDeclaracionJurada3_1").DataTable(
                        {
                            'language': { 'url': '/libs/datatables/spanish.json' },
                            lengthMenu: [[5], [5]]
                        });

                    $("#rtxtMontoDet3_1").val("");

                    document.getElementById("rtxtFechaModalDet3_1").focus = true;


                    // Descontar del monto maximo del Item de detalle.
                    const consumidoXDetalle = rdetComprobanteArray3.reduce((acc, item) => {
                        //if (item.seccion == 1) {
                        acc += item.total;
                        //}
                        return acc;
                    }, 0);

                    document.getElementById("rcbxConcepCabModal3").disabled = true;
                    document.getElementById("rcbxConcepDetModal3").disabled = true;
                    document.getElementById("rtxtObservacionModal3").disabled = true;

                    //$("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3 - consumidoXDetalle));
                    //$("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3));

                }
            }
        }
    });

    $("#rbtnAgregarMotivo3_2").click(function () {

        if (rvalidacionDetCmpbte(rtabSeleccionado)) {

            let respuesta = false;
            let importeIngresado = parseFloat($("#rtxtMontoDet3_2").val());

            if (importeIngresado == "0" || importeIngresado == "" || typeof (importeIngresado) == "undefined" || isNaN(importeIngresado)) {

                Swal.fire({
                    title: 'Ingrese un monto',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (parseFloat(importeIngresado) <= 0) {

                Swal.fire({
                    title: 'Ingrese un monto positivo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            else {

                let sumTotal3 = 0;
                let v3_TipoMod = $("#rcbxMonedaModal3").val();
                let v3_maximoS = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal3").val())).maximoSoles;
                let v3_maximoD = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal3").val())).maximoDolar;

                // Validar si excede el monto maximo.
                if (v3_TipoMod.toString() == 1) {

                    // Soles.
                    if (rdetComprobanteArray3.length > 0) {
                        sumTotal3 = rdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#rtxtMontoDet3_2").val());
                    }

                    if (parseFloat(sumTotal3) > v3_maximoS) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es S/.' + v3_maximoS,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }

                }
                else if (v3_TipoMod.toString() == 2) {

                    // Dolar.
                    if (zdetComprobanteArray3.length > 0) {
                        sumTotal3 = zdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#rtxtMontoDet3_2").val());
                    }

                    if (parseFloat(sumTotal3) > v3_maximoD) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es U$ ' + v3_maximoD,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }


                if (respuesta) {

                    riDetalle3++;

                    rdetComprobanteArray3.push({
                        idSolicitud: rvIdSolicitud,
                        idConcepCab: rvIdConceptoCab3,
                        idConcepDet: rvIdConceptoDet3,
                        conceptoDet: rvConceptoDet3,
                        iDetalle: riDetalle3,
                        fecha: FormatoFecha($("#rtxtFechaModalDet3_2").val(), "-"),
                        fechaBD: FormatoFecha($("#rtxtFechaModalDet3_2").val(), ""),
                        detalle1: $("#rcbxMonedaModal3 option:selected").text(),
                        detalle2: "",
                        codum: "UN", // UNIDAD
                        valorunit: parseFloat($("#rtxtMontoDet3_2").val()),
                        cantidad: 1,
                        total: parseFloat($("#rtxtMontoDet3_2").val()),
                        seccion: 2,
                        codCeCo: rvCodCeCo,
                        idTipo: rvIdTipo
                    });

                    let tabla = $("#rtblDeclaracionJurada3_2").DataTable();

                    tabla.destroy();
                    var tr = "";

                    rdetComprobanteArray3.forEach((obj) => {
                        if (obj.seccion == 2) {

                            tr += "<tr> "
                                + " <td> </td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        }
                    });

                    $("#rtblDeclaracionJuradaContent3_2").html(tr);

                    $("#rtblDeclaracionJurada3_2").DataTable(
                        {
                            'language': { 'url': '/libs/datatables/spanish.json' },
                            lengthMenu: [[5], [5]]
                        });

                    $("#rtxtMontoDet3_2").val("");

                    document.getElementById("rtxtFechaModalDet3_2").focus = true;


                    // Descontar del monto maximo del Item de detalle.
                    const consumidoXDetalle = rdetComprobanteArray3.reduce((acc, item) => {
                        //if (item.seccion == 2) {
                        acc += item.total;
                        //}
                        return acc;
                    }, 0);

                    document.getElementById("rcbxConcepCabModal3").disabled = true;
                    document.getElementById("rcbxConcepDetModal3").disabled = true;
                    document.getElementById("rtxtObservacionModal3").disabled = true;

                    //$("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3 - consumidoXDetalle));
                    //$("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3));

                }
            }
        }
    });

    $("#rtblFacturaBoleta").on("click", ".cselectEliminar1", function () {

        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < rdetComprobanteArray1.length; i++) {
            if (rdetComprobanteArray1[i].iDetalle == parseInt(vIDetalle)) {
                rdetComprobanteArray1.splice(i, 1);
            }
        }

        const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
            return acc += item.totalrestante
        }, 0);

        const sumAgregadosDet = rdetComprobanteArray1.reduce((acc, item) => {
            return acc += (item.total);
        }, 0);

        $("#rkpiMontoSeleecionadoModal1").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        if ((sumDetalleSol - sumAgregadosDet) < 0) {
            $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
        }
        else {
            $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
        }

        let tabla = $("#rtblFacturaBoleta").DataTable();

        tabla.destroy();
        var tr = "";

        rdetComprobanteArray1.forEach((obj) => {

            tr += "<tr> "
                + " <td></td>"
                + " <td> " + obj.codum + "</td>"
                + " <td> " + obj.conceptoDet + "</td>"
                + " <td> " + obj.detalle1 + "</td>"
                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                + " <td> " + formatoNumero(obj.total) + "</td>"
                + " <td class='text-center'>"
                + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                + "</td>"
                + "</tr>";
        });


        $("#rtblFacturaBoletaContent").html(tr);

        $("#rtblFacturaBoleta").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[5], [5]]
            });


        const importeTotal = rdetComprobanteArray1.reduce((acc, item) => {
            return acc += (item.valorunit * item.cantidad);
        }, 0);


        if ($("#rcbxTipoCpbteCompModal1").val().trim() == "1") {
            // FACTURA
            $("#rtxtDescripcion1").val("");
            //$("#txtCantidad1").val("");
            $("#rtxtValorUnitarioTotal1").val("");

            $("#ridimportetotal1").val(formatoNumero(importeTotal));
            $("#ridigv1").val(formatoNumero(importeTotal * (PORCENTAJE_IGV / 100)));
            $("#ridtotal1").val(formatoNumero(importeTotal + (importeTotal * (PORCENTAJE_IGV / 100))));
        }
        else if ($("#rcbxTipoCpbteCompModal1").val().trim() == "2") {
            // BOLETA
            $("#rtxtDescripcion1").val("");
            //$("#txtCantidad1").val("1");
            $("#rtxtValorUnitarioTotal1").val("");

            $("#ridimportetotal1").val(formatoNumero(importeTotal));
            $("#ridigv1").val(0);
            $("#ridtotal1").val(formatoNumero(importeTotal));
        }


        document.getElementById("rcbxUM1").focus = true;



        //$("#rkpiMontoSeleecionadoModal1").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        //$("#ridMontoSolicitadoModal1").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado1 - sumAgregadosDet));

    });

    $("#rtblPlanillaMovilidad").on("click", ".cselectEliminar2", function () {
        let vIDetalle = $(this).attr("data-iDetalle");

        for (var i = 0; i < rdetComprobanteArray2.length; i++) {
            if (rdetComprobanteArray2[i].iDetalle == parseInt(vIDetalle)) {
                rdetComprobanteArray2.splice(i, 1);
            }
        }

        for (var i = 0; i < rdetCpteArrayValid2.length; i++) {
            if (rdetCpteArrayValid2[i].id == vIDetalle) {
                rdetCpteArrayValid2.splice(i, 1);
            }
        }

        const sumAgregadosDet = rdetComprobanteArray2.reduce((acc, item) => {
            return acc += item.valorunit;
        }, 0);


        let tabla = $("#rtblPlanillaMovilidad").DataTable();

        tabla.destroy();
        var tr = "";

        rdetComprobanteArray2.forEach((obj) => {

            tr += "<tr> "
                + " <td> </td>"
                + " <td> " + obj.fecha + "</td>"
                + " <td> " + obj.detalle1 + "</td>"
                + " <td> " + obj.detalle2 + "</td>"
                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                + " <td class='text-center'>"
                + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                + "</td>"
                + "</tr>";
        });

        $("#rtblPlanillaMovilidadContent").html(tr);

        $("#rtblPlanillaMovilidad").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            });

        $("#rtxtOrgDstModal2").val("");
        $("#rtxtMotivoModal2").val("");
        $("#rtxtImporteModal2").val("0");

        document.getElementById("rtxtOrgDstModal2").focus = true;

        $("#rrembsumtotal").text("Suma Total: " + rvSimboloMoneda + "" + formatoNumero(sumAgregadosDet));


        //$("#ridMontoSolicitadoModal2").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado2 - sumAgregadosDet));
        //$("#ridMontoSolicitadoModal2").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado2));
    });

    $("#rtblDeclaracionJurada3_1").on("click", ".cselectEliminar3_1", function () {
        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < rdetComprobanteArray3.length; i++) {
            if (rdetComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                rdetComprobanteArray3.splice(i, 1);
            }
        }

        const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
            return acc += item.valorunit;
        }, 0);


        let tabla = $("#rtblDeclaracionJurada3_1").DataTable();

        tabla.destroy();
        var tr = "";


        rdetComprobanteArray3.forEach((obj) => {

            if (obj.seccion == 1) {
                tr += "<tr> "
                    + " <td></td>"
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            }
        });

        $("#rtblDeclaracionJuradaContent3_1").html(tr);

        $("#rtblDeclaracionJurada3_1").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[5], [5]]
            });

        $("#rtxtMontoDet3_1").val("");

        document.getElementById("rtxtFechaModalDet3_1").focus = true;
        //$("#ridMontoSolicitadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado3 - sumAgregadosDet));
        //$("#ridMontoSolicitadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado3));
    });

    $("#rtblDeclaracionJurada3_2").on("click", ".cselectEliminar3_2", function () {
        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < rdetComprobanteArray3.length; i++) {
            if (rdetComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                rdetComprobanteArray3.splice(i, 1);
            }
        }

        const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
            return acc += item.valorunit;
        }, 0);

        //$("#ridMontoSolicitadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado3 - sumAgregadosDet));
        //$("#ridMontoSolicitadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado3));


        let tabla = $("#rtblDeclaracionJurada3_2").DataTable();

        tabla.destroy();
        var tr = "";


        rdetComprobanteArray3.forEach((obj) => {

            if (obj.seccion == 2) {
                tr += "<tr> "
                    + " <td></td>"
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            }
        });

        $("#rtblDeclaracionJuradaContent3_2").html(tr);

        $("#rtblDeclaracionJurada3_2").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[5], [5]]
            });

        $("#rtxtMontoDet3_2").val("");

        document.getElementById("rtxtFechaModalDet3_2").focus = true;
    });

    $("#rbtnCancelarComprobante").click(function () {

        rlimpiarControlModal(1);
        rlimpiarControlModal(2);
        rlimpiarControlModal(3);
    });

    $("#rbtnGuardarComprobante").click(function () {

        if (rvalidacionGuardarComp(rtabSeleccionado)) {

            let parametro = {};
            let opcion = 0;

            if (rTIPO_REGISTRO == "INSERTAR") {
                opcion = 1;
            }
            else if (rTIPO_REGISTRO == "EDITAR") {
                opcion = 6;
            }

            // 1. Facturas / Boletas
            if (rtabSeleccionado == 1) {

                parametro = {
                    'opcion': opcion,
                    'idRendCompte': rvIdRendCompte,
                    'idTipoComp': parseInt($("#rcbxTipoCpbteCompModal1").val()),

                    'nserie': $("#rtxtSerieModal1").val(),
                    'ndocof': $("#rtxtNumeroModal1").val(),

                    'rucDNI': $("#rtxtRucCompModal1").val(),
                    'rs': $("#rtxtRSCompModal1").val(),
                    'codigoPC': $("#rtxtCodSofyaPCModal1").val(),
                    'obs': $("#rtxtObsCompModal1").val(),
                    'fechaEmision': $("#rtxtFechaModal1").val(),
                    'codceco': rvCodCeCo,
                    'idTipoMod': parseInt($("#rcbxMonedaModal1").val()),
                    'porcentajeIGV': (($("#rcbxTipoCpbteCompModal1").val().trim() == "1" && rswitch) ? PORCENTAJE_IGV : 0),
                    'obs1': '',
                    'obs2': '',
                    'fecha1': '',
                    'fecha2': '',
                    'periodo': $("#rcbxPeriodoModal1").val(),
                    'observacionDet': $("#rtxtObservacionModal1").val(),

                    'detalleComprobanteArray': rdetComprobanteArray1
                };

            }
            else if (rtabSeleccionado == 2) {

                // 2. Planilla de Movilidad
                parametro = {
                    'opcion': opcion,
                    'idRendCompte': rvIdRendCompte,
                    'idTipoComp': 3,

                    'nserie': ($("#ridCbxSede").val() == "C" ? "001" : "002") ,
                    'ndocof': FormatoFecha($("#rtxtFechaModal2").val()),

                    'rucDNI': $("#rtxtDNIModal2").val(),
                    'rs': $("#rtxtApeNomModal2").val(),
                    'codigoPC': "T-" + $("#rtxtDNIModal2").val(),
                    'obs': "PLANILLA DE MOVILIDAD - " + rvcolaborador,
                    'fechaEmision': $("#rtxtFechaModal2").val(),
                    'codceco': rvCodCeCo,
                    'idTipoMod': parseInt($("#rcbxMonedaModal2").val()),
                    'porcentajeIGV': 0,
                    'obs1': '',
                    'obs2': '',
                    'fecha1': '',
                    'fecha2': '',
                    'periodo': $("#rcbxPeriodoModal2").val(),
                    'observacionDet': $("#rtxtObservacionModal2").val(),
                    'sede': $("#ridCbxSede").val(),

                    'detalleComprobanteArray': rdetComprobanteArray2
                };
            }
            else if (rtabSeleccionado == 3) {

                // 2. Declaracion Jurada
                parametro = {
                    'opcion': opcion,
                    'idRendCompte': rvIdRendCompte,
                    'idTipoComp': 4,

                    'nserie': ($("#ridCbxSede").val() == "C" ? "001" : "002"),
                    'ndocof': FormatoFecha($("#rtxtFechaModal3").val(), ""),

                    'rucDNI': $("#rtxtDNIModal3").val(),
                    'rs': $("#rtxtApeNomModal3").val(),
                    'codigoPC': "T-" + $("#rtxtDNIModal3").val(),
                    'obs': "DECLARACIÓN JURADA - " + rvcolaborador,
                    'fechaEmision': $("#rtxtFechaModal3").val(),
                    'codceco': rvCodCeCo,
                    'idTipoMod': parseInt($("#rcbxMonedaModal3").val()),
                    'porcentajeIGV': 0,
                    'obs1': $("#rtxtCiudadModal3").val(),
                    'obs2': $("#rtxtPaisModal3").val(),
                    'fecha1': FormatoFecha($("#rtxtFechaDesdeModal3").val(), ""),
                    'fecha2': FormatoFecha($("#rtxtFechaHastaModal3").val(), ""),
                    'periodo': $("#rcbxPeriodoModal3").val(),
                    'observacionDet': $("#rtxtObservacionModal3").val(),
                    'sede': $("#ridCbxSede").val(),

                    'detalleComprobanteArray': rdetComprobanteArray3
                };
            }


            $.ajax({
                url: "/finanzas/RG_SetReembolsoComprobante",
                type: "post",
                data: parametro,
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        if (resultado.entidad.idResponse > 0) {

                            rvalidarrestadoSolicitud(2, rsolicitudCabCreada.idSolicitud);

                            rlimpiarControlModal(1);
                            rlimpiarControlModal(2);
                            rlimpiarControlModal(3);

                            $("#rregComprobModal").modal("hide");
                        }
                        else {
                            rmensajePrincipal(false, resultado.entidad.statusResponse);

                            console.log(resultado.entidad.statusResponse);
                        }
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        }
    });


    function FormatoFecha(pFecha, separador) {

        //let fechaFormato = new Date(pFecha + 'Z');

        let fechaString = "";

        //fechaString = fechaFormato.toISOString();
        //fechaString = fechaString.substr(0, 10);

        fechaString = moment(pFecha).format("YYYY-MM-DD");

        let fechaPre = fechaString.replace("-", "");
        let fechaFinal = fechaPre.replace("-", "");

        let anio_valor = fechaFinal.substr(0, 4);
        let mes_valor = fechaFinal.substr(4, 2);
        let dia_valor = fechaFinal.substr(6, 2);

        return [anio_valor, mes_valor, dia_valor].join(separador);
    }


    $('#rcbxTipoCpbteCompModal1').change(function () {

        var $option = $(this).find('option:selected');
        rvCodTipoComprobante = parseInt($option.val());

        rdefinirValoresTipoCpte(vCodTipoComprobante);

        $("#ridimportetotal1").val("0");
        $("#ridigv1").val("0");
        $("#ridtotal1").val("0");

        rdetComprobanteArray1 = [];

        let tabla = $("#rtblFacturaBoleta").DataTable();
        tabla.destroy();
        var tr = "";
        $("#rtblFacturaBoletaContent").html(tr);
        $("#rtblFacturaBoleta").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[3], [3]]
            }
        );
    });

    function rdefinirValoresTipoCpte(vCodTipoComprobante) {
        // Limpiar TAB Factura Boleta
        debugger
        if (vCodTipoComprobante == 1) {
            // Factura
            document.getElementById("rcbxConcepCabModal1").disabled = true;
            document.getElementById("rcbxConcepDetModal1").disabled = true;
            //document.getElementById("rcbxTipoCpbteCompModal1").disabled = true;
            document.getElementById("rtxtObservacionModal1").disabled = true;


            document.getElementById("rtxtObsCompModal1").disabled = false;

            document.getElementById("rcbxUM1").disabled = false;
            document.getElementById("rtxtDescripcion1").disabled = false;
            //document.getElementById("rtxtCantidad1").disabled = false;
            document.getElementById("rtxtValorUnitarioTotal1").disabled = false;

            document.getElementById("ridimportetotal1").disabled = true;
            document.getElementById("ridigv1").disabled = true;
            document.getElementById("ridtotal1").disabled = true;

            $('#rswtIGV').bootstrapToggle('on', true);
            rswitch = true;

        }
        else if (vCodTipoComprobante == 2) {
            // Boleta
            document.getElementById("rcbxConcepCabModal1").disabled = true;
            document.getElementById("rcbxConcepDetModal1").disabled = true;
            //document.getElementById("rcbxTipoCpbteCompModal1").disabled = true;
            document.getElementById("rtxtObsCompModal1").disabled = false;
            document.getElementById("rcbxUM1").disabled = true;
            document.getElementById("rtxtDescripcion1").disabled = true;
            //document.getElementById("rtxtCantidad1").disabled = true;
            document.getElementById("rtxtValorUnitarioTotal1").disabled = false;

            $("#rtxtDescripcion1").val("");
            $("#rcbxUM1").val("UN");
            //$("#rtxtCantidad1").val(1);

            document.getElementById("rtxtValorUnitarioTotal1").focus = true;

            $('#rswtIGV').bootstrapToggle('off', true);
            rswitch = false;
        }

        document.getElementById("ridimportetotal1").disabled = true;
        document.getElementById("ridigv1").disabled = true;
        document.getElementById("ridtotal1").disabled = true;

    }

    function rcambioTipoCpte(pCodTipoCpte) {


        // Limpiar TAB Factura Boleta

        if (pCodTipoCpte == 1) {
            // Factura
            document.getElementById("rcbxTipoCpbteCompModal1").disabled = false;
            document.getElementById("rtxtSerieModal1").disabled = false;
            document.getElementById("rtxtNumeroModal1").disabled = false;
            document.getElementById("rtxtObsCompModal1").disabled = false;

            document.getElementById("rcbxUM1").disabled = false;
            document.getElementById("rtxtDescripcion1").disabled = false;
            //document.getElementById("txtCantidad1").disabled = false;
            document.getElementById("rtxtValorUnitarioTotal1").disabled = false;

            document.getElementById("ridimportetotal1").disabled = true;
            document.getElementById("ridigv1").disabled = true;
            document.getElementById("ridtotal1").disabled = true;

            document.getElementById("rtxtSerieModal1").focus = true;
        }
        else if (pCodTipoCpte == 2) {
            // Boleta
            document.getElementById("rcbxTipoCpbteCompModal1").disabled = false;
            document.getElementById("rtxtSerieModal1").disabled = false;
            document.getElementById("rtxtObsCompModal1").disabled = false;

            document.getElementById("rcbxUM1").disabled = true;
            document.getElementById("rtxtDescripcion1").disabled = false;
            document.getElementById("rtxtValorUnitarioTotal1").disabled = false;

            $("#rtxtDescripcion1").val("");
            $("#rcbxUM1").val("UN");

            document.getElementById("rtxtValorUnitarioTotal1").focus = true;

        }

        rdetComprobanteArray1 = [];

        let tabla = $("#rtblFacturaBoleta").DataTable();
        tabla.destroy();
        var tr = "";
        $("#rtblFacturaBoletaContent").html(tr);
        $("#rtblFacturaBoleta").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[3], [3]]
            }
        );

        document.getElementById("ridimportetotal1").disabled = true;
        document.getElementById("ridigv1").disabled = true;
        document.getElementById("ridtotal1").disabled = true;

        $("#ridimportetotal1").val("0");
        $("#ridigv1").val("0");
        $("#ridtotal1").val("0");

        $('#rswtIGV').bootstrapToggle('off', true);
            rswitch = false;
        }


    $("#rtabRendicionGastos").on("click", ".rctabRegComp", function () {
        let index = $(this).attr("data-id");
        rtabSeleccionado = parseInt(index);
    });


    $('#rregComprobModal').on('shown.bs.modal', function (e) {

        var now = new Date();
        var today = FormatoFecha(now, "-");

        $('#rtxtFechaModal1').val(today);
        $('#rtxtFechaModal2').val(today);
        $('#rtxtFechaModal3').val(today);
        $('#rtxtFechaModalDet2').val(today);
        $('#rtxtFechaModalDet3').val(today);
        $('#rtxtFechaDesdeModal3').val(today);
        $('#rtxtFechaHastaModal3').val(today);
        $('#rtxtFechaModalDet3_1').val(today);
        $('#rtxtFechaModalDet3_2').val(today);

        $("#rcbxMonedaModal1").val(rsolicitudCabCreada.idTipoMod);
        $("#rcbxMonedaModal2").val(rsolicitudCabCreada.idTipoMod);
        $("#rcbxMonedaModal3").val(rsolicitudCabCreada.idTipoMod);

    });

    function rvalidacionDetCmpbte(tabSeleccion) {
        let respuesta = false;

        if (tabSeleccion == 1) {

            let tipoComprobante = $('#rcbxTipoCpbteCompModal1').val();

            let testvalue = $("#rtxtValorUnitarioTotal1").val();

            if ($("#rcbxTipoCpbteCompModal1").val().trim() == "0") {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione un Tipo de Comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

            else if (($("#rtxtSerieModal1").val() == "" || $("#rtxtSerieModal1").val() == null) && tipoComprobante == "1") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese la serie del comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (($("#rtxtNumeroModal1").val() == "" || $("#rtxtNumeroModal1").val() == null) && tipoComprobante == "1") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el numero de comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rcbxUM1").val() == "0" && tipoComprobante == "1") {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione una unidad de medida por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtDescripcion1").val().trim() == "" && (tipoComprobante == "1")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese la descripción por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (($("#rtxtValorUnitarioTotal1").val().trim() == "" || $("#rtxtValorUnitarioTotal1").val() == null || typeof ($("#rtxtValorUnitarioTotal1").val()) == "undefined") && (tipoComprobante == "1")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese el valor Unitario',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ((parseFloat($("#rtxtValorUnitarioTotal1").val()) == 0 || parseFloat($("#rtxtValorUnitarioTotal1").val()) < 0 || parseFloat($("#rtxtValorUnitarioTotal1").val()) > 1500) && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese un Valor unitario correcto por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (rvIdConceptoCab1.toString() == "5") {
                if ($("#rtxtObservacionModal1").val().trim() == "" || $("#rtxtObservacionModal1").val() == null || typeof ($("#rtxtObservacionModal1").val()) == "undefined") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese una descripción por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }
            else {
                respuesta = true;
            }
        }
        else if (tabSeleccion == 2) {

            //v2_TipoMod = $("#rcbxMonedaModal2").val();
            //let sumTotal2 = 0;

            //v2_maximoS = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal2").val())).maximoSoles;
            //v2_maximoD = rtiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#rcbxTipoCpbteCompModal2").val())).maximoDolar;



            if ($("#rtxtApeNomModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese Apellidos y Nombres',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtDNIModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: "Ingrese el número de DNI",
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtApeNomModal2").val().trim() == "0 Ninguno" || $("#rtxtApeNomModal2").val().trim() == "0 Varios") {
                respuesta = false;

                Swal.fire({
                    title: 'Colaborador no existe',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtOrgDstModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese una descripción de Origen/Destino',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtMotivoModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese una descripción del motivo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtImporteModal2").val().trim() == "" || $("#rtxtImporteModal2").val().trim() == "0") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el importe por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

            //else if (v2_TipoMod.toString() == 1) {




            //    if (rdetComprobanteArray2.length > 0) {

            //        var result = [];
            //        rdetComprobanteArray2.reduce(function (res, value) {
            //            if (!res[value.fecha]) {
            //                res[value.fecha] = { fecha: value.fecha, valorunit: 0 };
            //                result.push(res[value.fecha])
            //            }
            //            res[value.fecha].valorunit += value.valorunit;
            //            return res;
            //        }, {});


            //        console.log("resultadoooo")
            //        console.log(result)



            //    }
            //    else {
            //        sumTotal2 = $("#rtxtImporteModal2").val();
            //    }

            //    if (parseFloat(sumTotal2) > v2_maximoS) {
            //        respuesta = false;
            //        Swal.fire({
            //            title: 'El monto máximo permitido es S/.' + v2_maximoS,
            //            text: "Textile Sourcing Company",
            //            icon: 'warning',
            //            showConfirmButton: true,
            //            confirmButtonColor: '#3085d6',
            //            confirmButtonText: 'Ok'
            //        });
            //    }
            //    else {
            //        respuesta = true;
            //    }
            //}
            else {
                respuesta = true;
            }
        }
        else if (tabSeleccion == 3) {

            if ($("#rtxtCiudadModal3").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el nombre de la Ciudad',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtPaisModal3").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: "Ingrese el nombre del País",
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }

        }

        return respuesta;
    }

    function rvalidacionGuardarComp(indexTab) {
        var respuesta = false;

        // Registro de Factura y Boleta

        if (indexTab == 1) {

            let tipoComprobante = $('#rcbxTipoCpbteCompModal1').val();


            if ($("#rcbxTipoCpbteCompModal1").val().trim() == "0" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione un Tipo de Comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtSerieModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese un numero y serie',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtNumeroModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese un numero y serie',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtRucCompModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el número de RUC / DNI',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#rtxtCodSofyaPCModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'El proveedor debe estar registrado en Sofya para continuar',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (rdetComprobanteArray1.length == 0 && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe agregar el detalle del comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }
        }
        if (indexTab == 2) {

            // Planilla de Movilidad
            if ($("#rtxtDNIModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'No se encuentra el colaborador',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (rdetComprobanteArray2.length == 0) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe agregar el detalle de Planilla de Movilidad',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }
        }
        else if (indexTab == 3) {

            // Planilla de Movilidad
            if ($("#rcbxMonedaModal3").val().trim() == "0") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el tipo de Moneda',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            else if ($("#rtxtDNIModal3").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el número de DNI por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (rdetComprobanteArray3.length == 0) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe agregar el detalle de la Declaración Jurada',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }
        }


        return respuesta;
    }

    function rlimpiarControlModal(tabSeleccion) {

        var now = new Date();
        var today = FormatoFecha(now, "-");

        if (tabSeleccion == 1) {
            debugger
            // 1. Factura y Boleta
            $("#rcbxTipoCpbteCompModal1").val(rvCodTipoComprobante);


            //rcambioTipoCpte(rvCodTipoComprobante);
            $("#rtxtObservacionModal1").val("");
            $("#rtxtFechaModal1").val(today);
            $("#rtxtSerieModal1").val("");
            $("#rtxtNumeroModal1").val("");
            $("#rtxtRucCompModal1").val("");
            $("#rtxtRSCompModal1").val("");
            $("#rtxtCodSofyaPCModal1").val("");
            $("#rtxtObsCompModal1").val("");

            $("#rcbxUM1").val("UN");
            $("#rtxtDescripcion1").val("");
            //$("#txtCantidad1").val("");
            $("#rtxtValorUnitarioTotal1").val("");

            //$("#ridMontoSolicitadoModal1").text("0.00");

            let tabla = $("#rtblFacturaBoleta").DataTable();
            tabla.destroy();
            var tr = "";
            $("#rtblFacturaBoletaContent").html(tr);
            $("#rtblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );

            $("#ridimportetotal1").val("0");
            $("#ridigv1").val("0");
            $("#ridtotal1").val("0");

            rdetComprobanteArray1 = [];


            document.getElementById("rtxtSerieModal1").focus = true;

            document.getElementById("rcbxTipoCpbteCompModal1").disabled = false;

            document.getElementById("rcbxConcepCabModal1").disabled = false;
            document.getElementById("rcbxConcepDetModal1").disabled = false;
            document.getElementById("rtxtObservacionModal1").disabled = false;

            ractualizarTotalSolicitado($("#rcbxConcepCabModal1").val(), $("#rcbxConcepDetModal1").val());

            if (rvCodTipoComprobante == 1) {
                $('#rswtIGV').bootstrapToggle('on', true);
                rswitch = true;
            }
            else if (rvCodTipoComprobante == 2) {
                $('#rswtIGV').bootstrapToggle('off', true);
                rswitch = false;
            }

        }
        else if (tabSeleccion == 2) {

            // 2. Planilla de Movilidad
            $("#txtNumPlanillaModal2").val("");
            //$("#rtxtApeNomModal2").val("");
            //$("#rtxtDNIModal2").val("");
            $("#rtxtObservacionModal2").val("");
            $("#rtxtNumPlanillaModal2").val("");

            $("#rtxtFechaModal2").val(today);
            $("#rtxtOrgDstModal2").val("");
            $("#rtxtMotivoModal2").val("");
            $("#rtxtImporteModal2").val("");

            let tabla = $("#rtblPlanillaMovilidad").DataTable();
            tabla.destroy();
            var tr = "";
            $("#rtblPlanillaMovilidadContent").html(tr);
            $("#rtblPlanillaMovilidad").DataTable(
                {
                    "footerCallback": function (row, data, start, end, display) {
                        var api = this.api(), data;

                        // Remove the formatting to get integer data for summation
                        var intVal = function (i) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '') * 1 :
                                typeof i === 'number' ?
                                    i : 0;
                        };

                        // Total over all pages
                        total = api
                            .column(4)
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);

                        // Total over this page
                        pageTotal = api
                            .column(4, { page: 'current' })
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);

                        // Update footer
                        $(api.column(4).footer()).html(
                            '$' + pageTotal + ' ( $' + total + ' total)'
                        );
                    },
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );

            rdetComprobanteArray2 = [];
            rdetCpteArrayValid2 = [];

            document.getElementById("rcbxTipoCpbteCompModal2").disabled = false;

            document.getElementById("rcbxConcepCabModal2").disabled = false;
            document.getElementById("rcbxConcepDetModal2").disabled = false;
            document.getElementById("rtxtObservacionModal2").disabled = false;

            ractualizarTotalSolicitado($("#rcbxConcepCabModal2").val(), $("#rcbxConcepDetModal2").val());



        }
        else if (tabSeleccion == 3) {

            // 3. Declaración Jurada.
            $("#rtxtCodigoModal3").val("");
            //$("#rtxtApeNomModal3").val("");
            //$("#rtxtDNIModal3").val("");
            $("#rtxtObservacionModal3").val("");
            $("#rtxtFechaModal3").val(today);

            $("#rtxtMotivoModal3").val("");
            $("#rtxtPaisModal3").val("");

            $("#rtxtMontoDet3_1").val("");
            $("#rtxtMontoDet3_2").val("");


            let tabla1 = $("#rtblDeclaracionJurada3_1").DataTable();
            tabla1.destroy();
            var tr1 = "";
            $("#rtblDeclaracionJuradaContent3_1").html(tr1);
            $("#rtblDeclaracionJurada3_1").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );


            let tabla2 = $("#rtblDeclaracionJurada3_2").DataTable();
            tabla2.destroy();
            var tr2 = "";
            $("#rtblDeclaracionJuradaContent3_2").html(tr2);
            $("#rtblDeclaracionJurada3_2").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );


            rdetComprobanteArray3 = [];

            document.getElementById("rcbxTipoCpbteCompModal3").disabled = false;

            document.getElementById("rcbxConcepCabModal3").disabled = false;
            document.getElementById("rcbxConcepDetModal3").disabled = false;
            document.getElementById("rtxtObservacionModal3").disabled = false;

            ractualizarTotalSolicitado($("#rcbxConcepCabModal3").val(), $("#rcbxConcepDetModal3").val());
        }

        rdetComprobanteArray = [];
    }

    function rvalidarrestadoSolicitud(pOpcion, pIdSolicitud) {

        $.ajax({
            url: "/finanzas/RG_ValidarEstadoRendicion",
            type: "POST",
            data: {
                opcion: pOpcion,
                idSolicitud: pIdSolicitud,
                codigo: "",
                secuencia: 0,
                idRendCompte: 0
            },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {
                    rindicadorEstado(resultado.status.idResponse);
                    $("#restado-desc").text(resultado.status.statusResponse);


                    rgetListaDetalle(rsolicitudCabCreada.idSolicitud);
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    }

    function rbusquedaXDNI(dni, opcionModal) {

        if (dni == "") {
            Swal.fire({
                title: 'Ingrese el número de DNI',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Cancel',
                focusConfirm: true
            }).then(result => {
                if (result.value) {
                    // Planilla de Movilidad
                    if (opcionModal == 2) {
                        document.getElementById("rtxtDNIModal2").focus = true;
                    }
                    else if (opcionModal == 3) {
                        // Declaracion Jurada
                        document.getElementById("rtxtDNIModal3").focus = true;
                    }
                }
            });
        }
        else if (dni.length < 7) {
            Swal.fire({
                title: 'Ingrese un número RUC valido por favor',
                icon: 'warning',
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Cancel',
                focusConfirm: true
            }).then(result => {
                if (result.value) {
                    // Planilla de Movilidad
                    if (opcionModal == 2) {
                        document.getElementById("rtxtDNIModal2").focus = true;
                    }
                    else if (opcionModal == 3) {
                        // Declaracion Jurada
                        document.getElementById("rtxtDNIModal3").focus = true;
                    }
                }
            });
        }
        else {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_BuscarColaboradorXDNI',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { dni: dni },
                success: function (data) {

                    if (opcionModal == 2) {
                        // Planilla de Movilidad
                        $("#rtxtApeNomModal2").val(data.entidad.colaborador);
                    }
                    else if (opcionModal == 3) {
                        // Declaracion Jurada
                        $("#rtxtApeNomModal3").val(data.entidad.colaborador);
                    }

                    if (data.entidad.codcolaborador == "0") {

                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 2500,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })

                        Toast.fire({
                            icon: 'warning',
                            title: data.entidad.mensaje
                        });

                        if (opcionModal == 2) {
                            // Planilla de Movilidad
                            document.getElementById("rtxtDNIModal2").focus = true;
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            document.getElementById("rtxtDNIModal3").focus = true;
                        }
                    }
                    else {
                        if (opcionModal == 2) {
                            // Planilla de Movilidad
                            document.getElementById("rtxtOrgDstModal2").focus = true;
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            // document.getElementById("rtxtDNIModal3").focus = true;
                        }
                    }
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }
    }

    function rindicadorEstado(idEstado) {

        if (idEstado == 1) {
            // Pendiente
            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-aprobado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-rend-completa");
            $("#restado-icon").removeClass("icon-rend-incompleta");
            $("#restado-icon").addClass("icon-pendiente");

            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-aprobado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-rend-completa");
            $("#restado-desc").removeClass("desc-est-rend-incompleta");
            $("#restado-desc").addClass("desc-est-pendiente");

        }
        else if (idEstado == 2) {
            // Liberado
            $("#restado-icon").removeClass("icon-pendiente");
            $("#restado-icon").removeClass("icon-aprobado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-rend-completa");
            $("#restado-icon").removeClass("icon-rend-incompleta");
            $("#restado-icon").addClass("icon-liberado");

            $("#restado-desc").removeClass("desc-est-pendiente");
            $("#restado-desc").removeClass("desc-est-aprobado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-rend-completa");
            $("#restado-desc").removeClass("desc-est-rend-incompleta");
            $("#restado-desc").addClass("desc-est-liberado");

        }
        else if (idEstado == 3) {
            // Aprobado
            $("#restado-icon").removeClass("icon-pendiente");
            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-rend-completa");
            $("#restado-icon").removeClass("icon-rend-incompleta");
            $("#restado-icon").addClass("icon-aprobado");

            $("#restado-desc").removeClass("desc-est-pendiente");
            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-rend-completa");
            $("#restado-desc").removeClass("desc-est-rend-incompleta");
            $("#restado-desc").addClass("desc-est-aprobado");

        }
        else if (idEstado == 4) {
            // Aprobado
            $("#restado-icon").removeClass("icon-pendiente");
            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-rend-completa");
            $("#restado-icon").removeClass("icon-rend-incompleta");
            $("#restado-icon").addClass("icon-aprobado");

            $("#restado-desc").removeClass("desc-est-pendiente");
            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-rend-completa");
            $("#restado-desc").removeClass("desc-est-rend-incompleta");
            $("#restado-desc").addClass("desc-est-aprobado");

        }
        else if (idEstado == 5) {
            // Rechazado
            $("#restado-icon").removeClass("icon-pendiente");
            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-aprobado");
            $("#restado-icon").removeClass("icon-rend-completa");
            $("#restado-icon").removeClass("icon-rend-incompleta");
            $("#restado-icon").addClass("icon-rechazado");

            $("#restado-desc").removeClass("desc-est-pendiente");
            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-aprobado");
            $("#restado-desc").removeClass("desc-est-rend-completa");
            $("#restado-desc").removeClass("desc-est-rend-incompleta");
            $("#restado-desc").addClass("desc-est-rechazado");
        }
        else if (idEstado == 6) {
            // Rendicion Completa
            $("#restado-icon").removeClass("icon-pendiente");
            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-rend-incompleta");
            $("#restado-icon").addClass("icon-rend-completa");

            $("#restado-desc").removeClass("desc-est-pendiente");
            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-rend-incompleta");
            $("#restado-desc").addClass("desc-est-rend-completa");
        }
        else if (idEstado == 7) {
            // Rendicion Incompleta
            $("#restado-icon").removeClass("icon-pendiente");
            $("#restado-icon").removeClass("icon-liberado");
            $("#restado-icon").removeClass("icon-rechazado");
            $("#restado-icon").removeClass("icon-rend-completa");
            $("#restado-icon").addClass("icon-rend-incompleta");

            $("#restado-desc").removeClass("desc-est-pendiente");
            $("#restado-desc").removeClass("desc-est-liberado");
            $("#restado-desc").removeClass("desc-est-rechazado");
            $("#restado-desc").removeClass("desc-est-rend-completa");
            $("#restado-desc").addClass("desc-est-rend-incompleta");
        }

    }

    function formatoNumero(x) {
        x = x.toFixed(2);
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function rarmarTablaDetalle(lista) {

        let tabla = $("#rtblSolicitud").DataTable();

        tabla.destroy();
        var tr = "";

        lista.forEach((obj) => {

            tr += "<tr> "
                + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                + " <td class='ocultar-columna'> " + obj.secuencia + "</td>"
                + " <td> " + obj.serieNumero + "</td>"
                + " <td> " + obj.tipo + "</td>"
                + " <td> " + obj.conceptoCab + "</td>"
                + " <td> " + obj.conceptoDet + "</td>"
                + " <td> " + obj.cantDias + "</td>"
                + " <td> " + formatoNumero(obj.valor) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalRendido) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado - obj.totalRendido) + "</td>"

                + " <td class='text-center'>"
                + "     <button data-idtipocomp = " + obj.idTipoComp + "  data-idrendcompte=" + obj.idRendCompte + " data-toggle='collapse' class='btn btn-sm btn-danger cImprimirPDF' " + (obj.idRendCompte == 0 ? " disabled " : " ") + "><i class='fas fa-file-pdf'></i></button>"
                + "</td>"

                + " <td class='text-center'>"
                + "     <input type='checkbox' data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "' data-valor=" + obj.valor + " data-total=" + obj.total + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " class='seleccion ml-2' " + (obj.idEstadoDet == 6 ? " disabled " : " ") + ">"
                + "</td>"

                + "</tr>";
        });


        $("#rtblSolicitudContent").html(tr);

        $("#rtblSolicitud").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            });
    }

    $("#rbtnVerRegistrados").click(function () {

        if (rvalidacionVerCmptes()) {

            $.ajax({
                url: "@Url.Action("RG_BuscarIdSolicitud", "Finanzas")",
                data: {
                    idSolicitud: rsolicitudCabCreada.idSolicitud,
                },
                success: function (data) {
                    window.location.href = '@Url.Action("MapearReporteCXSPDF", "Finanzas")'
                }
            });
        }
    });

    function rvalidacionVerCmptes() {
        var respuesta = false;

        let idSolicitud = rsolicitudCabCreada.idSolicitud;

        if (idSolicitud == null || typeof (idSolicitud) == "undefined") {
            respuesta = false;

            Swal.fire({
                title: 'Seleccione una Solicitud por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else {
            respuesta = true;
        }

        return respuesta;
    }

    $("#list-comprobantes").on("click", "a", function () {

        let idRendCompte = $(this).attr("data-idrendcompte");

        rcargarComprobanteCabecera(idRendCompte);


    });

    function rmensajePrincipal(estado, mensaje) {
        if (estado == true) {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'success',
                title: mensaje
            });

        }
        else if (estado == false) {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'error',
                title: mensaje
            });

        }
    }

    $("#rtblDetalleContent").on("click", ".cImprimirPDF", function () {

        let idTipoComp = $(this).attr("data-idtipocomp");
        let idRendCompte = $(this).attr("data-idrendcompte");

        $.ajax({
            url: "@Url.Action("RG_BuscarIdCompte", "Finanzas")",
            data: {
                idTipoComp: idTipoComp,
                idRendCompte: idRendCompte
            },
            success: function (data) {

                if (idTipoComp == 3) {
                    // Planilla de Movilidad
                    window.location.href = '@Url.Action("MapearReportePLPDF", "Finanzas")'
                }
                else if (idTipoComp == 4) {
                    // Declaración Jurada
                    window.location.href = '@Url.Action("MapearReporteDJPDF", "Finanzas")'
                }

            }
        });

    });

    $("#rtblDetalleContent").on("click", ".cEditarCpte", function () {

        rdetalleArray = [];
        rvIdSolicitud = $(this).attr("data-idsolicitud");

        let secuencia = $(this).attr("data-secuencia");
        let valor = $(this).attr("data-valor");
        let totalRestante = $(this).attr("data-restante");
        let totalsolicitado = $(this).attr("data-totalsolicitado");

        rvIdRendCompte = $(this).attr("data-idrendcompte");

        rdetalleArray.push({ idsolicitud: rvIdSolicitud, secuencia: secuencia, valor: parseFloat(valor), totalrestante: parseFloat(totalsolicitado) });

        rTIPO_REGISTRO = "EDITAR";
        $("#rregComprobModal").modal("show");

        rcargarComprobanteCabecera(rvIdRendCompte);

    });

    $('#rtxtRucCompModal1').keypress(function (event) {
        //zzzz
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {

            let ruc = $("#rtxtRucCompModal1").val().trim();

            if (ruc == "") {
                Swal.fire({
                    title: 'Ingrese RUC',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("rtxtRucCompModal1").focus = true;
                    }
                });
            }
            else if (ruc.length < 7 || ruc.length > 15) {
                Swal.fire({
                    title: 'Ingrese un número RUC valido por favor',
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        //document.getElementById("ridtxtcodigo").focus = true;
                    }
                });

            }
            else {

                MostrarCarga("Buscando...");

                $.ajax({
                    url: "/finanzas/RG_SetproveedorValidar",
                    type: "POST",
                    data: { 'opcion': '1', 'tipoPersona': 'J', 'ruc': ruc, 'rs': '', 'direccion': '' },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            rproveedor = resultado.entidad;

                            if (resultado.entidad.idResponse == 0) {

                                Swal.fire({
                                    title: '¿Proveedor no existe, desea crearlo?',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Si',
                                    cancelButtonText: 'No'
                                }).then((result) => {
                                    if (result.value) {

                                        $("#rtxtRUCModal").val($("#rtxtRucCompModal1").val());
                                        document.getElementById("rtxtRUCModal").disabled = true;

                                        $("#rregComprobModal").modal("hide");
                                        $('#rproveedorModal').modal('show');
                                    }
                                });
                            }
                            else {

                                $("#rtxtRSCompModal1").val(resultado.entidad.danvar);
                                $("#rtxtCodSofyaPCModal1").val(resultado.entidad.ctpava + "-" + resultado.entidad.canvar);

                                rmensajePrincipal(true, "proveedor correcto");
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

            }

        }
    });

    $('#rproveedorModal').on('shown.bs.modal', function (e) {
        document.getElementById("rtxtRSModal").focus = true;
    });

    function rgetListaDetalle(pidSolicitud) {

        $.ajax({
            type: "GET",
            url: '/finanzas/RG_SolicitudDetReembolso',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: { idSolicitud: pidSolicitud },
            success: function (data) {

                if (data.isRedirect) {
                    window.location.href = data.redirectUrl;
                }
                else {
                    rgenerarTablaDetalle(data.lista);
                }
            },
            failure: function () {

                Swal.fire({
                    icon: 'error',
                    title: 'Error al mostrar datos',
                    text: 'Textile Sourcing Company',
                    showConfirmButton: false,
                    timer: 2500,
                });

            }
        });
    }

    function rgenerarTablaDetalle(lista) {

        let vTotal = 0;
        let tr_btn_pdf = "";
        var tr = "";
        let tabla = $("#rtblDetalle").DataTable();
        tabla.destroy();

        lista.forEach((obj) => {

            vTotal = vTotal + (obj.totalcpte);

            tr += "<tr> "
                + " <td> </td> "
                + " <td class='ocultar-columna'> " + obj.idSolicitud + "</td> "
                //+ " <td> " + obj.codigo + "</td> "
                //+ " <td> " + obj.fecha + "</td>"

                + " <td> " + obj.serieNumero + "</td>"
                + " <td> " + obj.ceco + "</td> "
                + " <td> " + obj.conceptoCab + "</td>"
                //+ " <td> " + obj.conceptoDet + "</td> "

                //+ " <td> " + obj.cantDias + "</td> "
                //+ " <td> " + obj.simbolo + " " + formatoNumero(obj.valor) + "</td>"
                //+ " <td> " + obj.simbolo + " " + formatoNumero(obj.total) + "</td>"
                //+ " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado - obj.totalRendido) + "</td>"

                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalcpte) + "</td>"


                + " <td class='text-center'>"
                + "     <button data-idsolicitud=" + obj.idSolicitud + " data-secuencia=" + obj.secuencia + " data-idrendcompte=" + obj.idRendCompte + " class='btn btn-sm btn-danger cEliminarCpte'  " + (obj.disabledhtml) + "><i class='fas fa-trash'></i></button>"
                + "</td>"

                + " <td class='text-center'>"
                + "     <button data-idrendcompte=" + obj.idRendCompte + "  data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "'  data-valor=" + obj.valor + " data-totalsolicitado = " + obj.totalSolicitado + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " data-toggle='collapse' class='btn btn-sm btn-success cEditarCpte' " + (obj.disabledhtml) + "><i class='fas fa-edit'></i></button>"
                + "</td>"


            if (obj.idTipoComp == 3 || obj.idTipoComp == 4) {

                tr_btn_pdf = " <td class='text-center'>"
                    + "     <button data-idtipocomp = " + obj.idTipoComp + "  data-idrendcompte=" + obj.idRendCompte + " data-toggle='collapse' class='btn btn-sm btn-danger cImprimirPDF' " + ((obj.idRendCompte == 0 || obj.idTipoComp == 1 || obj.idTipoComp == 2) ? " disabled " : " ") + "><i class='fas fa-file-pdf'></i></button>"
                    + "</td>";
            }
            else {
                tr_btn_pdf = " <td class='text-center'></td> ";
            }

            tr = tr + tr_btn_pdf;

            tr = tr + + "</tr>";



            //+ " <td class='text-center'>"
            //+ "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-primary solicitudDetalleItem'><i class='fas fa-eye'></i></button>"
            ////+ "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-success ml-1 solicitudEditarItem'" + (idEstado > 1 ? " disabled " : " ") + "><i class='fas fa-edit'></i></button>"
            ////+ "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-danger ml-1 solicitudEliminarItem'" + (idEstado > 1 ? " disabled " : " ") + "><i class='fas fa-trash'></i></button>"
            //+ " </td>"
            //+ " <td class='text-center'>"
            //+ "     <input type='checkbox' data-codceco='" + obj.codceco + "' data-ceco = '" + obj.ceco + "'  data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "' data-valor=" + obj.valor + " data-total=" + obj.total + "   data-restante=" + (obj.totalSolicitado - obj.totalRendido) + "  class='seleccion' " + (obj.idEstadoDet == 5 ? " disabled " : " ") + ">"
            //+ "</td>"

        });


        $("#rkpi-cantidad").text(lista.length.toString());


        $("#rkpi-total").text(formatoNumero(vTotal).toString());

        $("#rtblDetalleContent").html(tr);

        $("#rtblDetalle").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            }
        );
    }

    $("#rtblDetalleContent").on("click", ".cImprimirPDF", function () {

        let idTipoComp = $(this).attr("data-idtipocomp");
        let idRendCompte = $(this).attr("data-idrendcompte");

        $.ajax({
            url: "@Url.Action("RG_BuscarIdCompte", "Finanzas")",
            data: {
                idTipoComp: idTipoComp,
                idRendCompte: idRendCompte
            },
            success: function (data) {

                if (idTipoComp == 3) {
                    // Planilla de Movilidad
                    window.location.href = '@Url.Action("MapearReportePLPDF", "Finanzas")'
                }
                else if (idTipoComp == 4) {
                    // Declaración Jurada
                    window.location.href = '@Url.Action("MapearReporteDJPDF", "Finanzas")'
                }

            }
        });
    });

    $("#rtblDetalleContent").on("click", ".cEliminarCpte", function () {

        let idRendCompte = $(this).attr("data-idrendcompte");
        let idSolicitud = $(this).attr("data-idsolicitud");
        let secuencia = $(this).attr("data-secuencia");

        Swal.fire({
            title: '¿Desea Eliminar el Comprobante?',
            text: 'Textile Sourcing Company',
            icon: 'info',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Cancelar',
            confirmButtonText: 'Ok'

        }).then((result) => {

            if (result.value) {

                parametro = {
                    'opcion': 11,
                    'idRendCompte': idRendCompte,
                    'idTipoComp': 0,
                    'serieNumero': "",
                    'rucDNI': "",
                    'rs': "",
                    'codigoPC': "",
                    'obs': "",
                    'fechaEmision': "",
                    'codceco': 0,
                    'idTipoMod': 0,
                    'porcentajeIGV': 0,
                    'obs1': '',
                    'obs2': '',
                    'fecha1': '',
                    'periodo': "",
                    'solitudSeqArray': null,
                    'detalleComprobanteArray': null,
                    'idSolicitud': idSolicitud,
                    'secuencia': secuencia
                };

                $.ajax({
                    url: "/finanzas/RG_SetRendicionComprobante",
                    type: "post",
                    data: parametro,
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            if (resultado.entidad.idResponse > 0) {

                                rvalidarrestadoSolicitud(2, rsolicitudCabCreada.idSolicitud);


                                rlimpiarControlModal(1);
                                rlimpiarControlModal(2);
                                rlimpiarControlModal(3);

                                $("#rregComprobModal").modal("hide");

                                rmensajePrincipal(true, resultado.entidad.statusResponse);
                            }
                            else {
                                rmensajePrincipal(false, resultado.entidad.statusResponse);
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

            }

        });

    });

    $("#rbtnVerRegistrados").click(function () {

        if (rvalidacionVerCmptes()) {

            $.ajax({
                url: "@Url.Action("RG_BuscarIdSolicitud", "Finanzas")",
                data: {
                    idSolicitud: rsolicitudCabCreada.idSolicitud,
                },
                success: function (data) {
                    window.location.href = '@Url.Action("MapearReporteCXSPDF", "Finanzas")'
                }
            });

        }
    });

    function rvalidacionVerCmptes() {
        var respuesta = false;

        let idSolicitud = rsolicitudCabCreada.idSolicitud;

        if (idSolicitud == null || typeof (idSolicitud) == "undefined") {
            respuesta = false;

            Swal.fire({
                title: 'Seleccione una Solicitud por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else {
            respuesta = true;
        }

        return respuesta;
    }

    function rcargarComprobanteCabecera(pIdRendCompte) {

        $.ajax({
            url: "/finanzas/RG_ReembolsoCpteCabecera",
            type: "GET",
            data: { idRendCompte: pIdRendCompte },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {

                    rlistaComptesIdTipoComp = resultado.entidad.idTipoComp;
                    rsolicitudCabCreada = resultado.entidad;
                    rvSimboloMoneda = resultado.entidad.simbolo;

                    if (resultado.entidad.idTipoComp == 1 || resultado.entidad.idTipoComp == 2) {

                        // FACTURA Y BOLETA
                        $("#rfacturaboleta-tab").removeClass("disabled");
                        $("#rplanillamovilidad-tab").addClass("disabled");
                        $("#rdeclaracionjur-tab").addClass("disabled");

                        $("#rregComprobModal .nav-tabs #rfacturaboleta-tab").tab('show');
                        rtabSeleccionado = 1;

                        $("#rcbxTipoCpbteCompModal1").val(resultado.entidad.idTipoComp);
                        document.getElementById("rcbxTipoCpbteCompModal1").disabled = true;

                        $("#rcbxConcepCabModal1").val(resultado.entidad.idConceptoCab);
                        $("#rcbxConcepDetModal1").val(resultado.entidad.idConceptoDet);
                        $("#rtxtObservacionModal1").val(resultado.entidad.observacionDet);


                        $("#rtxtSerieModal1").val(resultado.entidad.nserie);
                        $("#rtxtNumeroModal1").val($.trim(resultado.entidad.ndocof));

                        $("#rtxtFechaModal1").val(resultado.entidad.fechaEmision);
                        $("#rcbxMonedaModal1").val(resultado.entidad.idTipoMod);
                        $("#rcbxPeriodoModal1").val(resultado.entidad.periodo);
                        $("#rtxtRucCompModal1").val(resultado.entidad.rucDNI);
                        $("#rtxtRSCompModal1").val(resultado.entidad.rs);
                        $("#rtxtCodSofyaPCModal1").val(resultado.entidad.codigoPC);
                        $("#rtxtObsCompModal1").val(resultado.entidad.obs);
                        $("#rtxtCeCoModal1").val(resultado.entidad.ceco);

                        $("#rkpiMontoSeleecionadoModal1").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalCmpbnteSolicitud - resultado.entidad.totalCmpbnte));


                        if (resultado.entidad.idTipoComp == 1) {
                            // Factura
                            $("#ridimportetotal1").val(formatoNumero(resultado.entidad.totalCmpbnteBI));
                            $("#ridigv1").val(formatoNumero(resultado.entidad.totalCmpbnteIGV));
                            $("#ridtotal1").val(formatoNumero(resultado.entidad.totalCmpbnte));
                        }
                        else if (resultado.entidad.idTipoComp == 2) {
                            // Boleta
                            $("#ridimportetotal1").val(formatoNumero(resultado.entidad.totalCmpbnteBI));
                            $("#ridigv1").val(formatoNumero(0));
                            $("#ridtotal1").val(formatoNumero(resultado.entidad.totalCmpbnte));
                        }

                        $("#rcbxUM1").val("UN");
                        $("#rtxtDescripcion1").val("");
                        $("#txtCantidad1").val("");
                        $("#rtxtValorUnitarioTotal1").val("");

                        rdefinirValoresTipoCpte($("#rcbxTipoCpbteCompModal1").val());
                        rcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);
                    }
                    else if (resultado.entidad.idTipoComp == 3) {

                        // PLANILLA DE MOVILIDADA
                        $("#rfacturaboleta-tab").addClass("disabled");
                        $("#rplanillamovilidad-tab").removeClass("disabled");
                        $("#rdeclaracionjur-tab").addClass("disabled");

                        $('#rregComprobModal .nav-tabs #rplanillamovilidad-tab').tab('show');
                        rtabSeleccionado = 2;

                        $("#rtxtObservacionModal2").val(resultado.entidad.observacionDet);


                        $("#rtxtFechaModal2").val(resultado.entidad.fechaEmision);
                        $("#rtxtNumPlanillaModal2").val(resultado.entidad.serieNumero);
                        $("#rcbxMonedaModal2").val(resultado.entidad.idTipoMod);
                        $("#rcbxPeriodoModal2").val(resultado.entidad.periodo);

                        $("#rtxtDNIModal2").val(resultado.entidad.rucDNI);
                        $("#rtxtApeNomModal2").val(resultado.entidad.rs);
                        $("#rtxtCeCoModal2").val(resultado.entidad.ceco);

                        $("#rkpiMontoSeleecionadoModal2").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalCmpbnteSolicitud - resultado.entidad.totalCmpbnte));

                        rcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);

                    }
                    else if (resultado.entidad.idTipoComp == 4) {

                        // DECLARACION JURADA.
                        $("#rfacturaboleta-tab").addClass("disabled");
                        $("#rplanillamovilidad-tab").addClass("disabled");
                        $("#rdeclaracionjur-tab").removeClass("disabled");

                        $("#rtxtObservacionModal3").val(resultado.entidad.observacionDet);

                        $('#rregComprobModal .nav-tabs #rdeclaracionjur-tab').tab('show');
                        rtabSeleccionado = 3;

                        $("#rtxtFechaModal3").val(resultado.entidad.fechaEmision);
                        $("#rtxtCodigoModal3").val(resultado.entidad.serieNumero);
                        $("#rcbxMonedaModal3").val(resultado.entidad.idTipoMod);
                        $("#rcbxPeriodoModal3").val(resultado.entidad.periodo);
                        $("#rtxtDNIModal3").val(resultado.entidad.rucDNI);
                        $("#rtxtApeNomModal3").val(resultado.entidad.rs);
                        $("#rtxtCeCoModal3").val(resultado.entidad.ceco);

                        $("#rtxtCiudadModal3").val(resultado.entidad.obs1);
                        $("#rtxtPaisModal3").val(resultado.entidad.obs2);
                        $("#rtxtFechaDesdeModal3").val(resultado.entidad.fecha1);
                        $("#rtxtFechaHastaModal3").val(resultado.entidad.fecha2);

                        $("#rkpiMontoSeleecionadoModal3").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalCmpbnteSolicitud - resultado.entidad.totalCmpbnte));

                        rcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);
                    }

                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });

    }

    function rcargarComprobanteDetalle(pIdRendCompte, pIdTipoComp) {

        $.ajax({
            url: "/finanzas/RG_ReembolsoCpteDetalle",
            type: "GET",
            data: { idRendCompte: pIdRendCompte },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {

                    if (pIdTipoComp == 1 || pIdTipoComp == 2) {

                        // FACTURA Y BOLETA

                        let tablaFB = $("#rtblFacturaBoleta").DataTable();

                        tablaFB.destroy();
                        var trFB = "";
                        rdetComprobanteArray1 = [];

                        resultado.lista.forEach((obj) => {

                            riDetalle1++;

                            rdetComprobanteArray1.push({
                                conceptoDet: obj.conceptoDet,
                                iDetalle: riDetalle1,
                                fecha: obj.fecha,
                                fechaBD: obj.fechaBD,
                                detalle1: obj.detalle1,
                                detalle2: "",
                                codum: obj.codum,
                                valorunit: obj.valorunit,
                                cantidad: obj.cantidad,
                                total: obj.total,

                                idConceptoDet: obj.idConceptoDet,
                                idConceptoCab: obj.idConceptoCab,
                                idSolicitud: obj.idSolicitud,
                                idTipo: obj.idTipo

                            });
                            //dddddd

                            trFB += "<tr> "
                                + " <td></td>"
                                + " <td> " + obj.um + "</td>"
                                + " <td> " + obj.conceptoDet + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td> " + formatoNumero(obj.total) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-iDetalle ='" + riDetalle1 + "' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });


                        $("#rtblFacturaBoletaContent").html(trFB);

                        $("#rtblFacturaBoleta").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[3], [3]]
                            });

                    }
                    else if (pIdTipoComp == 3) {

                        // PLANILLA DE MOVILIDAD

                        let tablaPM = $("#rtblPlanillaMovilidad").DataTable();

                        tablaPM.destroy();
                        var trPM = "";
                        rdetComprobanteArray2 = [];
                        rdetCpteArrayValid2 = [];

                        resultado.lista.forEach((obj) => {

                            riDetalle2++;

                            rdetComprobanteArray2.push({
                                iDetalle: riDetalle2,
                                fecha: obj.fecha,
                                fechaBD: obj.fechaBD,
                                detalle1: obj.detalle1,
                                detalle2: obj.detalle2,
                                codum: obj.codum, // UNIDAD
                                valorunit: obj.valorunit,
                                cantidad: obj.cantidad,

                                idConceptoDet: obj.idConceptoDet,
                                idConceptoCab: obj.idConceptoCab,
                                idSolicitud: obj.idSolicitud,
                                idTipo: obj.idTipo
                            });

                            trPM += "<tr> "
                                + " <td></td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + obj.detalle2 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idrendcomptedet='" + riDetalle2 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });

                        $("#rtblPlanillaMovilidadContent").html(trPM);

                        $("#rtblPlanillaMovilidad").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[3], [3]]
                            });


                        const sumAgregadosDet = rdetComprobanteArray2.reduce((acc, item) => {
                            return acc += (item.valorunit * item.cantidad);
                        }, 0);

                        $("#rrembsumtotal").text("Suma Total: " + rvSimboloMoneda + "" + formatoNumero(sumAgregadosDet));

                    }
                    else if (pIdTipoComp == 4) {

                        // DECLARACION JURADA

                        let tablaDJ_1 = $("#rtblDeclaracionJurada3_1").DataTable();
                        let tablaDJ_2 = $("#rtblDeclaracionJurada3_2").DataTable();

                        tablaDJ_1.destroy();
                        tablaDJ_2.destroy();

                        var trDJ_1 = "";
                        var trDJ_2 = "";

                        rdetComprobanteArray3 = [];


                        resultado.lista.forEach((obj) => {

                            riDetalle3++;

                            rdetComprobanteArray3.push({
                                iDetalle: riDetalle3,
                                fecha: obj.fecha,
                                fechaBD: obj.fechaBD,
                                detalle1: obj.detalle1,
                                detalle2: "",
                                codum: obj.codum, // UNIDAD
                                valorunit: obj.valorunit,
                                cantidad: obj.cantidad,
                                seccion: obj.seccion,
                                idConceptoDet: obj.idConceptoDet,
                                idConceptoCab: obj.idConceptoCab,
                                idSolicitud: obj.idSolicitud,
                                idTipo: obj.idTipo
                            });

                            if (obj.seccion == 1) {
                                trDJ_1 += "<tr> "
                                    + " <td></td>"
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.detalle1 + "</td>"
                                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-iDetalle='" + riDetalle3 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            }
                            else if (obj.seccion == 2) {
                                trDJ_2 += "<tr> "
                                    + " <td></td>"
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.detalle1 + "</td>"
                                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-iDetalle='" + riDetalle3 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            }

                        });

                        $("#rtblDeclaracionJuradaContent3_1").html(trDJ_1);
                        $("#rtblDeclaracionJuradaContent3_2").html(trDJ_2);

                        $("#rtblDeclaracionJurada3_1").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5], [5]]
                            });

                        $("#rtblDeclaracionJurada3_2").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5], [5]]
                            });
                    }
                }

            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    }

    $("#rbtnRegistrarProveedor").click(function () {

        if (rvalidacionRegistro()) {

            MostrarCarga("Guardando...");

            $.ajax({
                url: "/finanzas/RG_SetproveedorRegistrar",
                type: "POST",
                data: {
                    'opcion': '2',
                    'tipoPersona': 'J',
                    'ruc': $("#rtxtRUCModal").val(),
                    'rs': $("#rtxtRSModal").val(),
                    'direccion': $("#rtxtDireccionModal").val()
                },
                dataType: "json",
                success: function (resultado) {

                    rproveedor = resultado.entidad;

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {

                        if (resultado.entidad.idResponse == 1) {
                            rmensajePrincipal(true, resultado.entidad.statusResponse);
                        }
                        else {
                            rmensajePrincipal(false, resultado.entidad.statusResponse);
                        }
                    }

                    $("#rtxtRucCompModal1").val(rproveedor.creguc);
                    $("#rtxtRSCompModal1").val(rproveedor.danvar);
                    $("#rtxtCodSofyaPCModal1").val(rproveedor.ctpava + "-" + rproveedor.canvar);

                    $('#rproveedorModal').modal('hide');
                    $("#rregComprobModal").modal("show");
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        }
    });

    function rvalidacionRegistro() {
        var respuesta = false;

        if ($("#rtxtRUCModal").val().trim() == "") {
            respuesta = false;
            Swal.fire({
                title: 'Ingrese un código de RUC',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'

            });
        }
        else if ($("#rtxtRSModal").val().trim() == "") {
            respuesta = false;

            Swal.fire({
                title: 'Ingrese Razon Social',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else {
            respuesta = true;
        }

        return respuesta;
    }




    // Rendicion de Gastos


    function zsetPeriodo() {

        let fechaFormato = new Date();

        let month = '' + (fechaFormato.getMonth() + 1);
        let year = fechaFormato.getFullYear();

        if (month.length < 2) { month = '0' + month; }

        $("#zcbxPeriodoModal1").val("" + [year, month].join('-'));
        $("#zcbxPeriodoModal2").val("" + [year, month].join('-'));
        $("#zcbxPeriodoModal3").val("" + [year, month].join('-'));

        document.getElementById("zcbxPeriodoModal1").disabled = true;
        document.getElementById("zcbxPeriodoModal2").disabled = true;
        document.getElementById("zcbxPeriodoModal3").disabled = true;
    }

    function zgetTipoMoneda() {
        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_TiposDeMoneda',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#zcbxMonedaModal1").empty();
                $("#zcbxMonedaModal2").empty();
                $("#zcbxMonedaModal3").empty();

                $.each(data.lista, function () {
                    $("#zcbxMonedaModal1").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    $("#zcbxMonedaModal2").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    $("#zcbxMonedaModal3").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                });

                $("#zcbxMonedaModal1").val(1);
                $("#zcbxMonedaModal2").val(1);
                $("#zcbxMonedaModal3").val(1);

            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function zgetPeriodos() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_Periodos',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                $("#zcbxPeriodoModal1").empty();
                $("#zcbxPeriodoModal2").empty();
                $("#zcbxPeriodoModal3").empty();

                $.each(data.lista, function () {
                    $("#zcbxPeriodoModal1").append($("<option/>").val(this.periodo).text(this.periodo));
                    $("#zcbxPeriodoModal2").append($("<option/>").val(this.periodo).text(this.periodo));
                    $("#zcbxPeriodoModal3").append($("<option/>").val(this.periodo).text(this.periodo));
                });

                zsetPeriodo();
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function zgetUnidadesMedida() {

        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_UnidadesMedida',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#zcbxUM1").empty();

                $.each(data.lista, function () {
                    $("#zcbxUM1").append($("<option/>").val(this.codum).text(this.um));
                });

                $("#zcbxUM1").val("UN");
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });

    }

    function zgetTipoComprobantes() {
        $.ajax({
            type: "GET",
            url: '/Finanzas/RG_TipoComprobantes',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                let primerValorBool = true;

                ztiposComprobantesArray = data.lista;

                $("#zcbxTipoCpbteCompModal1").empty();
                $("#zcbxTipoCpbteCompModal2").empty();
                $("#zcbxTipoCpbteCompModal3").empty();


                $.each(data.lista, function () {
                    if (primerValorBool) {
                        vCodTipoComprobante = this.idTipoComp;
                    }

                    if (this.idTipoComp == 1 || this.idTipoComp == 2) {
                        $("#zcbxTipoCpbteCompModal1").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                    }
                    else if (this.idTipoComp == 3) {
                        $("#zcbxTipoCpbteCompModal2").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                    }
                    else if (this.idTipoComp == 4) {
                        $("#zcbxTipoCpbteCompModal3").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                    }

                    primerValorBool = false;
                });

                zcambioTipoCpte(vCodTipoComprobante);

                $("#zcbxTipoCpbteCompModal1").val(vCodTipoComprobante); // Factura o boleta.
                $("#zcbxTipoCpbteCompModal2").val(3); // Planilla de Movilidad
                $("#zcbxTipoCpbteCompModal3").val(4); // Planilla de Movilidad

                document.getElementById("zcbxTipoCpbteCompModal2").disabled = true;
                document.getElementById("zcbxTipoCpbteCompModal3").disabled = true;
            },
            failure: function () {
                console.error('error al cargar tipos periodos');
            }
        });
    }

    function zcambioTipoCpte(pCodTipoCpte) {

        // Limpiar TAB Factura Boleta

        if (pCodTipoCpte == 1) {
            // Factura
            document.getElementById("zcbxTipoCpbteCompModal1").disabled = false;
            document.getElementById("ztxtSerieModal1").disabled = false;
            document.getElementById("ztxtNumeroModal1").disabled = false;
            document.getElementById("ztxtObsCompModal1").disabled = false;

            document.getElementById("zcbxUM1").disabled = false;
            document.getElementById("ztxtDescripcion1").disabled = false;
            //document.getElementById("ztxtCantidad1").disabled = false;
            document.getElementById("ztxtValorUnitarioTotal1").disabled = false;

            document.getElementById("zidimportetotal1").disabled = true;
            document.getElementById("zidigv1").disabled = true;
            document.getElementById("zidtotal1").disabled = true;

            document.getElementById("ztxtSerieModal1").focus = true;
        }
        else if (pCodTipoCpte == 2) {
            // Boleta
            document.getElementById("zcbxTipoCpbteCompModal1").disabled = false;
            document.getElementById("ztxtSerieModal1").disabled = false;
            document.getElementById("ztxtObsCompModal1").disabled = false;

            document.getElementById("zcbxUM1").disabled = true;
            document.getElementById("ztxtDescripcion1").disabled = false;
            //document.getElementById("ztxtCantidad1").disabled = true;
            document.getElementById("ztxtValorUnitarioTotal1").disabled = false;

            $("#ztxtDescripcion1").val("");
            $("#zcbxUM1").val("UN");
            //$("#ztxtCantidad1").val(1);

            document.getElementById("ztxtValorUnitarioTotal1").focus = true;

        }

        zdetComprobanteArray1 = [];

        let tabla = $("#ztblFacturaBoleta").DataTable();
        tabla.destroy();
        var tr = "";
        $("#ztblFacturaBoletaContent").html(tr);
        $("#ztblFacturaBoleta").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[3], [3]]
            }
        );

        document.getElementById("zidimportetotal1").disabled = true;
        document.getElementById("zidigv1").disabled = true;
        document.getElementById("zidtotal1").disabled = true;

        $("#zidimportetotal1").val("0");
        $("#zidigv1").val("0");
        $("#zidtotal1").val("0");

        $('#zswtIGV').bootstrapToggle('off', true);
        zswitch = false;
    }

    function zvalidacionRegistro() {
        var respuesta = false;

        if ($("#ztxtRUCModal").val().trim() == "") {
            respuesta = false;
            Swal.fire({
                title: 'Ingrese un código de RUC',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'

            });
        }
        else if ($("#ztxtRSModal").val().trim() == "") {
            respuesta = false;

            Swal.fire({
                title: 'Ingrese Razon Social',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else {
            respuesta = true;
        }

        return respuesta;
    }


    $('#ztxtRucCompModal1').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {

            let ruc = $("#ztxtRucCompModal1").val().trim();

            if (ruc == "") {
                Swal.fire({
                    title: 'Ingrese RUC',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("ztxtRucCompModal1").focus = true;
                    }
                });
            }
            else if (ruc.length < 7 || ruc.length > 15) {
                Swal.fire({
                    title: 'Ingrese un número RUC valido por favor',
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        //document.getElementById("idztxtCodigo").focus = true;
                    }
                });
            }
            else {

                MostrarCarga("Buscando...");


                $.ajax({
                    url: "/finanzas/RG_SetproveedorValidar",
                    type: "POST",
                    data: { 'opcion': '1', 'tipoPersona': 'J', 'ruc': ruc, 'rs': '', 'direccion': '' },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            zproveedor = resultado.entidad;

                            if (resultado.entidad.idResponse == 0) {

                                Swal.fire({
                                    title: '¿Proveedor no existe, desea crearlo?',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Si',
                                    cancelButtonText: 'No'
                                }).then((result) => {
                                    if (result.value) {
                                        $("#zregComprobModal").modal("hide");
                                        $('#zproveedorModal').modal('show');
                                    }
                                });
                            }
                            else {

                                $("#ztxtRSCompModal1").val(resultado.entidad.danvar);
                                $("#ztxtCodSofyaPCModal1").val(resultado.entidad.ctpava + "-" + resultado.entidad.canvar);

                                zmensajePrincipal(true, "proveedor correcto");
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

            }

        }
    });

    $("#zbtnRegistrarProveedor").click(function () {

        if (zvalidacionRegistro()) {

            MostrarCarga("Guardando...");

            $.ajax({
                url: "/finanzas/RG_SetproveedorRegistrar",
                type: "POST",
                data: {
                    'opcion': '2',
                    'tipoPersona': 'J',
                    'ruc': $("#ztxtRUCModal").val(),
                    'rs': $("#ztxtRSModal").val(),
                    'direccion': $("#ztxtDireccionModal").val()
                },
                dataType: "json",
                success: function (resultado) {

                    zproveedor = resultado.entidad;

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {

                        if (resultado.entidad.idResponse == 1) {
                            zmensajePrincipal(true, resultado.entidad.statusResponse);
                        }
                        else {
                            zmensajePrincipal(false, resultado.entidad.statusResponse);
                        }
                    }

                    $("#ztxtRucCompModal1").val(zproveedor.creguc);
                    $("#ztxtRSCompModal1").val(zproveedor.danvar);
                    $("#ztxtCodSofyaPCModal1").val(zproveedor.ctpava + "-" + zproveedor.canvar);

                    $('#zproveedorModal').modal('hide');
                    $("#zregComprobModal").modal("show");

                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        }
    });

    $("#zbtnBuscarPendiente").click(function () {

        $.ajax({
            type: "GET",
            url: '/finanzas/RG_PendientesRendicion',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                let tabla = $("#ztblDetallePendiente").DataTable();

                tabla.destroy();
                var tr = "";

                data.lista.forEach((obj) => {

                    tr += "<tr> "
                        + " <td class='ocultar-columna'> " + obj.idSolicitud + "</td>"
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.codigo + "</td>"
                        + " <td style='min-width: 200px;'> " + obj.colaborador + "</td>"
                        + " <td> " + obj.glosa + "</td>"
                        + " <td> " + obj.total + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-codigo='" + obj.codigo + "' data-idsolicitud='" + obj.idSolicitud + "' data-toggle='collapse' class='btn btn-sm btn-outline-secondary cseleccionar ml-1'><i class='fas fa-check'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#ztblDetallePendienteContent").html(tr);


                $("#ztblDetallePendiente").DataTable(
                    {
                        "scrollY": "250px",
                        "scrollCollapse": true,
                        "paging": false
                    });


            },
            failure: function () {
                console.error('error al cargar los periodos');
            }
        });

        $('#zmodalSolicitudesPendientes').modal('show');

    });

    $('#zmodalSolicitudesPendientes').on('shown.bs.modal', function (e) {
        $('#ztblDetallePendiente').DataTable().columns.adjust();
    });

    $('#zmodalSolicitudesPendientes').on('hidden.bs.modal', function (e) {
        $('#ztblSolicitud').DataTable().columns.adjust();
    });



    $("#ztblDetallePendiente").on('click', '.cseleccionar', function () {
        // Modal Detalle, selecciona la solicitud.

        let codigo = $(this).attr("data-codigo");
        let idsolicitud = $(this).attr("data-idsolicitud");

        $.ajax({
            url: "/finanzas/RG_SolBusquedaXCod",
            type: "GET",
            data: { 'codigo': codigo, 'idSolicitud': idsolicitud },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {
                    if (resultado.entidad.idSolicitud > 0) {

                        zdetComprobanteArray1 = [];
                        zdetComprobanteArray2 = [];
                        zdetComprobanteArray3 = [];
                        zdetComprobanteArray = [];

                        zsolicitudSeleccionada = resultado.entidad;

                        $("#ztxtFecha").val(resultado.entidad.fecha);
                        $("#ztxtUsuario").val(USUARIO_COMPLETO);
                        $("#ztxtTipo").val(resultado.entidad.tipo);
                        $("#ztxtGlosa").val(resultado.entidad.observacion);
                        $("#ztxtCeCo").val(resultado.entidad.ceco);
                        $("#ztxtCodigo").val(resultado.entidad.codigo);
                        $("#ztxtColaborador").val(resultado.entidad.colaborador);
                        $("#ztxtTotalSol").val(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.total));

                        $("#zestado-desc").text(resultado.entidad.estado);

                        zmensajePrincipal(true, "Mostrando Solicitud");
                        zvalidarEstadoSolicitud(2, idsolicitud);

                        zarmarTablaDetalle(resultado.entidad.listaDetalle);
                        zindicadorEstado(resultado.entidad.idEstado);

                        $('#zmodalSolicitudesPendientes').modal('hide');

                    }
                    else {
                        zmensajePrincipal(false, "Solicitud no encontrada");
                    }
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    });

    $("#ztblSolicitud").on('click', '.seleccion', function () {

        let idsolicitud = $(this).attr("data-idsolicitud");
        let secuencia = $(this).attr("data-secuencia");
        let valor = $(this).attr("data-valor");
        let totalRestante = $(this).attr("data-restante");

        if ($(this).prop("checked")) {

            zdetalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), totalrestante: parseFloat(totalRestante) });

        } else {

            for (var i = 0; i < zdetalleArray.length; i++) {
                if (zdetalleArray[i].idsolicitud == idsolicitud && zdetalleArray[i].secuencia == secuencia) {
                    zdetalleArray.splice(i, 1);
                }
            }
        }
    });

    $("#ztblSolicitudContent").on("click", ".cRegistrarCpte", function () {

        zdetalleArray = [];

        let idsolicitud = $(this).attr("data-idsolicitud");
        let secuencia = $(this).attr("data-secuencia");
        let valor = $(this).attr("data-valor");
        let totalRestante = $(this).attr("data-restante");
        let idconceptodet = $(this).attr("data-idconceptodet");

        zdetalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), totalrestante: parseFloat(totalRestante) });

        let valorRestante = 0;

        zlimpiarControlModal(1);
        zlimpiarControlModal(2);
        zlimpiarControlModal(3);

        zTIPO_REGISTRO = "INSERTAR";

        $("#ztxtCeCoModal1").val(zsolicitudSeleccionada.ceco);
        $("#ztxtCeCoModal2").val(zsolicitudSeleccionada.ceco);
        $("#ztxtCeCoModal3").val(zsolicitudSeleccionada.ceco);

        $("#ztxtDNIModal2").val(zsolicitudSeleccionada.canvar_bnf);
        $("#ztxtDNIModal3").val(zsolicitudSeleccionada.canvar_bnf);
        $("#ztxtApeNomModal2").val(zsolicitudSeleccionada.colaborador);
        $("#ztxtApeNomModal3").val(zsolicitudSeleccionada.colaborador);

        for (var i = 0; i < zdetalleArray.length; i++) {
            valorRestante = valorRestante + zdetalleArray[i].totalrestante;
        }

        $("#zkpiMontoSeleecionadoModal1").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(valorRestante));
        $("#zkpiMontoSeleecionadoModal2").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(valorRestante));
        $("#zkpiMontoSeleecionadoModal3").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(valorRestante));

        $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
        $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
        $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");


        if (idconceptodet == "4" ||
            idconceptodet == "12" ||
            idconceptodet == "25" ||
            idconceptodet == "26" ||
            idconceptodet == "34" ||
            idconceptodet == "35") {

            $("#zfacturaboleta-tab").addClass("disabled");
            $("#zplanillamovilidad-tab").removeClass("disabled");
            $("#zdeclaracionjur-tab").addClass("disabled");

            $('#zregComprobModal .nav-tabs #zplanillamovilidad-tab').tab('show');
            ztabSeleccionado = 2;
        }
        else {
            $("#zfacturaboleta-tab").removeClass("disabled");
            $("#zplanillamovilidad-tab").addClass("disabled");
            $("#zdeclaracionjur-tab").removeClass("disabled");

            $("#zregComprobModal .nav-tabs #zfacturaboleta-tab").tab('show');
            ztabSeleccionado = 1;
        }

        var now = new Date();

        var today = FormatoFecha(now, "-");

        $('#ztxtFechaModal1').val(today);
        $('#ztxtFechaModal2').val(today);
        $('#ztxtFechaModal3').val(today);
        $('#ztxtFechaModalDet2').val(today);
        $('#ztxtFechaModalDet3').val(today);
        $('#ztxtFechaDesdeModal3').val(today);
        $('#ztxtFechaHastaModal3').val(today);
        $('#ztxtFechaModalDet3_1').val(today);
        $('#ztxtFechaModalDet3_2').val(today);

        $("#zcbxMonedaModal1").val(zsolicitudSeleccionada.idTipoMod);
        $("#zcbxMonedaModal2").val(zsolicitudSeleccionada.idTipoMod);
        $("#zcbxMonedaModal3").val(zsolicitudSeleccionada.idTipoMod);



        $("#zregComprobModal").modal("show");
    });

    $("#zbtnRegistrarcomprobante").click(function () {

        if (zdetalleArray.length > 0) {

            let valorRestante = 0;

            zlimpiarControlModal(1);
            zlimpiarControlModal(2);
            zlimpiarControlModal(3);


            // FACTURA Y BOLETA
            $("#zfacturaboleta-tab").removeClass("disabled");
            $("#zplanillamovilidad-tab").removeClass("disabled");
            $("#zdeclaracionjur-tab").removeClass("disabled");

            $("#zregComprobModal .nav-tabs #zfacturaboleta-tab").tab('show');

            zTIPO_REGISTRO = "INSERTAR";

            $("#ztxtCeCoModal1").val(zsolicitudSeleccionada.ceco);
            $("#ztxtCeCoModal2").val(zsolicitudSeleccionada.ceco);
            $("#ztxtCeCoModal3").val(zsolicitudSeleccionada.ceco);

            $("#ztxtDNIModal2").val(zsolicitudSeleccionada.canvar_bnf);
            $("#ztxtDNIModal3").val(zsolicitudSeleccionada.canvar_bnf);
            $("#ztxtApeNomModal2").val(zsolicitudSeleccionada.colaborador);
            $("#ztxtApeNomModal3").val(zsolicitudSeleccionada.colaborador);

            for (var i = 0; i < zdetalleArray.length; i++) {
                valorRestante = valorRestante + zdetalleArray[i].totalrestante;
            }

            $("#zkpiMontoSeleecionadoModal1").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(valorRestante));
            $("#zkpiMontoSeleecionadoModal2").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(valorRestante));
            $("#zkpiMontoSeleecionadoModal3").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(valorRestante));

            $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
            $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
            $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");


            var now = new Date();
            var today = FormatoFecha(now, "-");

            $('#ztxtFechaModal1').val(today);
            $('#ztxtFechaModal2').val(today);
            $('#ztxtFechaModal3').val(today);
            $('#ztxtFechaModalDet2').val(today);
            $('#ztxtFechaModalDet3').val(today);
            $('#ztxtFechaDesdeModal3').val(today);
            $('#ztxtFechaHastaModal3').val(today);
            $('#ztxtFechaModalDet3_1').val(today);
            $('#ztxtFechaModalDet3_2').val(today);

            $("#zcbxMonedaModal1").val(zsolicitudSeleccionada.idTipoMod);
            $("#zcbxMonedaModal2").val(zsolicitudSeleccionada.idTipoMod);
            $("#zcbxMonedaModal3").val(zsolicitudSeleccionada.idTipoMod);

            $("#zregComprobModal").modal("show");
        }
        else {
            Swal.fire({
                title: 'Seleccione el detalle de la Solicitud para le registro de Comprobante',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
    });

    $('#zproveedorModal').on('shown.bs.modal', function (e) {
        let rucIngresado = $("#ztxtRucCompModal1").val();

        $("#ztxtRUCModal").val(rucIngresado);
        document.getElementById("ztxtRSModal").focus = true;
    });

    $('#zproveedorModal').on('hidden.bs.modal', function (e) {
        $("#ztxtRUCModal").val("");
        $("#ztxtRSModal").val("");
        $("#ztxtDireccionModal").val("");
    });

    $('#ztxtDNIModal2').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {
            let dni = $("#ztxtDNIModal2").val().trim();
            busquedaXDNI(dni, ztabSeleccionado)
        }
    });

    $('#ztxtDNIModal3').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {
            let dni = $("#ztxtDNIModal3").val().trim();
            busquedaXDNI(dni, ztabSeleccionado)
        }
    });

    $('#zmodalSolDetInsertar').on('hidden.bs.modal', function (e) {
        $("#ztxtRUCModal").val("");
        $("#ztxtRSModal").val("");
        $("#ztxtDireccionModal").val("");
    });

        $('#zswtIGV').change(function () {
            zswitch = $(this).prop('checked');
        });

        $('#rswtIGV').change(function () {
            rswitch = $(this).prop('checked');
        });


    $("#zbtnAgregarMotivo1").click(function () {


        if (zvalidacionDetGuardarCpte(ztabSeleccionado)) {

            let cantidad = parseFloat($("#ztxtCantidad1").val());
            let valorUnitarioTotal = parseFloat($("#ztxtValorUnitarioTotal1").val());
            let valorUnitario = 0;

            if ($("#zcbxTipoCpbteCompModal1").val().trim() == "1") {

                if (zswitch) {
                    valorUnitario = (valorUnitarioTotal) / ((PORCENTAJE_IGV / 100) + 1);
                }
                else {
                    valorUnitario = (valorUnitarioTotal);
                }

            }
            else if ($("#zcbxTipoCpbteCompModal1").val().trim() == "2") {
                valorUnitario = (valorUnitarioTotal);
            }

            let total = (cantidad * valorUnitarioTotal);


            const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
                return acc += item.totalrestante
            }, 0);

            const sumAgregadosDet = zdetComprobanteArray1.reduce((acc, item) => {
                return acc += item.total;
            }, 0);


            if ((sumDetalleSol - (sumAgregadosDet + total)) < 0) {
                $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
            }
            else {
                $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
            }

            ziDetalle1++;

            var now = new Date();

            zdetComprobanteArray1.push({
                iDetalle: ziDetalle1,
                fecha: FormatoFecha(now, "/"),
                fechaBD: FormatoFecha(now, ""),
                detalle1: ($("#zcbxTipoCpbteCompModal1").val().trim() == "1" ? $("#ztxtDescripcion1").val() : $("#ztxtObsCompModal1").val()),
                detalle2: "",
                codum: $("#zcbxUM1").val(),
                valorunit: valorUnitario,
                cantidad: cantidad,
                total: total
            });


            let tabla = $("#ztblFacturaBoleta").DataTable();

            tabla.destroy();
            var tr = "";

            zdetComprobanteArray1.forEach((obj) => {

                tr += "<tr> "
                    + " <td> </td>"
                    + " <td> " + obj.codum + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + obj.cantidad + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td> " + formatoNumero(obj.total) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });

            $("#ztblFacturaBoletaContent").html(tr);

            $("#ztblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                });



            const importeTotal = zdetComprobanteArray1.reduce((acc, item) => {
                return acc += (item.valorunit * item.cantidad);
            }, 0);


            if ($("#zcbxTipoCpbteCompModal1").val().trim() == "1") {
                // FACTURA
                $("#zidimportetotal1").val(formatoNumero(importeTotal));

                if (zswitch) {
                    $("#zidigv1").val(formatoNumero(importeTotal * (PORCENTAJE_IGV / 100)));
                    $("#zidtotal1").val(formatoNumero(importeTotal + (importeTotal * (PORCENTAJE_IGV / 100))));
                }
                else {
                    $("#zidigv1").val(0);
                    $("#zidtotal1").val(formatoNumero(importeTotal));
                }

                $("#ztxtDescripcion1").val("");
                $("#ztxtCantidad1").val("");
                $("#ztxtValorUnitarioTotal1").val("");

                document.getElementById("zcbxUM1").focus = true;
            }
            else if ($("#zcbxTipoCpbteCompModal1").val().trim() == "2") {
                // BOLETA
                $("#zidimportetotal1").val(formatoNumero(importeTotal));
                $("#zidigv1").val(0);
                $("#zidtotal1").val(formatoNumero(importeTotal));

                $("#zcbxUM1").val("UN");
                $("#ztxtDescripcion1").val("");
                $("#ztxtCantidad1").val("1");
                $("#ztxtValorUnitarioTotal1").val("");

                document.getElementById("ztxtValorUnitarioTotal1").focus = true;
            }

            $("#zkpiMontoSeleecionadoModal1").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + total)));

        }
    });

    var zdetCpteArrayValid2 = [];
    var zi2 = 0;

    $("#zbtnAgregarMotivo2").click(function () {

        if (zvalidacionDetGuardarCpte(ztabSeleccionado)) {

            let importeIngresado = parseFloat($("#ztxtImporteModal2").val());

            ziDetalle2++;
            zi2++;

            let v2_maximoS = 0;
            let v2_maximoD = 0;
            let estadoValidacion = false;
            let valorSigaLoop = true;

            // validar el monto maximo
            zdetCpteArrayValid2.push({ id: ziDetalle2, fecha: $("#ztxtFechaModalDet2").val(), monto: parseFloat($("#ztxtImporteModal2").val()) });

            v2_TipoMod = $("#zcbxMonedaModal2").val();

            v2_maximoS = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal2").val())).maximoSoles;
            v2_maximoD = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal2").val())).maximoDolar;

            var result = [];
            var sumXFecha = 0;

            zdetCpteArrayValid2.reduce(function (res, value) {
                if (!res[value.fecha]) {
                    res[value.fecha] = { fecha: value.fecha, monto: 0 };
                    result.push(res[value.fecha])
                }
                res[value.fecha].monto += value.monto;
                return res;
            }, {});

            for (var i = 0; i < result.length; i++) {

                if (valorSigaLoop) {

                    sumXFecha = result[i].monto;

                    if (v2_TipoMod == "1") {
                        // Soles.
                        if (sumXFecha > v2_maximoS) {
                            estadoValidacion = false;

                            Swal.fire({
                                title: 'El monto máximo permitido es S/.' + v2_maximoS,
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            for (var i = 0; i < zdetCpteArrayValid2.length; i++) {
                                if (zdetCpteArrayValid2[i].id == ziDetalle2) {
                                    zdetCpteArrayValid2.splice(i, 1);
                                }
                            }
                            $("#ztxtImporteModal2").val("");
                            valorSigaLoop = false;
                        }
                        else {
                            estadoValidacion = true;
                        }
                    }
                    else if (v2_TipoMod == "2") {
                        // Dolar
                        if (sumXFecha > v2_maximoD) {
                            estadoValidacion = false;

                            Swal.fire({
                                title: 'El monto máximo permitido es U$.' + v2_maximoD,
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            for (var i = 0; i < zdetCpteArrayValid2.length; i++) {
                                if (zdetCpteArrayValid2[i].id == ziDetalle2) {
                                    zdetCpteArrayValid2.splice(i, 1);
                                }
                            }
                            $("#ztxtImporteModal2").val("");
                            valorSigaLoop = false;
                        }
                        else {
                            estadoValidacion = true;
                        }
                    }
                    else {
                        estadoValidacion = true;
                    }
                }
            }

            if (estadoValidacion) {

                const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
                    return acc += item.totalrestante
                }, 0);

                const sumAgregadosDet = zdetComprobanteArray2.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                    $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                }
                else {
                    $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                }

                zdetComprobanteArray2.push({
                    iDetalle: ziDetalle2,
                    fecha: FormatoFecha($("#ztxtFechaModalDet2").val(), "-"),
                    fechaBD: FormatoFecha($("#ztxtFechaModalDet2").val(), ""),
                    detalle1: $("#ztxtOrgDstModal2").val(),
                    detalle2: $("#ztxtMotivoModal2").val(),
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#ztxtImporteModal2").val()),
                    cantidad: 1
                });

                let tabla = $("#ztblPlanillaMovilidad").DataTable();

                tabla.destroy();
                var tr = "";

                zdetComprobanteArray2.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> </td>"
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + obj.detalle2 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#ztblPlanillaMovilidadContent").html(tr);

                $("#ztblPlanillaMovilidad").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    });

                $("#ztxtOrgDstModal2").val("");
                $("#ztxtMotivoModal2").val("");
                $("#ztxtImporteModal2").val("0");

                document.getElementById("ztxtOrgDstModal2").focus = true;

                const sumAgregadosDet1 = zdetComprobanteArray2.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);

                $("#zrendsumtotal").text("Suma Total: " + zsolicitudSeleccionada.simbolo + "" + formatoNumero(sumAgregadosDet1));
                $("#zkpiMontoSeleecionadoModal2").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + importeIngresado)));

            }
        }
    });


    $("#zbtnAgregarMotivo3_1").click(function () {

        if (zvalidacionDetGuardarCpte(ztabSeleccionado)) {

            let respuesta = false;
            let importeIngresado = parseFloat($("#ztxtMontoDet3_1").val());

            if (importeIngresado == "0" || importeIngresado == "" || typeof (importeIngresado) == "undefined" || isNaN(importeIngresado)) {

                Swal.fire({
                    title: 'Ingrese un monto',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (parseFloat(importeIngresado) <= 0) {

                Swal.fire({
                    title: 'Ingrese un monto positivo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            else {

                let sumTotal3 = 0;
                let v3_TipoMod = $("#zcbxMonedaModal3").val();
                let v3_maximoS = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal3").val())).maximoSoles;
                let v3_maximoD = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal3").val())).maximoDolar;

                // Validar si excede el monto maximo.
                if (v3_TipoMod.toString() == 1) {

                    // Soles.
                    if (zdetComprobanteArray3.length > 0) {
                        sumTotal3 = zdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#ztxtMontoDet3_1").val());
                    }

                    if (parseFloat(sumTotal3) > v3_maximoS) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es S/.' + v3_maximoS,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }

                }
                else if (v3_TipoMod.toString() == 2) {

                    // Dolar.
                    if (zdetComprobanteArray2.length > 0) {
                        sumTotal3 = zdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#ztxtMontoDet3_1").val());
                    }


                    if (parseFloat(sumTotal3) > v3_maximoD) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es U$ ' + v3_maximoD,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }


                // Paso la validacion.
                if (respuesta) {

                    const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
                        return acc += item.totalrestante
                    }, 0);

                    const sumAgregadosDet = zdetComprobanteArray3.reduce((acc, item) => {
                        return acc += (item.valorunit * item.cantidad);
                    }, 0);

                    if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                        $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                    }
                    else {
                        $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                    }


                    ziDetalle3++;

                    zdetComprobanteArray3.push({
                        iDetalle: ziDetalle3,
                        fecha: FormatoFecha($("#ztxtFechaModalDet3_1").val(), "-"),
                        fechaBD: FormatoFecha($("#ztxtFechaModalDet3_1").val(), ""),
                        detalle1: $("#zcbxMonedaModal3 option:selected").text(),
                        detalle2: "",
                        codum: "UN", // UNIDAD
                        valorunit: parseFloat($("#ztxtMontoDet3_1").val()),
                        cantidad: 1,
                        seccion: 1
                    });

                    let tabla = $("#ztblDeclaracionJurada3_1").DataTable();

                    tabla.destroy();
                    var tr = "";

                    zdetComprobanteArray3.forEach((obj) => {
                        if (obj.seccion == 1) {

                            tr += "<tr> "
                                + " <td> </td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        }
                    });

                    $("#ztblDeclaracionJuradaContent3_1").html(tr);

                    $("#ztblDeclaracionJurada3_1").DataTable(
                        {
                            'language': { 'url': '/libs/datatables/spanish.json' },
                            lengthMenu: [[5], [5]]
                        });

                    $("#ztxtMontoDet3_1").val("");

                    document.getElementById("ztxtFechaModalDet3_1").focus = true;

                    $("#zkpiMontoSeleecionadoModal3").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + importeIngresado)));

                }
            }
        }
    });


    $("#zbtnAgregarMotivo3_2").click(function () {

        if (zvalidacionDetGuardarCpte(ztabSeleccionado)) {

            let respuesta = false;
            let importeIngresado = parseFloat($("#ztxtMontoDet3_2").val());

            if (importeIngresado == "0" || importeIngresado == "" || typeof (importeIngresado) == "undefined" || isNaN(importeIngresado)) {

                Swal.fire({
                    title: 'Ingrese un monto',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (parseFloat(importeIngresado) <= 0) {

                Swal.fire({
                    title: 'Ingrese un monto positivo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            else {

                let sumTotal3 = 0;
                let v3_TipoMod = $("#zcbxMonedaModal3").val();
                let v3_maximoS = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal3").val())).maximoSoles;
                let v3_maximoD = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal3").val())).maximoDolar;

                // Validar si excede el monto maximo.
                if (v3_TipoMod.toString() == 1) {

                    // Soles.
                    if (zdetComprobanteArray3.length > 0) {
                        sumTotal3 = zdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#ztxtMontoDet3_2").val());
                    }

                    if (parseFloat(sumTotal3) > v3_maximoS) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es S/.' + v3_maximoS,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }

                }
                else if (v3_TipoMod.toString() == 2) {

                    // Dolar.
                    if (zdetComprobanteArray2.length > 0) {
                        sumTotal3 = zdetComprobanteArray3.reduce((acc, item) => {
                            return acc += item.valorunit * item.cantidad
                        }, 0);
                    }
                    else {
                        sumTotal3 = parseFloat($("#ztxtMontoDet3_2").val());
                    }

                    if (parseFloat(sumTotal3) > v3_maximoD) {
                        respuesta = false;
                        Swal.fire({
                            title: 'El monto máximo permitido es U$ ' + v3_maximoD,
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }


                if (respuesta) {



                    const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
                        return acc += item.totalrestante
                    }, 0);

                    const sumAgregadosDet = zdetComprobanteArray3.reduce((acc, item) => {
                        return acc += (item.valorunit * item.cantidad);
                    }, 0);

                    if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                        $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                    }
                    else {
                        $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                    }

                    ziDetalle3++;

                    zdetComprobanteArray3.push({
                        iDetalle: ziDetalle3,
                        fecha: FormatoFecha($("#ztxtFechaModalDet3_2").val(), "-"),
                        fechaBD: FormatoFecha($("#ztxtFechaModalDet3_2").val(), ""),
                        detalle1: $("#zcbxMonedaModal3 option:selected").text(),
                        detalle2: "",
                        codum: "UN", // UNIDAD
                        valorunit: parseFloat($("#ztxtMontoDet3_2").val()),
                        cantidad: 1,
                        seccion: 2
                    });

                    let tabla = $("#ztblDeclaracionJurada3_2").DataTable();

                    tabla.destroy();
                    var tr = "";

                    zdetComprobanteArray3.forEach((obj) => {
                        if (obj.seccion == 2) {

                            tr += "<tr> "
                                + " <td> </td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        }
                    });

                    $("#ztblDeclaracionJuradaContent3_2").html(tr);

                    $("#ztblDeclaracionJurada3_2").DataTable(
                        {
                            'language': { 'url': '/libs/datatables/spanish.json' },
                            lengthMenu: [[5], [5]]
                        });

                    $("#ztxtMontoDet3_2").val("");

                    document.getElementById("ztxtFechaModalDet3_2").focus = true;

                    $("#zkpiMontoSeleecionadoModal3").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + importeIngresado)));

                }
            }
        }
    });

    $("#ztblFacturaBoleta").on("click", ".cselectEliminar1", function () {

        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < zdetComprobanteArray1.length; i++) {
            if (zdetComprobanteArray1[i].iDetalle == parseInt(vIDetalle)) {
                zdetComprobanteArray1.splice(i, 1);
            }
        }

        const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
            return acc += item.totalrestante
        }, 0);

        const sumAgregadosDet = zdetComprobanteArray1.reduce((acc, item) => {
            return acc += (item.total);
        }, 0);

        $("#zkpiMontoSeleecionadoModal1").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        if ((sumDetalleSol - sumAgregadosDet) < 0) {
            $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
        }
        else {
            $("#zregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
        }

        let tabla = $("#ztblFacturaBoleta").DataTable();

        tabla.destroy();
        var tr = "";

        zdetComprobanteArray1.forEach((obj) => {

            tr += "<tr> "
                + " <td> </td>"
                + " <td> " + obj.codum + "</td>"
                + " <td> " + obj.detalle1 + "</td>"
                + " <td> " + obj.cantidad + "</td>"
                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                + " <td> " + formatoNumero(obj.total) + "</td>"
                + " <td class='text-center'>"
                + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                + "</td>"
                + "</tr>";
        });


        $("#ztblFacturaBoletaContent").html(tr);

        $("#ztblFacturaBoleta").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[5], [5]]
            });

        const importeTotal = zdetComprobanteArray1.reduce((acc, item) => {
            return acc += (item.valorunit * item.cantidad);
        }, 0);


        if ($("#zcbxTipoCpbteCompModal1").val().trim() == "1") {
            // FACTURA
            $("#ztxtDescripcion1").val("");
            $("#ztxtCantidad1").val("");
            $("#ztxtValorUnitarioTotal1").val("");

            if (zswitch) {
                $("#zidimportetotal1").val(formatoNumero(importeTotal));
                $("#zidigv1").val(formatoNumero(importeTotal * (PORCENTAJE_IGV / 100)));
                $("#zidtotal1").val(formatoNumero(importeTotal + (importeTotal * (PORCENTAJE_IGV / 100))));
            }
            else {
                $("#zidimportetotal1").val(formatoNumero(importeTotal));
                $("#zidigv1").val(0);
                $("#zidtotal1").val(formatoNumero(importeTotal));
            }
        }
        else if ($("#zcbxTipoCpbteCompModal1").val().trim() == "2") {
            // BOLETA
            $("#ztxtDescripcion1").val("");
            $("#ztxtCantidad1").val("1");
            $("#ztxtValorUnitarioTotal1").val("");

            $("#zidimportetotal1").val(formatoNumero(importeTotal));
            $("#zidigv1").val(0);
            $("#zidtotal1").val(formatoNumero(importeTotal));
        }


        document.getElementById("zcbxUM1").focus = true;

        $("#zkpiMontoSeleecionadoModal1").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

    });

    $("#ztblPlanillaMovilidad").on("click", ".cselectEliminar2", function () {
        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < zdetComprobanteArray2.length; i++) {
            if (zdetComprobanteArray2[i].iDetalle == parseInt(vIDetalle)) {
                zdetComprobanteArray2.splice(i, 1);
            }
        }


        for (var i = 0; i < zdetCpteArrayValid2.length; i++) {
            if (zdetCpteArrayValid2[i].id == vIDetalle) {
                zdetCpteArrayValid2.splice(i, 1);
            }
        }

        const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
            return acc += item.totalrestante
        }, 0);

        const sumAgregadosDet = zdetComprobanteArray2.reduce((acc, item) => {
            return acc += item.valorunit;
        }, 0);

        $("#zkpiMontoSeleecionadoModal2").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        if ((sumDetalleSol - sumAgregadosDet) < 0) {
            $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
        }
        else {
            $("#zregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
        }

        let tabla = $("#ztblPlanillaMovilidad").DataTable();

        tabla.destroy();
        var tr = "";

        zdetComprobanteArray2.forEach((obj) => {

            tr += "<tr> "
                + " <td> </td>"
                + " <td> " + obj.fecha + "</td>"
                + " <td> " + obj.detalle1 + "</td>"
                + " <td> " + obj.detalle2 + "</td>"
                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                + " <td class='text-center'>"
                + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                + "</td>"
                + "</tr>";
        });

        $("#ztblPlanillaMovilidadContent").html(tr);

        $("#ztblPlanillaMovilidad").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            });

        $("#ztxtOrgDstModal2").val("");
        $("#ztxtMotivoModal2").val("");
        $("#ztxtImporteModal2").val("0");

        document.getElementById("ztxtOrgDstModal2").focus = true;


        const sumAgregadosDet1 = zdetComprobanteArray2.reduce((acc, item) => {
            return acc += (item.valorunit * item.cantidad);
        }, 0);

        $("#zrendsumtotal").text("Suma Total: " + zsolicitudSeleccionada.simbolo + "" + formatoNumero(sumAgregadosDet1));
    });


    $("#ztblDeclaracionJurada3_1").on("click", ".cselectEliminar3_1", function () {
        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < zdetComprobanteArray3.length; i++) {
            if (zdetComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                zdetComprobanteArray3.splice(i, 1);
            }
        }

        const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
            return acc += item.totalrestante
        }, 0);

        const sumAgregadosDet = zdetComprobanteArray3.reduce((acc, item) => {
            return acc += item.valorunit;
        }, 0);

        $("#zkpiMontoSeleecionadoModal3").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        if ((sumDetalleSol - sumAgregadosDet) < 0) {
            $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
        }
        else {
            $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
        }

        let tabla = $("#ztblDeclaracionJurada3_1").DataTable();

        tabla.destroy();
        var tr = "";


        zdetComprobanteArray3.forEach((obj) => {

            if (obj.seccion == 1) {
                tr += "<tr> "
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            }
        });

        $("#ztblDeclaracionJuradaContent3_1").html(tr);

        $("#ztblDeclaracionJurada3_1").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[5], [5]]
            });

        $("#ztxtMontoDet3_1").val("");

        document.getElementById("ztxtFechaModalDet3_1").focus = true;
    });

    $("#ztblDeclaracionJurada3_2").on("click", ".cselectEliminar3_2", function () {
        let vIDetalle = $(this).attr("data-idetalle");

        for (var i = 0; i < zdetComprobanteArray3.length; i++) {
            if (zdetComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                zdetComprobanteArray3.splice(i, 1);
            }
        }

        const sumDetalleSol = zdetalleArray.reduce((acc, item) => {
            return acc += item.totalrestante
        }, 0);

        const sumAgregadosDet = zdetComprobanteArray3.reduce((acc, item) => {
            return acc += item.valorunit;
        }, 0);

        $("#zkpiMontoSeleecionadoModal3").text(zsolicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        if ((sumDetalleSol - sumAgregadosDet) < 0) {
            $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
        }
        else {
            $("#zregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
        }

        let tabla = $("#ztblDeclaracionJurada3_2").DataTable();

        tabla.destroy();
        var tr = "";


        zdetComprobanteArray3.forEach((obj) => {

            if (obj.seccion == 1) {
                tr += "<tr> "
                    + " <td> </td>"
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            }
        });

        $("#ztblDeclaracionJuradaContent3_2").html(tr);

        $("#ztblDeclaracionJurada3_2").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[5], [5]]
            });

        $("#ztxtMontoDet3_2").val("");

        document.getElementById("ztxtFechaModalDet3_2").focus = true;
    });


    $("#zbtnGuardarComprobante").click(function () {

        if (zvalidacionGuardarComp(ztabSeleccionado)) {

            let parametro = {};
            let opcion = 0;

            if (zTIPO_REGISTRO == "INSERTAR") {
                opcion = 1;
            }
            else if (zTIPO_REGISTRO == "EDITAR") {
                opcion = 6;
            }


            if (ztabSeleccionado == 1) {

                // 1. Facturas / Boletas
                parametro = {
                    'opcion': opcion,
                    'idRendCompte': zvIdRendCompte,
                    'idTipoComp': parseInt($("#zcbxTipoCpbteCompModal1").val()),

                    'nserie': $("#ztxtSerieModal1").val(),
                    'ndocof': $("#ztxtNumeroModal1").val(),

                    'rucDNI': $("#ztxtRucCompModal1").val(),
                    'rs': $("#ztxtRSCompModal1").val(),
                    'codigoPC': $("#ztxtCodSofyaPCModal1").val(),
                    'obs': $("#ztxtObsCompModal1").val(),
                    'fechaEmision': FormatoFecha($("#ztxtFechaModal1").val(), ""),
                    'codceco': zsolicitudSeleccionada.codceco,
                    'idTipoMod': parseInt($("#zcbxMonedaModal1").val()),
                    'porcentajeIGV': (($("#zcbxTipoCpbteCompModal1").val().trim() == "1" && zswitch) ? PORCENTAJE_IGV : 0),
                    'obs1': '',
                    'obs2': '',
                    'fecha1': '',
                    'fecha2': '',
                    'periodo': $("#zcbxPeriodoModal1").val(),
                    'solitudSeqArray': zdetalleArray,
                    'detalleComprobanteArray': zdetComprobanteArray1
                };

            }
            else if (ztabSeleccionado == 2) {

                // 2. Planilla de Movilidad
                parametro = {
                    'opcion': opcion,
                    'idRendCompte': zvIdRendCompte,
                    'idTipoComp': 3,

                    'nserie': (zsolicitudSeleccionada.codSede == "C" ? "001" : "002"),
                    'ndocof': FormatoFecha($("#ztxtFechaModal2").val(), ""),

                    'rucDNI': $("#ztxtDNIModal2").val(),
                    'rs': $("#ztxtApeNomModal2").val(),
                    'codigoPC': $("#ztxtDNIModal2").val(),
                    'obs': "PLANILLA DE MOVILIDAD - " + $("#ztxtColaborador").val(),
                    'fechaEmision': $("#ztxtFechaModal2").val(),
                    'codceco': zsolicitudSeleccionada.codceco,
                    'idTipoMod': parseInt($("#zcbxMonedaModal2").val()),
                    'porcentajeIGV': 0,
                    'obs1': '',
                    'obs2': '',
                    'fecha1': '',
                    'fecha2': '',
                    'periodo': $("#zcbxPeriodoModal2").val(),

                    'solitudSeqArray': zdetalleArray,
                    'detalleComprobanteArray': zdetComprobanteArray2
                };

            }
            else if (ztabSeleccionado == 3) {

                // 2. Declaracion Jurada

                parametro = {
                    'opcion': opcion,
                    'idRendCompte': zvIdRendCompte,
                    'idTipoComp': 4,

                    'nserie': (zsolicitudSeleccionada.codSede == "C" ? "001" : "002"),
                    'ndocof': FormatoFecha($("#ztxtFechaModal3").val(), ""),

                    'rucDNI': $("#ztxtDNIModal3").val(),
                    'rs': $("#ztxtApeNomModal3").val(),
                    'codigoPC': $("#ztxtDNIModal3").val(),
                    'obs': "DECLARACIÓN JURADA - " + $("#ztxtColaborador").val(),
                    'fechaEmision': $("#ztxtFechaModal3").val(),
                    'codceco': zsolicitudSeleccionada.codceco,
                    'idTipoMod': parseInt($("#zcbxMonedaModal3").val()),
                    'porcentajeIGV': 0,
                    'obs1': $("#ztxtCiudadModal3").val(),
                    'obs2': $("#ztxtPaisModal3").val(),
                    'fecha1': FormatoFecha($("#ztxtFechaDesdeModal3").val(), ""),
                    'fecha2': FormatoFecha($("#ztxtFechaHastaModal3").val(), ""),
                    'periodo': $("#zcbxPeriodoModal3").val(),

                    'solitudSeqArray': zdetalleArray,
                    'detalleComprobanteArray': zdetComprobanteArray3
                };
            }


            $.ajax({
                url: "/finanzas/RG_SetRendicionComprobante",
                type: "post",
                data: parametro,
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        if (resultado.entidad.idResponse > 0) {

                            zdetalleArray = [];

                            zdetComprobanteArray1 = [];

                            zdetComprobanteArray2 = [];
                            zdetCpteArrayValid2 = [];

                            zdetComprobanteArray3 = [];

                            zlimpiarControlModal(1);
                            zlimpiarControlModal(2);
                            zlimpiarControlModal(3);

                            zvalidarEstadoSolicitud(2, zsolicitudSeleccionada.idSolicitud);
                            zactualizarLista(zsolicitudSeleccionada.idSolicitud);



                            //if (zTIPO_REGISTRO == "INSERTAR") {

                            //    zlimpiarControlModal(1);
                            //    zlimpiarControlModal(2);
                            //    zlimpiarControlModal(3);

                            //    zdetComprobanteArray1 = [];
                            //    zdetComprobanteArray2 = [];
                            //    zdetComprobanteArray3 = [];

                            //    zdetalleArray = [];
                            //}

                            $("#zregComprobModal").modal("hide");

                        }
                        else {
                            zmensajePrincipal(false, resultado.entidad.statusResponse);
                        }
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });



        }
    });

    $('#zcbxTipoCpbteCompModal1').change(function () {

        var $option = $(this).find('option:selected');
        let vCodTipoComprobante = parseInt($option.val());

        $("#zidimportetotal1").val("0");
        $("#zidigv1").val("0");
        $("#zidtotal1").val("0");

        zdefinirValoresTipoCpte(vCodTipoComprobante);

        zdetComprobanteArray1 = [];

        let tabla = $("#ztblFacturaBoleta").DataTable();
        tabla.destroy();
        var tr = "";
        $("#ztblFacturaBoletaContent").html(tr);
        $("#ztblFacturaBoleta").DataTable(
            {
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[3], [3]]
            }
        );
    });


    function zdefinirValoresTipoCpte(vCodTipoComprobante) {
        // Limpiar TAB Factura Boleta

        if (vCodTipoComprobante == 1) {
            // Factura
            document.getElementById("zcbxTipoCpbteCompModal1").disabled = false;

            document.getElementById("ztxtObsCompModal1").disabled = false;

            document.getElementById("zcbxUM1").disabled = false;
            document.getElementById("ztxtDescripcion1").disabled = false;
            document.getElementById("ztxtCantidad1").disabled = false;
            document.getElementById("ztxtValorUnitarioTotal1").disabled = false;

            document.getElementById("zidimportetotal1").disabled = true;
            document.getElementById("zidigv1").disabled = true;
            document.getElementById("zidtotal1").disabled = true;

            $('#zswtIGV').bootstrapToggle('on', true);
            zswitch = true;
        }
        else if (vCodTipoComprobante == 2) {
            // Boleta
            document.getElementById("zcbxTipoCpbteCompModal1").disabled = false;
            //document.getElementById("txtSerieNumCompModal1").disabled = false;
            document.getElementById("ztxtObsCompModal1").disabled = false;

            document.getElementById("zcbxUM1").disabled = true;
            document.getElementById("ztxtDescripcion1").disabled = true;
            document.getElementById("ztxtCantidad1").disabled = true;
            document.getElementById("ztxtValorUnitarioTotal1").disabled = false;

            $("#ztxtDescripcion1").val("");
            $("#zcbxUM1").val("UN");
            $("#ztxtCantidad1").val(1);

            document.getElementById("ztxtValorUnitarioTotal1").focus = true;

            $('#zswtIGV').bootstrapToggle('off', true);
            zswitch = false;
        }

        document.getElementById("zidimportetotal1").disabled = true;
        document.getElementById("zidigv1").disabled = true;
        document.getElementById("zidtotal1").disabled = true;
    }


    $("#ztabRendicionGastos").on("click", ".zctabRegComp", function () {
        let index = $(this).attr("data-id");
        ztabSeleccionado = parseInt(index);
    });

    $('.cfecha').change(function () {

        var inputDate = new Date(this.value);
        var today = new Date();

        if (inputDate > today) {

            $(this).val(FormatoFecha(today, "-"));

            Swal.fire({
                title: 'La fecha no puede ser mayor a la fecha Actual',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }

    });

    function zvalidacionDetGuardarCpte(tabSeleccion) {
        let respuesta = false;

        let v1_TipoMod = 0;
        let v1_maximoS = 0;
        let v1_maximoD = 0;

        if (tabSeleccion == 1) {

            let tipoComprobante = $('#zcbxTipoCpbteCompModal1').val();
            let sumTotal1 = 0;

            v1_TipoMod = $("#zcbxMonedaModal1").val();
            v1_maximoS = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal1").val())).maximoSoles;
            v1_maximoD = ztiposComprobantesArray.find(x => x.idTipoComp == parseInt($("#zcbxTipoCpbteCompModal1").val())).maximoDolar;


            let desc = $("#ztxtDescripcion1").val();

            if ($("#zcbxTipoCpbteCompModal1").val().trim() == "0") {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione un Tipo de Comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#zcbxUM1").val() == "0" && tipoComprobante == "1") {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione una unidad de medida por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtDescripcion1").val().trim() == "" && (tipoComprobante == "1")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese la descripción por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (($("#ztxtCantidad1").val().trim() == "" || $("#ztxtCantidad1").val() == null || typeof ($("#ztxtCantidad1").val()) == "undefined") && (tipoComprobante == "1")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese la cantidad por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ((parseFloat($("#ztxtCantidad1").val()) == 0 || parseFloat($("#ztxtCantidad1").val()) < 0 || parseFloat($("#ztxtCantidad1").val()) > 50) && (tipoComprobante == "1")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese una cantidad correcta por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (($("#ztxtValorUnitarioTotal1").val().trim() == "" || $("#ztxtValorUnitarioTotal1").val() == null || typeof ($("#ztxtValorUnitarioTotal1").val()) == "undefined") && (tipoComprobante == "1")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese el valor Unitario',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ((parseFloat($("#ztxtValorUnitarioTotal1").val()) == 0 || parseFloat($("#ztxtValorUnitarioTotal1").val()) < 0 || parseFloat($("#ztxtValorUnitarioTotal1").val()) > 1500) && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;
                Swal.fire({
                    title: 'Ingrese un Valor unitario correcto por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

            else if (v1_TipoMod.toString() == 1) {

                if (zdetComprobanteArray1.length > 0) {
                    sumTotal1 = zdetComprobanteArray1.reduce((acc, item) => {
                        return acc += item.valorunit * item.cantidad
                    }, 0);
                }
                else {
                    sumTotal1 = parseFloat($("#ztxtValorUnitarioTotal1").val()) * parseFloat($("#ztxtCantidad1").val());
                }

                // Soles.
                if (sumTotal1 > v1_maximoS) {
                    respuesta = false;
                    Swal.fire({
                        title: 'El monto máximo permitido es S/.' + v1_maximoS,
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }

            }
            else if (v1_TipoMod.toString() == 2) {

                // Soles.
                if (zdetComprobanteArray1.length > 0) {
                    sumTotal1 = zdetComprobanteArray1.reduce((acc, item) => {
                        return acc += item.valorunit * item.cantidad
                    }, 0);
                }
                else {
                    sumTotal1 = parseFloat($("#ztxtValorUnitarioTotal1").val()) * parseFloat($("#ztxtCantidad1").val());
                }

                if (sumTotal1 > v1_maximoD) {
                    respuesta = false;
                    Swal.fire({
                        title: 'El monto máximo permitido es U$ ' + v1_maximoD,
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }

            else {
                respuesta = true;
            }

        }
        else if (tabSeleccion == 2) {

            if ($("#ztxtApeNomModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese Apellidos y Nombres',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtDNIModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: "Ingrese el número de DNI",
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtApeNomModal2").val().trim() == "0 Ninguno" || $("#ztxtApeNomModal2").val().trim() == "0 Varios") {
                respuesta = false;

                Swal.fire({
                    title: 'Colaborador no existe',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtOrgDstModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese una descripción de Origen/Destino',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtMotivoModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese una descripción del motivo',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtImporteModal2").val().trim() == "" || $("#ztxtImporteModal2").val().trim() == "0") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el importe por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

            else {
                respuesta = true;
            }
        }
        else if (tabSeleccion == 3) {


            if ($("#ztxtCiudadModal3").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el nombre de la Ciudad',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtPaisModal3").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: "Ingrese el nombre del País",
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }
        }

        return respuesta;
    }

    function zvalidacionGuardarComp(indexTab) {
        var respuesta = false;

        if (indexTab == 1) {
            // Registro de Factura y Boleta
            let tipoComprobante = $('#zcbxTipoCpbteCompModal1').val();

            if ($("#zcbxTipoCpbteCompModal1").val().trim() == "0" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione un Tipo de Comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtSerieModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese al serie del comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtNumeroModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el numero del comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtRucCompModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el número de RUC / DNI',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if ($("#ztxtCodSofyaPCModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'El proveedor debe estar registrado en Sofya para continuar',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (zdetComprobanteArray1.length == 0 && (tipoComprobante == "1" || tipoComprobante == "2")) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe agregar el detalle del comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

            else {
                respuesta = true;
            }
        }
        if (indexTab == 2) {

            // Planilla de Movilidad

            if ($("#ztxtDNIModal2").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'No se encuentra el colaborador',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (zdetComprobanteArray2.length == 0) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe agregar el detalle de Planilla de Movilidad',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }
        }
        else if (indexTab == 3) {

            // Declaracion Jurada
            if ($("#zcbxMonedaModal3").val().trim() == "0") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el tipo de Moneda',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
            else if ($("#ztxtDNIModal3").val().trim() == "") {
                respuesta = false;

                Swal.fire({
                    title: 'Ingrese el número de DNI por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else if (zdetComprobanteArray3.length == 0) {
                respuesta = false;

                Swal.fire({
                    title: 'Debe agregar el detalle de la Declaración Jurada',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }
        }


        return respuesta;
    }


    function zlimpiarControlModal(tabSeleccion) {

        var now = new Date();
        var today = FormatoFecha(now, "-");

        if (tabSeleccion == 1) {

            // 1. Factura y Boleta
            //$("#zcbxTipoCpbteCompModal1").val(0);

            let tipoCpte = $("#zcbxTipoCpbteCompModal1").val();

            $("#ztxtFechaModal1").val(today);

            $("#ztxtSerieModal1").val("");
            $("#ztxtNumeroModal1").val("");

            $("#ztxtRucCompModal1").val("");
            $("#ztxtRSCompModal1").val("");
            $("#ztxtCodSofyaPCModal1").val("");
            $("#ztxtObsCompModal1").val("");

            $("#zcbxUM1").val("UN");
            $("#ztxtDescripcion1").val("");
            $("#ztxtCantidad1").val("");
            $("#ztxtValorUnitarioTotal1").val("");

            $("#zidimportetotal1").val("0");
            $("#zidigv1").val("0");
            $("#zidtotal1").val("0");

            $("#zkpiMontoSeleecionadoModal1").text("0.00");
            document.getElementById("zcbxTipoCpbteCompModal1").disabled = false;

            let tablafb = $("#ztblFacturaBoleta").DataTable();
            tablafb.destroy();
            var tr = "";
            $("#ztblFacturaBoletaContent").html(tr);
            $("#ztblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );

            zdefinirValoresTipoCpte(tipoCpte);

        }
        else if (tabSeleccion == 2) {

            // 2. Planilla de Movilidad
            $("#ztxtNumPlanillaModal2").val("");
            $("#ztxtApeNomModal2").val("");
            $("#ztxtDNIModal2").val("");
            $("#ztxtCeCoModal2").val("");

            $("#ztxtFechaModal2").val(today);
            $("#ztxtOrgDstModal2").val("");
            $("#ztxtMotivoModal2").val("");
            $("#ztxtImporteModal2").val("");

            let tablap = $("#ztblPlanillaMovilidad").DataTable();
            tablap.destroy();
            var tr = "";
            $("#ztblPlanillaMovilidadContent").html(tr);
            $("#ztblPlanillaMovilidad").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );

            $("#zrendsumtotal").text("Suma Total: 0.00");
            $("#zkpiMontoSeleecionadoModal2").text("0.00");
        }
        else if (tabSeleccion == 3) {

            // 3. Declaración Jurada.
            $("#ztxtCodigoModal3").val("");

            $("#ztxtCiudadModal3").val("");
            $("#ztxtPaisModal3").val("");

            $("#ztxtFechaDesdeModal3").val(today);
            $("#ztxtFechaHastaModal3").val(today);
            $("#txtMotivoModal3").val("");
            $("#txtImporteModal3").val("");

            let tabla1 = $("#ztblDeclaracionJurada3_1").DataTable();
            tabla1.destroy();
            var tr1 = "";
            $("#ztblDeclaracionJuradaContent3_1").html(tr1);
            $("#ztblDeclaracionJurada3_1").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );

            let tabla2 = $("#ztblDeclaracionJurada3_2").DataTable();
            tabla2.destroy();
            var tr2 = "";
            $("#ztblDeclaracionJuradaContent3_2").html(tr2);
            $("#ztblDeclaracionJurada3_2").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );


            $("#zkpiMontoSeleecionadoModal3").text("0.00");
        }

        zdetComprobanteArray = [];
    }

    function zactualizarLista(pIdSolicitud) {
        $.ajax({
            url: "/finanzas/RG_SolicitudDetalleRendicion",
            type: "GET",
            data: { idSolicitud: pIdSolicitud },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {
                    zarmarTablaDetalle(resultado.lista);
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    }

    function zvalidarEstadoSolicitud(pOpcion, pIdSolicitud) {

        $.ajax({
            url: "/finanzas/RG_ValidarEstadoRendicion",
            type: "POST",
            data: {
                opcion: pOpcion,
                idSolicitud: pIdSolicitud,
                codigo: "",
                secuencia: 0,
                idRendCompte: 0
            },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {
                    zindicadorEstado(resultado.status.idResponse);
                    $("#zestado-desc").text(resultado.status.statusResponse);
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    }

    function busquedaXDNI(dni, opcionModal) {

        if (dni == "") {
            Swal.fire({
                title: 'Ingrese el número de DNI',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Cancel',
                focusConfirm: true
            }).then(result => {
                if (result.value) {
                    // Planilla de Movilidad
                    if (opcionModal == 2) {
                        document.getElementById("ztxtDNIModal2").focus = true;
                    }
                    else if (opcionModal == 3) {
                        // Declaracion Jurada
                        document.getElementById("ztxtDNIModal3").focus = true;
                    }
                }
            });
        }
        else if (dni.length < 7) {
            Swal.fire({
                title: 'Ingrese un número RUC valido por favor',
                icon: 'warning',
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Cancel',
                focusConfirm: true
            }).then(result => {
                if (result.value) {
                    // Planilla de Movilidad
                    if (opcionModal == 2) {
                        document.getElementById("ztxtDNIModal2").focus = true;
                    }
                    else if (opcionModal == 3) {
                        // Declaracion Jurada
                        document.getElementById("ztxtDNIModal3").focus = true;
                    }
                }
            });
        }
        else {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_BuscarColaboradorXDNI',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { dni: dni },
                success: function (data) {

                    if (opcionModal == 2) {
                        // Planilla de Movilidad
                        $("#ztxtApeNomModal2").val(data.entidad.codcolaborador + " " + data.entidad.colaborador);
                    }
                    else if (opcionModal == 3) {
                        // Declaracion Jurada
                        $("#ztxtApeNomModal3").val(data.entidad.codcolaborador + " " + data.entidad.colaborador);
                    }

                    if (data.entidad.codcolaborador == "0") {

                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 2500,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })

                        Toast.fire({
                            icon: 'warning',
                            title: data.entidad.mensaje
                        });

                        if (opcionModal == 2) {
                            // Planilla de Movilidad
                            document.getElementById("ztxtDNIModal2").focus = true;
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            document.getElementById("ztxtDNIModal3").focus = true;
                        }
                    }
                    else {
                        if (opcionModal == 2) {
                            // Planilla de Movilidad
                            document.getElementById("ztxtOrgDstModal2").focus = true;
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            // document.getElementById("ztxtDNIModal3").focus = true;
                        }
                    }
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }
    }

    function zindicadorEstado(idEstado) {

        $("#zestado-icon").removeClass("icon-pendiente");
        $("#zestado-icon").removeClass("icon-liberado");
        $("#zestado-icon").removeClass("icon-rechazado");
        $("#zestado-icon").removeClass("icon-rend-completa");
        $("#zestado-icon").removeClass("icon-rend-incompleta");
        $("#zestado-icon").addClass("icon-aprobado");

    }

    function formatoNumero(x) {
        x = x.toFixed(2);
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function zarmarTablaDetalle(lista) {

        let tabla = $("#ztblSolicitud").DataTable();

        tabla.destroy();

        var tr = "";
        let tr_cptes = "";


        lista.forEach((obj) => {

            tr_cptes = "";

            tr += "<tr> "
                + " <td></td>"
                + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                + " <td class='ocultar-columna'> " + obj.secuencia + "</td>";

            if (obj.countCpte == 0) {
                tr_cptes = " <td class='text-center'>"
                    + "     <button data-idtipocomp = " + obj.idTipoComp + " data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "'  data-valor=" + obj.valor + " data-totalsolicitado = " + obj.totalSolicitado + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " data-idconceptodet=" + obj.idConceptoDet + " data-toggle='collapse' class='btn btn-sm btn-info cDetalleComprobante'>0<i class='fas fa-eye'></i></button>"
                    + "</td>";

                tr = tr + tr_cptes;

            }
            else if (obj.countCpte == 1) {
                tr_cptes = " <td class='text-center'>"
                    + "     <button data-idtipocomp = " + obj.idTipoComp + " data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "'  data-valor=" + obj.valor + " data-totalsolicitado = " + obj.totalSolicitado + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " data-idconceptodet=" + obj.idConceptoDet + " data-toggle='collapse' class='btn btn-sm btn-info cDetalleComprobante'>" + obj.serieNumero + " <i class='fas fa-eye'></i></button>"
                    + "</td>";

                tr = tr + tr_cptes;

            }
            else {
                tr_cptes = " <td class='text-center'>"
                    + "     <button data-idtipocomp = " + obj.idTipoComp + " data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "'  data-valor=" + obj.valor + " data-totalsolicitado = " + obj.totalSolicitado + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " data-idconceptodet=" + obj.idConceptoDet + " data-toggle='collapse' class='btn btn-sm btn-info cDetalleComprobante'>2+ <i class='fas fa-eye'></i></button>"
                    + "</td>";

                tr = tr + tr_cptes;
            }


            tr = tr + " <td> " + obj.tipo + "</td>"
                + " <td> " + obj.conceptoCab + "</td>"
                + " <td> " + obj.conceptoDet + "</td>"
                + " <td> " + obj.cantDias + "</td>"
                + " <td> " + formatoNumero(obj.valor) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalEntregado) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalRendido) + "</td>"
                + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalEntregado - obj.totalRendido) + "</td>"
                + " <td class='text-center'>"
                + "     <button data-idsolicitud = " + obj.idSolicitud + " data-secuencia = " + obj.secuencia + " data-idtipocomp = " + obj.idTipoComp + " data-idrendcompte=" + obj.idRendCompte + "  data-valor=" + obj.valor + " data-restante=" + (obj.totalEntregado - obj.totalRendido) + " data-idconceptodet=" + obj.idConceptoDet + " data-toggle='collapse' class='btn btn-sm btn-primary cRegistrarCpte'><i class='fas fa-save'></i></button>"
                + "</td>"
                + "</tr>";
        });

        $("#ztblSolicitudContent").html(tr);

        $("#ztblSolicitud").DataTable(
            {
                "scrollX": true,
                "bSort": true,
                buttons: [
                    'excel', 'pdf', 'print'
                ],
                scrollY: '50vh',
                scrollCollapse: true,
                paging: true,
                'language': { 'url': '/libs/datatables/spanish.json' },
                lengthMenu: [[10, 20, 30, -1], [10, 20, 30, 'Todos']]
            });



    }


    $("#zbtnVerRegistrados").click(function () {

        if (zvalidacionVerCmptes()) {

            $.ajax({
                url: "@Url.Action("RG_BuscarIdSolicitud", "Finanzas")",
                data: {
                    idSolicitud: zsolicitudSeleccionada.idSolicitud,
                },
                success: function (data) {
                    window.location.href = '@Url.Action("MapearReporteCXSPDF", "Finanzas")'
                }
            });
        }
    });

    function zvalidacionVerCmptes() {
        var respuesta = false;

        let idSolicitud = zsolicitudSeleccionada.idSolicitud;

        if (idSolicitud == null || typeof (idSolicitud) == "undefined") {
            respuesta = false;

            Swal.fire({
                title: 'Seleccione una Solicitud por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ok'
            });
        }
        else {
            respuesta = true;
        }

        return respuesta;
    }

    $("#zlist-comprobantes").on("click", "a", function () {

        let idRendCompte = $(this).attr("data-idrendcompte");

        zcargarComprobanteCabecera(idRendCompte);
    });


    function zgetSolicitudComprobante(idRendCompte) {

        $.ajax({
            url: "/finanzas/RG_SolicitudComprobante",
            type: "GET",
            data: { idRendCompte: idRendCompte },
            dataType: "json",
            success: function (resultado) {
                zdetalleArray = resultado.lista;
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    }


    function zcargarComprobanteCabecera(pIdRendCompte) {

        $.ajax({
            url: "/finanzas/RG_ComprobateCabecera",
            type: "GET",
            data: { idRendCompte: pIdRendCompte },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {

                    zsolicitudSeleccionada = resultado.entidad;
                    zlistaComptesIdTipoComp = resultado.entidad.idTipoComp;

                    if (resultado.entidad.idTipoComp == 1 || resultado.entidad.idTipoComp == 2) {

                        // FACTURA Y BOLETA
                        $("#zfacturaboleta-tab").removeClass("disabled");
                        $("#zplanillamovilidad-tab").addClass("disabled");
                        $("#zdeclaracionjur-tab").addClass("disabled");

                        $("#zregComprobModal .nav-tabs #zfacturaboleta-tab").tab('show');
                        ztabSeleccionado = 1;

                        $("#zcbxTipoCpbteCompModal1").val(resultado.entidad.idTipoComp);
                        document.getElementById("zcbxTipoCpbteCompModal1").disabled = true;

                        //$("#txtSerieNumCompModal1").val(resultado.entidad.serieNumero);
                        $("#ztxtSerieModal1").val(resultado.entidad.nserie);
                        $("#ztxtNumeroModal1").val($.trim(resultado.entidad.ndocof));

                        $("#ztxtFechaModal1").val(resultado.entidad.fechaEmision);
                        $("#zcbxMonedaModal1").val(resultado.entidad.idTipoMod);
                        $("#zcbxPeriodoModal1").val(resultado.entidad.periodo);
                        $("#ztxtRucCompModal1").val(resultado.entidad.rucDNI);
                        $("#ztxtRSCompModal1").val(resultado.entidad.rs);
                        $("#ztxtCodSofyaPCModal1").val(resultado.entidad.codigoPC);
                        $("#ztxtObsCompModal1").val(resultado.entidad.obs);
                        $("#ztxtCeCoModal1").val(resultado.entidad.ceco);

                        $("#zkpiMontoSeleecionadoModal1").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalEntregado - resultado.entidad.totalCmpbnte));


                        if (resultado.entidad.idTipoComp == 1) {
                            // Factura
                            $("#zidimportetotal1").val(formatoNumero(resultado.entidad.totalCmpbnteBI));
                            $("#zidigv1").val(formatoNumero(resultado.entidad.totalCmpbnteIGV));
                            $("#zidtotal1").val(formatoNumero(resultado.entidad.totalCmpbnte));
                        }
                        else if (resultado.entidad.idTipoComp == 2) {
                            // Boleta
                            $("#zidimportetotal1").val(formatoNumero(resultado.entidad.totalCmpbnteBI));
                            $("#zidigv1").val(formatoNumero(0));
                            $("#zidtotal1").val(formatoNumero(resultado.entidad.totalCmpbnte));
                        }

                        $("#zcbxUM1").val("UN");
                        $("#ztxtDescripcion1").val("");
                        $("#ztxtCantidad1").val("");
                        $("#ztxtValorUnitarioTotal1").val("");

                        zdefinirValoresTipoCpte($("#zcbxTipoCpbteCompModal1").val());
                        zcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);

                    }
                    else if (resultado.entidad.idTipoComp == 3) {

                        // PLANILLA DE MOVILIDADA
                        $("#zfacturaboleta-tab").addClass("disabled");
                        $("#zplanillamovilidad-tab").removeClass("disabled");
                        $("#zdeclaracionjur-tab").addClass("disabled");

                        $('#zregComprobModal .nav-tabs #zplanillamovilidad-tab').tab('show');
                        ztabSeleccionado = 2;

                        $("#ztxtFechaModal2").val(resultado.entidad.fechaEmision);
                        $("#ztxtNumPlanillaModal2").val(resultado.entidad.serieNumero);
                        $("#zcbxMonedaModal2").val(resultado.entidad.idTipoMod);
                        $("#zcbxPeriodoModal2").val(resultado.entidad.periodo);
                        $("#ztxtDNIModal2").val(resultado.entidad.rucDNI);
                        $("#ztxtApeNomModal2").val(resultado.entidad.rs);
                        $("#ztxtCeCoModal2").val(resultado.entidad.ceco);

                        $("#zkpiMontoSeleecionadoModal2").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalEntregado - resultado.entidad.totalCmpbnte));

                        zcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);
                    }
                    else if (resultado.entidad.idTipoComp == 4) {

                        // DECLARACION JURADA.
                        $("#zfacturaboleta-tab").addClass("disabled");
                        $("#zplanillamovilidad-tab").addClass("disabled");
                        $("#zdeclaracionjur-tab").removeClass("disabled");

                        $('#zregComprobModal .nav-tabs #zdeclaracionjur-tab').tab('show');
                        ztabSeleccionado = 3;
                        $("#ztxtFechaModal3").val(resultado.entidad.fechaEmision);
                        $("#ztxtCodigoModal3").val(resultado.entidad.serieNumero);
                        $("#zcbxMonedaModal3").val(resultado.entidad.idTipoMod);
                        $("#zcbxPeriodoModal3").val(resultado.entidad.periodo);
                        $("#ztxtDNIModal3").val(resultado.entidad.rucDNI);
                        $("#ztxtApeNomModal3").val(resultado.entidad.rs);
                        $("#ztxtCeCoModal3").val(resultado.entidad.ceco);

                        $("#ztxtCiudadModal3").val(resultado.entidad.ciudad);
                        $("#ztxtPaisModal3").val(resultado.entidad.pais);

                        $("#ztxtFechaDesdeModal3").val(resultado.entidad.fdesde);
                        $("#ztxtFechaHastaModal3").val(resultado.entidad.fhasta);


                        $("#zkpiMontoSeleecionadoModal3").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalEntregado - resultado.entidad.totalCmpbnte));

                        zcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);
                    }

                }
            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });

    }

    function zcargarComprobanteDetalle(pIdRendCompte, pIdTipoComp) {

        $.ajax({
            url: "/finanzas/RG_ComprobateDetalle",
            type: "GET",
            data: { idRendCompte: pIdRendCompte },
            dataType: "json",
            success: function (resultado) {

                if (resultado.isRedirect) {
                    window.location.href = resultado.redirectUrl;
                }
                else {

                    if (pIdTipoComp == 1 || pIdTipoComp == 2) {

                        // FACTURA Y BOLETA

                        let tablaFB = $("#ztblFacturaBoleta").DataTable();

                        tablaFB.destroy();
                        var trFB = "";
                        zdetComprobanteArray1 = [];

                        resultado.lista.forEach((obj) => {

                            ziDetalle1++;

                            zdetComprobanteArray1.push({
                                iDetalle: ziDetalle1,
                                fecha: obj.fecha,
                                fechaBD: obj.fechaBD,
                                detalle1: obj.detalle1,
                                detalle2: "",
                                codum: obj.codum,
                                valorunit: obj.valorunit,
                                cantidad: obj.cantidad,
                                total: obj.total
                            });

                            trFB += "<tr> "
                                + " <td> </td>"
                                + " <td> " + obj.um + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + obj.cantidad + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td> " + formatoNumero(obj.total) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idetalle ='" + ziDetalle1 + "' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });


                        $("#ztblFacturaBoletaContent").html(trFB);

                        $("#ztblFacturaBoleta").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[3], [3]]
                            });
                    }
                    else if (pIdTipoComp == 3) {

                        // PLANILLA DE MOVILIDAD

                        let tablaPM = $("#ztblPlanillaMovilidad").DataTable();

                        tablaPM.destroy();
                        var trPM = "";
                        zdetComprobanteArray2 = [];

                        resultado.lista.forEach((obj) => {

                            ziDetalle2++;

                            zdetComprobanteArray2.push({
                                iDetalle: ziDetalle2,
                                fecha: obj.fecha,
                                fechaBD: obj.fechaBD,
                                detalle1: obj.detalle1,
                                detalle2: obj.detalle2,
                                codum: obj.codum, // UNIDAD
                                valorunit: obj.valorunit,
                                cantidad: obj.cantidad
                            });

                            trPM += "<tr> "
                                + " <td> </td>"
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + obj.detalle2 + "</td>"
                                + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idetalle='" + ziDetalle2 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });

                        $("#ztblPlanillaMovilidadContent").html(trPM);

                        $("#ztblPlanillaMovilidad").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[3], [3]]
                            });

                        const sumAgregadosDet = zdetComprobanteArray2.reduce((acc, item) => {
                            return acc += (item.valorunit * item.cantidad);
                        }, 0);

                        $("#zrendsumtotal").text("Suma Total: " + zsolicitudSeleccionada.simbolo + "" + formatoNumero(sumAgregadosDet));

                    }
                    else if (pIdTipoComp == 4) {

                        // DECLARACION JURADA

                        let tablaDJ_1 = $("#ztblDeclaracionJurada3_1").DataTable();
                        let tablaDJ_2 = $("#ztblDeclaracionJurada3_2").DataTable();

                        tablaDJ_1.destroy();
                        tablaDJ_2.destroy();

                        var trDJ_1 = "";
                        var trDJ_2 = "";

                        zdetComprobanteArray3 = [];


                        resultado.lista.forEach((obj) => {

                            ziDetalle3++;

                            zdetComprobanteArray3.push({
                                iDetalle: ziDetalle3,
                                fecha: obj.fecha,
                                fechaBD: obj.fechaBD,
                                detalle1: obj.detalle1,
                                detalle2: "",
                                codum: obj.codum, // UNIDAD
                                valorunit: obj.valorunit,
                                cantidad: obj.cantidad,
                                seccion: obj.seccion
                            });

                            if (obj.seccion == 1) {
                                trDJ_1 += "<tr> "
                                    + " <td> </td>"
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.detalle1 + "</td>"
                                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-idetalle='" + ziDetalle3 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            }
                            else if (obj.seccion == 2) {
                                trDJ_2 += "<tr> "
                                    + " <td> </td>"
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.detalle1 + "</td>"
                                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-idetalle='" + ziDetalle3 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            }

                        });

                        $("#ztblDeclaracionJuradaContent3_1").html(trDJ_1);
                        $("#ztblDeclaracionJuradaContent3_2").html(trDJ_2);

                        $("#ztblDeclaracionJurada3_1").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5], [5]]
                            });

                        $("#ztblDeclaracionJurada3_2").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5], [5]]
                            });
                    }
                }

            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });
    }

    function zmensajePrincipal(estado, mensaje) {
        if (estado == true) {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'success',
                title: mensaje
            });

        }
        else if (estado == false) {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'error',
                title: mensaje
            });

        }
    }

    $("#ztblCptesRegistradosCont").on("click", ".cImprimirPDF", function () {

        let idTipoComp = $(this).attr("data-idtipocomp");
        let idRendCompte = $(this).attr("data-idrendcompte");

        $.ajax({
            url: "@Url.Action("RG_BuscarIdCompte", "Finanzas")",
            data: {
                idTipoComp: idTipoComp,
                idRendCompte: idRendCompte
            },
            success: function (data) {

                if (idTipoComp == 3) {
                    // Planilla de Movilidad
                    window.location.href = '@Url.Action("MapearReportePLPDF", "Finanzas")'
                }
                else if (idTipoComp == 4) {
                    // Declaración Jurada
                    window.location.href = '@Url.Action("MapearReporteDJPDF", "Finanzas")'
                }

            }
        });

    });

    $("#ztblSolicitudContent").on("click", ".cDevolucion", function () {

        zidsolicitud_dev = $(this).attr("data-idsolicitud");
        zidsecuencia_dev = $(this).attr("data-secuencia");


        $("#zregistrarDevModal").modal("show");

    });

    $("#ztblCptesRegistradosCont").on("click", ".cEditarCpte", function () {

        $("#zdetComprobantesModal").modal("hide");
        zdetalleArray = [];

        let idsolicitud = $(this).attr("data-idsolicitud");
        let secuencia = $(this).attr("data-secuencia");
        let valor = $(this).attr("data-valor");
        let totalRestante = $(this).attr("data-restante");
        let totalsolicitado = $(this).attr("data-totalsolicitado");

        zvIdRendCompte = $(this).attr("data-idrendcompte");

        zdetalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), totalrestante: parseFloat(totalsolicitado) });

        zTIPO_REGISTRO = "EDITAR";

        var now = new Date();
         var today = FormatoFecha(now, "-");

        $('#ztxtFechaModal1').val(today);
        $('#ztxtFechaModal2').val(today);
        $('#ztxtFechaModal3').val(today);
        $('#ztxtFechaModalDet2').val(today);
        $('#ztxtFechaModalDet3').val(today);
        $('#ztxtFechaDesdeModal3').val(today);
        $('#ztxtFechaHastaModal3').val(today);
        $('#ztxtFechaModalDet3_1').val(today);
        $('#ztxtFechaModalDet3_2').val(today);

        $("#zcbxMonedaModal1").val(zsolicitudSeleccionada.idTipoMod);
        $("#zcbxMonedaModal2").val(zsolicitudSeleccionada.idTipoMod);
        $("#zcbxMonedaModal3").val(zsolicitudSeleccionada.idTipoMod);

        $("#zregComprobModal").modal("show");

        zcargarComprobanteCabecera(zvIdRendCompte);

    });


    $("#ztblSolicitudContent").on("click", ".cDetalleComprobante", function () {

        let idsolicitud = $(this).attr("data-idsolicitud");
        let secuencia = $(this).attr("data-secuencia");

        let v_valor = $(this).attr("data-valor");
        let v_totalsolicitado = $(this).attr("data-totalsolicitado");
        let v_restante = $(this).attr("data-restante");
        let v_idconceptodet = $(this).attr("data-idconceptodet");
        let v_idtipo = $(this).attr("data-idtipocomp");


        $.ajax({
            type: "GET",
            url: '/finanzas/RG_CptesRegistrados',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: {
                'idsolicitud': idsolicitud,
                'secuencia': secuencia
            },
            success: function (data) {

                let tabla = $("#ztblCptesRegistrados").DataTable();

                tabla.destroy();
                var tr = "";
                var tr_btn_pdf = "";


                data.lista.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> " + obj.numserie + "</td>"
                        + " <td> " + obj.rs + "</td>"
                        + " <td> " + obj.simbolo + " " + formatoNumero(obj.total) + "</td>";


                    if (obj.idTipoComp == 3 || obj.idTipoComp == 4) {
                        tr_btn_pdf =
                            " <td class='text-center'>"
                            + "     <button data-idtipocomp = " + v_idtipo + " data-idrendcompte=" + obj.idRendCompte + " data-toggle='collapse' class='btn btn-sm btn-danger cImprimirPDF' " + (obj.idRendCompte == 0 ? " disabled " : " ") + "><i class='fas fa-file-pdf'></i></button>"
                            + " </td> ";
                    }
                    else {
                        tr_btn_pdf = " <td class='text-center'></td> ";
                    }

                    tr = tr + tr_btn_pdf;


                    tr = tr + " <td class='text-center'>"
                        + "     <button data-idrendcompte=" + obj.idRendCompte + "  data-idsolicitud='" + idsolicitud + "' data-secuencia='" + secuencia + "'  data-valor=" + v_valor + " data-totalsolicitado = " + v_totalsolicitado + " data-restante=" + v_restante + " data-idconceptodet=" + v_idconceptodet + " data-toggle='collapse' class='btn btn-sm btn-success cEditarCpte'><i class='fas fa-edit'></i></button>"
                        + "</td>"

                        + " <td class='text-center'>"
                        + "     <button data-idrendcompte=" + obj.idRendCompte + " class='btn btn-sm btn-danger cEliminarCpte'><i class='fas fa-trash'></i></button>"
                        + "</td>"

                        + "</tr>";
                });

                $("#ztblCptesRegistradosCont").html(tr);

                $("#ztblCptesRegistrados").DataTable(
                    {
                        searching: false,
                        paging: false,
                        info: false,
                        'language': { 'url': '/libs/datatables/spanish.json' }
                    });


                $("#zdetComprobantesModal").modal("show");

            },
            failure: function () {
                console.error('error al cargar los periodos');
            }
        });

    });

    $("#ztblCptesRegistradosCont").on("click", ".cEliminarCpte", function () {

        let idRendCompte = $(this).attr("data-idrendcompte");

        if (idRendCompte == "0" || idRendCompte == null || typeof (idRendCompte) == "undefined") {

            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })

            Toast.fire({
                icon: 'warning',
                title: 'No existe comprobante para eliminar'
            });
        }
        else {

            Swal.fire({
                title: '¿Desea Eliminar el Comprobante?',
                text: 'Textile Sourcing Company',
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Ok'

            }).then((result) => {

                if (result.value) {

                    parametro = {
                        'opcion': 10,
                        'idRendCompte': idRendCompte,
                        'idTipoComp': 0,
                        'serieNumero': "",
                        'rucDNI': "",
                        'rs': "",
                        'codigoPC': "",
                        'obs': "",
                        'fechaEmision': "",
                        'codceco': 0,
                        'idTipoMod': 0,
                        'porcentajeIGV': 0,
                        'obs1': '',
                        'obs2': '',
                        'fecha1': '',
                        'fecha2': '',
                        'periodo': "",
                        'solitudSeqArray': null,
                        'detalleComprobanteArray': null,
                        'idSolicitud': 0,
                        'secuencia': 0
                    };

                    $.ajax({
                        url: "/finanzas/RG_SetRendicionComprobante",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.entidad.idResponse > 0) {

                                    zdetComprobanteArray1 = [];
                                    zdetComprobanteArray2 = [];
                                    zdetComprobanteArray3 = [];
                                    zdetComprobanteArray = [];

                                    zvalidarEstadoSolicitud(2, zsolicitudSeleccionada.idSolicitud);
                                    zactualizarLista(zsolicitudSeleccionada.idSolicitud);

                                    zmensajePrincipal(true, resultado.entidad.statusResponse);
                                }
                                else {
                                    zmensajePrincipal(false, resultado.entidad.statusResponse);
                                }

                                $("#zdetComprobantesModal").modal("hide");
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }

            });
        }
    });


    $('#ztxtMontoDevolucion').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);

        if (keycode == '13') {

            let monto = $("#ztxtMontoDevolucion").val().trim();

            if (monto == "") {
                Swal.fire({
                    title: 'Ingrese el monto por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("ztxtMontoDevolucion").focus = true;
                    }
                });
            }
            else if (parseFloat(monto) <= 0 || parseFloat(monto) > 1000) {
                Swal.fire({
                    title: 'Ingrese un monto correcto, por favor',
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        document.getElementById("ztxtMontoDevolucion").focus = true;
                    }
                });
            }
            else {

                MostrarCarga("Guardando...");


                $.ajax({
                    url: "/finanzas/RG_SetDevolucionRend",
                    type: "POST",
                    data: {
                        'opcion': 5,
                        'idsolicitud': zidsolicitud_dev,
                        'secuencia': zidsecuencia_dev,
                        'montoDev': parseFloat(monto)
                    },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {

                            if (resultado.entidad.idResponse > 0) {

                                Swal.fire({
                                    title: 'Registro Correcto',
                                    text: 'Textile Sourcing CompanY',
                                    icon: 'success',
                                    showConfirmButton: true,
                                    showCancelButton: false,
                                    confirmButtonText: 'Ok',
                                    cancelButtonText: 'Cancel',
                                    focusConfirm: true
                                }).then(result => {
                                    if (result.value) {
                                        document.getElementById("ztxtMontoDevolucion").focus = true;
                                    }
                                });
                            }
                            else {

                                Swal.fire({
                                    title: 'Ocurrio un error al registrar monto',
                                    text: 'Textile Sourcing CompanY',
                                    icon: 'error',
                                    showConfirmButton: true,
                                    showCancelButton: false,
                                    confirmButtonText: 'Ok',
                                    cancelButtonText: 'Cancel',
                                    focusConfirm: true
                                }).then(result => {
                                    if (result.value) {
                                        document.getElementById("ztxtMontoDevolucion").focus = true;
                                    }
                                });

                            }

                            $("#zregistrarDevModal").modal("hide");
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

            }

        }
    });

    $('#zregistrarDevModal').on('shown.bs.modal', function (e) {
        document.getElementById("ztxtMontoDevolucion").focus = true;
    });

    $('#zregistrarDevModal').on('hidden.bs.modal', function (e) {
        $("#ztxtMontoDevolucion").val("");
    });

    $("#zbtnGuardarDevolucion").click(function () {

        let monto = $("#ztxtMontoDevolucion").val().trim();

        if (monto == "") {
            Swal.fire({
                title: 'Ingrese el monto por favor',
                text: "Textile Sourcing Company",
                icon: 'warning',
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Cancel',
                focusConfirm: true
            }).then(result => {
                if (result.value) {
                    document.getElementById("ztxtMontoDevolucion").focus = true;
                }
            });
        }
        else if (parseFloat(monto) <= 0 || parseFloat(monto) > 1000) {
            Swal.fire({
                title: 'Ingrese un monto correcto, por favor',
                icon: 'warning',
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Cancel',
                focusConfirm: true
            }).then(result => {
                if (result.value) {
                    document.getElementById("ztxtMontoDevolucion").focus = true;
                }
            });
        }
        else {

            MostrarCarga("Guardando...");


            $.ajax({
                url: "/finanzas/RG_SetDevolucionRend",
                type: "POST",
                data: {
                    'opcion': 5,
                    'idsolicitud': zidsolicitud_dev,
                    'secuencia': zidsecuencia_dev,
                    'monto': parseFloat(monto)
                },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {

                        if (resultado.entidad.idResponse > 0) {

                            Swal.fire({
                                title: 'Registro Correcto',
                                text: 'Textile Sourcing CompanY',
                                icon: 'success',
                                showConfirmButton: true,
                                showCancelButton: false,
                                confirmButtonText: 'Ok',
                                cancelButtonText: 'Cancel',
                                focusConfirm: true
                            }).then(result => {
                                if (result.value) {
                                    document.getElementById("ztxtMontoDevolucion").focus = true;
                                }
                            });
                        }
                        else {

                            Swal.fire({
                                title: 'Ocurrio un error al registrar monto',
                                text: 'Textile Sourcing Company',
                                icon: 'error',
                                showConfirmButton: true,
                                showCancelButton: false,
                                confirmButtonText: 'Ok',
                                cancelButtonText: 'Cancel',
                                focusConfirm: true
                            }).then(result => {
                                if (result.value) {
                                    document.getElementById("ztxtMontoDevolucion").focus = true;
                                }
                            });

                        }

                        zactualizarLista(zsolicitudSeleccionada.idSolicitud);
                        $("#zregistrarDevModal").modal("hide");
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });

        }


    });





    </script>


    @*<script src="~/Admin/js/Finanzas/Rendiciones/solicitudgastos.js"></script>
        <script src="~/Admin/js/Finanzas/Rendiciones/reembolso.js"></script>
        <script src="~/Admin/js/Finanzas/Rendiciones/rendicion.js"></script>*@
}


