@{
    ViewBag.Title = "Reembolso";
    ViewBag.Modulo = "Finanzas";
    Layout = "~/Views/Plantillas/_Layout.cshtml";
}


<div id="rsolrem" class="container-fluid">

    <div class="container-fluid">

        <div class="card">

            <div class="row m-2">

                <div class="col-4 p-1">
                    <label for="">Buscar Colaborador - SOFYA</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <button type="button" id="rbtnBuscarColaborador" class="btn btn-warning btn-sm"><i class="fas fa-search"></i></button>
                        </div>
                        <input type="text" class="form-control form-control-sm" placeholder="Colaborador" id="rtxtcolaborador" aria-label="Username" disabled>
                    </div>
                </div>

                <div class="col-3 p-1">
                    <label for="ridCbxTipo">Tipo</label>
                    <select class="form-control form-control-sm" id="ridCbxTipo" disabled></select>
                </div>

                <div class="col-3 p-1">
                    <label for="ridtxtcodigo">Código</label>
                    <input class="form-control form-control-sm" type="text" id="ridtxtcodigo" placeholder="Codigo" maxlength="10" disabled>
                </div>

                <div class="col-2 p-1">
                    <label for="riddttFechaHora">Fecha</label>
                    <input class="form-control form-control-sm" type="text" id="riddttFechaHora" disabled>
                </div>

                @*<div class="col-3 p-1">
                        <label for="idtxtusuario">Usuario</label>
                        <input class="form-control form-control-sm" type="text" id="idtxtusuario" disabled>
                    </div>*@




                <div class="col-1 p-1">
                    <label for="ridCbxSede">Sede</label>
                    <select class="form-control form-control-sm" id="ridCbxSede"></select>
                </div>

                <div class="col-2 p-1">
                    <label for="ridCbxTipoMod">Tipo de Moneda</label>
                    <select class="form-control form-control-sm" id="ridCbxTipoMod"></select>
                </div>

                <div class="col-5 p-1">
                    <label for="ridtxtaobs">Motivo Glosa / Descripción Solicitud</label>
                    <input type="text" class="form-control form-control-sm" placeholder="Ingrese una descripción / glosa" id="ridtxtaobs" maxlength="300" />
                </div>

                <div class="col-4 p-1">
                    <label for="rcbxCeCo1">Centro de Costo:</label>
                    <select class="form-control form-control-sm" id="rcbxCeCo1"></select>
                </div>



                <div class="col-12 p-2 d-flex justify-content-between">
                    <div class="col-8 d-flex justify-content-between cbtn-acciones">

                        <div>
                            <button id="rbtnNuevo" type="button" class="btn btn-primary btn-sm"><i class="fas fa-file"></i> Nuevo</button>
                        </div>
                        <div>

                            <button id="rbtnGenerarComprobante" type="button" class="btn btn-success btn-sm ml-1 mr-1"><i class="fas fa-save"></i> Registrar Comprobante</button>

                            @*<button id="rbtnGuardarCabecera" type="button" class="btn btn-success btn-sm ml-1 mr-1"><i class="fas fa-save"></i> Generar Solicitud</button>
                                <button id="btnAgregarDetalle" type="button" data-toggle="modal" data-target="#modalSolicitudDetalle" class="btn btn-warning btn-sm"><i class="fas fa-plus"></i> Agregar Detalle</button>*@


                        </div>

                    </div>

                    <div class="col-3 ckpi-total d-flex justify-content-between">

                        <div class="rckpi-item">
                            <h5 id="rkpi-cantidad">0</h5>
                            <span>Cantidad</span>
                        </div>

                        <div class="rckpi-item">
                            <h5 id="rkpi-total">0</h5>
                            <span>Total</span>
                        </div>

                    </div>

                </div>

            </div>
        </div>

        <div class="card card-body mt-1">

            <table class="table table-sm table-bordered table-hover display nowrap" id="rtblDetalle" style="width: 100%">
                <thead class="thead-light">
                    <tr>
                        <th class="ocultar-columna">id</th>
                        <th class="">Serie Número</th>
                        <th>Centro de Costo</th>
                        <th>Concepto</th>
                        <th>Total</th>
                        <th style="text-align: center">Eliminar cpte</th>
                        <th>PDF</th>
                        @*<th>Acciones</th>*@
                    </tr>
                </thead>
                <tbody id="rtblDetalleContent"></tbody>
            </table>

        </div>

        <div>
            <hr />
        </div>

        <div class="container-fluid mb-2">
            <div class="row d-flex justify-content-lg-between">
                <div>
                    <button type="button" id="rbtnVerRegistrados" class="btn btn-primary btn-sm"><i class='fas fa-eye'></i>  Ver Registrados</button>
                </div>
                @*<div>
                        <button type="button" id="rbtnRegistrarcomprobante" class="btn btn-primary btn-sm">Registrar Comprobante</button>
                    </div>*@
            </div>
        </div>


    </div>

</div>


@*  :::::::::::::::::::::::::::::::::::::::::     INSERTAR     ::::::::::::::::::::::::::::::::::::::::::::::  *@


<div class="modal fade" id="rmodalSolDetInsertar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">


                <div class="row">
                    <div class="col-2">
                        <label for="ridmcodigo">Codigo:</label>
                        <input type="text" class="form-control form-control-sm" getid="ridmcodigo" readonly>
                    </div>
                    <div class="col-4">
                        <label for="ridmCbxConcepCab">Concepto:</label>
                        <select class="form-control form-control-sm" id="ridmCbxConcepCab"></select>
                    </div>

                    <div class="col-6">
                        <label for="ridmCbxCeCo">Centro de Costo:</label>
                        <select class="form-control form-control-sm" id="ridmCbxCeCo"></select>
                    </div>
                </div>


                <div class="row p-2 mt-1 d-flex flex-row justify-content-between">

                    <div class="card col-9 p-2 d-flex flex-row justify-content-start">
                        <div class="d-flex justify-content-center align-items-center">
                            <input type='checkbox' id="rseleccionar-todo" class="form-control form-control-sm">
                        </div>
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="ml-2">Seleccionar Todo</div>
                        </div>
                    </div>

                    <div class="card col-2 p-2">
                        <div class="d-flex flex-column justify-content-center align-content-center">
                            <div class="rcant-sum-total-det" id="sum-total-det">0.00</div>
                            <div class="rsubt-sum-total-det">Total</div>
                        </div>
                    </div>

                </div>


                <div class="container-fluid">
                    <div class="row">
                        <div class="col">
                            <ul class="list-group">

                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-1">
                                            <h6>Marcar</h6>
                                        </div>
                                        <div class="col-2">
                                            <h6>Concepto</h6>
                                        </div>
                                        <div class="col-1">
                                            <h6>Monto</h6>
                                        </div>
                                        <div class="col-7">
                                            <h6>Consideracion</h6>
                                        </div>
                                        <div class="col-1">
                                            <h6>Días</h6>
                                        </div>
                                    </div>
                                </li>

                                <li class="list-group-item" id="rdetalleConceptoInsertarEditar">
                                </li>

                            </ul>
                        </div>
                    </div>

                </div>


            </div>
            <div class="modal-footer">
                <button id="rbtnCancelar" type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button id="rbtnGuardarDetalle" type="button" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
</div>



@*  :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::     VISUALIZAR     ::::::::::::::::::::::::::::::::::::::::::::::.  *@

<div class="modal fade" id="rmodalSolDetVisualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form>
                    <div class="row">
                        <div class="col-2">
                            <label for="ridmdCodigo">Codigo:</label>
                            <input type="text" class="form-control form-control-sm" id="ridmdCodigo" readonly>
                        </div>
                        <div class="col-4">
                            <label for="ridmdConcepCab">Concepto:</label>
                            <input class="form-control form-control-sm" id="ridmdConcepCab" readonly>
                        </div>

                        <div class="col-6">
                            <label for="ridmdCeCo">Centro de Costo:</label>
                            <input class="form-control form-control-sm" id="ridmdCeCo">
                        </div>
                    </div>


                    <div class="container-fluid mt-4">

                        <div class="row">
                            <div class="col">
                                <ul class="list-group">

                                    <li class="list-group-item">
                                        <div class="row">
                                            <div class="col-2">
                                                <h6>Concepto</h6>
                                            </div>
                                            <div class="col-1">
                                                <h6>Monto</h6>
                                            </div>

                                            <div class="col-8">
                                                <h6>Consideracion</h6>
                                            </div>
                                            <div class="col-1">
                                                <h6>Marcar</h6>
                                            </div>
                                        </div>
                                    </li>

                                    <li class="list-group-item" id="rdetalleConceptoVisualizar">
                                    </li>

                                </ul>
                            </div>
                        </div>

                    </div>

                </form>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>


@*  ::::::::::::::::::::::  BUSCAR COLABORADOR - SOFYA   ::::::::::::::::    *@


<div class="modal fade bd-example-modal-lg" id="rmodalColaboradorSofya" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Buscar Colaborador - SOFYA</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="form-group">
                    <input type="text" class="form-control form-control-sm" id="ridBusquedaColaborador" placeholder="Buscar Colaborador <Presionar Enter>">
                </div>

                <table class="table table-sm table-bordered table-hover display nowrap" id="rtblColaborador" style="width: 100%">
                    <thead class="thead-light">
                        <tr>
                            <th>Codigo SOFYA</th>
                            <th>Colaborador</th>
                            <th>Seleecionar</th>
                        </tr>
                    </thead>
                    <tbody id="rtblColaboradorContent"></tbody>
                </table>

            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="rregComprobModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Registro de Comprobante</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <ul class="nav nav-tabs nav-justified md-tabs indigo" id="rtabRendicionGastos" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active rctabRegComp" data-id="1" id="rfacturaboleta-just" data-toggle="tab" href="#rsg-facturaboleta" role="tab" aria-controls="firma-just"
                           aria-selected="true">Factura / Boleta</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rctabRegComp" data-id="2" id="rplanillamovilidad-tab" data-toggle="tab" href="#rsg-planillamovilidad" role="tab" aria-controls="aprobadas-just"
                           aria-selected="false">Planilla de Movilidad</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rctabRegComp" data-id="3" id="rdeclaracionjur-tab" data-toggle="tab" href="#rsg-declaracionjur" role="tab" aria-controls="aprobadas-just"
                           aria-selected="false">Declaración Jurada</a>
                    </li>
                </ul>


                <div class="tab-content card pt-1">

                    @*    **********************          FACTURA Y BOLETA        **********************  *@

                    <div class="tab-pane fade show active" id="rsg-facturaboleta" role="tabpanel" aria-labelledby="rfacturaboleta-tab">

                        @Html.Partial("Finanzas/remRendFacturaBoleta")

                    </div>


                    @*    **********************          PLANILLA DE MOVILIDAD        **********************  *@

                    <div class="tab-pane fade" id="rsg-planillamovilidad" role="tabpanel" aria-labelledby="rplanillamovilidad-tab">

                        @Html.Partial("Finanzas/remRendPlanillaMovilidad")

                    </div>


                    @*    **********************          DECLARACION JURADA        **********************  *@

                    <div class="tab-pane fade" id="rsg-declaracionjur" role="tabpanel" aria-labelledby="rdeclaracionjur-tab">

                        @Html.Partial("Finanzas/remRendDeclaracionJurada")

                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <span class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</span>
                <span class="btn btn-sm btn-primary" id="btnGuardarComprobante">Guardar</span>
            </div>
        </div>
    </div>
</div>










<style>




    #rmodalSolDetInsertar .rcant-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 18px;
    }


    #rmodalSolDetInsertar .rsubt-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 14px;
    }



    #rsolrem label {
        font-family: 'Roboto', sans-serif;
    }

    #modalSolicitudDetalle input, select, span, label {
        font-family: 'Roboto', sans-serif;
    }

    #rsolrem .ridtxtcodigo-ok {
        background-color: #82E0AA !important;
    }


    #rsolrem table .ocultar-columna {
        display: none;
    }


    #rsolrem .cbtn-acciones {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #rsolrem .ckpi-total {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #rsolrem .rckpi-item {
        background-color: #EBEDEF;
        width: 45%;
        margin: auto;
        padding: 4px;
        border-radius: 3px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }


    #rsolrem .rkpi-cantidad {
    }

    #rsolrem #rtblHistorial th {
        font-family: 'Roboto', sans-serif !important;
    }

    #rsolrem #rtblHistorial td {
        font-family: 'Roboto', sans-serif !important;
        font-weight: 600;
    }

    #rsolrem #rtblDetalle th {
        font-family: 'Roboto', sans-serif !important;
    }

    #rsolrem #rtblDetalle td {
        font-family: 'Roboto', sans-serif !important;
    }

    #rsolrem .estado-solicitud {
        padding: 10px;
        border: 1px solid #000000;
        border-radius: 5px;
    }

    #rsolrem #restado-desc {
        margin-right: 8px;
    }

    #modalSolicitudDetalle #idmConcepDetConsid {
        height: 100px !important;
    }


    #rsolrem .icon-pendiente::after {
        content: url(../../Public/icon-pend.png);
    }

    #rsolrem .icon-liberado::after {
        content: url(../../Public/icon-libe.png);
    }

    #rsolrem .icon-aprobado::after {
        content: url(../../Public/icon-apro.png);
    }

    #rsolrem .icon-rechazado::after {
        content: url(../../Public/icon-rech.png);
    }



    #rsolrem .desc-est-pendiente {
        color: #616A6B;
    }

    #rsolrem .desc-est-liberado {
        color: #F1C40F;
    }

    #rsolrem .desc-est-aprobado {
        color: #28B463;
    }

    #rsolrem .desc-est-rechazado {
        color: #C0392B;
    }


    #rsolrem #listDetalleConcept p {
        font-size: 13px !important;
        border: 1px solid #E5E8E8 !important;
        padding: 4px !important;
    }

    #rregComprobModal span.btn {
        cursor: pointer;
    }

    input[type="checkbox"] {
        position: relative;
        width: 2.2em;
        height: 2.2em;
        color: #000;
        border: 1px solid #D5D8DC;
        border-radius: 4px;
        appearance: none;
        outline: 0;
        cursor: pointer;
        transition: background 175ms cubic-bezier(0.1, 0.1, 0.25, 1);
    }

        input[type="checkbox"]::before {
            position: absolute;
            content: '';
            display: block;
            top: 3px;
            left: 8px;
            width: 10px;
            height: 16px;
            border-style: solid;
            border-color: #ffffff;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            opacity: 0;
        }


        input[type="checkbox"]:checked {
            color: #ffffff;
            border-color: #28B463;
            background: #28B463;
        }


        input[type="checkbox"]:before {
            opacity: 1;
        }

    input.seleccion {
    }


    #rregComprobModal .kpi-modal-monto1 {
        text-align: center;
        background-color: #D5D8DC;
    }

    #rregComprobModal .kpi-modal-monto2 {
        text-align: center;
        background-color: #D5D8DC;
    }

    #rregComprobModal .kpi-modal-monto3 {
        text-align: center;
        background-color: #D5D8DC;
    }


    @@media (min-width: 320px) and (max-width: 479.98px) {
    }

    @@media (min-width: 480px) and (max-width: 767.98px) {
    }

    @@media (min-width: 768px) and (max-width: 991.98px) {
    }

    @@media (min-width: 992px) and (max-width: 1199.98px) {
    }

    @@media (min-width: 1200px) {
    }
</style>


@section scripts {
    <script>

        const rNIVEL_INTERFAZ = 10;
        const USUARIO = "@Request.RequestContext.HttpContext.Session["usuario"]";
        const USUARIO_COMPLETO = "@Request.RequestContext.HttpContext.Session["usuario"]" + " - " + "@Request.RequestContext.HttpContext.Session["nombre"]";

        const PORCENTAJE_IGV = 18;
        var rswitchInsertarEditar = 0; // 1: Insertar, 2: Editar

        var rvIdSolicitud = 0;
        var rvIdRendCompte = 0;
        var rvCodTipoComprobante = 0;
        var vIdTipoMod = 0;
        var rvSimboloMoneda = "";
        var rvCodCeCo = 0;
        var rvCeCo = "";
        var rvIdTipo = 0;

        var rvTotalSolicitado1 = 0;
        var rvTotalSolicitado2 = 0;
        var rvTotalSolicitado3 = 0;

        var rvIdConceptoCab1 = 0;
        var rvIdConceptoCab2 = 0;
        var rrvIdConceptoCab3 = 0;

        var rvIdConceptoDet1 = 0;
        var rvIdConceptoDet2 = 0;
        var rvIdConceptoDet3 = 0;

        var rvConceptoDet1 = "";
        var rvConceptoDet2 = "";
        var rvConceptoDet3 = "";

        var rvChecked = false;

        var rdiasArray = [];
        var rentidadEditar = {};
        var rdiasArrayEditar = [];
        var rtipoMonedaArray = [];

        var rsumTotalDetalle = 0;

        var rvCodColSofya = "";
        var rvColaboradorSofya = "";

        var rrvctpava_bnfcol = "";
        var rvcanvar_bnfcol = "";
        var rvcolaborador = "";

        var rvCodSede = "";

        var rsolicitudCabCreada = {};
        var riDetalle1 = 0;
        var riDetalle2 = 0;
        var riDetalle3 = 0;

        var riSecuencia1 = 0;
        var riSecuencia2 = 0;
        var riSecuencia3 = 0;

        var rproveedor = {};
        var rdetalleArray = [];
        var rdetalleArray3 = [];
        var rdetPlaMovdetPlaMov = {};

        var rdetComprobanteArray1 = [];
        var rdetComprobanteArray2 = [];
        var rdetComprobanteArray3 = [];

        var rconceptoDetalleArray1 = [];
        var rconceptoDetalleArray2 = [];
        var rconceptoDetalleArray3 = [];

        var rrconceptoCabeceraArray1 = [];
        var rrconceptoCabeceraArray2 = [];
        var rrconceptoCabeceraArray3 = [];

        var rconceptoCabArray1 = [];
        var rconceptoCabArray2 = [];
        var rconceptoCabArray3 = [];


        var rtabSeleccionado = 1; // 1: Factura y Boleta, 2: Planilla Movilidad, 3: Planilla de Movilidada

        var rTIPO_REGISTRO = "";





        $(document).ready(function () {

            Inicializar();


            function Inicializar() {

                let parametros = { nivelInterfaz: rNIVEL_INTERFAZ };
                let now = new Date();

                rgetTipoDeMoneda();
                rgetPermisosXCeCo(parametros);
                rgetUnidadesMedida();
                rgetTipos();
                rgetPeriodos();
                rgetSede();

                rlimpiarCabecera();

                document.getElementById("ridCbxSede").disabled = false;
                document.getElementById("ridCbxTipoMod").disabled = false;
                document.getElementById("ridtxtaobs").disabled = false;
                document.getElementById("rcbxCeCo1").disabled = false;

                $("#ridtxtcodigo").val("0");
                $("#riddttFechaHora").val(new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().substring(0, 19).toString());


            }


            // Funcionalidades.

            function rlimpiarCabecera() {
                let now = new Date();

                $("#riddttFechaHora").val("");
                $("#ridtxtcodigo").val("");
                $("#ridtxtcodigo").removeClass("ridtxtcodigo-ok");
                $("#ridCbxTipo").val(4);
                $("#ridCbxTipoMod").val(1);
                $("#ridtxtaobs").val("");
            }

            function rvalidacionCabecera() {
                var respuesta = false;

                if (vIdTipoMod == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione un Tipo de Moneda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#ridtxtaobs").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción de la solicitud por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (rvIdTipo == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione el tipo de Solicitud, por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (rvctpava_bnfcol == "" || rvctpava_bnfcol == null || typeof (rvctpava_bnfcol) == "undefined") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Registre el colaborador beneficierio',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }

                else if (rvCodSede == "" || rvCodSede == null || typeof (rvCodSede) == "undefined") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione una Sede',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }

                return respuesta;
            }

            function rvalidacionDetalle() {
                let respuesta = true;
                let isFalseLoop = false;
                let cantConceptpDetArray = 0;

                cantConceptpDetArray = rconceptoDetArray.filter(x => x.isChecked == true).length;

                if (rvIdSolicitud == 0) {

                    Swal.fire({
                        title: 'Debe generar el codigo de solicitud para continuar',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'

                    });

                    return false;
                }
                else if (cantConceptpDetArray == 0 || cantConceptpDetArray == null || typeof (cantConceptpDetArray) == "undefined") {

                    Swal.fire({
                        title: 'Seleccione un concepto, por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    return false;
                }
                else if (rvCodCeCo == 0 || rvCodCeCo == null) {

                    Swal.fire({
                        title: 'Seleccione un centro de costo',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    return false;
                }

                $("#rdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {

                    let valorIngresado = $(obj).val();
                    let valorMaximoS = $(obj).attr("data-valor-maxs");
                    let valorMaximoD = $(obj).attr("data-valor-maxd");

                    let nombreID = obj.id;
                    let idConceptoDet = $(obj).attr("data-idconceptodet");

                    let estaSeleccionado = rconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);


                    if (typeof (estaSeleccionado) != "undefined") {

                        if (valorIngresado.toString().trim() == "" || valorIngresado == null || typeof (valorIngresado) == "undefined" || valorIngresado.toString().trim() == "0") {
                            Swal.fire({
                                title: 'Ingrese el monto por favor',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById(nombreID).focus();
                            isFalseLoop = true;
                            return false;

                        }

                        else if (parseFloat(valorIngresado) < 0) {

                            Swal.fire({
                                title: 'El monto ingresado no debe ser negativo',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById(nombreID).focus();
                            isFalseLoop = true;
                            return false;
                        }

                        else if (vIdTipoMod == 1) {

                            if (parseFloat(valorIngresado) > valorMaximoS) {
                                isFalseLoop = true;
                                return false;

                                $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                valorActual = 0;

                                Swal.fire({
                                    title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showConfirmButton: true,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                });

                                document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            }
                        }
                        else if (vIdTipoMod == 2) {
                            // DOLAR
                            if (parseFloat(valorIngresado) > valorMaximoD) {
                                isFalseLoop = true;
                                return false;

                                $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                valorActual = 0;

                                Swal.fire({
                                    title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showConfirmButton: true,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                });

                                document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            }
                        }
                    }

                });

                // Servicio
                if (rvIdConcepCab == "5") {
                    $("#rdetalleConceptoInsertarEditar input.cobsdet").each(function (i, obj) {
                        let obsIngresado = $(this).val();

                        if (obsIngresado == "" || obsIngresado == null || typeof (obsIngresado) == "undefined") {
                            Swal.fire({
                                title: 'Debe ingresar una descripción para el tipo de Solicitud',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            isFalseLoop = true;
                            return false;
                        }
                    });
                }


                if (isFalseLoop) {
                    respuesta = false;
                }
                else {
                    respuesta = true;
                }

                return respuesta;

            }

            function rsetPeriodo() {

                let fechaFormato = new Date();

                let month = '' + (fechaFormato.getMonth() + 1);
                let year = fechaFormato.getFullYear();

                if (month.length < 2) { month = '0' + month; }

                $("#rcbxPeriodoModal1").val("" + [year, month].join('-'));
                $("#rcbxPeriodoModal2").val("" + [year, month].join('-'));
                $("#rcbxPeriodoModal3").val("" + [year, month].join('-'));

                document.getElementById("rcbxPeriodoModal1").disabled = true;
                document.getElementById("rcbxPeriodoModal2").disabled = true;
                document.getElementById("rcbxPeriodoModal3").disabled = true;
            }


            // Listados.

            function rgetPermisosXCeCo(parametros) {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_PermisosXCeCo',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: parametros,
                    success: function (data) {
                        let primerValorBool = true;

                        $("#rcbxCeCo1").empty();

                        $.each(data.lista, function () {
                            if (primerValorBool) {
                                rvCodCeCo = this.codCeCo;
                                rvCeCo = this.descripcion;

                                primerValorBool = false;
                            }
                            $("#rcbxCeCo1").append($("<option/>").val(this.codCeCo).text(this.descripcion));
                        });

                        $("#rcbxCeCo1").val(rvCodCeCo);
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function rconceptoCabXTipo(pIdTipo, pIdConceptoDet) {

                let firstConceptoCab = 0;
                let firstLoop = true;
                let conceptoArray = [];

                let v_codConceptoCab = 0;
                let v_cantidadDetalle = 0;

                let newCabeceraArray = [];
                let newrdetalleArray = [];


                if (pIdConceptoDet > 0) {

                    $("#cbxConcepCab").empty();

                    v_codConceptoCab = conceptordetalleArray.filter(x => x.idConceptoDet == pIdConceptoDet).idConceptoCab;

                    v_cantidadDetalle = conceptordetalleArray.filter(x => x.idConcepDet != pIdConceptoDet).length;

                    if (v_cantidadDetalle > 0) {
                        $("#cbxConcepCab").val(v_codConceptoCab);
                        newrdetalleArray = conceptordetalleArray.filter(x => x.idConcepDet != pIdConceptoDet);
                    }
                    else {
                        newCabeceraArray = rconceptoCabeceraArray.filter(x => x.idConcepCab != v_codConceptoCab);
                        newrdetalleArray = conceptordetalleArray.filter(x => x.idConcepDet != pIdConceptoDet);
                    }


                    rllenarCbxDetalle(newrdetalleArray);

                    $.each(conceptoArray, function () {
                        if (firstLoop) {
                            firstConceptoCab = this.idConceptoCab;

                            firstLoop = false;
                        }
                        $("#cbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                    });

                    rvIdConcepCab = firstConceptoCab;

                    $("#cbxConcepCab").val(firstConceptoCab);
                    rgetConceptoDet(firstConceptoCab);
                }

            }

            function rgetTipoDeMoneda() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_TiposDeMoneda',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        rtipoMonedaArray = data.lista;

                        $("#ridCbxTipoMod").empty();
                        $("#rcbxMonedaModal1").empty();
                        $("#rcbxMonedaModal2").empty();
                        $("#rcbxMonedaModal3").empty();

                        $.each(data.lista, function () {

                            $("#ridCbxTipoMod").append($("<option/>").val(this.idTipoMod).text(this.descripcion));

                            $("#rcbxMonedaModal1").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                            $("#rcbxMonedaModal2").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                            $("#rcbxMonedaModal3").append($("<option/>").val(this.idTipoMod).text(this.descripcion));

                        });

                        $("#ridCbxTipoMod").val(1);
                        $("#rcbxMonedaModal1").val(1);
                        $("#rcbxMonedaModal2").val(1);
                        $("#rcbxMonedaModal3").val(1);

                        rvSimboloMoneda = rtipoMonedaArray.find(x => x.idTipoMod == 1).simbolo;
                        vIdTipoMod = 1;

                        rgetTipoComprobantes();
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function rgetTipos() {

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_TiposAprobGstsFnzs',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        $("#ridCbxTipo").empty();
                        $.each(data.lista, function () {
                            $("#ridCbxTipo").append($("<option/>").val(this.idTipo).text(this.tipo));
                        });

                        $("#ridCbxTipo").val(4);
                        rvIdTipo = 4;
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function rgetUnidadesMedida() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_UnidadesMedida',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $("#rcbxUM1").empty();
                        $.each(data.lista, function () {
                            $("#rcbxUM1").append($("<option/>").val(this.codum).text(this.um));
                        });
                        $("#rcbxUM1").val("UN");
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function rgetPeriodos() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_Periodos',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $("#rcbxPeriodoModal1").empty();
                        $("#rcbxPeriodoModal2").empty();
                        $("#rcbxPeriodoModal3").empty();

                        $.each(data.lista, function () {
                            $("#rcbxPeriodoModal1").append($("<option/>").val(this.periodo).text(this.periodo));
                            $("#rcbxPeriodoModal2").append($("<option/>").val(this.periodo).text(this.periodo));
                            $("#rcbxPeriodoModal3").append($("<option/>").val(this.periodo).text(this.periodo));
                        });

                        rsetPeriodo();
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function rgetSede() {

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_Sedes',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        $("#ridCbxSede").empty();
                        $.each(data.lista, function () {
                            $("#ridCbxSede").append($("<option/>").val(this.codSede).text(this.sede));
                        });
                        $("#ridCbxSede").val("C");
                        rvCodSede = "C";
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function rresetControles() {
                rlimpiarCabecera();
                rlimpiarDetalle();

                document.getElementById("ridCbxSede").disabled = false;
                document.getElementById("ridCbxTipoMod").disabled = false;
                document.getElementById("ridtxtaobs").disabled = false;
                document.getElementById("rcbxCeCo1").disabled = false;

                $("#ridusuario").val(USUARIO_COMPLETO);

                let now = new Date();
                $("#riddttFechaHora").val(new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().substring(0, 19).toString());

                //document.getElementById("rbtnGuardarCabecera").disabled = false;
                //$("#rbtnGuardarCabecera").removeClass("btn-secondary");
                //$("#rbtnGuardarCabecera").addClass("btn-primary");

                //document.getElementById("btnAgregarDetalle").disabled = true;
                //$("#btnAgregarDetalle").removeClass("btn-warning");
                //$("#btnAgregarDetalle").addClass("btn-secondary");

                $("#rkpi-cantidad").text("0");
                $("#rkpi-total").text("0");

                let tabla = $("#rtblDetalle").DataTable();
                tabla.destroy();
                var tr = "";
                $("#rtblDetalleContent").html(tr);
                $("#rtblDetalle").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                    }
                );
                $("#restado-desc").text("");

                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-aprobado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-pendiente");

                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-aprobado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-pendiente");

            }

            function rajaxConceptoEdit(idSolicitud) {
                return $.ajax({
                    type: "GET",
                    url: "/Finanzas/RG_ConceptoCabEdit",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud }
                });
            }

            function rajaxDetalleEditar(idSolicitud, idConceptoCab) {
                return $.ajax({
                    type: "GET",
                    url: "/Finanzas/RG_DetalleEditar",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab }
                });
            }


            // Eventos Click

            $("#rbtnCancelar").click(function () {
                document.getElementById("ridmCbxCeCo").focus();
            });

            $("#rbtnGuardarCabecera").click(function () {

                if (rvalidacionCabecera()) {

                    let parametro = {
                        'opcion': 1,
                        'idSolicitud': 0,
                        'codigo': 0,
                        'idEmpresa': 1,
                        'idEstado': 10,
                        'idAnulado': 0,
                        'idTipoMod': vIdTipoMod,
                        'observacion': $("#ridtxtaobs").val().trim(),

                        'codCeCo': rvCodCeCo,
                        'idConceptoDet': rvIdConcepDet,
                        'valor': 0,
                        'secuencia': 0,
                        'usuario': USUARIO,
                        'usuarioCompleto': USUARIO_COMPLETO,
                        'nivelInterfaz': 0,
                        'idTipo': vIdTipo,
                        'seleccionadoDet': 0,
                        'idConceptoCab': 0,

                        'cantDias': 0,
                        'montoSolicitado': 0,
                        'observacionDet': '',
                        'ctpava_bnf': rvctpava_bnfcol,
                        'canvar_bnf': rvcanvar_bnfcol,
                        'colaborador': vcolaborador,

                        'codSede': rvCodSede
                    }

                    $.ajax({
                        url: "/finanzas/RG_SetRendicionGastos",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.status.idResponse > 0) {

                                    rvIdSolicitud = resultado.status.idResponse;
                                    rsolicitudCabCreada = resultado.responseEntity;

                                    $("#riddttFechaHora").val(resultado.responseEntity.fechaEmision);
                                    $("#ridtxtcodigo").val(resultado.responseEntity.codigo);
                                    $("#ridtxtcodigo").addClass("ridtxtcodigo-ok");

                                    document.getElementById("ridtxtcodigo").disabled = false;
                                    document.getElementById("ridCbxTipo").disabled = true;
                                    document.getElementById("ridCbxTipoMod").disabled = true;
                                    document.getElementById("ridtxtaobs").disabled = true;
                                    document.getElementById("rbtnBuscarColaborador").disabled = true;

                                    rmensajePrincipal(true, resultado.status.statusResponse);
                                    restadoSolicitud(rvIdSolicitud);

                                    $("#rbtnGuardarCabecera").removeClass("btn-primary");
                                    $("#rbtnGuardarCabecera").addClass("btn-secondary");
                                    document.getElementById("rbtnGuardarCabecera").disabled = true;

                                    //$("#btnAgregarDetalle").removeClass("btn-secondary");
                                    //$("#btnAgregarDetalle").addClass("btn-warning");
                                    //document.getElementById("btnAgregarDetalle").disabled = false;
                                    //document.getElementById("btnAgregarDetalle").focus();
                                }
                                else {
                                    rmensajePrincipal(false, "Ocurrio un problema");
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }

            });

            $("#rbtnGenerarComprobante").click(function () {

                if (rvalidacionCabecera()) {

                    if (rvIdSolicitud > 0) {

                        // Si ya existe una solicitud.
                        rTIPO_REGISTRO = "INSERTAR";

                        $("#rtxtCeCoModal1").val(rvCeCo);
                        $("#rtxtCeCoModal2").val(rvCeCo);
                        $("#rtxtCeCoModal3").val(rvCeCo);

                        $("#rtxtDNIModal2").val(rsolicitudCabCreada.canvar_bnf);
                        $("#rtxtDNIModal3").val(rsolicitudCabCreada.canvar_bnf);
                        $("#rtxtApeNomModal2").val(rsolicitudCabCreada.colaborador);
                        $("#rtxtApeNomModal3").val(rsolicitudCabCreada.colaborador);

                        rconceptoCabXTipo(vIdTipo, 0);
                        $("#rregComprobModal").modal("show");
                    }
                    else {

                        let parametro = {
                            'opcion': 1,
                            'idSolicitud': 0,
                            'codigo': 0,
                            'idEmpresa': 1,
                            'idEstado': 10,
                            'idAnulado': 0,
                            'idTipoMod': vIdTipoMod,
                            'observacion': $("#ridtxtaobs").val().trim(),

                            'codCeCo': rvCodCeCo,
                            'idConceptoDet': 0,
                            'valor': 0,
                            'secuencia': 0,
                            'usuario': USUARIO,
                            'usuarioCompleto': USUARIO_COMPLETO,
                            'nivelInterfaz': 0,
                            'idTipo': vIdTipo,
                            'seleccionadoDet': 0,
                            'idConceptoCab': 0,

                            'cantDias': 0,
                            'montoSolicitado': 0,
                            'observacionDet': '',
                            'ctpava_bnf': rvctpava_bnfcol,
                            'canvar_bnf': rvcanvar_bnfcol,
                            'colaborador': vcolaborador,

                            'codSede': rvCodSede
                        }

                        $.ajax({
                            url: "/finanzas/RG_SetRendicionGastos",
                            type: "post",
                            data: parametro,
                            dataType: "json",
                            success: function (resultado) {

                                if (resultado.isRedirect) {
                                    window.location.href = resultado.redirectUrl;
                                }
                                else {

                                    if (resultado.status.idResponse > 0) {

                                        rvIdSolicitud = resultado.status.idResponse;
                                        rsolicitudCabCreada = resultado.responseEntity;

                                        $("#riddttFechaHora").val(resultado.responseEntity.fechaEmision);
                                        $("#ridtxtcodigo").val(resultado.responseEntity.codigo);
                                        $("#ridtxtcodigo").addClass("ridtxtcodigo-ok");

                                        document.getElementById("ridCbxSede").disabled = true;
                                        document.getElementById("ridtxtcodigo").disabled = true;
                                        document.getElementById("ridCbxTipo").disabled = true;
                                        document.getElementById("ridCbxTipoMod").disabled = true;
                                        document.getElementById("ridtxtaobs").disabled = true;
                                        document.getElementById("rcbxCeCo1").disabled = true;
                                        document.getElementById("rbtnBuscarColaborador").disabled = true;


                                        // MOSTRAR MODAL DE REGISTRO DE COMPROBANTE.

                                        let valorRestante = 0;

                                        rlimpiarControlModal(1);
                                        rlimpiarControlModal(2);
                                        rlimpiarControlModal(3);


                                        // Factura y boleta
                                        $("#rfacturaboleta-tab").removeClass("disabled");
                                        $("#rplanillamovilidad-tab").removeClass("disabled");
                                        $("#rdeclaracionjur-tab").removeClass("disabled");

                                        $("#rregComprobModal .nav-tabs #rfacturaboleta-tab").tab('show');

                                        rTIPO_REGISTRO = "INSERTAR";

                                        $("#rtxtCeCoModal1").val(rvCeCo);
                                        $("#rtxtCeCoModal2").val(rvCeCo);
                                        $("#rtxtCeCoModal3").val(rvCeCo);

                                        $("#rtxtDNIModal2").val(rsolicitudCabCreada.canvar_bnf);
                                        $("#rtxtDNIModal3").val(rsolicitudCabCreada.canvar_bnf);
                                        $("#rtxtApeNomModal2").val(rsolicitudCabCreada.colaborador);
                                        $("#rtxtApeNomModal3").val(rsolicitudCabCreada.colaborador);

                                        //$("#rkpiMontoSeleecionadoModal1").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(valorRestante));
                                        //$("#rkpiMontoSeleecionadoModal2").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(valorRestante));
                                        //$("#rkpiMontoSeleecionadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(valorRestante));

                                        $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
                                        $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                                        $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");

                                        rconceptoCabXTipo(vIdTipo, 0);

                                        $("#rregComprobModal").modal("show");
                                    }
                                    else {
                                        rmensajePrincipal(false, "Ocurrio un problema");
                                    }
                                }
                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                            }
                        });

                    }

                }

            });

            function rvalidarAgregarDetalle() {
                let respuesta = false;
                let codigoGenerado = $("#ridtxtcodigo").val();

                if (vIdTipoMod == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Debe seleccionar el tipo de Moneda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else if (codigoGenerado == "" || codigoGenerado == null || typeof (codigoGenerado) == "undefined") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Debe Generar la cabecera de la Solicitud para continuar',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else {
                    respuesta = true;
                }

                return respuesta;
            }

            $("#rbtnGuardarDetalle").click(function () {

                if (rvalidacionDetalle()) {

                    $("#rdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
                        let idConceptoDet = $(obj).attr("data-idconceptodet");
                        let estaSeleccionado = rconceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);
                        if (typeof (estaSeleccionado) != "undefined") {
                            for (var i = 0; i < rconceptoDetArray.length; i++) {
                                if (rconceptoDetArray[i].isChecked == true && rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                                    rconceptoDetArray[i].montoSolicitado = parseFloat($("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val());
                                    rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                                }
                            }
                        }
                    });

                    rconceptoDetArray = rconceptoDetArray.filter(x => x.isChecked == true);

                    let parametro = {
                        'opcion': 2,
                        'idSolicitud': rvIdSolicitud,
                        'codigo': 0,
                        'idEmpresa': 1,
                        'idEstado': 1,
                        'idAnulado': 0,
                        'idTipoMod': 0,
                        'observacion': '',
                        'codCeCo': rvCodCeCo,
                        'idConceptoDet': rvIdConcepDet,
                        'valor': $("#idmvalor").val(),
                        'secuencia': 0,
                        'usuario': USUARIO,
                        'usuarioCompleto': USUARIO_COMPLETO,
                        'nivelInterfaz': 0,
                        'idTipo': 0,
                        'conceptoDetArray': rconceptoDetArray
                    }

                    $.ajax({
                        url: "/finanzas/RG_SetRendicionGastosDet",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {

                                $('#rmodalSolDetInsertar').modal('hide');

                                if (resultado.status.idResponse > 0) {
                                    rmensajePrincipal(true, "Actualizando Detalle");
                                }
                                else {
                                    rmensajePrincipal(false, "Ocurrio un problema al agregar el motivo");
                                }

                                rgetListaDetalle(rvIdSolicitud);
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }
            });

            $("#rbtnNuevo").click(function () {
                rresetControles();
                document.getElementById("ridtxtcodigo").disabled = true;
                document.getElementById("ridCbxTipoMod").focus();
                $("#ridtxtcodigo").val("0");
            });

            $("#rtblDetalle").on('click', '.solicitudDetalleItem', function () {

                let idSolicitud = $(this).attr("data-idsolicitud");
                let idConceptoCab = $(this).attr("data-idconceptoCab");

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_SolicitudDetalle',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab },
                    success: function (data) {

                        if (data.isRedirect) {
                            window.location.href = data.redirectUrl;
                        }
                        else {

                            let detHTML = "";
                            let checkeHTML = "";

                            $("#rdetalleConceptoVisualizar").empty();

                            $("#ridmdCodigo").val(data.entidad.codigo);
                            $("#ridmdConcepCab").val(data.entidad.conceptoCab);
                            $("#ridmdCeCo").val(data.entidad.ceco);


                            $.each(data.entidad.conceptoDetalle, function () {

                                detHTML += "<div class='row mt-1'>";

                                //if (this.existe == 0) {
                                //    checkeHTML = "<div class='col-1'>"
                                //        + "     <input type='checkbox' class='cseleccion' data-idConceptoDet=" + this.idConceptoDet + " disabled>"
                                //        + "</div>";
                                //}
                                //else {
                                //    checkeHTML = "<div class='col-1'>"
                                //        + "     <input type='checkbox' class='cseleccion' data-idConceptoDet=" + this.idConceptoDet + " readonly checked='checked'>"
                                //        + "</div>";
                                //}

                                detHTML = detHTML + checkeHTML;

                                detHTML = detHTML + "<div class='col-2'>"
                                    + "      <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                                    + "</div>"
                                    + "<div class='col-1'>"
                                    + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + formatoNumero(this.montoSolicitado) + "</p>"
                                    + "</div>"
                                    + "<div class='col-4'>"
                                    + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.observacionDet + "</p>"
                                    + "</div>"
                                    + "<div class='col-4'>"
                                    + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                                    + "</div> ";

                                detHTML = detHTML + "</div>";

                            });

                            $("#rdetalleConceptoVisualizar").html(detHTML);
                            $('#rmodalSolDetVisualizar').modal('show');
                        }
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            });

            $("#rtblDetalle").on('click', '.solicitudRendirItem', function () {
                $("#rregComprobModal").modal("show");
            });

            $("#rtblDetalle").on('click', '.solicitudEditarItem', function () {

                let idSolicitud = $(this).attr("data-idsolicitud");
                let idConceptoCab = $(this).attr("data-idconceptoCab");
                rswitchInsertarEditar = 2; // 2: Editar

                $.when(rajaxConceptoEdit(idSolicitud), rajaxDetalleEditar(idSolicitud, idConceptoCab)).done(function (dataConcepto, dataDetalle) {

                    rentidadEditar = {};

                    if (dataConcepto.isRedirect) {
                        window.location.href = dataConcepto[0].redirectUrl;
                    }
                    else {

                        let detHTML = "";
                        let cbxDiasHTML = "";
                        let cantChecked = 0;
                        let primerLoopCbxDia = true;
                        let cantDiaSeleccionado = 0;

                        rdiasArrayEditar = [];
                        rentidadEditar = dataDetalle[0].entidad;
                        rvCodCeCo = dataDetalle[0].entidad.codCeCo;
                        rvIdSolicitud = dataDetalle[0].entidad.idSolicitud;


                        $("#rdetalleConceptoInsertarEditar").empty();


                        // Concepto
                        $("#ridmCbxConcepCab").empty();
                        $.each(dataConcepto[0].lista, function () {
                            $("#ridmCbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                        });


                        // Detalle
                        $.each(rdiasArray, function () {

                            if (primerLoopCbxDia) {
                                cbxDiasHTML += "<option value='" + this.codDia + "' selected>" + this.dia + "</option>";
                                cantDiaSeleccionado = this.codDia;
                            }
                            else {
                                cbxDiasHTML += "<option value='" + this.codDia + "'>" + this.dia + "</option>";
                            }

                            primerLoopCbxDia = false;
                        });

                        $.each(dataDetalle[0].entidad.conceptoDetalle, function () {

                            detHTML += "<div class='row mt-1'>";

                            if (this.existe == 0) {
                                checkeHTML = "<div class='col-1'>"
                                    + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoSolicitado + " >"
                                    + "</div>";
                                rconceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 0, codCeCo: rvCodCeCo, isChecked: false, cantDias: this.cantDias, montoSolicitado: this.montoSolicitado, observacionDet: this.observacionDet });
                            }
                            else {
                                checkeHTML = "<div class='col-1'>"
                                    + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoSolicitado + "  checked='checked'>"
                                    + "</div>";
                                rconceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 1, codCeCo: rvCodCeCo, isChecked: true, cantDias: this.cantDias, montoSolicitado: this.montoSolicitado, observacionDet: this.observacionDet });

                                rsumTotalDetalle = rsumTotalDetalle + parseFloat(this.montoSolicitado * this.cantDias);
                                cantChecked++;
                            }

                            detHTML = detHTML + checkeHTML;

                            detHTML = detHTML
                                + "<div class='col-2'>"
                                + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                                + "</div>"

                                + "<div class='col-1'>"
                                + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + this.idConceptoDet + "' min='0' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd = '" + this.montoMaximoD + "'  data-idconceptodet='" + this.idConceptoDet + "' value='" + this.montoSolicitado + "'>"
                                + "</div>"

                                + "<div class='col-2'>"
                                + "     <input class='form-control form-control-sm cobsdet' type='text' id='txtObsDet" + this.idConceptoDet + "' data-idconceptodet='" + this.idConceptoDet + "' value='" + this.observacionDet + "'>"
                                + "</div>"

                                + "<div class='col-5'>"
                                + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                                + "</div> "

                                + "<div class='col-1'>"
                                + "   <select class='form-control form-control-sm cdias cbxDias" + this.idConceptoDet + "' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd = '" + this.montoMaximoD + "' data-id=" + this.idConceptoDet + "" + ((this.existe == 0 || idConceptoCab == 5) ? " disabled " : " ") + ">"
                                + cbxDiasHTML
                                + "</select>"

                                + "</div>"
                                + "</div>"


                            rdiasArrayEditar.push({ idConceptoDet: this.idConceptoDet, cantDias: this.cantDias });

                        });

                        if (cantChecked == dataDetalle[0].entidad.conceptoDetalle.length) {
                            $("#rseleccionar-todo").prop("checked", true);
                        }


                        let codigoGenerado = $("#ridtxtcodigo").val();

                        $("#ridmcodigo").val(codigoGenerado);
                        $("#ridmCbxConcepCab").val(rentidadEditar.idConceptoCab);
                        $("#ridmCbxCeCo").val(rentidadEditar.codCeCo);

                        rvCodCeCo = rentidadEditar.codCeCo;

                        $("#sum-total-det").text(formatoNumero(rsumTotalDetalle * cantDiaSeleccionado));
                        $("#rdetalleConceptoInsertarEditar").html(detHTML);
                        $('#rmodalSolDetInsertar').modal('show');
                    }

                });

            });

            $("#rtblDetalle").on('click', '.solicitudEliminarItem', function () {

                let idsolcitud = $(this).attr("data-idsolicitud");
                let idconceptocab = $(this).attr("data-idconceptocab");

                MostrarCarga("Eliminando registro...");

                Swal.fire({
                    title: '¿Esta seguro de eliminar el registro?',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si',
                    cancelButtonText: 'No'
                }).then((result) => {

                    if (result.value) {

                        let parametro = {
                            'opcion': 3,
                            'idSolicitud': idsolcitud,
                            'codigo': 0,
                            'idEmpresa': 1,
                            'idEstado': 1,
                            'idAnulado': 0,
                            'idTipoMod': vIdTipoMod,
                            'observacion': '',

                            'codCeCo': rvCodCeCo,
                            'idConceptoDet': rvIdConcepDet,
                            'valor': 0,
                            'secuencia': 0,
                            'usuario': USUARIO,
                            'usuarioCompleto': USUARIO_COMPLETO,
                            'nivelInterfaz': 0,
                            'idTipo': vIdTipo,
                            'seleccionadoDet': 0,
                            'idConceptoCab': idconceptocab,
                            'observacionDet': "",
                            'ctpava_bnf': "",
                            'canvar_bnf': "",
                            'colaborador': ""
                        }


                        $.ajax({
                            url: "/finanzas/RG_EliminarSolicitud",
                            type: "post",
                            data: parametro,
                            dataType: "json",
                            success: function (resultado) {
                                console.log(resultado);

                                if (resultado.isRedirect) {
                                    window.location.href = resultado.redirectUrl;
                                }
                                else {
                                    if (resultado.status.idResponse > 0) {
                                        rmensajePrincipal(true, "Item Eliminado Correctamente");
                                    }
                                    else {
                                        rmensajePrincipal(false, "Ocurrio un problema");
                                    }
                                }
                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                            }
                        });

                        rgetListaDetalle(rvIdSolicitud);
                    }
                })

            });

            $("#rbtnBuscar").click(function () {

                let fechaIni = $('#idfechaInicio').val();
                let fechaFin = $('#idfechaFin').val();

                if (fechaIni == null ||
                    fechaFin == null ||
                    typeof (fechaIni) == "undefined" ||
                    typeof (fechaFin) == "undefined" ||
                    fechaIni.trim() == "" ||
                    fechaFin.trim() == "") {

                    Swal.fire('Seleccione la fecha, por favor')
                }
                else {

                    var datos =
                    {
                        'fechaInicio': fechaIni,
                        'fechaFin': fechaFin
                    }

                    $.ajax({
                        type: "GET",
                        url: '/finanzas/RG_BuscarHistorial',
                        contentType: "application/json; charset=utf-8",
                        data: datos,
                        dataType: "json",
                        success: function (data) {

                            let tabla = $("#rtblHistorial").DataTable();

                            tabla.destroy();
                            var tr = "";

                            data.lista.forEach((obj) => {

                                tr += "<tr> "
                                    + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.codigo + "</td>"
                                    + " <td> " + obj.observacion + "</td>"
                                    + " <td> " + obj.estado + "</td>"
                                    + " <td> " + obj.tipo + "</td>"
                                    + " <td> " + obj.nivelAprob + "</td>"
                                    + " <td> " + obj.moneda + "</td>"
                                    + " <td> " + formatoNumero(obj.valor) + "</td>"
                                    + "</tr>";
                            });

                            $("#rtblHistorialContent").html(tr);


                            $("#rtblHistorial").DataTable(
                                {
                                    dom: 'Bfrtip',
                                    buttons: [
                                        'copy', 'excel', 'pdf', 'print'
                                    ],
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                                });

                        },
                        failure: function () {
                            console.error('error al cargar los periodos');
                        }
                    });

                }

            });

            $("#rbtnBuscarCodigo").click(function () {
                rlimpiarCabecera();
                rlimpiarDetalle();

                document.getElementById("rbtnBuscarCodigo").disabled  = true;
                $("#rbtnBuscarCodigo").removeClass("btn-primary");
                $("#rbtnBuscarCodigo").addClass("btn-secondary");

                document.getElementById("ridCbxSede").disabled = true;
                document.getElementById("ridCbxTipo").disabled = true;
                document.getElementById("ridCbxTipoMod").disabled = true;
                document.getElementById("ridtxtaobs").disabled = true;
                document.getElementById("rcbxCeCo1").disabled = true;

                rvIdSolicitud = 0;
                $("#ridtxtcodigo").val("");

                //$("#btnAgregarDetalle").removeClass("btn-warning");
                //$("#btnAgregarDetalle").addClass("btn-secondary");
                //document.getElementById("btnAgregarDetalle").disabled  = true;

                let tabla = $("#rtblDetalle").DataTable();
                tabla.destroy();
                var tr = "";
                $("#rtblDetalleContent").html(tr);
                $("#rtblDetalle").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                    }
                );

                $("#restado-desc").text("");

                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-aprobado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-pendiente");

                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-aprobado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-pendiente");

                document.getElementById("ridtxtcodigo").disabled = false;
                document.getElementById("ridtxtcodigo").focus();
            });



            // Otros Eventos

            $('#ridCbxTipoMod').change(function () {
                var $option = $(this).find('option:selected');
                vIdTipoMod = parseInt($option.val());
                rvSimboloMoneda = rtipoMonedaArray.find(x => x.idTipoMod == vIdTipoMod).simbolo;
            });

            $('#ridCbxSede').change(function () {
                var $option = $(this).find('option:selected');
                rvCodSede = parseInt($option.val());
            });

            $('#rcbxCeCo1').change(function () {
                var $option = $(this).find('option:selected');

                rvCodCeCo = parseInt($option.val());
                rCodCeCo = $option.text();
            });

            $('#ridCbxTipo').change(function () {
                var $option = $(this).find('option:selected');
                rvIdTipo = parseInt($option.val());

                if (rvIdTipo == 1 || rvIdTipo == 2) {
                    $("#ridCbxTipoMod").val(1);
                    vIdTipoMod = $("#ridCbxTipoMod").val();
                    rvSimboloMoneda = rtipoMonedaArray.find(x => x.idTipoMod == 1).simbolo;

                    document.getElementById("ridCbxTipoMod").disabled = true;
                }
                else if (rvIdTipo == 3) {
                    document.getElementById("ridCbxTipoMod").disabled = false;
                }
            });

            $('#ridtxtcodigo').keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);

                if (keycode == '13') {

                    let codigo = $("#ridtxtcodigo").val().trim();

                    if (codigo == "") {
                        Swal.fire({
                            title: 'Ingrese un código',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'Cancel',
                            focusConfirm: true
                        }).then(result => {
                            if (result.value) {
                                document.getElementById("ridtxtcodigo").focus();
                            }
                        });
                    }
                    else if (codigo.length < 10 || codigo.length > 10) {
                        Swal.fire({
                            title: 'Ingrese un código',
                            title: 'Ingrese un código valido por favor',
                            icon: 'warning',
                            showConfirmButton: true,
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'Cancel',
                            focusConfirm: true
                        }).then(result => {
                            if (result.value) {
                                document.getElementById("ridtxtcodigo").focus();
                            }
                        });
                    }
                    else {

                        MostrarCarga("Buscando...");


                        $.ajax({
                            url: "/finanzas/RG_SolicitudXCodigo",
                            type: "GET",
                            data: { 'codigo': codigo },
                            dataType: "json",
                            success: function (resultado) {

                                if (resultado.isRedirect) {
                                    window.location.href = resultado.redirectUrl;
                                }
                                else {
                                    if (resultado.entidad.idSolicitud > 0) {

                                        rvIdSolicitud = resultado.entidad.idSolicitud;

                                        $("#ridtxtcodigo").val(resultado.entidad.codigo);
                                        $("#ridtxtcodigo").addClass("ridtxtcodigo-ok");
                                        $("#riddttFechaHora").val(resultado.entidad.fecha);
                                        $("#ridusuario").val(resultado.entidad.usuSolicitante);
                                        $("#ridCbxTipo").val(resultado.entidad.idTipo);
                                        $("#ridCbxTipoMod").val(resultado.entidad.idTipoMod);
                                        $("#ridtxtaobs").val(resultado.entidad.observacion);
                                        $("#restado-desc").text(resultado.entidad.estado);

                                        if (resultado.entidad.idEstado == 10) {
                                            // Pendiente
                                            $("#restado-icon").removeClass("icon-liberado");
                                            $("#restado-icon").removeClass("icon-aprobado");
                                            $("#restado-icon").removeClass("icon-rechazado");
                                            $("#restado-icon").addClass("icon-pendiente");

                                            $("#restado-desc").removeClass("desc-est-liberado");
                                            $("#restado-desc").removeClass("desc-est-aprobado");
                                            $("#restado-desc").removeClass("desc-est-rechazado");
                                            $("#restado-desc").addClass("desc-est-pendiente");

                                        }
                                        else if (resultado.entidad.idEstado == 15) {
                                            // Liberado
                                            $("#restado-icon").removeClass("icon-pendiente");
                                            $("#restado-icon").removeClass("icon-aprobado");
                                            $("#restado-icon").removeClass("icon-rechazado");
                                            $("#restado-icon").addClass("icon-liberado");

                                            $("#restado-desc").removeClass("desc-est-pendiente");
                                            $("#restado-desc").removeClass("desc-est-aprobado");
                                            $("#restado-desc").removeClass("desc-est-rechazado");
                                            $("#restado-desc").addClass("desc-est-liberado");

                                        }
                                        else if (resultado.entidad.idEstado == 20) {
                                            // Aprobado Total
                                            $("#restado-icon").removeClass("icon-pendiente");
                                            $("#restado-icon").removeClass("icon-liberado");
                                            $("#restado-icon").removeClass("icon-rechazado");
                                            $("#restado-icon").addClass("icon-aprobado");

                                            $("#restado-desc").removeClass("desc-est-pendiente");
                                            $("#restado-desc").removeClass("desc-est-liberado");
                                            $("#restado-desc").removeClass("desc-est-rechazado");
                                            $("#restado-desc").addClass("desc-est-aprobado");

                                        }
                                        else if (resultado.entidad.idEstado == 21) {
                                            // Aprobado Parcial
                                            $("#restado-icon").removeClass("icon-pendiente");
                                            $("#restado-icon").removeClass("icon-liberado");
                                            $("#restado-icon").removeClass("icon-rechazado");
                                            $("#restado-icon").addClass("icon-aprobado");

                                            $("#restado-desc").removeClass("desc-est-pendiente");
                                            $("#restado-desc").removeClass("desc-est-liberado");
                                            $("#restado-desc").removeClass("desc-est-rechazado");
                                            $("#restado-desc").addClass("desc-est-aprobado");

                                        }
                                        else if (resultado.entidad.idEstado == 22) {
                                            // Rechazado
                                            $("#restado-icon").removeClass("icon-pendiente");
                                            $("#restado-icon").removeClass("icon-liberado");
                                            $("#restado-icon").removeClass("icon-aprobado");
                                            $("#restado-icon").addClass("icon-rechazado");

                                            $("#restado-desc").removeClass("desc-est-pendiente");
                                            $("#restado-desc").removeClass("desc-est-liberado");
                                            $("#restado-desc").removeClass("desc-est-aprobado");
                                            $("#restado-desc").addClass("desc-est-rechazado");
                                        }

                                        $("#rbtnGuardarCabecera").removeClass("btn-primary");
                                        $("#rbtnGuardarCabecera").addClass("btn-secondary");
                                        document.getElementById("rbtnGuardarCabecera").disabled = true;


                                        //// Si tiene estado mayor a 0, tiene aprobación
                                        //if (resultado.entidad.idEstado > 10) {
                                        //    document.getElementById("btnAgregarDetalle").disabled = true;
                                        //    $("#btnAgregarDetalle").removeClass("btn-warning");
                                        //    $("#btnAgregarDetalle").addClass("btn-secondary");
                                        //}
                                        //else {

                                        //    $("#btnAgregarDetalle").removeClass("btn-secondary");
                                        //    $("#btnAgregarDetalle").addClass("btn-warning");
                                        //    document.getElementById("btnAgregarDetalle").disabled = false;
                                        //    document.getElementById("btnAgregarDetalle").focus();
                                        //}

                                        if (resultado.entidad.listaDetalle.length > 0) {
                                            rgenerarTablaDetalle(resultado.entidad.listaDetalle, resultado.entidad.idEstado);
                                        }
                                        else {
                                            rlimpiarDetalle();

                                            let tabla = $("#rtblDetalle").DataTable();
                                            tabla.destroy();
                                            var tr = "";
                                            $("#rtblDetalleContent").html(tr);
                                            $("#rtblDetalle").DataTable(
                                                {
                                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                                                }
                                            );

                                            $("#rkpi-cantidad").text("0");
                                            $("#rkpi-total").text("0");

                                            rsumTotalDetalle = 0;
                                        }

                                        rmensajePrincipal(true, "Mostrando Solicitud");
                                    }
                                    else {
                                        rmensajePrincipal(false, "Solicitud no encontrada");

                                        rresetControles();

                                        $("#ridtxtcodigo").val("");
                                        document.getElementById("ridCbxSede").disabled = false;
                                        document.getElementById("ridtxtcodigo").disabled = false;
                                        document.getElementById("ridCbxTipo").disabled  = true;
                                        document.getElementById("ridCbxTipoMod").disabled  = true;
                                        document.getElementById("ridtxtaobs").disabled = true;
                                        document.getElementById("rcbxCeCo1").disabled = true;

                                        document.getElementById("rbtnGuardarCabecera").disabled  = true;
                                        $("#rbtnGuardarCabecera").removeClass("btn-primary");
                                        $("#rbtnGuardarCabecera").addClass("btn-secondary");

                                        document.getElementById("rbtnBuscarCodigo").disabled  = true;
                                        $("#rbtnBuscarCodigo").removeClass("btn-primary");
                                        $("#rbtnBuscarCodigo").addClass("btn-secondary");

                                        document.getElementById("ridtxtcodigo").focus();
                                    }
                                }
                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                            }
                        });

                    }

                }
            });

            $('#rmodalSolDetInsertar').on('hidden.bs.modal', function (e) {
                rlimpiarDetalle();
            });

        });








        function rgetConceptoCab() {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_ConceptoCabReembolso',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    let firstConceptoCab = 0;
                    let firstLoop = true;

                    $("#rcbxConcepCabModal1").empty();
                    $("#rcbxConcepCabModal2").empty();
                    $("#rcbxConcepCabModal3").empty();

                    rconceptoCabeceraArray = data.lista;

                    rconceptoCabArray1 = rconceptoCabeceraArray;
                    rconceptoCabArray2 = rconceptoCabeceraArray.filter(x => x.idConceptoCab == 1 || x.idConceptoCab == 3);
                    rconceptoCabArray3 = rconceptoCabeceraArray;


                    $.each(rconceptoCabArray1, function () {
                        if (firstLoop) {
                            firstConceptoCab = this.idConceptoCab;
                            firstLoop = false;
                        }
                        $("#rcbxConcepCabModal1").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                    });
                    rvIdConceptoCab1 = firstConceptoCab;


                    $.each(rconceptoCabArray2, function () {
                        if (firstLoop) {
                            firstConceptoCab = this.idConceptoCab;
                            firstLoop = false;
                        }
                        $("#rcbxConcepCabModal2").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                    });
                    rvIdConceptoCab2 = firstConceptoCab;


                    $.each(rconceptoCabArray3, function () {
                        if (firstLoop) {
                            firstConceptoCab = this.idConceptoCab;
                            firstLoop = false;
                        }
                        $("#rcbxConcepCabModal3").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                    });
                    rvIdConceptoCab3 = firstConceptoCab;

                    $("#rcbxConcepCabModal1").val(rvIdConceptoCab1);
                    $("#rcbxConcepCabModal2").val(rvIdConceptoCab2);
                    $("#rcbxConcepCabModal3").val(rvIdConceptoCab3);

                    rgetConceptoDet(parseInt($("#rcbxTipoCpbteCompModal1").val()), rvIdConceptoCab1);
                    rgetConceptoDet(parseInt($("#rcbxTipoCpbteCompModal2").val()), rvIdConceptoCab2);
                    rgetConceptoDet(parseInt($("#rcbxTipoCpbteCompModal3").val()), rvIdConceptoCab3);

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        $('#rdetalleConceptoInsertarEditar').on('click', '.cseleccion', function (e) {

            let inputCheck = $(this);
            let idConceptoDet = $(this).attr("data-id");
            let valorPre = "";
            let valor = 0;

            if (inputCheck.is(":checked")) {


                for (var i = 0; i < rconceptoDetArray.length; i++) {
                    if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {

                        rconceptoDetArray[i].seleccionadoDet = 1;
                        rconceptoDetArray[i].isChecked = true;

                        // Servicio y Otros
                        if (rconceptoDetArray[i].idConceptoDet == 10) {
                            $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                        }
                        else {
                            $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                        }

                        valorPre = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                        if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                            valor = 0;
                        }
                        else {
                            valor = parseFloat(valorPre);
                        }

                        rsumTotalDetalle = rsumTotalDetalle + (valor * parseFloat(rconceptoDetArray[i].cantDias));
                    }
                }

            } else {
                for (var i = 0; i < rconceptoDetArray.length; i++) {
                    if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        rconceptoDetArray[i].seleccionadoDet = 0;
                        rconceptoDetArray[i].isChecked = false;
                        rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();

                        valorPre = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                        if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                            valor = 0;
                        }
                        else {
                            valor = parseFloat(valorPre);
                        }

                        rsumTotalDetalle = rsumTotalDetalle - valor * parseFloat(rconceptoDetArray[i].cantDias);
                    }
                }
                $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
            }

            if (rconceptoDetArray.filter(x => x.isChecked == true).length == rconceptoDetArray.length) {
                $("#rseleccionar-todo").prop("checked", true);
            }
            else {
                $("#rseleccionar-todo").prop("checked", false);
            }

            $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));
        });

        $('#rmodalSolDetInsertar').on('click', '#rseleccionar-todo', function (e) {
            let idConceptoDet = 0;
            var inputCheck = $(this);
            rsumTotalDetalle = 0;

            if (inputCheck.is(":checked")) {

                let valorXConceptDet = 0;

                $("#rdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                    let valor = $(this).attr("data-valor");
                    idConceptoDet = $(this).attr("data-id");
                    valorXConceptDet = 0;

                    if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        rconceptoDetArray[i].seleccionadoDet = 1;
                        rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                    }

                    rconceptoDetArray[i].isChecked = true;

                    $(this).prop("checked", true);
                    $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);

                    valorXConceptDet = parseFloat(valor) * rconceptoDetArray[i].cantDias;

                    rsumTotalDetalle = rsumTotalDetalle + valorXConceptDet;
                });

            } else {
                $("#rdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                    idConceptoDet = $(this).attr("data-id");

                    if (rconceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        rconceptoDetArray[i].seleccionadoDet = 0;
                        rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                    }

                    rconceptoDetArray[i].isChecked = false;
                    $(this).prop("checked", false);
                    $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);

                    rsumTotalDetalle = 0;
                });
            }

            $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));
        });

        $('#rcbxConcepCabModal1').change(function () {
            var $option = $(this).find('option:selected');
            rvIdConceptoCab1 = $option.val().toString();

            if (rvIdConceptoCab1 != 0 && rvIdConceptoCab1 != null && typeof (rvIdConceptoCab1) != "undefined") {
                rconceptoDetalleArray1 = [];

                rgetConceptoDet($("#rcbxTipoCpbteCompModal1").val(), rvIdConceptoCab1);
            }
        });

        $('#rcbxConcepCabModal2').change(function () {
            var $option = $(this).find('option:selected');
            rvIdConceptoCab2 = $option.val().toString();

            if (rvIdConceptoCab2 != 0 && rvIdConceptoCab2 != null && typeof (rvIdConceptoCab2) != "undefined") {
                rconceptoDetalleArray2 = [];

                rgetConceptoDet($("#rcbxTipoCpbteCompModal2").val(), rvIdConceptoCab2);
            }
        });

        $('#rcbxConcepCabModal3').change(function () {

            var $option = $(this).find('option:selected');
            rvIdConceptoCab3 = $option.val().toString();

            if (rvIdConceptoCab3 != 0 && rvIdConceptoCab3 != null && typeof (rvIdConceptoCab3) != "undefined") {
                rconceptoDetalleArray3 = [];

                rgetConceptoDet($("#rcbxTipoCpbteCompModal3").val(), rvIdConceptoCab3);
            }
        });

        $('#rrcbxConcepDetModal1').change(function () {
            var $option = $(this).find('option:selected');
            rvIdConceptoDet1 = $option.val().toString();

            ractualizarTotalSolicitado(parseInt($("#rcbxTipoCpbteCompModal1").val()), rvIdConceptoDet1);
            rseleccionarConsideracion(parseInt($("#rcbxTipoCpbteCompModal1").val()), rvIdConceptoDet1);
        });

        $('#rrcbxConcepDetModal2').change(function () {
            var $option = $(this).find('option:selected');
            rvIdConceptoDet2 = $option.val().toString();

            ractualizarTotalSolicitado(parseInt($("#rcbxTipoCpbteCompModal2").val()), rvIdConceptoDet2);
            rseleccionarConsideracion(parseInt($("#rcbxTipoCpbteCompModal2").val()), rvIdConceptoDet2);
        });

        $('#rcbxConcepDetModal3').change(function () {
            var $option = $(this).find('option:selected');
            rvIdConceptoDet3 = $option.val().toString();

            ractualizarTotalSolicitado(parseInt($("#rcbxTipoCpbteCompModal3").val()), rvIdConceptoDet3);
            rseleccionarConsideracion(parseInt($("#rcbxTipoCpbteCompModal3").val()), rvIdConceptoDet3);
        });


        function rgetConceptoDet(pTipoCpte, idConceptoCab) {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_ConceptoDetalle',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idConceptoCab: idConceptoCab },
                success: function (data) {

                    if (pTipoCpte == 1 || pTipoCpte == 2) {
                        // Factura y boleta
                        rconceptoDetalleArray1 = data.lista;
                        rllenarCbxDetalle(pTipoCpte, data.lista);
                    }
                    else if (pTipoCpte == 3) {
                        // Planilla de Movilidad
                        rconceptoDetalleArray2 = data.lista.filter(x => x.idConceptoDet == 4 || x.idConceptoDet == 6 || x.idConceptoDet == 8);
                        rllenarCbxDetalle(pTipoCpte, rconceptoDetalleArray2);

                    }
                    else if (pTipoCpte == 4) {
                        // Declaracion Jurada.
                        rconceptoDetalleArray3 = data.lista;
                        rllenarCbxDetalle(pTipoCpte, data.lista);
                    }

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function rllenarCbxDetalle(pTipoCpte, lista) {

            let firstIdConceptoDet = 0;
            let firstConceptoDet = 0;

            let primerValorBool = true;
            let existeConceptoDetalle = false;



            if (pTipoCpte == 1 || pTipoCpte == 2) {

                // Factura y Boleta

                $("#rrcbxConcepDetModal1").empty();

                $.each(lista, function () {
                    existeConceptoDetalle = false;

                    if (primerValorBool) {
                        firstIdConceptoDet = this.idConceptoDet;
                        firstConceptoDet = this.conceptoDet;

                        primerValorBool = false;
                    }

                    //for (var i = 0; i < rdetComprobanteArray1.length; i++) {
                    //    if (rdetComprobanteArray1[i].idConcepDet == this.idConceptoDet) {
                    //        existeConceptoDetalle = true;
                    //    }
                    //}

                    //if (!existeConceptoDetalle) {
                        $("#rrcbxConcepDetModal1").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));
                    //}
                });

                $("#rrcbxConcepDetModal1").val(firstIdConceptoDet);

                rvIdConceptoDet1 = firstIdConceptoDet;
                rvConceptoDet1 = firstConceptoDet;

                ractualizarTotalSolicitado(pTipoCpte, firstIdConceptoDet);
                rseleccionarConsideracion(pTipoCpte, firstIdConceptoDet);

            }
            else if (pTipoCpte == 3) {

                // Planilla de Movilidad
                $("#rrcbxConcepDetModal2").empty();

                $.each(lista, function () {
                    existeConceptoDetalle = false;

                    if (primerValorBool) {
                        firstIdConceptoDet = this.idConceptoDet;
                        firstConceptoDet = this.conceptoDet;

                        primerValorBool = false;
                    }

                    for (var i = 0; i < rdetComprobanteArray2.length; i++) {
                        if (rdetComprobanteArray2[i].idConcepDet == this.idConceptoDet) {
                            existeConceptoDetalle = true;
                        }
                    }

                    if (!existeConceptoDetalle) {
                        $("#rrcbxConcepDetModal2").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));
                    }
                });

                $("#rrcbxConcepDetModal2").val(firstIdConceptoDet);

                rvIdConceptoDet2 = firstIdConceptoDet;
                rvConceptoDet2 = firstConceptoDet;

                ractualizarTotalSolicitado(pTipoCpte, rvIdConceptoDet2);
                rseleccionarConsideracion(pTipoCpte, rvIdConceptoDet2);


            }
            else if (pTipoCpte == 4) {

                // Declaracion Jurada.
                $("#rcbxConcepDetModal3").empty();

                $.each(lista, function () {
                    existeConceptoDetalle = false;

                    if (primerValorBool) {
                        firstIdConceptoDet = this.idConceptoDet;
                        firstConceptoDet = this.conceptoDet;

                        primerValorBool = false;
                    }

                    for (var i = 0; i < rdetComprobanteArray3.length; i++) {
                        if (rdetComprobanteArray3[i].idConcepDet == this.idConceptoDet) {
                            existeConceptoDetalle = true;
                        }
                    }

                    if (!existeConceptoDetalle) {
                        $("#rcbxConcepDetModal3").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));
                    }
                });

                $("#rcbxConcepDetModal3").val(firstIdConceptoDet);

                rvIdConceptoDet3 = firstIdConceptoDet;
                rvConceptoDet3 = firstConceptoDet;

                ractualizarTotalSolicitado(pTipoCpte, rvIdConceptoDet3);
                rseleccionarConsideracion(pTipoCpte, rvIdConceptoDet3);
            }


        }

        function ractualizarTotalSolicitado(pTipoCpte, pIdConceptoDet) {

            if (pTipoCpte == 1 || pTipoCpte == 2) {
                // Factura y Boleta
                if (vIdTipoMod == 1) {
                    rvTotalSolicitado1 = rconceptoDetalleArray1.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoS;
                }
                else if (vIdTipoMod == 2) {
                    rvTotalSolicitado1 = rconceptoDetalleArray1.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoD;
                }
                $("#ridMontoSolicitadoModal1").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado1));
            }
            else if (pTipoCpte == 3) {
                // Planilla de Movilidad
                if (vIdTipoMod == 1) {
                    rvTotalSolicitado2 = rconceptoDetalleArray2.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoS;
                }
                else if (vIdTipoMod == 2) {
                    rvTotalSolicitado2 = rconceptoDetalleArray2.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoD;
                }
                $("#ridMontoSolicitadoModal2").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado2));
            }
            else if (pTipoCpte == 4) {
                // Planilla de Movilidad
                if (vIdTipoMod == 1) {
                    rvTotalSolicitado3 = rconceptoDetalleArray3.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoS;
                }
                else if (vIdTipoMod == 2) {
                    rvTotalSolicitado3 = rconceptoDetalleArray3.find(x => x.idConceptoDet == parseInt(pIdConceptoDet)).montoMaximoD;
                }
                $("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3));
            }

        }

        function rseleccionarConsideracion(pTipoCpte, pIdConceptoDet) {

            let consideracion = "";

            if (pTipoCpte == 1 || pTipoCpte == 2) {
                // Factura y Boleta
                consideracion = rconceptoDetalleArray1.find(x => x.idConceptoDet == pIdConceptoDet).consideracion;
                $("#rtxtConsideracionModal1").val(consideracion);
            }
            else if (pTipoCpte == 3) {
                // Planilla de Movilidad
                consideracion = rconceptoDetalleArray2.find(x => x.idConceptoDet == pIdConceptoDet).consideracion;
                $("#rtxtConsideracionModal2").val(consideracion);
            }
            else if (pTipoCpte == 4) {
                // Declaracion Jurada
                consideracion = rconceptoDetalleArray3.find(x => x.idConceptoDet == pIdConceptoDet).consideracion;
                $("#rtxtConsideracionModal3").val(consideracion);
            }

        }

        $('#rcbxConcepDet').change(function () {

            //let firstIdConceptoDet = 0;
            //let firstConceptoDet = 0;

            //let primerValorBool = true;
            //let existeConceptoDetalle = false;
            //// yyyy
            //$("#rcbxConcepDet").empty();


            //$.each(conceptordetalleArray, function () {

            //    let existe = rdetComprobanteArray1.find(x => x.idConcepDet == this.idConceptoDet);

            //    if (existe == -1 || typeof (existe) == "undefined" || existe == null) {

            //        existeConceptoDetalle = false;

            //        if (primerValorBool) {
            //            firstIdConceptoDet = this.idConceptoDet;
            //            firstConceptoDet = this.conceptoDet;

            //            primerValorBool = false;
            //        }

            //        for (var i = 0; i < rdetComprobanteArray1.length; i++) {
            //            if (rdetComprobanteArray1[i].idConcepDet == this.idConceptoDet) {
            //                existeConceptoDetalle = true;
            //            }
            //        }

            //        if (!existeConceptoDetalle) {
            //            $("#rcbxConcepDet").append($("<option/>").val(this.idConceptoDet).text(this.conceptoDet));
            //        }
            //    }
            //});


            //$("#rcbxConcepDet").val(firstIdConceptoDet);

            //rvIdConcepDet = firstIdConceptoDet;
            //rvConcepDet = firstConceptoDet;



            let $option = $(this).find('option:selected');
            rvIdConcepDet = $option.val();
            rvConcepDet = $option.text();

            //ractualizarTotalSolicitado(rvIdConcepDet, $("#cbxCantDias").val());
            ractualizarTotalSolicitado(rvIdConcepDet, 1);
            rseleccionarConsideracion(rvIdConcepDet);

        });

        $('#rdetalleConceptoInsertarEditar').on('change', '.cdias', function (e) {

            rsumTotalDetalle = 0;

            $("#rdetalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {

                let valorPre = "";
                let valorActual = 0;

                let idConceptoDetCheckbox = $(obj).attr("data-id");
                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                if (rconceptoDetArray[i].isChecked == true) {

                    rconceptoDetArray[i].seleccionadoDet = 1;
                    rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    rconceptoDetArray[i].montoSolicitado = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();


                    valorPre = $("#rdetalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valorActual = 0;
                    }
                    else {
                        valorActual = parseFloat(valorPre);
                    }

                    // SOLES
                    if (vIdTipoMod == 1) {

                        if (valorActual > parseFloat(valorMaximoS)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        rsumTotalDetalle = rsumTotalDetalle + (valorActual * parseFloat(rconceptoDetArray[i].cantDias));
                    }
                    else if (vIdTipoMod == 2) {
                        // DOLAR

                        if (valorActual > parseFloat(valorMaximoD)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        rsumTotalDetalle = rsumTotalDetalle + (valorActual * parseFloat(rconceptoDetArray[i].cantDias));
                    }
                }
                else {

                    rconceptoDetArray[i].seleccionadoDet = 0;
                    rconceptoDetArray[i].cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    rconceptoDetArray[i].observacionDet = $("#rdetalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();
                }
            });

            $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));

        });

        $('#rmodalSolDetInsertar').on('shown.bs.modal', function (e) {

            let idConceptoDet = 0;
            let primerCantDias = 0;
            let primerLoopCbxDia = true;

            if (rswitchInsertarEditar == 2) {
                $("#rdetalleConceptoInsertarEditar .cdias").each(function (i, obj) {

                    idConceptoDet = $(this).attr("data-id");
                    $("#ridmCbxConcepCab").prop("disabled", true);

                    $.each(rdiasArray, function () {
                        if (primerLoopCbxDia) {
                            primerCantDias = this.codDia;
                        }
                        primerLoopCbxDia = false;
                    });

                    let dias = rdiasArrayEditar.find(x => x.idConceptoDet == idConceptoDet).cantDias;

                    if (dias > 0) {
                        $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(dias);
                    }
                    else {
                        $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(primerCantDias);
                    }
                });
            }

        });

        $('#ridBusquedaColaborador').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            let filtro = $("#ridBusquedaColaborador").val();

            if (keycode == '13') {

                if (filtro == "") {
                    Swal.fire({
                        title: 'Ingrese el filtro para la busqueda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            document.getElementById("ridBusquedaColaborador").focus();
                        }
                    });
                }
                else {

                    $.ajax({
                        url: "/finanzas/RG_ColaboradorSofya",
                        type: "GET",
                        data: { 'filtro': filtro },
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                let tabla = $("#rtblColaborador").DataTable();

                                tabla.destroy();
                                var tr = "";

                                resultado.lista.forEach((obj) => {

                                    tr += "<tr> "
                                        + " <td> " + obj.codsofya + "</td>"
                                        + " <td> " + obj.colaborador + "</td>"
                                        + " <td class='text-center'>"
                                        + "     <button data-ctpava='" + obj.ctpava + "' data-canvar='" + obj.canvar + "' data-codsofya='" + obj.codsofya + "' data-colaborador='" + obj.colaborador + "' data-toggle='collapse' class='btn btn-sm btn-success cseleccionar ml-1'><i class='fas fa-check'></i></button>"
                                        + "</td>"
                                        + "</tr>";
                                });

                                $("#rtblColaboradorContent").html(tr);

                                $("#rtblColaborador").DataTable(
                                    {
                                        'language': { 'url': '/libs/datatables/spanish.json' },
                                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                                    });
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }

            }
        });

        $('#rtblColaborador').on('click', '.cseleccionar', function (e) {
            rvCodColSofya = $(this).attr("data-codsofya");
            rvColaboradorSofya = $(this).attr("data-colaborador");
            rvctpava_bnfcol = $(this).attr("data-ctpava");
            rvcanvar_bnfcol = $(this).attr("data-canvar");

            rvcolaborador = $.trim(rvColaboradorSofya);
            $("#rtxtcolaborador").val($.trim(rvColaboradorSofya));

            $("#rmodalColaboradorSofya").modal("hide");
        });

        $("#rbtnBuscarColaborador").click(function () {
            $("#rmodalColaboradorSofya").modal("show");
        });



        // Funciones Generales

        function formatoNumero(x) {
            x = x.toFixed(2);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function rmensajePrincipal(estado, mensaje) {
            if (estado == true) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: mensaje
                });

            }
            else if (estado == false) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'error',
                    title: mensaje
                });

            }
        }

        function rgetConceptoDet_old(idConceptoCab) {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_ConceptoDetalleInsertar',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idConceptoCab: idConceptoCab },
                success: function (data) {

                    $("#rdetalleConceptoInsertarEditar").empty();

                    let detHTML = "";
                    let cbxDiasHTML = "";

                    let primerLoopCbxDia = true;
                    let cantDiaSeleccionado = 0;

                    $.each(rdiasArray, function () {

                        if (primerLoopCbxDia) {
                            cbxDiasHTML += "<option value='" + this.codDia + "' selected>" + this.dia + "</option>";
                            cantDiaSeleccionado = this.codDia;
                        }
                        else {
                            cbxDiasHTML += "<option value='" + this.codDia + "'>" + this.dia + "</option>";
                        }

                        primerLoopCbxDia = false;
                    });

                    $.each(data.lista, function () {

                        detHTML += "<div class='row mt-1'>"
                            + "<div class='col-1'>"
                            + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoMaximo + ">"
                            + "</div>"
                            + "<div class='col-2'>"
                            + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                            + "</div>"
                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + this.idConceptoDet + "' min='0' max='" + this.montoMaximo + "' data-idconceptodet='" + this.idConceptoDet + "' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd='" + this.montoMaximoD + "'>"
                            + "</div>"

                            + "<div class='col-2'>"
                            + "     <input class='form-control form-control-sm cobsdet' type='text' id='txtObsDet" + this.idConceptoDet + "' data-idconceptodet='" + this.idConceptoDet + "'>"
                            + "</div>"

                            + "<div class='col-5'>"
                            + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                            + "</div>"
                            + "<div class='col-1'>"
                            + "   <select class='form-control form-control-sm cdias cbxDias" + this.idConceptoDet + "' data-id=" + this.idConceptoDet + " data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd='" + this.montoMaximoD + "' disabled>"
                            + cbxDiasHTML
                            + "</select>"
                            + "</div>"
                            + "</div>";

                        //rsumTotalDetalle = rsumTotalDetalle + parseFloat(this.montoMaximo);
                        rsumTotalDetalle = 0;
                        rconceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 1, codCeCo: rvCodCeCo, isChecked: false, cantDias: cantDiaSeleccionado, montoSolicitado: 0, observacionDet: this.observacionDet });
                    });

                    $("#rseleccionar-todo").prop("checked", false);
                    $("#rdetalleConceptoInsertarEditar").html(detHTML);
                    $("#sum-total-det").text(formatoNumero(rsumTotalDetalle * cantDiaSeleccionado));

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        $("#rdetalleConceptoInsertarEditar").on("keyup", ".cmontosolicitar", function () {

            rsumTotalDetalle = 0;

            $("#rdetalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
                idConceptoDet = $(obj).attr("data-idconceptodet");

                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                if (rconceptoDetArray[i].idConceptoDet == idConceptoDet && rconceptoDetArray[i].isChecked == true) {
                    let valorActual = 0;
                    let cantDias = $("#rdetalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();


                    if ($(obj).val() == null || typeof ($(obj).val()) == "undefined" || $(obj).val().trim() == "") {
                        valorActual = 0;
                    }
                    else {
                        valorActual = parseFloat($(obj).val());
                    }


                    // SOLES
                    if (vIdTipoMod == 1) {
                        if (valorActual > parseFloat(valorMaximoS)) {

                            $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                        }

                    }
                    else if (vIdTipoMod == 2) {
                        // DOLAR

                        if (valorActual > parseFloat(valorMaximoD)) {

                            $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                        }
                    }

                    rsumTotalDetalle = rsumTotalDetalle + (valorActual * parseFloat(cantDias));
                }
            });

            $("#sum-total-det").text(formatoNumero(rsumTotalDetalle));
        });

        $("#rtabRendicionGastos").on("click", ".rctabRegComp", function () {
            let index = $(this).attr("data-id");
            rtabSeleccionado = parseInt(index);
        });

        $('.rcfecha').change(function () {

            var inputDate = new Date(this.value);
            var today = new Date();

            if (inputDate > today) {

                let dd = String(today.getDate()).padStart(2, '0');
                let mm = String(today.getMonth() + 1).padStart(2, '0');
                let yyyy = today.getFullYear();

                today = yyyy + '-' + mm + '-' + dd;

                $(this).val(today);

                Swal.fire({
                    title: 'La fecha no puede ser mayor a la fecha Actual',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

        });

        $("#rtblDetalleContent").on('click', '.seleccion', function () {

            let idsolicitud = $(this).attr("data-idsolicitud");
            let secuencia = $(this).attr("data-secuencia");
            let valor = $(this).attr("data-valor");
            let total = $(this).attr("data-total");
            let codceco = $(this).attr("data-codceco");
            let ceco = $(this).attr("data-ceco");
            let totalRestante = $(this).attr("data-restante");

            if ($(this).prop("checked")) {
                rdetalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), total: parseFloat(total), codceco: codceco, ceco: ceco, totalrestante: parseFloat(totalRestante)});

            } else {

                for (var i = 0; i < rdetalleArray.length; i++) {
                    if (rdetalleArray[i].idsolicitud == idsolicitud && rdetalleArray[i].secuencia == secuencia) {
                        rdetalleArray.splice(i, 1);
                    }
                }
            }
        });


        function restadoSolicitud(pIdSolicitud) {
            $.ajax({
                url: "/finanzas/RG_restadoSolicitud",
                type: "GET",
                data: { idSolicitud: pIdSolicitud },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        $("#restado-desc").text(resultado.entidad.estado);
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                }
            });
        }

        function rgetTipoComprobantes() {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_TipoComprobantes',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    let primerValorBool = true;

                    $("#rcbxTipoCpbteCompModal1").empty();
                    $("#rcbxTipoCpbteCompModal2").empty();
                    $("#rcbxTipoCpbteCompModal3").empty();

                    $.each(data.lista, function () {
                        if (primerValorBool) {
                            rvCodTipoComprobante = this.idTipoComp;
                        }

                        if (this.idTipoComp == 1 || this.idTipoComp == 2) {
                            $("#rcbxTipoCpbteCompModal1").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                        }
                        else if (this.idTipoComp == 3) {
                            $("#rcbxTipoCpbteCompModal2").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                        }
                        else if (this.idTipoComp == 4) {
                            $("#rcbxTipoCpbteCompModal3").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                        }

                        primerValorBool = false;
                    });

                    rcambioTipoCpte(rvCodTipoComprobante);

                    $("#rcbxTipoCpbteCompModal1").val(rvCodTipoComprobante);
                    $("#rcbxTipoCpbteCompModal2").val(3); // Planilla de Movilidad
                    $("#rcbxTipoCpbteCompModal3").val(4); // Declaracion Jurada

                    document.getElementById("rcbxTipoCpbteCompModal2").disabled = true;
                    document.getElementById("rcbxTipoCpbteCompModal3").disabled = true;

                    rgetConceptoCab();

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }

        function rgetTipoMoneda() {

            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_TiposDeMoneda',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#rcbxMonedaModal1").empty();
                    $("#rcbxMonedaModal2").empty();
                    $("#rcbxMonedaModal3").empty();

                    $.each(data.lista, function () {
                        $("#rcbxMonedaModal1").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    });
                    $.each(data.lista, function () {
                        $("#rcbxMonedaModal2").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    });
                    $.each(data.lista, function () {
                        $("#rcbxMonedaModal3").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                    });

                    $("#rcbxMonedaModal1").val(0);
                    $("#rcbxMonedaModal2").val(0);
                    $("#rcbxMonedaModal3").val(0);
                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }


        $("#rbtnRegistrarcomprobante").click(function () {

            if (rdetalleArray.length > 0) {
                let valorRestante = 0;

                rlimpiarControlModal(1);
                rlimpiarControlModal(2);
                rlimpiarControlModal(3);


                // FACTURA Y BOLETA
                $("#rfacturaboleta-tab").removeClass("disabled");
                $("#rplanillamovilidad-tab").removeClass("disabled");
                $("#rdeclaracionjur-tab").removeClass("disabled");

                $("#rregComprobModal .nav-tabs #rfacturaboleta-tab").tab('show');


                rTIPO_REGISTRO = "INSERTAR";

                for (var i = 0; i < rdetalleArray.length; i++) {
                    valorRestante = valorRestante + rdetalleArray[i].totalrestante;

                    rsolicitudCabCreada.codceco = rdetalleArray[i].codceco;
                    rsolicitudCabCreada.ceco = rdetalleArray[i].ceco;
                }

                $("#rtxtCeCoModal1").val(rsolicitudCabCreada.ceco);
                $("#rtxtCeCoModal2").val(rsolicitudCabCreada.ceco);
                $("#rtxtCeCoModal3").val(rsolicitudCabCreada.ceco);

                $("#rtxtDNIModal2").val(rsolicitudCabCreada.canvar_bnf);
                $("#rtxtDNIModal3").val(rsolicitudCabCreada.canvar_bnf);
                $("#rtxtApeNomModal2").val(rsolicitudCabCreada.colaborador);
                $("#rtxtApeNomModal3").val(rsolicitudCabCreada.colaborador);

                //$("#rkpiMontoSeleecionadoModal1").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(valorRestante));
                //$("#rkpiMontoSeleecionadoModal2").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(valorRestante));
                //$("#rkpiMontoSeleecionadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(valorRestante));

                $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
                $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");

                $("#rregComprobModal").modal("show");

            }
            else {
                Swal.fire({
                    title: 'Seleccione el detalle de la Solicitud para le registro de Comprobante',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });

            }
        });

        $('#rtxtDNIModal2').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            if (keycode == '13') {
                let dni = $("#rtxtDNIModal2").val().trim();
                rbusquedaXDNI(dni, rtabSeleccionado)
            }
        });

        $('#rtxtDNIModal3').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            if (keycode == '13') {
                let dni = $("#rtxtDNIModal3").val().trim();
                rbusquedaXDNI(dni, rtabSeleccionado)
            }
        });

        $('#rmodalSolDetInsertar').on('hidden.bs.modal', function (e) {
            $("#rtxtRUCModal").val("");
            $("#rtxtRSModal").val("");
            $("#rtxtDireccionModal").val("");
        });

        $("#rbtnAgregarMotivo1").click(function () {

            if (rvalidacionDetCmpbte(rtabSeleccionado)) {

                //let cantidad = parseFloat($("#txtCantidad1").val());
                let cantidad = 1;
                let valorUnitarioTotal = parseFloat($("#txtValorUnitarioTotal1").val());
                let valorUnitario = 0;

                if ($("#rcbxTipoCpbteCompModal1").val().trim() == "1") {
                    valorUnitario = (valorUnitarioTotal) / ((PORCENTAJE_IGV / 100) + 1);

                }
                else if ($("#rcbxTipoCpbteCompModal1").val().trim() == "2") {
                    valorUnitario = (valorUnitarioTotal);
                }

                let total = (cantidad * valorUnitarioTotal);

                const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                    return acc += item.totalrestante
                }, 0);

                const sumAgregadosDet = rdetComprobanteArray1.reduce((acc, item) => {
                    return acc += item.total;
                }, 0);


                riDetalle1++;

                var d = new Date(), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();
                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                rdetComprobanteArray1.push({
                    idSolicitud: rvIdSolicitud,
                    idConcepCab: rvIdConceptoCab1,
                    idConcepDet: rvIdConceptoDet1,
                    conceptoDet: rvConceptoDet1,
                    iDetalle: riDetalle1,
                    fecha: [year, month, day].join('/'),
                    fechaBD: [year, month, day].join(''),
                    detalle1: ($("#rcbxTipoCpbteCompModal1").val().trim() == "1" ? $("#rtxtDescripcion1").val() : $("#rtxtObsCompModal1").val()),
                    detalle2: "",
                    codum: $("#rcbxUM1").val(),
                    valorunit: valorUnitario,
                    cantidad: cantidad,
                    total: total,
                    seccion: 1,
                    codCeCo: rvCodCeCo,
                    idTipo: vIdTipo
                });


                let tabla = $("#rtblFacturaBoleta").DataTable();

                tabla.destroy();
                var tr = "";

                rdetComprobanteArray1.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> " + obj.codum + "</td>"
                        + " <td> " + obj.conceptoDet + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        //+ " <td> " + obj.cantidad + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td> " + formatoNumero(obj.total) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#rtblFacturaBoletaContent").html(tr);

                $("#rtblFacturaBoleta").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    });


                const importeTotal = rdetComprobanteArray1.reduce((acc, item) => {
                    return acc += (item.valorunit);
                }, 0);


                if ($("#rcbxTipoCpbteCompModal1").val().trim() == "1") {
                    // FACTURA
                    $("#idimportetotal1").val(formatoNumero(importeTotal));
                    $("#idigv1").val(formatoNumero(importeTotal * (PORCENTAJE_IGV / 100)));
                    $("#idtotal1").val(formatoNumero(importeTotal + (importeTotal * (PORCENTAJE_IGV / 100))));

                    $("#rtxtDescripcion1").val("");
                    //$("#txtCantidad1").val("");
                    $("#txtValorUnitarioTotal1").val("");

                    document.getElementById("rcbxUM1").focus = true;
                }
                else if ($("#rcbxTipoCpbteCompModal1").val().trim() == "2") {
                    // BOLETA
                    $("#idimportetotal1").val(formatoNumero(importeTotal));
                    $("#idigv1").val(0);
                    $("#idtotal1").val(formatoNumero(importeTotal));

                    $("#rcbxUM1").val("UN");
                    $("#rtxtDescripcion1").val("");
                    //$("#txtCantidad1").val("1");
                    $("#txtValorUnitarioTotal1").val("");

                    document.getElementById("txtValorUnitarioTotal1").focus = true;
                }


                const totalDetalle = rdetComprobanteArray1.reduce((acc, item) => {

                    //if (item.idConcepDet == rvIdConcepDet) {
                        acc += item.total;
                    //}
                    return acc;
                }, 0);

                // Descontar del monto maximo del Item de detalle.
                //const consumidoXDetalle = rdetComprobanteArray1.reduce((acc, item) => {
                //    if (item.idConcepDet == rvIdConcepDet) {
                //        acc += item.total;
                //    }
                //    return acc;
                //}, 0);


                document.getElementById("rcbxConcepCabModal1").disabled = true;
                document.getElementById("rrcbxConcepDetModal1").disabled = true;
                document.getElementById("txtObservacionModal1").disabled = true;

                $("#ridMontoSolicitadoModal1").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado1 - totalDetalle));
            }

        });

        $("#btnAgregarMotivo2").click(function () {

            if (rvalidacionDetCmpbte(rtabSeleccionado)) {

                let importeIngresado = parseFloat($("#txtImporteModal2").val());

                const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                    return acc += item.totalrestante
                }, 0);

                const sumAgregadosDet = rdetComprobanteArray2.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                    $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                }
                else {
                    $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
                }

                riDetalle2++;

                var d = new Date($("#rtxtFechaModalDet2").val());

                let month = '' + (d.getMonth() + 1);
                let day = '' + d.getDate();
                let year = d.getFullYear();

                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                rdetComprobanteArray2.push({
                    idSolicitud: rvIdSolicitud,
                    idConcepCab: rvIdConceptoCab2,
                    idConcepDet: rvIdConceptoDet2,
                    conceptoDet: rvConceptoDet2,
                    iDetalle: riDetalle2,
                    fecha: [year, month, day].join('-'),
                    fechaBD: [year, month, day].join(''),
                    detalle1: $("#txtOrgDstModal2").val(),
                    detalle2: $("#txtMotivoModal2").val(),
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#txtImporteModal2").val()),
                    cantidad: 1,
                    total: parseFloat($("#txtImporteModal2").val()),
                    seccion: 1,
                    codCeCo: rvCodCeCo,
                    idTipo: vIdTipo
                });


                let tabla = $("#rrtblPlanillaMovilidad").DataTable();

                tabla.destroy();
                var tr = "";

                rdetComprobanteArray2.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + obj.detalle2 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#rrtblPlanillaMovilidadContent").html(tr);

                $("#rrtblPlanillaMovilidad").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    });

                $("#txtOrgDstModal2").val("");
                $("#txtMotivoModal2").val("");
                $("#txtImporteModal2").val("");

                document.getElementById("txtOrgDstModal2").focus = true;

                // Descontar del monto maximo del Item de detalle.
                const consumidoXDetalle = rdetComprobanteArray2.reduce((acc, item) => {
                    //if (item.idConcepDet == rvIdConcepDet) {
                        acc += item.total;
                    //}
                    return acc;
                }, 0);


                document.getElementById("rcbxConcepCabModal2").disabled = true;
                document.getElementById("rrcbxConcepDetModal2").disabled = true;
                document.getElementById("txtObservacionModal2").disabled = true;

                $("#ridMontoSolicitadoModal2").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado2 - consumidoXDetalle));
            }

        });

        $("#btnAgregarMotivo3_1").click(function () {

            if (rvalidacionDetCmpbte(rtabSeleccionado)) {

                let importeIngresado = parseFloat($("#txtMontoDet3_1").val());

                const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                    return acc += item.totalrestante
                }, 0);

                const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                    $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                }
                else {
                    $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                }

                riDetalle3++;

                var d = new Date($("#rtxtFechaModalDet3_1").val());

                let month = '' + (d.getMonth() + 1);
                let day = '' + d.getDate();
                let year = d.getFullYear();

                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                rdetComprobanteArray3.push({
                    idSolicitud: rvIdSolicitud,
                    idConcepCab: rvIdConceptoCab3,
                    idConcepDet: rvIdConceptoDet3,
                    conceptoDet: rvConceptoDet3,
                    iDetalle: riDetalle3,
                    fecha: [year, month, day].join('-'),
                    fechaBD: [year, month, day].join(''),
                    detalle1: $("#rcbxMonedaModal3 option:selected").text(),
                    detalle2: "",
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#txtMontoDet3_1").val()),
                    cantidad: 1,
                    total: parseFloat($("#txtMontoDet3_1").val()),
                    seccion: 1,
                    codCeCo: rvCodCeCo,
                    idTipo: vIdTipo
                });

                let tabla = $("#rtblDeclaracionJurada3_1").DataTable();

                tabla.destroy();
                var tr = "";

                rdetComprobanteArray3.forEach((obj) => {
                    if (obj.seccion == 1) {

                        tr += "<tr> "
                            + " <td> " + obj.fecha + "</td>"
                            + " <td> " + obj.detalle1 + "</td>"
                            + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                            + " <td class='text-center'>"
                            + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                            + "</td>"
                            + "</tr>";
                    }
                });

                $("#tblDeclaracionJuradaContent3_1").html(tr);

                $("#rtblDeclaracionJurada3_1").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5], [5]]
                    });

                $("#txtMontoDet3_1").val("");

                document.getElementById("rtxtFechaModalDet3_1").focus = true;


                // Descontar del monto maximo del Item de detalle.
                const consumidoXDetalle = rdetComprobanteArray3.reduce((acc, item) => {
                    //if (item.seccion == 1) {
                        acc += item.total;
                    //}
                    return acc;
                }, 0);

                document.getElementById("rcbxConcepCabModal3").disabled = true;
                document.getElementById("rcbxConcepDetModal3").disabled = true;
                document.getElementById("rtxtObservacionModal3").disabled = true;

                $("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3 - consumidoXDetalle));

            }
        });

        $("#btnAgregarMotivo3_2").click(function () {

            if (rvalidacionDetCmpbte(rtabSeleccionado)) {

                let importeIngresado = parseFloat($("#txtMontoDet3_2").val());

                const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                    return acc += item.totalrestante
                }, 0);

                const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                    $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                }
                else {
                    $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
                }

                riDetalle3++;

                var d = new Date($("#rtxtFechaModalDet3_2").val());

                let month = '' + (d.getMonth() + 1);
                let day = '' + d.getDate();
                let year = d.getFullYear();

                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                rdetComprobanteArray3.push({
                    idSolicitud: rvIdSolicitud,
                    idConcepCab: rvIdConceptoCab3,
                    idConcepDet: rvIdConceptoDet3,
                    conceptoDet: rvConceptoDet3,
                    iDetalle: riDetalle3,
                    fecha: [year, month, day].join('-'),
                    fechaBD: [year, month, day].join(''),
                    detalle1: $("#rcbxMonedaModal3 option:selected").text(),
                    detalle2: "",
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#txtMontoDet3_2").val()),
                    cantidad: 1,
                    total: parseFloat($("#txtMontoDet3_2").val()),
                    seccion: 2,
                    codCeCo: rvCodCeCo,
                    idTipo: vIdTipo
                });

                let tabla = $("#rtblDeclaracionJurada3_2").DataTable();

                tabla.destroy();
                var tr = "";

                rdetComprobanteArray3.forEach((obj) => {
                    if (obj.seccion == 2) {

                        tr += "<tr> "
                            + " <td> " + obj.fecha + "</td>"
                            + " <td> " + obj.detalle1 + "</td>"
                            + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                            + " <td class='text-center'>"
                            + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                            + "</td>"
                            + "</tr>";
                    }
                });

                $("#tblDeclaracionJuradaContent3_2").html(tr);

                $("#rtblDeclaracionJurada3_2").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5], [5]]
                    });

                $("#txtMontoDet3_2").val("");

                document.getElementById("rtxtFechaModalDet3_2").focus = true;


                // Descontar del monto maximo del Item de detalle.
                const consumidoXDetalle = rdetComprobanteArray3.reduce((acc, item) => {
                    //if (item.seccion == 2) {
                        acc += item.total;
                    //}
                    return acc;
                }, 0);

                document.getElementById("rcbxConcepCabModal3").disabled = true;
                document.getElementById("rcbxConcepDetModal3").disabled = true;
                document.getElementById("rtxtObservacionModal3").disabled = true;

                $("#ridMontoSolicitadoModal3").text(rvSimboloMoneda + " " + formatoNumero(rvTotalSolicitado3 - consumidoXDetalle));

            }
        });


        $("#rtblFacturaBoleta").on("click", ".cselectEliminar1", function () {

            let vIDetalle = $(this).attr("data-idetalle");

            for (var i = 0; i < rdetComprobanteArray1.length; i++) {
                if (rdetComprobanteArray1[i].iDetalle == parseInt(vIDetalle)) {
                    rdetComprobanteArray1.splice(i, 1);
                }
            }

            const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                return acc += item.totalrestante
            }, 0);

            const sumAgregadosDet = rdetComprobanteArray1.reduce((acc, item) => {
                return acc += (item.total);
            }, 0);

            $("#rkpiMontoSeleecionadoModal1").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
            }
            else {
                $("#rregComprobModal .kpi-modal-monto1").css("background-color", "#ABB2B9");
            }

            let tabla = $("#rtblFacturaBoleta").DataTable();

            tabla.destroy();
            var tr = "";

            rdetComprobanteArray1.forEach((obj) => {

                tr += "<tr> "
                    + " <td> " + obj.um + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + obj.cantidad + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td> " + formatoNumero(obj.total) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });


            $("#rtblFacturaBoletaContent").html(tr);

            $("#rtblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5], [5]]
                });




            const importeTotal = rdetComprobanteArray1.reduce((acc, item) => {
                return acc += (item.valorunit);
            }, 0);


            if ($("#rcbxTipoCpbteCompModal1").val().trim() == "1") {
                // FACTURA
                $("#rtxtDescripcion1").val("");
                //$("#txtCantidad1").val("");
                $("#txtValorUnitarioTotal1").val("");

                $("#idimportetotal1").val(formatoNumero(importeTotal));
                $("#idigv1").val(formatoNumero(importeTotal * (PORCENTAJE_IGV / 100)));
                $("#idtotal1").val(formatoNumero(importeTotal + (importeTotal * (PORCENTAJE_IGV / 100))));
            }
            else if ($("#rcbxTipoCpbteCompModal1").val().trim() == "2") {
                // BOLETA
                $("#rtxtDescripcion1").val("");
                //$("#txtCantidad1").val("1");
                $("#txtValorUnitarioTotal1").val("");

                $("#idimportetotal1").val(formatoNumero(importeTotal));
                $("#idigv1").val(0);
                $("#idtotal1").val(formatoNumero(importeTotal));
            }


            document.getElementById("rcbxUM1").focus = true;

            $("#rkpiMontoSeleecionadoModal1").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        });

        $("#rrtblPlanillaMovilidad").on("click", ".cselectEliminar2", function () {
            let vIDetalle = $(this).attr("data-iDetalle");

            for (var i = 0; i < rdetComprobanteArray2.length; i++) {
                if (rdetComprobanteArray2[i].iDetalle == parseInt(vIDetalle)) {
                    rdetComprobanteArray2.splice(i, 1);
                }
            }

            const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                return acc += item.totalrestante
            }, 0);

            const sumAgregadosDet = rdetComprobanteArray2.reduce((acc, item) => {
                return acc += item.valorunit;
            }, 0);

            $("#ridMontoSolicitadoModal2").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
            }
            else {
                $("#rregComprobModal .kpi-modal-monto2").css("background-color", "#ABB2B9");
            }

            let tabla = $("#rrtblPlanillaMovilidad").DataTable();

            tabla.destroy();
            var tr = "";

            rdetComprobanteArray2.forEach((obj) => {

                tr += "<tr> "
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + obj.detalle2 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });

            $("#rrtblPlanillaMovilidadContent").html(tr);

            $("#rrtblPlanillaMovilidad").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                });

            $("#txtOrgDstModal2").val("");
            $("#txtMotivoModal2").val("");
            $("#txtImporteModal2").val("0");

            document.getElementById("txtOrgDstModal2").focus = true;
        });

        $("#rtblDeclaracionJurada3_1").on("click", ".cselectEliminar3_1", function () {
            let vIDetalle = $(this).attr("data-idetalle");

            const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                return acc += item.totalrestante
            }, 0);

            for (var i = 0; i < rdetComprobanteArray3.length; i++) {
                if (rdetComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                    rdetComprobanteArray3.splice(i, 1);
                }
            }

            const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
                return acc += item.valorunit;
            }, 0);


            $("#ridMontoSolicitadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado3 - sumAgregadosDet));

            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
            }
            else {
                $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
            }



            let tabla = $("#rtblDeclaracionJurada3_1").DataTable();

            tabla.destroy();
            var tr = "";


            rdetComprobanteArray3.forEach((obj) => {

                if (obj.seccion == 1) {
                    tr += "<tr> "
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_1 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                }
            });

            $("#tblDeclaracionJuradaContent3_1").html(tr);

            $("#rtblDeclaracionJurada3_1").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5], [5]]
                });

            $("#txtMontoDet3_1").val("");

            document.getElementById("rtxtFechaModalDet3_1").focus = true;
        });

        $("#rtblDeclaracionJurada3_2").on("click", ".cselectEliminar3_2", function () {
            let vIDetalle = $(this).attr("data-idetalle");

            const sumDetalleSol = rdetalleArray.reduce((acc, item) => {
                return acc += item.totalrestante
            }, 0);

            for (var i = 0; i < rdetComprobanteArray3.length; i++) {
                if (rdetComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                    rdetComprobanteArray3.splice(i, 1);
                }
            }

            const sumAgregadosDet = rdetComprobanteArray3.reduce((acc, item) => {
                return acc += item.valorunit;
            }, 0);

            $("#ridMontoSolicitadoModal3").text(rsolicitudCabCreada.simbolo + " " + formatoNumero(rvTotalSolicitado3 - sumAgregadosDet));



            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
            }
            else {
                $("#rregComprobModal .kpi-modal-monto3").css("background-color", "#ABB2B9");
            }





            let tabla = $("#rtblDeclaracionJurada3_2").DataTable();

            tabla.destroy();
            var tr = "";


            rdetComprobanteArray3.forEach((obj) => {

                if (obj.seccion == 1) {
                    tr += "<tr> "
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3_2 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                }
            });

            $("#tblDeclaracionJuradaContent3_2").html(tr);

            $("#rtblDeclaracionJurada3_2").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5], [5]]
                });

            $("#txtMontoDet3_2").val("");

            document.getElementById("rtxtFechaModalDet3_2").focus = true;
        });

        $("#btnGuardarComprobante").click(function () {

            if (rvalidacionGuardarComp(rtabSeleccionado)) {

                let parametro = {};
                let opcion = 0;

                if (rTIPO_REGISTRO == "INSERTAR") {
                    opcion = 1;
                }
                else if (rTIPO_REGISTRO == "EDITAR") {
                    opcion = 6;
                }


                // 1. Facturas / Boletas
                if (rtabSeleccionado == 1) {

                    parametro = {
                        'opcion': opcion,
                        'idRendCompte': rvIdRendCompte,
                        'idTipoComp': parseInt($("#rcbxTipoCpbteCompModal1").val()),

                        'nserie': $("#txtSerieModal1").val(),
                        'ndocof': $("#txtNumeroModal1").val(),

                        'rucDNI': $("#rtxtRucCompModal1").val(),
                        'rs': $("#rtxtRSCompModal1").val(),
                        'codigoPC': $("#rtxtCodSofyaPCModal1").val(),
                        'obs': $("#rtxtObsCompModal1").val(),
                        'fechaEmision': $("#rtxtFechaModal1").val(),
                        'codceco': rvCodCeCo,
                        'idTipoMod': parseInt($("#rcbxMonedaModal1").val()),
                        'porcentajeIGV': (($("#rcbxTipoCpbteCompModal1").val().trim() == "1") ? PORCENTAJE_IGV : 0),
                        'obs1': '',
                        'obs2': '',
                        'fecha1': '',
                        'periodo': $("#rcbxPeriodoModal1").val(),

                        'detalleComprobanteArray': rdetComprobanteArray1
                    };

                }
                else if (rtabSeleccionado == 2) {

                    // 2. Planilla de Movilidad
                    parametro = {
                        'opcion': opcion,
                        'idRendCompte': rvIdRendCompte,
                        'idTipoComp': 3,

                        'nserie': "000",
                        'ndocof': FormatoFecha($("#rtxtFechaModal2").val()),

                        'rucDNI': $("#rtxtDNIModal2").val(),
                        'rs': $("#rtxtApeNomModal2").val(),
                        'codigoPC': $("#rtxtDNIModal2").val(),
                        'obs': "PLANILLA DE MOVILIDAD - " + vcolaborador,
                        'fechaEmision': $("#rtxtFechaModal2").val(),
                        'codceco': rvCodCeCo,
                        'idTipoMod': parseInt($("#rcbxMonedaModal2").val()),
                        'porcentajeIGV': 0,
                        'obs1': '',
                        'obs2': '',
                        'fecha1': $("#rtxtFechaDesdeModal3").val(),
                        'periodo': $("#rcbxPeriodoModal2").val(),

                        'detalleComprobanteArray': rdetComprobanteArray2
                    };
                }
                else if (rtabSeleccionado == 3) {

                    // 2. Declaracion Jurada
                    parametro = {
                        'opcion': opcion,
                        'idRendCompte': rvIdRendCompte,
                        'idTipoComp': 4,

                        'nserie': "000",
                        'ndocof': FormatoFecha($("#rtxtFechaModal3").val()),

                        'rucDNI': $("#rtxtDNIModal3").val(),
                        'rs': $("#rtxtApeNomModal3").val(),
                        'codigoPC': $("#rtxtDNIModal3").val(),
                        'obs': "DECLARACIÓN JURADA - " + vcolaborador,
                        'fechaEmision': $("#rtxtFechaModal3").val(),
                        'codceco': rvCodCeCo,
                        'idTipoMod': parseInt($("#rcbxMonedaModal3").val()),
                        'porcentajeIGV': 0,
                        'obs1': $("#txtCiudadModal3").val(),
                        'obs2': $("#txtPaisModal3").val(),
                        'fecha1': FormatoFecha($("#rtxtFechaDesdeModal3").val()),
                        'periodo': $("#rcbxPeriodoModal3").val(),

                        'detalleComprobanteArray': rdetComprobanteArray3
                    };
                }


                $.ajax({
                    url: "/finanzas/RG_SetReembolsoComprobante",
                    type: "post",
                    data: parametro,
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            if (resultado.entidad.idResponse > 0) {

                                rvalidarrestadoSolicitud(2, rsolicitudCabCreada.idSolicitud);
                                rgetListaDetalle(rsolicitudCabCreada.idSolicitud);

                                rlimpiarControlModal(1);
                                rlimpiarControlModal(2);
                                rlimpiarControlModal(3);

                                $("#rregComprobModal").modal("hide");
                            }
                            else {
                                rmensajePrincipal(false, resultado.entidad.statusResponse);

                                console.log(resultado.entidad.statusResponse);
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });
            }
        });

        function FormatoFecha(pFecha) {
            let fechaFormato = new Date(pFecha);

            let month = '' + (fechaFormato.getMonth() + 1);
            let day = '' + fechaFormato.getDate();
            let year = fechaFormato.getFullYear();

            if (month.length < 2) { month = '0' + month; }
            if (day.length < 2) { day = '0' + day; }

            return [year, month, day].join('');
        }

        $('#rcbxTipoCpbteCompModal1').change(function () {

            var $option = $(this).find('option:selected');
            rvCodTipoComprobante = parseInt($option.val());

            rcambioTipoCpte(rvCodTipoComprobante);
        });

        function rcambioTipoCpte(pCodTipoCpte) {


            // Limpiar TAB Factura Boleta

            if (pCodTipoCpte == 1) {
                // Factura
                document.getElementById("rcbxTipoCpbteCompModal1").disabled = false;
                document.getElementById("txtSerieModal1").disabled = false;
                document.getElementById("txtNumeroModal1").disabled = false;
                document.getElementById("rtxtObsCompModal1").disabled = false;

                document.getElementById("rcbxUM1").disabled = false;
                document.getElementById("rtxtDescripcion1").disabled = false;
                //document.getElementById("txtCantidad1").disabled = false;
                document.getElementById("txtValorUnitarioTotal1").disabled = false;

                document.getElementById("idimportetotal1").disabled = true;
                document.getElementById("idigv1").disabled = true;
                document.getElementById("idtotal1").disabled = true;

                document.getElementById("txtSerieModal1").focus = true;
            }
            else if (pCodTipoCpte == 2) {
                // Boleta
                document.getElementById("rcbxTipoCpbteCompModal1").disabled = false;
                document.getElementById("txtSerieModal1").disabled = false;
                document.getElementById("rtxtObsCompModal1").disabled = false;

                document.getElementById("rcbxUM1").disabled = true;
                document.getElementById("rtxtDescripcion1").disabled = false;
                //document.getElementById("txtCantidad1").disabled = true;
                document.getElementById("txtValorUnitarioTotal1").disabled = false;

                $("#rtxtDescripcion1").val("");
                $("#rcbxUM1").val("UN");
                //$("#txtCantidad1").val(1);

                document.getElementById("txtValorUnitarioTotal1").focus = true;

            }

            rdetComprobanteArray1 = [];

            let tabla = $("#rtblFacturaBoleta").DataTable();
            tabla.destroy();
            var tr = "";
            $("#rtblFacturaBoletaContent").html(tr);
            $("#rtblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[3], [3]]
                }
            );

            document.getElementById("idimportetotal1").disabled = true;
            document.getElementById("idigv1").disabled = true;
            document.getElementById("idtotal1").disabled = true;

            $("#idimportetotal1").val("0");
            $("#idigv1").val("0");
            $("#idtotal1").val("0");
        }

        $("#rtabRendicionGastos").on("click", ".rctabRegComp", function () {
            let index = $(this).attr("data-id");
            rtabSeleccionado = parseInt(index);
        });

        $('.rcfecha').change(function () {

            var inputDate = new Date(this.value);
            var today = new Date();

            if (inputDate > today) {

                let dd = String(today.getDate()).padStart(2, '0');
                let mm = String(today.getMonth() + 1).padStart(2, '0');
                let yyyy = today.getFullYear();

                today = yyyy + '-' + mm + '-' + dd;

                $(this).val(today);

                Swal.fire({
                    title: 'La fecha no puede ser mayor a la fecha Actual',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

        });

        $('#rregComprobModal').on('shown.bs.modal', function (e) {
            var now = new Date();
            var month = (now.getMonth() + 1);
            var day = now.getDate();
            if (month < 10)
                month = "0" + month;
            if (day < 10)
                day = "0" + day;
            var today = now.getFullYear() + '-' + month + '-' + day;

            $('#rtxtFechaModal1').val(today);
            $('#rtxtFechaModal2').val(today);
            $('#rtxtFechaModal3').val(today);
            $('#rtxtFechaModalDet2').val(today);
            $('#rtxtFechaModalDet3').val(today);
            $('#rtxtFechaDesdeModal3').val(today);
            $('#rtxtFechaModalDet3_1').val(today);
            $('#rtxtFechaModalDet3_2').val(today);

            $("#rcbxMonedaModal1").val(rsolicitudCabCreada.idTipoMod);
            $("#rcbxMonedaModal2").val(rsolicitudCabCreada.idTipoMod);
            $("#rcbxMonedaModal3").val(rsolicitudCabCreada.idTipoMod);

        });



        function rvalidacionDetCmpbte(tabSeleccion) {
            let respuesta = false;

            if (tabSeleccion == 1) {

                let tipoComprobante = $('#rcbxTipoCpbteCompModal1').val();

                if ($("#rcbxTipoCpbteCompModal1").val().trim() == "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione un Tipo de Comprobante',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#rcbxUM1").val() == "0" && tipoComprobante == "1") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione una unidad de medida por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#rtxtDescripcion1").val().trim() == "" && (tipoComprobante == "1")) {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese la descripción por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                //else if (($("#txtCantidad1").val().trim() == "" || $("#txtCantidad1").val() == null || typeof ($("#txtCantidad1").val()) == "undefined") && (tipoComprobante == "1")) {
                //    respuesta = false;
                //    Swal.fire({
                //        title: 'Ingrese la cantidad por favor',
                //        text: "Textile Sourcing Company",
                //        icon: 'warning',
                //        showConfirmButton: true,
                //        confirmButtonColor: '#3085d6',
                //        confirmButtonText: 'Ok'
                //    });
                //}
                //else if ((parseFloat($("#txtCantidad1").val()) == 0 || parseFloat($("#txtCantidad1").val()) < 0 || parseFloat($("#txtCantidad1").val()) > 50) && (tipoComprobante == "1")) {
                //    respuesta = false;
                //    Swal.fire({
                //        title: 'Ingrese una cantidad correcta por favor',
                //        text: "Textile Sourcing Company",
                //        icon: 'warning',
                //        showConfirmButton: true,
                //        confirmButtonColor: '#3085d6',
                //        confirmButtonText: 'Ok'
                //    });
                //}
                else if (($("#txtValorUnitarioTotal1").val().trim() == "" || $("#txtValorUnitarioTotal1").val() == null || typeof ($("#txtValorUnitarioTotal1").val()) == "undefined") && (tipoComprobante == "1")) {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese el valor Unitario',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ((parseFloat($("#txtValorUnitarioTotal1").val()) == 0 || parseFloat($("#txtValorUnitarioTotal1").val()) < 0 || parseFloat($("#txtValorUnitarioTotal1").val()) > 1500) && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese un Valor unitario correcto por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }


                else if (rvIdConceptoCab1.toString() == "5") {
                    if ($("#txtObservacionModal1").val().trim() == "" || $("#txtObservacionModal1").val() == null || typeof ($("#txtObservacionModal1").val()) == "undefined") {
                        respuesta = false;
                        Swal.fire({
                            title: 'Ingrese una descripción por favor',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }


                else {
                    respuesta = true;
                }
            }
            else if (tabSeleccion == 2) {

                if ($("#rtxtApeNomModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese Apellidos y Nombres',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#rtxtDNIModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: "Ingrese el número de DNI",
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#rtxtApeNomModal2").val().trim() == "0 Ninguno" || $("#rtxtApeNomModal2").val().trim() == "0 Varios") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Colaborador no existe',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtOrgDstModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción de Origen/Destino',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtMotivoModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción del motivo',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtImporteModal2").val().trim() == "" || $("#txtImporteModal2").val().trim() == "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el importe por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }
            else if (tabSeleccion == 3) {

                //if ($("#txtMotivoModal3").val().trim() == "") {
                //    respuesta = false;

                //    Swal.fire({
                //        title: 'Ingreso el Motivo por favor',
                //        text: "Textile Sourcing Company",
                //        icon: 'warning',
                //        showConfirmButton: true,
                //        confirmButtonColor: '#3085d6',
                //        confirmButtonText: 'Ok'
                //    });
                //}
                //else if ($("#txtImporteModal3").val().trim() == "") {
                //    respuesta = false;

                //    Swal.fire({
                //        title: 'Ingrese el importe por favor',
                //        text: "Textile Sourcing Company",
                //        icon: 'warning',
                //        showConfirmButton: true,
                //        confirmButtonColor: '#3085d6',
                //        confirmButtonText: 'Ok'
                //    });

                //}
                //else {
                //    respuesta = true;
                //}

                respuesta = true;
            }

            return respuesta;
        }

        function rvalidacionGuardarComp(indexTab) {
            var respuesta = false;

            // Registro de Factura y Boleta

            if (indexTab == 1) {

                let tipoComprobante = $('#rcbxTipoCpbteCompModal1').val();


                if ($("#rcbxTipoCpbteCompModal1").val().trim() == "0" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione un Tipo de Comprobante',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtSerieModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese un numero y serie',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtNumeroModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese un numero y serie',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#rtxtRucCompModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el número de RUC / DNI',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#rtxtCodSofyaPCModal1").val().trim() == "" && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;

                    Swal.fire({
                        title: 'El rproveedor debe estar registrado en Sofya para continuar',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (rdetComprobanteArray1.length == 0 && (tipoComprobante == "1" || tipoComprobante == "2")) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Debe agregar el detalle del comprobante',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }
            if (indexTab == 2) {

                // Planilla de Movilidad
                if ($("#rtxtDNIModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'No se encuentra el colaborador',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (rdetComprobanteArray2.length == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Debe agregar el detalle de Planilla de Movilidad',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }
            else if (indexTab == 3) {

                // Planilla de Movilidad
                if ($("#rcbxMonedaModal3").val().trim() == "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el tipo de Moneda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else if ($("#rtxtDNIModal3").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el número de DNI por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (rdetComprobanteArray3.length == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Debe agregar el detalle de la Declaración Jurada',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }


            return respuesta;
        }

        function rlimpiarControlModal(tabSeleccion) {

            var now = new Date();
            var month = (now.getMonth() + 1);
            var day = now.getDate();
            if (month < 10)
                month = "0" + month;
            if (day < 10)
                day = "0" + day;
            var today = now.getFullYear() + '-' + month + '-' + day;


            if (tabSeleccion == 1) {

                // 1. Factura y Boleta
                $("#rcbxTipoCpbteCompModal1").val(rvCodTipoComprobante);
                //rcambioTipoCpte(rvCodTipoComprobante);

                $("#rtxtFechaModal1").val(today);
                $("#txtSerieModal1").val("");
                $("#txtNumeroModal1").val("");
                $("#rtxtRucCompModal1").val("");
                $("#rtxtRSCompModal1").val("");
                $("#rtxtCodSofyaPCModal1").val("");
                $("#rtxtObsCompModal1").val("");

                $("#rcbxUM1").val("UN");
                $("#rtxtDescripcion1").val("");
                //$("#txtCantidad1").val("");
                $("#txtValorUnitarioTotal1").val("");

                //$("#ridMontoSolicitadoModal1").text("0.00");

                let tabla = $("#rtblFacturaBoleta").DataTable();
                tabla.destroy();
                var tr = "";
                $("#rtblFacturaBoletaContent").html(tr);
                $("#rtblFacturaBoleta").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    }
                );

                $("#idimportetotal1").val("0");
                $("#idigv1").val("0");
                $("#idtotal1").val("0");

                rdetComprobanteArray1 = [];

                document.getElementById("txtSerieModal1").focus = true;

                document.getElementById("rcbxConcepCabModal1").disabled = false;
                document.getElementById("rrcbxConcepDetModal1").disabled = false;
                document.getElementById("txtObservacionModal1").disabled = false;

            }
            else if (tabSeleccion == 2) {

                // 2. Planilla de Movilidad
                $("#txtNumPlanillaModal2").val("");
                $("#rtxtApeNomModal2").val("");
                $("#rtxtDNIModal2").val("");
                $("#rtxtCeCoModal2").val("");

                $("#rtxtFechaModal2").val(today);
                $("#txtOrgDstModal2").val("");
                $("#txtMotivoModal2").val("");
                $("#txtImporteModal2").val("");

                let tabla = $("#rrtblPlanillaMovilidad").DataTable();
                tabla.destroy();
                var tr = "";
                $("#rrtblPlanillaMovilidadContent").html(tr);
                $("#rrtblPlanillaMovilidad").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    }
                );

                rdetComprobanteArray2 = [];

                document.getElementById("rcbxConcepCabModal2").disabled = false;
                document.getElementById("rrcbxConcepDetModal2").disabled = false;
                document.getElementById("txtObservacionModal2").disabled = false;

                //$("#ridMontoSolicitadoModal2").text("0.00");
            }
            else if (tabSeleccion == 3) {

                // 3. Declaración Jurada.
                $("#txtCodigoModal3").val("");
                $("#rtxtApeNomModal3").val("");
                $("#rtxtDNIModal3").val("");

                $("#rtxtFechaModal3").val(today);
                $("#txtMotivoModal3").val("");
                $("#txtImporteModal3").val("");

                let tabla = $("#tblDeclaracionJurada").DataTable();
                tabla.destroy();
                var tr = "";
                $("#tblDeclaracionJuradaContent").html(tr);
                $("#tblDeclaracionJurada").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    }
                );

                rdetComprobanteArray3 = [];

                document.getElementById("rcbxConcepCabModal3").disabled = false;
                document.getElementById("rcbxConcepDetModal3").disabled = false;
                document.getElementById("rtxtObservacionModal3").disabled = false;

                //$("#ridMontoSolicitadoModal3").text("0.00");
            }

            rdetComprobanteArray = [];
        }


        function rvalidarrestadoSolicitud(pOpcion, pIdSolicitud) {

            $.ajax({
                url: "/finanzas/RG_ValidarEstadoRendicion",
                type: "POST",
                data: {
                    opcion: pOpcion,
                    idSolicitud: pIdSolicitud,
                    codigo: "",
                    secuencia: 0,
                    idRendCompte: 0
                },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        rindicadorEstado(resultado.status.idResponse);
                        $("#restado-desc").text(resultado.status.statusResponse);
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        }

        function rbusquedaXDNI(dni, opcionModal) {

            if (dni == "") {
                Swal.fire({
                    title: 'Ingrese el número de DNI',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        // Planilla de Movilidad
                        if (opcionModal == 2) {
                            document.getElementById("rtxtDNIModal2").focus = true;
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            document.getElementById("rtxtDNIModal3").focus = true;
                        }
                    }
                });
            }
            else if (dni.length < 7) {
                Swal.fire({
                    title: 'Ingrese un número RUC valido por favor',
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        // Planilla de Movilidad
                        if (opcionModal == 2) {
                            document.getElementById("rtxtDNIModal2").focus = true;
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            document.getElementById("rtxtDNIModal3").focus = true;
                        }
                    }
                });
            }
            else {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_BuscarColaboradorXDNI',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { dni: dni },
                    success: function (data) {

                        if (opcionModal == 2) {
                            // Planilla de Movilidad
                            $("#rtxtApeNomModal2").val(data.entidad.colaborador);
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            $("#rtxtApeNomModal3").val(data.entidad.colaborador);
                        }

                        if (data.entidad.codcolaborador == "0") {

                            const Toast = Swal.mixin({
                                toast: true,
                                position: 'top-end',
                                showConfirmButton: false,
                                timer: 2500,
                                timerProgressBar: true,
                                didOpen: (toast) => {
                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                }
                            })

                            Toast.fire({
                                icon: 'warning',
                                title: data.entidad.mensaje
                            });

                            if (opcionModal == 2) {
                                // Planilla de Movilidad
                                document.getElementById("rtxtDNIModal2").focus = true;
                            }
                            else if (opcionModal == 3) {
                                // Declaracion Jurada
                                document.getElementById("rtxtDNIModal3").focus = true;
                            }
                        }
                        else {
                            if (opcionModal == 2) {
                                // Planilla de Movilidad
                                document.getElementById("txtOrgDstModal2").focus = true;
                            }
                            else if (opcionModal == 3) {
                                // Declaracion Jurada
                                // document.getElementById("rtxtDNIModal3").focus = true;
                            }
                        }
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }
        }

        function rlistarDetalle(idRendCompte) {

            $.ajax({
                url: "/finanzas/RG_RendicionDetalle",
                type: "GET",
                data: { idRendCompte: idRendCompte },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        let tabla = $("#rrtblPlanillaMovilidad").DataTable();

                        tabla.destroy();
                        var tr = "";

                        resultado.lista.forEach((obj) => {

                            tr += "<tr> "
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + obj.detalle2 + "</td>"
                                + " <td> " + formatoNumero(obj.importe) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idRendCompteDet='" + obj.idRendCompteDet + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });

                        $("#rrtblPlanillaMovilidadContent").html(tr);


                        $("#rrtblPlanillaMovilidad").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                            });
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });


        }

        function rindicadorEstado(idEstado) {

            if (idEstado == 1) {
                // Pendiente
                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-aprobado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-rend-completa");
                $("#restado-icon").removeClass("icon-rend-incompleta");
                $("#restado-icon").addClass("icon-pendiente");

                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-aprobado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-rend-completa");
                $("#restado-desc").removeClass("desc-est-rend-incompleta");
                $("#restado-desc").addClass("desc-est-pendiente");

            }
            else if (idEstado == 2) {
                // Liberado
                $("#restado-icon").removeClass("icon-pendiente");
                $("#restado-icon").removeClass("icon-aprobado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-rend-completa");
                $("#restado-icon").removeClass("icon-rend-incompleta");
                $("#restado-icon").addClass("icon-liberado");

                $("#restado-desc").removeClass("desc-est-pendiente");
                $("#restado-desc").removeClass("desc-est-aprobado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-rend-completa");
                $("#restado-desc").removeClass("desc-est-rend-incompleta");
                $("#restado-desc").addClass("desc-est-liberado");

            }
            else if (idEstado == 3) {
                // Aprobado
                $("#restado-icon").removeClass("icon-pendiente");
                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-rend-completa");
                $("#restado-icon").removeClass("icon-rend-incompleta");
                $("#restado-icon").addClass("icon-aprobado");

                $("#restado-desc").removeClass("desc-est-pendiente");
                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-rend-completa");
                $("#restado-desc").removeClass("desc-est-rend-incompleta");
                $("#restado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 4) {
                // Aprobado
                $("#restado-icon").removeClass("icon-pendiente");
                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-rend-completa");
                $("#restado-icon").removeClass("icon-rend-incompleta");
                $("#restado-icon").addClass("icon-aprobado");

                $("#restado-desc").removeClass("desc-est-pendiente");
                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-rend-completa");
                $("#restado-desc").removeClass("desc-est-rend-incompleta");
                $("#restado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 5) {
                // Rechazado
                $("#restado-icon").removeClass("icon-pendiente");
                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-aprobado");
                $("#restado-icon").removeClass("icon-rend-completa");
                $("#restado-icon").removeClass("icon-rend-incompleta");
                $("#restado-icon").addClass("icon-rechazado");

                $("#restado-desc").removeClass("desc-est-pendiente");
                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-aprobado");
                $("#restado-desc").removeClass("desc-est-rend-completa");
                $("#restado-desc").removeClass("desc-est-rend-incompleta");
                $("#restado-desc").addClass("desc-est-rechazado");
            }
            else if (idEstado == 6) {
                // Rendicion Completa
                $("#restado-icon").removeClass("icon-pendiente");
                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-rend-incompleta");
                $("#restado-icon").addClass("icon-rend-completa");

                $("#restado-desc").removeClass("desc-est-pendiente");
                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-rend-incompleta");
                $("#restado-desc").addClass("desc-est-rend-completa");
            }
            else if (idEstado == 7) {
                // Rendicion Incompleta
                $("#restado-icon").removeClass("icon-pendiente");
                $("#restado-icon").removeClass("icon-liberado");
                $("#restado-icon").removeClass("icon-rechazado");
                $("#restado-icon").removeClass("icon-rend-completa");
                $("#restado-icon").addClass("icon-rend-incompleta");

                $("#restado-desc").removeClass("desc-est-pendiente");
                $("#restado-desc").removeClass("desc-est-liberado");
                $("#restado-desc").removeClass("desc-est-rechazado");
                $("#restado-desc").removeClass("desc-est-rend-completa");
                $("#restado-desc").addClass("desc-est-rend-incompleta");
            }

        }

        function formatoNumero(x) {
            x = x.toFixed(2);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function rarmarTablaDetalle(lista) {

            let tabla = $("#rtblSolicitud").DataTable();

            tabla.destroy();
            var tr = "";

            lista.forEach((obj) => {

                tr += "<tr> "
                    + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                    + " <td class='ocultar-columna'> " + obj.secuencia + "</td>"
                    + " <td> " + obj.serieNumero + "</td>"
                    + " <td> " + obj.tipo + "</td>"
                    + " <td> " + obj.conceptoCab + "</td>"
                    + " <td> " + obj.conceptoDet + "</td>"
                    + " <td> " + obj.cantDias + "</td>"
                    + " <td> " + formatoNumero(obj.valor) + "</td>"
                    + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado) + "</td>"
                    + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalRendido) + "</td>"
                    + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado - obj.totalRendido) + "</td>"

                    + " <td class='text-center'>"
                    + "     <button data-idtipocomp = " + obj.idTipoComp + "  data-idrendcompte=" + obj.idRendCompte + " data-toggle='collapse' class='btn btn-sm btn-danger cImprimirPDF' " + (obj.idRendCompte == 0 ? " disabled " : " ") + "><i class='fas fa-file-pdf'></i></button>"
                    + "</td>"

                    + " <td class='text-center'>"
                    + "     <input type='checkbox' data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "' data-valor=" + obj.valor + " data-total=" + obj.total + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " class='seleccion ml-2' " + (obj.idEstadoDet == 6 ? " disabled " : " ") + ">"
                    + "</td>"

                    + "</tr>";
            });


            $("#rtblSolicitudContent").html(tr);

            $("#rtblSolicitud").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                });
        }


        $("#rbtnVerRegistrados").click(function () {

            if (rvalidacionVerCmptes()) {

                $.ajax({
                    url: "@Url.Action("RG_BuscarIdSolicitud", "Finanzas")",
                    data: {
                        idSolicitud: rsolicitudCabCreada.idSolicitud,
                    },
                    success: function (data) {
                        window.location.href = '@Url.Action("MapearReporteCXSPDF", "Finanzas")'
                    }
                });



                //$.ajax({
                //    url: "/finanzas/RG_ComprobantesRegistrados",
                //    type: "GET",
                //    data: { idSolicitud: rsolicitudCabCreada.idSolicitud },
                //    dataType: "json",
                //    success: function (resultado) {

                //        console.log("ver Registrados");
                //        console.log(resultado);

                //        if (resultado.isRedirect) {
                //            window.location.href = resultado.redirectUrl;
                //        }
                //        else {
                //            let itemList = "";
                //            let activoPrimero = true;
                //            let comprobanteCab = 0;

                //            $("#list-comprobantes").empty();

                //            resultado.lista.forEach((obj) => {
                //                itemList += "<a class='list-group-item list-group-item-action " + (activoPrimero ? " active " : " ") + "' data-toggle='list' role='tab' data-idrendcompte=" + obj.idRendCompte + ">" + obj.serieNumero + "</a>";

                //                if (activoPrimero) {
                //                    comprobanteCab = obj;
                //                }

                //                activoPrimero = false;
                //            });

                //            $("#list-comprobantes").html(itemList);

                //            rcargarComprobanteCabecera(comprobanteCab.idRendCompte);

                //            $("#editComprobModal").modal("show");
                //        }
                //    },
                //    error: function (xhr, ajaxOptions, thrownError) {

                //    }
                //});
            }
        });

        function rvalidacionVerCmptes() {
            var respuesta = false;

            let idSolicitud = rsolicitudCabCreada.idSolicitud;

            if (idSolicitud == null || typeof (idSolicitud) == "undefined") {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione una Solicitud por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }

            return respuesta;
        }

        $("#list-comprobantes").on("click", "a", function () {

            let idRendCompte = $(this).attr("data-idrendcompte");

            rcargarComprobanteCabecera(idRendCompte);

        });


        function rmensajePrincipal(estado, mensaje) {
            if (estado == true) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: mensaje
                });

            }
            else if (estado == false) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'error',
                    title: mensaje
                });

            }
        }

        $("#rtblDetalleContent").on("click", ".cImprimirPDF", function () {

            let idTipoComp = $(this).attr("data-idtipocomp");
            let idRendCompte = $(this).attr("data-idrendcompte");

            $.ajax({
                url: "@Url.Action("RG_BuscarIdCompte", "Finanzas")",
                data: {
                    idTipoComp: idTipoComp,
                    idRendCompte: idRendCompte
                },
                success: function (data) {

                    if (idTipoComp == 3) {
                        // Planilla de Movilidad
                        window.location.href = '@Url.Action("MapearReportePLPDF", "Finanzas")'
                    }
                    else if (idTipoComp == 4) {
                        // Declaración Jurada
                        window.location.href = '@Url.Action("MapearReporteDJPDF", "Finanzas")'
                    }

                }
            });

        });

        $("#rtblDetalleContent").on("click", ".cEditarCpte", function () {

            rdetalleArray = [];

            let idsolicitud = $(this).attr("data-idsolicitud");
            let secuencia = $(this).attr("data-secuencia");
            let valor = $(this).attr("data-valor");
            let totalRestante = $(this).attr("data-restante");
            let totalsolicitado = $(this).attr("data-totalsolicitado");

            rvIdRendCompte = $(this).attr("data-idrendcompte");

            rdetalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), totalrestante: parseFloat(totalsolicitado) });

            rTIPO_REGISTRO = "EDITAR";
            $("#rregComprobModal").modal("show");

            rcargarComprobanteCabecera(rvIdRendCompte);
        });


        $('#rtxtRucCompModal1').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            if (keycode == '13') {

                let ruc = $("#rtxtRucCompModal1").val().trim();

                if (ruc == "") {
                    Swal.fire({
                        title: 'Ingrese RUC',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            document.getElementById("rtxtRucCompModal1").focus = true;
                        }
                    });
                }
                else if (ruc.length < 7 || ruc.length > 15) {
                    Swal.fire({
                        title: 'Ingrese un número RUC valido por favor',
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            //document.getElementById("ridtxtcodigo").focus = true;
                        }
                    });
                }
                else {

                    MostrarCarga("Buscando...");


                    $.ajax({
                        url: "/finanzas/RG_SetrproveedorValidar",
                        type: "POST",
                        data: { 'opcion': '1', 'tipoPersona': 'J', 'ruc': ruc, 'rs': '', 'direccion': '' },
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                rproveedor = resultado.entidad;

                                if (resultado.entidad.idResponse == 0) {

                                    Swal.fire({
                                        title: '¿rproveedor no existe, desea crearlo?',
                                        text: "Textile Sourcing Company",
                                        icon: 'warning',
                                        showCancelButton: true,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: 'Si',
                                        cancelButtonText: 'No'
                                    }).then((result) => {
                                        if (result.value) {
                                            $("#rregComprobModal").modal("hide");
                                            $('#rproveedorModal').modal('show');
                                        }
                                    });
                                }
                                else {

                                    $("#rtxtRSCompModal1").val(resultado.entidad.danvar);
                                    $("#rtxtCodSofyaPCModal1").val(resultado.entidad.ctpava + "-" + resultado.entidad.canvar);

                                    rmensajePrincipal(true, "rproveedor correcto");
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }

            }
        });


        function rgetListaDetalle(pidSolicitud) {

            $.ajax({
                type: "GET",
                url: '/finanzas/RG_SolicitudDetReembolso',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idSolicitud: pidSolicitud },
                success: function (data) {

                    if (data.isRedirect) {
                        window.location.href = data.redirectUrl;
                    }
                    else {
                        rgenerarTablaDetalle(data.lista);
                    }
                },
                failure: function () {

                    Swal.fire({
                        icon: 'error',
                        title: 'Error al mostrar datos',
                        text: 'Textile Sourcing Company',
                        showConfirmButton: false,
                        timer: 2500,
                    });

                }
            });
        }

        function rgenerarTablaDetalle(lista) {

            let vTotal = 0;
            let tabla = $("#rtblDetalle").DataTable();
            tabla.destroy();
            var tr = "";
            let tr_btn_pdf = "";
            let tr_fin = "";

            // Nueva Lista

            lista.forEach((obj) => {

                vTotal = vTotal + (obj.totalcpte);

                tr += "<tr> "
                    + " <td class='ocultar-columna'> " + obj.idSolicitud + "</td> "
                    //+ " <td> " + obj.codigo + "</td> "
                    //+ " <td> " + obj.fecha + "</td>"

                    + " <td> " + obj.serieNumero + "</td>"
                    + " <td> " + obj.ceco + "</td> "
                    + " <td> " + obj.conceptoCab + "</td>"
                    //+ " <td> " + obj.conceptoDet + "</td> "

                    //+ " <td> " + obj.cantDias + "</td> "
                    //+ " <td> " + obj.simbolo + " " + formatoNumero(obj.valor) + "</td>"
                    //+ " <td> " + obj.simbolo + " " + formatoNumero(obj.total) + "</td>"
                    //+ " <td> " + obj.simbolo + " " + formatoNumero(obj.totalSolicitado - obj.totalRendido) + "</td>"

                    + " <td> " + obj.simbolo + " " + formatoNumero(obj.totalcpte) + "</td>"


                    + " <td class='text-center'>"
                    + "     <button data-idsolicitud=" + obj.idSolicitud + " data-secuencia=" + obj.secuencia + " data-idrendcompte=" + obj.idRendCompte + " class='btn btn-sm btn-danger cEliminarCpte'><i class='fas fa-trash'></i></button>"
                    + "</td>";

                    //+ " <td class='text-center'>"
                    //+ "     <button data-idrendcompte=" + obj.idRendCompte + "  data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "'  data-valor=" + obj.valor + " data-totalsolicitado = " + obj.totalSolicitado + " data-restante=" + (obj.totalSolicitado - obj.totalRendido) + " data-toggle='collapse' class='btn btn-sm btn-success cEditarCpte' " + ((obj.idRendCompte > 0) ? "  " : " disabled ") + "><i class='fas fa-edit'></i></button>"
                    //+ "</td>"


                if (obj.idTipoComp == 3 || obj.idTipoComp == 4) {

                    tr_btn_pdf =  " <td class='text-center'>"
                        + "     <button data-idtipocomp = " + obj.idTipoComp + "  data-idrendcompte=" + obj.idRendCompte + " data-toggle='collapse' class='btn btn-sm btn-danger cImprimirPDF' " + ((obj.idRendCompte == 0 || obj.idTipoComp == 1 || obj.idTipoComp == 2) ? " disabled " : " ") + "><i class='fas fa-file-pdf'></i></button>"
                        + "</td>";
                }
                else {
                    tr_btn_pdf = " <td class='text-center'></td> ";
                }

                tr = tr + tr_btn_pdf;

                tr = tr + + "</tr>";



                    //+ " <td class='text-center'>"
                    //+ "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-primary solicitudDetalleItem'><i class='fas fa-eye'></i></button>"
                    ////+ "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-success ml-1 solicitudEditarItem'" + (idEstado > 1 ? " disabled " : " ") + "><i class='fas fa-edit'></i></button>"
                    ////+ "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-danger ml-1 solicitudEliminarItem'" + (idEstado > 1 ? " disabled " : " ") + "><i class='fas fa-trash'></i></button>"
                    //+ " </td>"
                    //+ " <td class='text-center'>"
                    //+ "     <input type='checkbox' data-codceco='" + obj.codceco + "' data-ceco = '" + obj.ceco + "'  data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "' data-valor=" + obj.valor + " data-total=" + obj.total + "   data-restante=" + (obj.totalSolicitado - obj.totalRendido) + "  class='seleccion' " + (obj.idEstadoDet == 5 ? " disabled " : " ") + ">"
                    //+ "</td>"

            });


            $("#rkpi-cantidad").text(lista.length.toString());


            $("#rkpi-total").text(formatoNumero(vTotal).toString());

            $("#rtblDetalleContent").html(tr);

            $("#rtblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                }
            );
        }


        $("#rtblDetalleContent").on("click", ".cImprimirPDF", function () {

            let idTipoComp = $(this).attr("data-idtipocomp");
            let idRendCompte = $(this).attr("data-idrendcompte");

            $.ajax({
                url: "@Url.Action("RG_BuscarIdCompte", "Finanzas")",
                data: {
                    idTipoComp: idTipoComp,
                    idRendCompte: idRendCompte
                },
                success: function (data) {

                    if (idTipoComp == 3) {
                        // Planilla de Movilidad
                        window.location.href = '@Url.Action("MapearReportePLPDF", "Finanzas")'
                    }
                    else if (idTipoComp == 4) {
                        // Declaración Jurada
                        window.location.href = '@Url.Action("MapearReporteDJPDF", "Finanzas")'
                    }

                }
            });
        });

        $("#rtblDetalleContent").on("click", ".cEliminarCpte", function () {

            let idRendCompte = $(this).attr("data-idrendcompte");
            let idSolicitud = $(this).attr("data-idsolicitud");
            let secuencia = $(this).attr("data-secuencia");

            Swal.fire({
                title: '¿Desea Eliminar el Comprobante?',
                text:'Textile Sourcing Company',
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Ok'

            }).then((result) => {

                if (result.value) {

                    parametro = {
                        'opcion': 11,
                        'idRendCompte': idRendCompte,
                        'idTipoComp': 0,
                        'serieNumero': "",
                        'rucDNI': "",
                        'rs': "",
                        'codigoPC': "",
                        'obs': "",
                        'fechaEmision': "",
                        'codceco': 0,
                        'idTipoMod': 0,
                        'porcentajeIGV': 0,
                        'obs1': '',
                        'obs2': '',
                        'fecha1': '',
                        'periodo': "",
                        'solitudSeqArray': null,
                        'detalleComprobanteArray': null,
                        'idSolicitud' : idSolicitud,
                        'secuencia' : secuencia
                    };

                    $.ajax({
                        url: "/finanzas/RG_SetRendicionComprobante",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.entidad.idResponse > 0) {

                                    rvalidarrestadoSolicitud(2, rsolicitudCabCreada.idSolicitud);
                                    rgetListaDetalle(rsolicitudCabCreada.idSolicitud);

                                    rlimpiarControlModal(1);
                                    rlimpiarControlModal(2);
                                    rlimpiarControlModal(3);

                                    $("#rregComprobModal").modal("hide");

                                    rmensajePrincipal(true, resultado.entidad.statusResponse);
                                }
                                else {
                                    rmensajePrincipal(false, resultado.entidad.statusResponse);
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }

            });

        });


        $("#rbtnVerRegistrados").click(function () {

            if (rvalidacionVerCmptes()) {

                $.ajax({
                    url: "@Url.Action("RG_BuscarIdSolicitud", "Finanzas")",
                    data: {
                        idSolicitud: rsolicitudCabCreada.idSolicitud,
                    },
                    success: function (data) {
                        window.location.href = '@Url.Action("MapearReporteCXSPDF", "Finanzas")'
                    }
                });

            }
        });

        function rvalidacionVerCmptes() {
            var respuesta = false;

            let idSolicitud = rsolicitudCabCreada.idSolicitud;

            if (idSolicitud == null || typeof (idSolicitud) == "undefined") {
                respuesta = false;

                Swal.fire({
                    title: 'Seleccione una Solicitud por favor',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }
            else {
                respuesta = true;
            }

            return respuesta;
        }


        function rcargarComprobanteCabecera(pIdRendCompte) {

            $.ajax({
                url: "/finanzas/RG_ComprobateCabecera",
                type: "GET",
                data: { idRendCompte: pIdRendCompte },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {

                        rlistaComptesIdTipoComp = resultado.entidad.idTipoComp;

                        if (resultado.entidad.idTipoComp == 1 || resultado.entidad.idTipoComp == 2) {

                            // FACTURA Y BOLETA
                            $("#rfacturaboleta-tab").removeClass("disabled");
                            $("#rplanillamovilidad-tab").addClass("disabled");
                            $("#rdeclaracionjur-tab").addClass("disabled");

                            $("#rregComprobModal .nav-tabs #rfacturaboleta-tab").tab('show');

                            $("#rcbxTipoCpbteCompModal1").val(resultado.entidad.idTipoComp);
                            document.getElementById("rcbxTipoCpbteCompModal1").disabled = true;

                            //$("#txtSerieNumCompModal1").val(resultado.entidad.serieNumero);
                            $("#rtxtFechaModal1").val(resultado.entidad.fechaEmision);
                            $("#rcbxMonedaModal1").val(resultado.entidad.idTipoMod);
                            $("#rcbxPeriodoModal1").val(resultado.entidad.periodo);
                            $("#rtxtRucCompModal1").val(resultado.entidad.rucDNI);
                            $("#rtxtRSCompModal1").val(resultado.entidad.rs);
                            $("#rtxtCodSofyaPCModal1").val(resultado.entidad.codigoPC);
                            $("#rtxtObsCompModal1").val(resultado.entidad.obs);
                            $("#rtxtCeCoModal1").val(resultado.entidad.ceco);

                            $("#rkpiMontoSeleecionadoModal1").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalCmpbnteSolicitud - resultado.entidad.totalCmpbnte));


                            if (resultado.entidad.idTipoComp == 1) {
                                // Factura
                                $("#idimportetotal1").val(formatoNumero(resultado.entidad.totalCmpbnteBI));
                                $("#idigv1").val(formatoNumero(resultado.entidad.totalCmpbnteBI * (PORCENTAJE_IGV / 100)));
                                $("#idtotal1").val(formatoNumero(resultado.entidad.totalCmpbnte));
                            }
                            else if (resultado.entidad.idTipoComp == 2) {
                                // Boleta
                                $("#idimportetotal1").val(formatoNumero(resultado.entidad.totalCmpbnteBI));
                                $("#idigv1").val(formatoNumero(0));
                                $("#idtotal1").val(formatoNumero(resultado.entidad.totalCmpbnte));
                            }

                            $("#rcbxUM1").val("UN");
                            $("#rtxtDescripcion1").val("");
                            $("#txtCantidad1").val("");
                            $("#txtValorUnitarioTotal1").val("");

                            rcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);

                        }
                        else if (resultado.entidad.idTipoComp == 3) {

                            // PLANILLA DE MOVILIDADA
                            $("#rfacturaboleta-tab").addClass("disabled");
                            $("#rplanillamovilidad-tab").removeClass("disabled");
                            $("#rdeclaracionjur-tab").addClass("disabled");

                            $('#rregComprobModal .nav-tabs #rplanillamovilidad-tab').tab('show');

                            $("#rtxtFechaModal2").val(resultado.entidad.fechaEmision);
                            $("#txtNumPlanillaModal2").val(resultado.entidad.serieNumero);
                            $("#rcbxMonedaModal2").val(resultado.entidad.idTipoMod);
                            $("#rcbxPeriodoModal2").val(resultado.entidad.periodo);
                            $("#rtxtDNIModal2").val(resultado.entidad.rucDNI);
                            $("#rtxtApeNomModal2").val(resultado.entidad.rs);
                            $("#rtxtCeCoModal2").val(resultado.entidad.ceco);

                            $("#rkpiMontoSeleecionadoModal2").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalCmpbnteSolicitud - resultado.entidad.totalCmpbnte));

                            rcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);
                        }
                        else if (resultado.entidad.idTipoComp == 4) {

                            // DECLARACION JURADA.
                            $("#rfacturaboleta-tab").addClass("disabled");
                            $("#rplanillamovilidad-tab").addClass("disabled");
                            $("#rdeclaracionjur-tab").removeClass("disabled");

                            $('#rregComprobModal .nav-tabs #rdeclaracionjur-tab').tab('show');

                            $("#rtxtFechaModal3").val(resultado.entidad.fechaEmision);
                            $("#txtCodigoModal3").val(resultado.entidad.serieNumero);
                            $("#rcbxMonedaModal3").val(resultado.entidad.idTipoMod);
                            $("#rcbxPeriodoModal3").val(resultado.entidad.periodo);
                            $("#rtxtDNIModal3").val(resultado.entidad.rucDNI);
                            $("#rtxtApeNomModal3").val(resultado.entidad.rs);
                            $("#rtxtCeCoModal3").val(resultado.entidad.ceco);

                            $("#rkpiMontoSeleecionadoModal3").text(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.totalCmpbnteSolicitud - resultado.entidad.totalCmpbnte));

                            rcargarComprobanteDetalle(resultado.entidad.idRendCompte, resultado.entidad.idTipoComp);
                        }

                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });

        }

        function rcargarComprobanteDetalle(pIdRendCompte, pIdTipoComp) {

            $.ajax({
                url: "/finanzas/RG_ComprobateDetalle",
                type: "GET",
                data: { idRendCompte: pIdRendCompte },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {

                        if (pIdTipoComp == 1 || pIdTipoComp == 2) {

                            // FACTURA Y BOLETA

                            let tablaFB = $("#rtblFacturaBoleta").DataTable();

                            tablaFB.destroy();
                            var trFB = "";
                            rdetComprobanteArray1 = [];

                            resultado.lista.forEach((obj) => {

                                riDetalle1++;

                                rdetComprobanteArray1.push({
                                    iDetalle: riDetalle1,
                                    fecha: obj.fecha,
                                    detalle1: obj.detalle1,
                                    detalle2: "",
                                    codum: obj.codum,
                                    valorunit: obj.valorunit,
                                    cantidad: obj.cantidad,
                                    total: obj.total
                                });

                                trFB += "<tr> "
                                    + " <td> " + obj.um + "</td>"
                                    + " <td> " + obj.detalle1 + "</td>"
                                    + " <td> " + obj.cantidad + "</td>"
                                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                    + " <td> " + formatoNumero(obj.total) + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-iDetalle ='" + riDetalle1 + "' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            });


                            $("#rtblFacturaBoletaContent").html(trFB);

                            $("#rtblFacturaBoleta").DataTable(
                                {
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[3], [3]]
                                });

                        }
                        else if (pIdTipoComp == 3) {

                            // PLANILLA DE MOVILIDAD

                            let tablaPM = $("#rrtblPlanillaMovilidad").DataTable();

                            tablaPM.destroy();
                            var trPM = "";
                            rdetComprobanteArray2 = [];

                            resultado.lista.forEach((obj) => {

                                riDetalle2++;

                                rdetComprobanteArray2.push({
                                    iDetalle: riDetalle2,
                                    fecha: obj.fecha,
                                    detalle1: obj.detalle1,
                                    detalle2: obj.detalle2,
                                    codum: obj.codum, // UNIDAD
                                    valorunit: obj.valorunit,
                                    cantidad: obj.cantidad
                                });

                                trPM += "<tr> "
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.detalle1 + "</td>"
                                    + " <td> " + obj.detalle2 + "</td>"
                                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                    + " <td class='text-center'>"
                                    + "     <button data-idrendcomptedet='" + riDetalle2 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                                    + "</td>"
                                    + "</tr>";
                            });

                            $("#rrtblPlanillaMovilidadContent").html(trPM);

                            $("#rrtblPlanillaMovilidad").DataTable(
                                {
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[3], [3]]
                                });

                        }
                        else if (pIdTipoComp == 4) {

                            // DECLARACION JURADA

                            let tablaDJ_1 = $("#rtblDeclaracionJurada3_1").DataTable();
                            let tablaDJ_2 = $("#rtblDeclaracionJurada3_2").DataTable();

                            tablaDJ_1.destroy();
                            tablaDJ_2.destroy();

                            var trDJ_1 = "";
                            var trDJ_2 = "";

                            rdetComprobanteArray3 = [];


                            resultado.lista.forEach((obj) => {

                                riDetalle3++;

                                rdetComprobanteArray3.push({
                                    iDetalle: riDetalle3,
                                    fecha: obj.fecha,
                                    detalle1: obj.detalle1,
                                    detalle2: "",
                                    codum: obj.codum, // UNIDAD
                                    valorunit: obj.valorunit,
                                    cantidad: obj.cantidad,
                                    seccion: obj.seccion
                                });

                                if (obj.seccion == 1) {
                                    trDJ_1 += "<tr> "
                                        + " <td> " + obj.fecha + "</td>"
                                        + " <td> " + obj.detalle1 + "</td>"
                                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                        + " <td class='text-center'>"
                                        + "     <button data-idrendcomptedet='" + riDetalle3 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3 ml-1'><i class='fas fa-trash'></i></button>"
                                        + "</td>"
                                        + "</tr>";
                                }
                                else if (obj.seccion == 2) {
                                    trDJ_2 += "<tr> "
                                        + " <td> " + obj.fecha + "</td>"
                                        + " <td> " + obj.detalle1 + "</td>"
                                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                                        + " <td class='text-center'>"
                                        + "     <button data-idrendcomptedet='" + riDetalle3 + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3 ml-1'><i class='fas fa-trash'></i></button>"
                                        + "</td>"
                                        + "</tr>";
                                }

                            });

                            $("#tblDeclaracionJuradaContent3_1").html(trDJ_1);
                            $("#tblDeclaracionJuradaContent3_2").html(trDJ_2);

                            $("#rtblDeclaracionJurada3_1").DataTable(
                                {
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[5], [5]]
                                });

                            $("#rtblDeclaracionJurada3_2").DataTable(
                                {
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[5], [5]]
                                });
                        }
                    }

                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });
        }



    </script>

}


*