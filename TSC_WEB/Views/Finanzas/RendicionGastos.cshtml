@{
    ViewBag.Title = "Rendición de Gastos con Solicitud";
    ViewBag.Modulo = "Finanzas";
    Layout = "~/Views/Plantillas/_Layout.cshtml";
}


<div class="rendgas container-fluid">

    <div class="container-fluid card">

        <div class=" mt-3 ml-2 d-flex flex-row justify-content-between">
            <div>
                <button type="button" id="btnBuscarPendiente" class="btn btn-warning btn-sm">Buscar Pendientes</button>
            </div>
            <div class="indicador">
                <div class="row d-flex flex-row">
                    <div id="estado-icon"></div>
                    <h5 id="estado-desc"></h5>
                </div>
            </div>
        </div>

        <hr />

        <div class="row m-1">

            <div class="col-1 p-1">
                <label for="txtCodigo">Código:</label>
                <input class="form-control form-control-sm" id="txtCodigo" disabled>
            </div>
            <div class="col-1 p-1">
                <label for="txtFecha">Fecha</label>
                <input class="form-control form-control-sm" type="text" id="txtFecha" disabled>
            </div>
            <div class="col-3 p-1">
                <label for="txtUsuario">Usuario:</label>
                <input class="form-control form-control-sm" id="txtUsuario" disabled>
            </div>
            <div class="col-2 p-1">
                <label for="txtTipo">Tipo:</label>
                <input class="form-control form-control-sm" id="txtTipo" disabled>
            </div>
            <div class="col-5 p-1">
                <label for="txtCeCo">Centro de Costo:</label>
                <input class="form-control form-control-sm" id="txtCeCo" disabled>
            </div>


            <div class="col-5 p-1">
                <label for="txtColaborador">Colaborador</label>
                <input class="form-control form-control-sm" type="text" id="txtColaborador" disabled>
            </div>
            <div class="col-5 p-1">
                <label for="txtGlosa">Glosa Solicitud</label>
                <input class="form-control form-control-sm" type="text" id="txtGlosa" disabled>
            </div>

            <div class="col-2 p-1">
                <label for="txtTotalSol">Total:</label>
                <input class="form-control form-control-sm" type="text" id="txtTotalSol" disabled>
            </div>
        </div>


        <div>
            <hr />
        </div>

        <div class="container-fluid mt-2">
            <table class="table table-sm table-bordered table-hover display nowrap" id="tblSolicitud">
                <thead class="thead-light">
                    <tr>
                        <th class="ocultar-columna">idSolicitud</th>
                        <th>Secuencia</th>
                        <th>Estado Item</th>
                        <th>Tipo</th>
                        <th>Concepto</th>
                        <th>Detallle</th>

                        <th>Cant. Dias</th>
                        <th>Valor Unitario</th>
                        <th>Total</th>

                        <th>Seleccionar</th>
                    </tr>
                </thead>
                <tbody id="tblSolicitudContent"></tbody>
            </table>
        </div>

        <div>
            <hr />
        </div>

        <div class="container-fluid mb-2">
            <div class="row d-flex justify-content-end">
                <button type="button" id="btnRegistrarcomprobante" class="btn btn-primary btn-sm">Registrar Comprobante</button>
            </div>
        </div>


    </div>

</div>


<div class="modal fade" id="proveedorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Registro de Proveedor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-6">
                                <label for="txtTipoPersonaModal">Tipo Persona</label>
                                <select class="form-control form-control-sm" id="txtTipoPersonaModal" disabled>
                                    <option value="J" selected>Jurídica</option>
                                </select>
                            </div>

                            <div class="col-6">
                                <label for="txtPaisModal">Pais:</label>
                                <input type="text" class="form-control form-control-sm" id="txtPaisModal" value="Perú" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="txtRUCModal" class="col-form-label">RUC:</label>
                        <input type="text" class="form-control" id="txtRUCModal" maxlength="15">
                    </div>

                    <div class="form-group">
                        <label for="txtRSModal" class="col-form-label">Razon Social:</label>
                        <input type="text" class="form-control" id="txtRSModal" maxlength="140">
                    </div>

                    <div class="form-group">
                        <label for="txtDireccionModal" class="col-form-label">Dirección:</label>
                        <textarea class="form-control" id="txtDireccionModal" maxlength="340"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnRegistrarProveedor">Registrar</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="modalSolicitudesPendientes" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Solicitudes Pendientes de Rendición</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="contenedor-detalle">
                    <table class="table table-sm table-bordered table-hover display nowrap" id="tblDetallePendiente" style="width: 100%">
                        <thead class="thead-light">
                            <tr>
                                <th>Fecha</th>
                                <th>Codigo</th>
                                <th>Glosa</th>
                                <th>Total</th>
                                <th style="text-align: center">Seleccionar</th>
                            </tr>
                        </thead>
                        <tbody id="tblDetallePendienteContent"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="regComprobModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Registro de Comprobante</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <ul class="nav nav-tabs nav-justified md-tabs indigo" id="tabRendicionGastos" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active ctabRegComp" data-id="1" id="facturaboleta-just" data-toggle="tab" href="#sg-facturaboleta" role="tab" aria-controls="firma-just"
                           aria-selected="true">Factura / Boleta</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link ctabRegComp" data-id="2" id="planillamovilidad-tab" data-toggle="tab" href="#sg-planillamovilidad" role="tab" aria-controls="aprobadas-just"
                           aria-selected="false">Planilla de Movilidad</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link ctabRegComp" data-id="3" id="declaracionjur-tab" data-toggle="tab" href="#sg-declaracionjur" role="tab" aria-controls="aprobadas-just"
                           aria-selected="false">Declaración Jurada</a>
                    </li>
                </ul>


                <div class="tab-content card pt-1">

                    @*    **********************          FACTURA Y BOLETA        **********************  *@

                    <div class="tab-pane fade show active" id="sg-facturaboleta" role="tabpanel" aria-labelledby="facturaboleta-tab">

                        <div class="row m-2">

                            <div class="col-2 p-1">
                                <label for="cbxTipoCpbteCompModal1">Tipo Comprobante:</label>
                                <select class="form-control form-control-sm" id="cbxTipoCpbteCompModal1"></select>
                            </div>

                            <div class="col-3 p-1">
                                <label for="txtSerieNumCompModal1">N° Comprobante:</label>
                                <input id="txtSerieNumCompModal1" class="form-control form-control-sm" type="text" placeholder="N° Comprobante">
                            </div>

                            <div class="col-2 p-1">
                                <label for="txtFechaModal1">Fecha Emisión:</label>
                                <input class="form-control form-control-sm cfecha" type="date" id="txtFechaModal1">
                            </div>
                            <div class="col-2 p-1">
                                <label for="cbxMonedaModal1">Moneda:</label>
                                <select class="form-control form-control-sm" id="cbxMonedaModal1" disabled></select>
                            </div>

                            <div class="col-3 p-1 card kpi-modal-monto1">
                                <label for="kpiMontoSeleecionadoModal1">Monto Seleccionado</label>
                                <h6 id="kpiMontoSeleecionadoModal1">0</h6>
                            </div>


                            <div class="col-3 p-1">
                                <label for="txtRucCompModal1">RUC / N° DNI:</label>
                                <input id="txtRucCompModal1" class="form-control form-control-sm" type="text" maxlength="11" placeholder="Buscar N° RUC <Enter>">
                            </div>

                            <div class="col-7 p-1">
                                <label for="txtRSCompModal1">Razon Social:</label>
                                <input id="txtRSCompModal1" class="form-control form-control-sm" type="text" placeholder="Razon Social" disabled>
                            </div>

                            <div class="col-2 p-1">
                                <label for="txtCodSofyaPCModal1">Código Sofya</label>
                                <input id="txtCodSofyaPCModal1" class="form-control form-control-sm" type="text" placeholder="" disabled>
                            </div>


                            <div class="col-7 p-1">
                                <label for="txtObsCompModal1">Glosa:</label>
                                <input id="txtObsCompModal1" class="form-control form-control-sm" type="text">
                            </div>
                            <div class="col-5 p-1">
                                <label for="txtCeCoModal1">Centro de Costo:</label>
                                <input id="txtCeCoModal1" class="form-control form-control-sm" type="text" disabled>
                            </div>


                            <div class="card container-fluid mt-2" style="background-color: #F2F4F4">
                                <div class="row">

                                    <div class="col-2 p-1">
                                        <label for="cbxUM1">UM:</label>
                                        <select class="form-control form-control-sm" id="cbxUM1"></select>
                                    </div>
                                    <div class="col-4 p-1">
                                        <label for="txtDescripcion1">Descripción:</label>
                                        <input id="txtDescripcion1" class="form-control form-control-sm" type="text" maxlength="60" placeholder="">
                                    </div>
                                    <div class="col-2 p-1">
                                        <label for="txtCantidad1">Cantidad:</label>
                                        <input id="txtCantidad1" class="form-control form-control-sm" type="number">
                                    </div>
                                    <div class="col-2 p-1">
                                        <label for="txtValorUnitario1">Valor Unitario:</label>
                                        <input id="txtValorUnitario1" class="form-control form-control-sm" type="number">
                                    </div>

                                    <div class="col-2 p-1">
                                        <label for="btnAgregarMotivo1">Agregar:</label>
                                        <button type="button" style="width: 100%" class="btn btn-primary btn-sm" id="btnAgregarMotivo1">Agregar</button>
                                    </div>

                                </div>
                            </div>


                            <div class="container-fluid">

                                <table class="table table-sm table-bordered table-hover display nowrap mt-3" id="tblFacturaBoleta" style="width: 100%">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>UM</th>
                                            <th>Descripción</th>
                                            <th>Cantidad</th>
                                            <th>Precio Unit.</th>
                                            <th>Total</th>
                                            <th style="text-align: center">Eliminar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tblFacturaBoletaContent"></tbody>
                                </table>

                            </div>

                            <div class="card p-2 mt-2" style="width: 100%">
                                <div class="form-inline d-flex justify-content-around">
                                    <div class="form-group">
                                        <label for="idimportetotal1">Importe Total: </label>
                                        <input class="form-control form-control-sm ml-1" type="number" id="idimportetotal1" disabled>
                                    </div>

                                    <div class="form-group ml-4">
                                        <label for="idigv1">IGV: </label>
                                        <input class="form-control form-control-sm ml-1" type="number" id="idigv1" disabled>
                                    </div>

                                    <div class="form-group ml-4">
                                        <label for="idtotal1">Total: </label>
                                        <input class="form-control form-control-sm ml-1" type="number" id="idtotal1" disabled>
                                    </div>
                                </div>
                            </div>


                        </div>

                    </div>


                    @*    **********************          PLANILLA DE MOVILIDAD        **********************  *@

                    <div class="tab-pane fade" id="sg-planillamovilidad" role="tabpanel" aria-labelledby="planillamovilidad-tab">

                        <div class="row m-2">

                            <div class="col-3 p-1">
                                <label for="txtEmpresaModal2">Empresa:</label>
                                <input id="txtEmpresaModal2" class="form-control form-control-sm" type="text" placeholder="" value="Textile Sourcing Company SAC" disabled>
                            </div>
                            <div class="col-2 p-1">
                                <label for="txtFechaModal2">Fecha Emisión:</label>
                                <input class="form-control form-control-sm cfecha" type="date" id="txtFechaModal2">
                            </div>
                            <div class="col-2 p-1">
                                <label for="txtNumPlanillaModal2">N° Planilla:</label>
                                <input id="txtNumPlanillaModal2" class="form-control form-control-sm" type="text" maxlength="11" disabled>
                            </div>
                            <div class="col-2 p-1">
                                <label for="cbxMonedaModal2">Moneda:</label>
                                <select class="form-control form-control-sm" id="cbxMonedaModal2" disabled></select>
                            </div>
                            <div class="col-3 p-1 card kpi-modal-monto2">
                                <label for="kpiMontoSeleecionadoModal2">Monto Seleccionado</label>
                                <h6 id="kpiMontoSeleecionadoModal2">0</h6>
                            </div>


                            <div class="col-2 p-1">
                                <label for="txtDNIModal2">DNI:</label>
                                <input id="txtDNIModal2" class="form-control form-control-sm" type="text" placeholder="Buscar por DNI" maxlength="12" disabled>
                            </div>
                            <div class="col-5 p-1">
                                <label for="txtApeNomModal2">Apellidos y Nombres:</label>
                                <input id="txtApeNomModal2" class="form-control form-control-sm" type="text" disabled>
                            </div>
                            <div class="col-5 p-1">
                                <label for="txtCeCoModal2">Centro de Costo:</label>
                                <input id="txtCeCoModal2" class="form-control form-control-sm" type="text" maxlength="200" disabled>
                            </div>


                            <div class="card container-fluid mt-2" style="background-color: #F2F4F4">
                                <div class="row">

                                    <div class="col-4 p-1">
                                        <label for="txtOrgDstModal2">Origen / Destino:</label>
                                        <input id="txtOrgDstModal2" class="form-control form-control-sm" type="text" maxlength="120" placeholder="">
                                    </div>
                                    <div class="col-4 p-1">
                                        <label for="txtMotivoModal2">Motivo:</label>
                                        <input id="txtMotivoModal2" class="form-control form-control-sm" type="text" maxlength="120" placeholder="">
                                    </div>
                                    <div class="col-2 p-1">
                                        <label for="txtImporteModal2">Importe:</label>
                                        <input id="txtImporteModal2" class="form-control form-control-sm" type="number" maxlength="120" placeholder="">
                                    </div>

                                    <div class="col-2 p-1">
                                        <label for="btnAgregarMotivo2">Agregar:</label>
                                        <button type="button" style="width: 100%" class="btn btn-primary btn-sm" id="btnAgregarMotivo2">Agregar</button>
                                    </div>

                                </div>
                            </div>

                            <div class="container-fluid">

                                <table class="table table-sm table-bordered table-hover display nowrap mt-3" id="tblPlanillaMovilidad" style="width: 100%">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Origen / Destino:</th>
                                            <th>Motivo</th>
                                            <th>Importe</th>
                                            <th style="text-align: center">Eliminar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tblPlanillaMovilidadContent"></tbody>
                                </table>

                            </div>

                        </div>

                    </div>


                    @*    **********************          DECLARACION JURADA        **********************  *@

                    <div class="tab-pane fade" id="sg-declaracionjur" role="tabpanel" aria-labelledby="declaracionjur-tab">

                        <div class="row m-2">

                            <div class="col-3 p-1">
                                <label for="txtEmpresaModal3">Empresa:</label>
                                <input id="txtEmpresaModal3" class="form-control form-control-sm" type="text" placeholder="" value="Textile Sourcing Company SAC" disabled>
                            </div>
                            <div class="col-2 p-1">
                                <label for="txtFechaModal3">Fecha Emisión:</label>
                                <input id="txtFechaModal3" class="form-control form-control-sm cfecha" type="date">
                            </div>
                            <div class="col-2 p-1">
                                <label for="txtCodigoModal3">Codigo Correlativo:</label>
                                <input id="txtCodigoModal3" class="form-control form-control-sm" type="text" maxlength="15" disabled>
                            </div>
                            <div class="col-2 p-1">
                                <label for="cbxMonedaModal3">Moneda:</label>
                                <select class="form-control form-control-sm" id="cbxMonedaModal3" disabled></select>
                            </div>
                            <div class="col-3 p-1 card kpi-modal-monto3">
                                <label for="kpiMontoSeleecionadoModal3">Monto Seleccionado</label>
                                <h6 id="kpiMontoSeleecionadoModal3">0</h6>
                            </div>


                            <div class="col-2 p-1">
                                <label for="txtDNIModal3">DNI:</label>
                                <input id="txtDNIModal3" class="form-control form-control-sm" type="text" placeholder="Buscar por DNI" maxlength="12" disabled>
                            </div>
                            <div class="col-5 p-1">
                                <label for="txtApeNomModal3">Apellidos y Nombres:</label>
                                <input id="txtApeNomModal3" class="form-control form-control-sm" type="text" disabled>
                            </div>
                            <div class="col-5 p-1">
                                <label for="txtCeCoModal3">Centro de Costo:</label>
                                <input id="txtCeCoModal3" class="form-control form-control-sm" type="text" maxlength="200" disabled>
                            </div>


                            <div class="card container-fluid mt-2" style="background-color: #F2F4F4">
                                <div class="row">
                                    <div class="col-4 p-1">
                                        <label for="txtFechaModalDet3">Fecha:</label>
                                        <input id="txtFechaModalDet3" class="form-control form-control-sm cfecha" type="date">
                                    </div>
                                    <div class="col-4 p-1">
                                        <label for="txtMotivoModal3">Motivo:</label>
                                        <input id="txtMotivoModal3" class="form-control form-control-sm" type="text" maxlength="120" placeholder="">
                                    </div>
                                    <div class="col-2 p-1">
                                        <label for="txtImporteModal3">Importe:</label>
                                        <input id="txtImporteModal3" class="form-control form-control-sm" type="number" maxlength="120" placeholder="">
                                    </div>
                                    <div class="col-2 p-1">
                                        <label for="btnAgregarMotivo3">Agregar:</label>
                                        <button type="button" style="width: 100%" class="btn btn-primary btn-sm" id="btnAgregarMotivo3">Agregar</button>
                                    </div>
                                </div>
                            </div>


                            <div class="container-fluid">

                                <table class="table table-sm table-bordered table-hover display nowrap mt-3" id="tblDeclaracionJurada" style="width: 100%">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Motivo</th>
                                            <th>Importe</th>
                                            <th style="text-align: center">Eliminar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tblDeclaracionJuradaContent"></tbody>
                                </table>

                            </div>

                        </div>

                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarComprobante">Guardar</button>
            </div>
        </div>
    </div>
</div>


<style>


    .rendgas label {
        font-family: 'Roboto', sans-serif;
    }

    .rendgas input, select, span, label {
        font-family: 'Roboto', sans-serif;
    }

    .rendgas table .ocultar-columna {
        display: none;
    }

    .rendgas #estado-desc {
        margin-right: 8px;
    }

    #regComprobModal .kpi-modal-monto1 {
        text-align: center;
    }

    #regComprobModal .kpi-modal-monto2 {
        text-align: center;
    }

    #regComprobModal .kpi-modal-monto3 {
        text-align: center;
    }



    .rendgas .icon-pendiente::after {
        content: url(../../../../Public/icon-pend.png);
    }

    .rendgas .icon-liberado::after {
        content: url(../../../../Public/icon-libe.png);
    }

    .rendgas .icon-aprobado::after {
        content: url(../../../../Public/icon-apro.png);
    }

    .rendgas .icon-rechazado::after {
        content: url(../../../../Public/icon-rech.png);
    }

    .rendgas .icon-rend-completa::after {
        content: url(../../../../Public/icon-apro.png);
    }

    .rendgas .icon-rend-incompleta::after {
        content: url(../../../../Public/icon-libe.png);
    }



    .rendgas .desc-est-pendiente {
        color: #616A6B;
    }

    .rendgas .desc-est-liberado {
        color: #F1C40F;
    }

    .rendgas .desc-est-aprobado {
        color: #28B463;
    }

    .rendgas .desc-est-rechazado {
        color: #C0392B;
    }

    .rendgas .desc-est-rend-completa {
        color: #28B463;
    }

    .rendgas .desc-est-rend-incompleta {
        color: #F1C40F;
    }


    @@media (min-width: 320px) and (max-width: 479.98px) {
    }

    @@media (min-width: 480px) and (max-width: 767.98px) {
    }

    @@media (min-width: 768px) and (max-width: 991.98px) {
    }

    @@media (min-width: 992px) and (max-width: 1199.98px) {
    }

    @@media (min-width: 1200px) {
    }
</style>


@section scripts {
    <script>

        const USUARIO = "@Request.RequestContext.HttpContext.Session["usuario"]";
        const USUARIO_COMPLETO = "@Request.RequestContext.HttpContext.Session["usuario"]" + " - " + "@Request.RequestContext.HttpContext.Session["nombre"]";

        var solicitudSeleccionada = {};
        var vIdSolicitud = 0;
        var vCeCo = 0;
        var iDetalle1 = 0;
        var iDetalle2 = 0;
        var iDetalle3 = 0;

        var proveedor = {};
        var detalleArray = [];
        var detalleArray3 = [];
        var detPlaMov = {};

        var detComprobanteArray1 = [];
        var detComprobanteArray2 = [];
        var detComprobanteArray3 = [];

        var tabSeleccionado = 1; // 1: Factura y Boleta, 2: Planilla Movilidad, 3: Planilla de Movilidada

        $(document).ready(function () {

            Inicializar();

            function Inicializar() {

                getTipoComprobantes();
                getTipoMoneda();
                getUnidadesMedida();

                $("#regComprobModal .kpi-modal-monto1").css("background-color", "#D5F5E3");
                $("#regComprobModal .kpi-modal-monto2").css("background-color", "#D5F5E3");
                $("#regComprobModal .kpi-modal-monto3").css("background-color", "#D5F5E3");

                $("#txtCodigoModal3").val("0");
                $("#txtNumPlanillaModal2").val("0");

            }

            function mensajePrincipal(estado, mensaje) {
                if (estado == true) {

                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2500,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })

                    Toast.fire({
                        icon: 'success',
                        title: mensaje
                    });

                }
                else if (estado == false) {

                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2500,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })

                    Toast.fire({
                        icon: 'error',
                        title: mensaje
                    });

                }
            }

            function getTipoMoneda() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_TiposDeMoneda',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $("#cbxMonedaModal1").empty();
                        $("#cbxMonedaModal2").empty();
                        $("#cbxMonedaModal3").empty();

                        $.each(data.lista, function () {
                            $("#cbxMonedaModal1").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                        });
                        $.each(data.lista, function () {
                            $("#cbxMonedaModal2").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                        });
                        $.each(data.lista, function () {
                            $("#cbxMonedaModal3").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                        });

                        $("#cbxMonedaModal1").val(0);
                        $("#cbxMonedaModal2").val(0);
                        $("#cbxMonedaModal3").val(0);
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getUnidadesMedida() {

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_UnidadesMedida',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $("#cbxUM1").empty();

                        $.each(data.lista, function () {
                            $("#cbxUM1").append($("<option/>").val(this.codum).text(this.um));
                        });

                        $("#cbxUM1").val("0");
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });

            }

            function getTipoComprobantes() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_TipoComprobantes',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $("#cbxTipoCpbteCompModal1").empty();
                        $.each(data.lista, function () {
                            $("#cbxTipoCpbteCompModal1").append($("<option/>").val(this.idTipoComp).text(this.tipoComprobante));
                        });
                        $("#cbxTipoCpbteCompModal1").val(0);
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function validacionRegistro() {
                var respuesta = false;

                if ($("#txtRUCModal").val().trim() == "") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese un código de RUC',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'

                    });
                }
                else if ($("#txtRSModal").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese Razon Social',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }

                return respuesta;
            }


            $('#txtRucCompModal1').keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);

                if (keycode == '13') {

                    let ruc = $("#txtRucCompModal1").val().trim();

                    if (ruc == "") {
                        Swal.fire({
                            title: 'Ingrese RUC',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'Cancel',
                            focusConfirm: true
                        }).then(result => {
                            if (result.value) {
                                document.getElementById("txtRucCompModal1").focus();
                            }
                        });
                    }
                    else if (ruc.length < 7 || ruc.length > 15) {
                        Swal.fire({
                            title: 'Ingrese un número RUC valido por favor',
                            icon: 'warning',
                            showConfirmButton: true,
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'Cancel',
                            focusConfirm: true
                        }).then(result => {
                            if (result.value) {
                                //document.getElementById("idtxtcodigo").focus();
                            }
                        });
                    }
                    else {

                        MostrarCarga("Buscando...");


                        $.ajax({
                            url: "/finanzas/RG_SetProveedorValidar",
                            type: "POST",
                            data: { 'opcion': '1', 'tipoPersona': 'J', 'ruc': ruc, 'rs': '', 'direccion': '' },
                            dataType: "json",
                            success: function (resultado) {

                                if (resultado.isRedirect) {
                                    window.location.href = resultado.redirectUrl;
                                }
                                else {
                                    proveedor = resultado.entidad;

                                    if (resultado.entidad.idResponse == 0) {

                                        Swal.fire({
                                            title: '¿Proveedor no existe, desea crearlo?',
                                            text: "Textile Sourcing Company",
                                            icon: 'warning',
                                            showCancelButton: true,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'Si',
                                            cancelButtonText: 'No'
                                        }).then((result) => {
                                            if (result.value) {
                                                $("#regComprobModal").modal("hide");
                                                $('#proveedorModal').modal('show');
                                            }
                                        });
                                    }
                                    else {

                                        $("#txtRSCompModal1").val(resultado.entidad.danvar);
                                        $("#txtCodSofyaPCModal1").val(resultado.entidad.ctpava + "-" + resultado.entidad.canvar);

                                        mensajePrincipal(true, "Proveedor correcto");
                                    }
                                }
                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                            }
                        });

                    }

                }
            });

            $("#btnRegistrarProveedor").click(function () {

                if (validacionRegistro()) {

                    MostrarCarga("Guardando...");

                    $.ajax({
                        url: "/finanzas/RG_SetProveedorRegistrar",
                        type: "POST",
                        data: {
                            'opcion': '2',
                            'tipoPersona': 'J',
                            'ruc': $("#txtRUCModal").val(),
                            'rs': $("#txtRSModal").val(),
                            'direccion': $("#txtDireccionModal").val()
                        },
                        dataType: "json",
                        success: function (resultado) {

                            proveedor = resultado.entidad;

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {

                                if (resultado.entidad.idResponse == 1) {
                                    mensajePrincipal(true, resultado.entidad.statusResponse);
                                }
                                else {
                                    mensajePrincipal(false, resultado.entidad.statusResponse);
                                }
                            }

                            $("#txtRucCompModal1").val(proveedor.creguc);
                            $("#txtRSCompModal1").val(proveedor.danvar);
                            $("#txtCodSofyaPCModal1").val(proveedor.ctpava + "-" + proveedor.canvar);

                            $('#proveedorModal').modal('hide');
                            $("#regComprobModal").modal("show");

                            document.getElementById("txtMontoCompModal1").focus();

                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }
            });

            $("#btnBuscarPendiente").click(function () {

                $.ajax({
                    type: "GET",
                    url: '/finanzas/RG_PendientesRendicion',
                    contentType: "application/json; charset=utf-8",
                   // data: { nivelInterfaz: nivelInterfaz },
                    dataType: "json",
                    success: function (data) {

                        let tabla = $("#tblDetallePendiente").DataTable();

                        tabla.destroy();
                        var tr = "";

                        data.lista.forEach((obj) => {

                            tr += "<tr> "
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.codigo + "</td>"
                                + " <td> " + obj.glosa + "</td>"
                                + " <td> " + obj.total + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-codigo='" + obj.codigo + "' data-toggle='collapse' class='btn btn-sm btn-outline-secondary cseleccionar ml-1'><i class='fas fa-check'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });

                        $("#tblDetallePendienteContent").html(tr);


                        $("#tblDetallePendiente").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                            });

                    },
                    failure: function () {
                        console.error('error al cargar los periodos');
                    }
                });


                $('#modalSolicitudesPendientes').modal('show');

            });

            $("#tblDetallePendiente").on('click', '.cseleccionar', function () {
                // Modal Detalle, selecciona la solicitud.

                let codigo = $(this).attr("data-codigo");

                $.ajax({
                    url: "/finanzas/RG_SolBusquedaXCod",
                    type: "GET",
                    data: { 'codigo': codigo },
                    dataType: "json",
                    success: function (resultado) {

                        console.log(resultado.entidad);

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            if (resultado.entidad.idSolicitud > 0) {

                                solicitudSeleccionada = resultado.entidad;

                                $("#txtFecha").val(resultado.entidad.fecha);
                                $("#txtUsuario").val(USUARIO_COMPLETO);
                                $("#txtTipo").val(resultado.entidad.tipo);
                                $("#txtGlosa").val(resultado.entidad.observacion);
                                $("#txtCeCo").val(resultado.entidad.ceco);
                                $("#txtCodigo").val(resultado.entidad.codigo);
                                $("#txtColaborador").val(resultado.entidad.colaborador);
                                $("#txtTotalSol").val(resultado.entidad.simbolo + " " + formatoNumero(resultado.entidad.total));

                                $("#estado-desc").text(resultado.entidad.estado);

                                $("#txtCeCoModal2").val(resultado.entidad.ceco);
                                $("#txtCeCoModal3").val(resultado.entidad.ceco);
                                $("#txtDNIModal2").val(resultado.entidad.canvar_bnf);
                                $("#txtDNIModal3").val(resultado.entidad.canvar_bnf);
                                $("#txtApeNomModal2").val(resultado.entidad.colaborador);
                                $("#txtApeNomModal3").val(resultado.entidad.colaborador);

                                mensajePrincipal(true, "Mostrando Solicitud");

                                armarTablaDetalle(resultado.entidad.listaDetalle);
                                indicadorEstado(resultado.entidad.idEstado);

                                $('#modalSolicitudesPendientes').modal('hide');
                            }
                            else {
                                mensajePrincipal(false, "Solicitud no encontrada");
                            }
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });
            });

            $("#tblSolicitud").on('click', '.seleccion', function () {

                let idsolicitud = $(this).attr("data-idsolicitud");
                let secuencia = $(this).attr("data-secuencia");
                let valor = $(this).attr("data-valor");
                let total = $(this).attr("data-total");

                if ($(this).prop("checked")) {

                    detalleArray.push({ idsolicitud: idsolicitud, secuencia: secuencia, valor: parseFloat(valor), total: parseFloat(total) });

                } else {

                    for (var i = 0; i < detalleArray.length; i++) {
                        if (detalleArray[i].idsolicitud == idsolicitud && detalleArray[i].secuencia == secuencia) {
                            detalleArray.splice(i, 1);
                        }
                    }
                }
            });

            $("#btnRegistrarcomprobante").click(function () {
                if (detalleArray.length > 0) {
                    let valorTotalSeleccionado = 0;

                    $("#txtCeCoModal1").val($("#txtCeCo").val());
                    $("#txtCeCoModal2").val($("#txtCeCo").val());

                    for (var i = 0; i < detalleArray.length; i++) {
                        valorTotalSeleccionado = valorTotalSeleccionado + detalleArray[i].total;
                    }

                    $("#kpiMontoSeleecionadoModal1").text(solicitudSeleccionada.simbolo + " " + formatoNumero(valorTotalSeleccionado));
                    $("#kpiMontoSeleecionadoModal2").text(solicitudSeleccionada.simbolo + " " + formatoNumero(valorTotalSeleccionado));
                    $("#kpiMontoSeleecionadoModal3").text(solicitudSeleccionada.simbolo + " " + formatoNumero(valorTotalSeleccionado));

                    $("#regComprobModal").modal("show");
                }
                else {
                    Swal.fire({
                        title: 'Seleccione el detalle de la Solicitud para le registro de Comprobante',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
            });

            $("#btnGuardarComprobante").click(function () {

                if (validacionGuardarComp(tabSeleccionado)) {

                    let parametro = {};

                    // 1. Facturas / Boletas
                    if (tabSeleccionado == 1) {

                        parametro = {
                            'opcion': 1,
                            'idRendCompte': 0,
                            'idTipoComp': parseInt($("#cbxTipoCpbteCompModal1").val()),
                            'serieNumero': $("#txtSerieNumCompModal1").val(),
                            'rucDNI': $("#txtRucCompModal1").val(),
                            'rs': $("#txtRSCompModal1").val(),
                            'codigoPC': $("#txtCodSofyaPCModal1").val(),
                            'monto': $("#txtMontoCompModal1").val(),
                            'obs': $("#txtObsCompModal1").val(),
                            'fechaEmision': $("#txtFechaModal1").val(),
                            'codceco': solicitudSeleccionada.codceco,
                            'idTipoMod': parseInt("#cbxMonedaModal1"),

                            'solitudSeqArray': detalleArray,
                            'detalleComprobanteArray': detComprobanteArray1
                        };

                    }
                    else if (tabSeleccionado == 2) {

                        // 2. Planilla de Movilidad
                        parametro = {
                            'opcion': 1,
                            'idRendCompte': 0,
                            'idTipoComp': 3,
                            'serieNumero': "",
                            'rucDNI': $("#txtDNIModal2").val(),
                            'rs': $("#txtApeNomModal2").val(),
                            'codigoPC': $("#txtDNIModal2").val(),
                            'obs': $("#txtNumPlanillaModal2").val(),
                            'fechaEmision': $("#txtFechaModal2").val(),
                            'codceco': solicitudSeleccionada.codceco,
                            'idTipoMod': parseInt("#cbxMonedaModal2"),

                            'solitudSeqArray': detalleArray,
                            'detalleComprobanteArray': detComprobanteArray2
                        };
                    }
                    else if (tabSeleccionado == 3) {

                        // 2. Declaracion Jurada
                        parametro = {
                            'opcion': 1,
                            'idRendCompte': 0,
                            'idTipoComp': 4,
                            'serieNumero': "",
                            'rucDNI': $("#txtDNIModal3").val(),
                            'rs': $("#txtApeNomModal3").val(),
                            'codigoPC': $("#txtDNIModal3").val(),
                            'obs': "",
                            'fechaEmision': $("#txtFechaModal3").val(),
                            'codceco': solicitudSeleccionada.codceco,
                            'idTipoMod': parseInt("#cbxMonedaModal3"),

                            'solitudSeqArray': detalleArray,
                            'detalleComprobanteArray': detComprobanteArray3
                        };
                    }


                    $.ajax({
                        url: "/finanzas/RG_SetRendicionComprobante",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {
                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.entidad.idResponse > 0) {

                                    indicadorEstado(resultado.entidad.idEstado);

                                    detalleArray = [];
                                    detComprobanteArray = [];

                                    actualizarLista($("#txtCodigo").val());
                                    validarEstadoSolicitud();
                                    limpiarControlModal(tabSeleccionado);

                                    $("#regComprobModal").modal("hide");
                                }
                                else {
                                    mensajePrincipal(false, "Ocurrio un problema");

                                    console.log(resultado.entidad.statusResponse);
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }
            });


            function actualizarLista(codigo) {
                $.ajax({
                    url: "/finanzas/RG_SolicitudDetalleRendicion",
                    type: "GET",
                    data: { codigo: codigo},
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            armarTablaDetalle(resultado.lista);
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });
            }

            function validarEstadoSolicitud() {

                $.ajax({
                    url: "/finanzas/RG_EstadoSolicitudRendGast",
                    type: "GET",
                    data: { idSolicitud: solicitudSeleccionada.idSolicitud },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            indicadorEstado(resultado.entidad.idEstado);
                            $("#estado-desc").text(resultado.entidad.estado);
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });
            }

            function validacionGuardarComp(indexTab) {
                var respuesta = false;

                // Registro de Factura y Boleta

                if (indexTab == 1) {

                    if ($("#cbxTipoCpbteCompModal1").val().trim() == "0") {
                        respuesta = false;

                        Swal.fire({
                            title: 'Seleccione un Tipo de Comprobante',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else if ($("#txtSerieNumCompModal1").val().trim() == "") {
                        respuesta = false;

                        Swal.fire({
                            title: 'Ingrese un numero y serie',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else if ($("#txtRucCompModal1").val().trim() == "") {
                        respuesta = false;

                        Swal.fire({
                            title: 'Ingrese el número de RUC / DNI',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else if ($("#txtCodSofyaPCModal1").val().trim() == "") {
                        respuesta = false;

                        Swal.fire({
                            title: 'El proveedor debe estar registrado en Sofya para continuar',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else if (detComprobanteArray1.length == 0) {
                        respuesta = false;

                        Swal.fire({
                            title: 'Debe agregar el detalle del comprobante',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }
                if (indexTab == 2) {

                    // Planilla de Movilidad
                    if ($("#txtDNIModal2").val().trim() == "") {
                        respuesta = false;

                        Swal.fire({
                            title: 'No se encuentra el colaborador',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else if (detComprobanteArray2.length == 0) {
                        respuesta = false;

                        Swal.fire({
                            title: 'Debe agregar el detalle de Planilla de Movilidad',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }
                else if (indexTab == 3) {

                    // Planilla de Movilidad
                    if ($("#cbxMonedaModal3").val().trim() == "0") {
                        respuesta = false;

                        Swal.fire({
                            title: 'Ingrese el tipo de Moneda',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });

                    }
                    else if ($("#txtDNIModal3").val().trim() == "") {
                        respuesta = false;

                        Swal.fire({
                            title: 'Ingrese el número de DNI por favor',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else if (detComprobanteArray3.length == 0) {
                        respuesta = false;

                        Swal.fire({
                            title: 'Debe agregar el detalle de la Declaración Jurada',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Ok'
                        });
                    }
                    else {
                        respuesta = true;
                    }
                }


                return respuesta;
            }

        });


        $('#proveedorModal').on('shown.bs.modal', function (e) {
            let rucIngresado = $("#txtRucCompModal1").val();

            $("#txtRUCModal").val(rucIngresado);
            document.getElementById("txtRSModal").focus();
        });

        $('#proveedorModal').on('hidden.bs.modal', function (e) {
            $("#txtRUCModal").val("");
            $("#txtRSModal").val("");
            $("#txtDireccionModal").val("");
        });

        $('#txtDNIModal2').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            if (keycode == '13') {
                let dni = $("#txtDNIModal2").val().trim();
                busquedaXDNI(dni, tabSeleccionado)
            }
        });

        $('#txtDNIModal3').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            if (keycode == '13') {
                let dni = $("#txtDNIModal3").val().trim();
                busquedaXDNI(dni, tabSeleccionado)
            }
        });

        $('#modalSolDetInsertar').on('hidden.bs.modal', function (e) {
            $("#txtRUCModal").val("");
            $("#txtRSModal").val("");
            $("#txtDireccionModal").val("");
        });


        $("#tblFacturaBoleta").on("click", ".cselectEliminar1", function () {

            let vIDetalle = $(this).attr("data-idetalle");

            for (var i = 0; i < detComprobanteArray1.length; i++) {
                if (detComprobanteArray1[i].iDetalle == parseInt(vIDetalle)) {
                    detComprobanteArray1.splice(i, 1);
                }
            }

            const sumDetalleSol = detalleArray.reduce((acc, item) => {
                return acc += item.total
            }, 0);

            const sumAgregadosDet = detComprobanteArray1.reduce((acc, item) => {
                return acc += (item.valorunit * item.cantidad);
            }, 0);

            $("#kpiMontoSeleecionadoModal1").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#regComprobModal .kpi-modal-monto1").css("background-color", "#FADBD8");
            }
            else {
                $("#regComprobModal .kpi-modal-monto1").css("background-color", "#D5F5E3");
            }

            let tabla = $("#tblFacturaBoleta").DataTable();

            tabla.destroy();
            var tr = "";

            detComprobanteArray1.forEach((obj) => {

                tr += "<tr> "
                    + " <td> " + obj.um + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + obj.cantidad + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td> " + formatoNumero(obj.cantidad * obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });


            $("#tblFacturaBoletaContent").html(tr);

            $("#tblFacturaBoleta").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5], [5]]
                });

            $("#cbxUM1").val("0");
            $("#txtDescripcion1").val("");
            $("#txtCantidad1").val("0");
            $("#txtValorUnitario1").val("0");

            document.getElementById("cbxUM1").focus();

            $("#kpiMontoSeleecionadoModal1").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

        });

        $("#tblPlanillaMovilidad").on("click", ".cselectEliminar2", function () {
            let vIDetalle = $(this).attr("data-iDetalle");

            for (var i = 0; i < detComprobanteArray2.length; i++) {
                if (detComprobanteArray2[i].iDetalle == parseInt(vIDetalle)) {
                    detComprobanteArray2.splice(i, 1);
                }
            }

            const sumDetalleSol = detalleArray.reduce((acc, item) => {
                return acc += item.total
            }, 0);

            const sumAgregadosDet = detComprobanteArray2.reduce((acc, item) => {
                return acc += item.valorunit;
            }, 0);

            $("#kpiMontoSeleecionadoModal2").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#regComprobModal .kpi-modal-monto2").css("background-color", "#FADBD8");
            }
            else {
                $("#regComprobModal .kpi-modal-monto2").css("background-color", "#D5F5E3");
            }

            let tabla = $("#tblPlanillaMovilidad").DataTable();

            tabla.destroy();
            var tr = "";

            detComprobanteArray.forEach((obj) => {

                tr += "<tr> "
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + obj.detalle2 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });

            $("#tblPlanillaMovilidadContent").html(tr);

            $("#tblPlanillaMovilidad").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                });

            $("#txtOrgDstModal2").val("");
            $("#txtMotivoModal2").val("");
            $("#txtImporteModal2").val("0");

            document.getElementById("txtOrgDstModal2").focus();
        });

        $("#tblDeclaracionJurada").on("click", ".cselectEliminar3", function () {
            let vIDetalle = $(this).attr("data-idetalle");

            for (var i = 0; i < detComprobanteArray3.length; i++) {
                if (detComprobanteArray3[i].iDetalle == parseInt(vIDetalle)) {
                    detComprobanteArray3.splice(i, 1);
                }
            }

            const sumDetalleSol = detalleArray.reduce((acc, item) => {
                return acc += item.total
            }, 0);

            const sumAgregadosDet = detComprobanteArray3.reduce((acc, item) => {
                return acc += item.valorunit;
            }, 0);

            $("#kpiMontoSeleecionadoModal3").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - sumAgregadosDet));

            if ((sumDetalleSol - sumAgregadosDet) < 0) {
                $("#regComprobModal .kpi-modal-monto3").css("background-color", "#FADBD8");
            }
            else {
                $("#regComprobModal .kpi-modal-monto3").css("background-color", "#D5F5E3");
            }

            let tabla = $("#tblDeclaracionJurada").DataTable();

            tabla.destroy();
            var tr = "";


            detComprobanteArray3.forEach((obj) => {

                tr += "<tr> "
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.detalle1 + "</td>"
                    + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                    + " <td class='text-center'>"
                    + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3 ml-1'><i class='fas fa-trash'></i></button>"
                    + "</td>"
                    + "</tr>";
            });

            $("#tblDeclaracionJuradaContent").html(tr);

            $("#tblDeclaracionJurada").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5], [5]]
                });

            $("#txtMotivoModal3").val("");
            $("#txtImporteModal3").val("0");

            document.getElementById("txtFechaModalDet3").focus();
        });


        $("#btnAgregarMotivo1").click(function () {

            if (validacionDetCmpbte(tabSeleccionado)) {

                let cantidad = parseFloat($("#txtCantidad1").val());
                let valorunit = parseFloat($("#txtValorUnitario1").val());
                let total = cantidad * valorunit;

                const sumDetalleSol = detalleArray.reduce((acc, item) => {
                    return acc += item.total
                }, 0);

                const sumAgregadosDet = detComprobanteArray1.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + total)) < 0) {
                    $("#regComprobModal .kpi-modal-monto1").css("background-color", "#FADBD8");
                }
                else {
                    $("#regComprobModal .kpi-modal-monto1").css("background-color", "#D5F5E3");
                }

                iDetalle1++;

                var d = new Date(), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();
                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                detComprobanteArray1.push({
                    iDetalle: iDetalle1,
                    fecha: [year, month, day].join('/'),
                    detalle1: $("#txtDescripcion1").val(),
                    detalle2: "",
                    codum: $("#cbxUM1").val(),
                    valorunit: valorunit,
                    cantidad: cantidad
                });


                const importeTotal = detComprobanteArray1.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                // FACTURA
                if ($("#cbxTipoCpbteCompModal1").val().trim() == "1") {
                    $("#idimportetotal1").val(formatoNumero(importeTotal));
                    $("#idigv1").val(formatoNumero(importeTotal * 0.18));
                    $("#idtotal1").val(formatoNumero(importeTotal + (importeTotal * 0.18)));
                }
                else if ($("#cbxTipoCpbteCompModal1").val().trim() == "2") {
                    // BOLETA
                    $("#idimportetotal1").val(formatoNumero(importeTotal));
                    $("#idigv1").val(0);
                    $("#idtotal1").val(formatoNumero(importeTotal));
                }


                let tabla = $("#tblFacturaBoleta").DataTable();

                tabla.destroy();
                var tr = "";


                detComprobanteArray1.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> " + obj.codum + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + obj.cantidad + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td> " + formatoNumero(obj.cantidad * obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar1 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#tblFacturaBoletaContent").html(tr);

                $("#tblFacturaBoleta").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    });

                $("#cbxUM1").val("0");
                $("#txtDescripcion1").val("");
                $("#txtCantidad1").val("0");
                $("#txtValorUnitario1").val("0");

                document.getElementById("cbxTipoCpbteCompModal1").disabled = true;

                document.getElementById("cbxUM1").focus();

                $("#kpiMontoSeleecionadoModal1").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + total)));

            }

        });

        $("#btnAgregarMotivo2").click(function () {

            if (validacionDetCmpbte(tabSeleccionado)) {

                let importeIngresado = parseFloat($("#txtImporteModal2").val());

                const sumDetalleSol = detalleArray.reduce((acc, item) => {
                    return acc += item.total
                }, 0);

                const sumAgregadosDet = detComprobanteArray2.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                    $("#regComprobModal .kpi-modal-monto2").css("background-color", "#FADBD8");
                }
                else {
                    $("#regComprobModal .kpi-modal-monto2").css("background-color", "#D5F5E3");
                }

                iDetalle2++;

                var d = new Date(), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();
                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                detComprobanteArray2.push({
                    iDetalle: iDetalle2,
                    fecha: [year, month, day].join('/'),
                    detalle1: $("#txtOrgDstModal2").val(),
                    detalle2: $("#txtMotivoModal2").val(),
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#txtImporteModal2").val()),
                    cantidad: 1
                });


                let tabla = $("#tblPlanillaMovilidad").DataTable();

                tabla.destroy();
                var tr = "";

                detComprobanteArray2.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + obj.detalle2 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-iDetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar2 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#tblPlanillaMovilidadContent").html(tr);

                $("#tblPlanillaMovilidad").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[3], [3]]
                    });

                $("#txtOrgDstModal2").val("");
                $("#txtMotivoModal2").val("");
                $("#txtImporteModal2").val("0");

                document.getElementById("txtOrgDstModal2").focus();

                $("#kpiMontoSeleecionadoModal2").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + importeIngresado)));
            }

        });

        $("#btnAgregarMotivo3").click(function () {

            if (validacionDetCmpbte(tabSeleccionado)) {

                let importeIngresado = parseFloat($("#txtImporteModal3").val());

                const sumDetalleSol = detalleArray.reduce((acc, item) => {
                    return acc += item.total
                }, 0);

                const sumAgregadosDet = detComprobanteArray3.reduce((acc, item) => {
                    return acc += (item.valorunit * item.cantidad);
                }, 0);


                if ((sumDetalleSol - (sumAgregadosDet + importeIngresado)) < 0) {
                    $("#regComprobModal .kpi-modal-monto3").css("background-color", "#FADBD8");
                }
                else {
                    $("#regComprobModal .kpi-modal-monto3").css("background-color", "#D5F5E3");
                }

                iDetalle3++;

                var d = new Date(), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();
                if (month.length < 2) { month = '0' + month; }
                if (day.length < 2) { day = '0' + day; }

                detComprobanteArray3.push({
                    iDetalle: iDetalle3,
                    fecha: [year, month, day].join('/'),
                    detalle1: $("#txtMotivoModal3").val(),
                    detalle2: "",
                    codum: "UN", // UNIDAD
                    valorunit: parseFloat($("#txtImporteModal3").val()),
                    cantidad: 1
                });


                let tabla = $("#tblDeclaracionJurada").DataTable();

                tabla.destroy();
                var tr = "";

                detComprobanteArray3.forEach((obj) => {

                    tr += "<tr> "
                        + " <td> " + obj.fecha + "</td>"
                        + " <td> " + obj.detalle1 + "</td>"
                        + " <td> " + formatoNumero(obj.valorunit) + "</td>"
                        + " <td class='text-center'>"
                        + "     <button data-idetalle='" + obj.iDetalle + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar3 ml-1'><i class='fas fa-trash'></i></button>"
                        + "</td>"
                        + "</tr>";
                });

                $("#tblDeclaracionJuradaContent").html(tr);

                $("#tblDeclaracionJurada").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5], [5]]
                    });

                $("#txtMotivoModal3").val("");
                $("#txtImporteModal3").val("0");

                document.getElementById("txtFechaModalDet3").focus();

                $("#kpiMontoSeleecionadoModal3").text(solicitudSeleccionada.simbolo + " " + formatoNumero(sumDetalleSol - (sumAgregadosDet + importeIngresado)));
            }

        });


        $("#tabRendicionGastos").on("click", ".ctabRegComp", function () {
            let index = $(this).attr("data-id");
            tabSeleccionado = parseInt(index);
        });

        $('.cfecha').change(function () {

            var inputDate = new Date(this.value);
            var today = new Date();

            if (inputDate > today) {

                let dd = String(today.getDate()).padStart(2, '0');
                let mm = String(today.getMonth() + 1).padStart(2, '0');
                let yyyy = today.getFullYear();

                today = yyyy + '-' + mm + '-' + dd;

                $(this).val(today);

                Swal.fire({
                    title: 'La fecha no puede ser mayor a la fecha Actual',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok'
                });
            }

        });


        $('#regComprobModal').on('shown.bs.modal', function (e) {
            var now = new Date();
            var month = (now.getMonth() + 1);
            var day = now.getDate();
            if (month < 10)
                month = "0" + month;
            if (day < 10)
                day = "0" + day;
            var today = now.getFullYear() + '-' + month + '-' + day;

            $('#txtFechaModal1').val(today);
            $('#txtFechaModal2').val(today);
            $('#txtFechaModal3').val(today);
            $('#txtFechaModalDet3').val(today);

            $("#cbxMonedaModal1").val(solicitudSeleccionada.idTipoMod);
            $("#cbxMonedaModal2").val(solicitudSeleccionada.idTipoMod);
            $("#cbxMonedaModal3").val(solicitudSeleccionada.idTipoMod);
        });

        $('#regComprobModal').on('hidden.bs.modal', function (e) {

        });



        function limpiarControlModal(tabSeleccion) {
            iDetalle = 0;

            if (tabSeleccion == 1) {

                // 1. Factura y Boleta
                $("#cbxTipoCpbteCompModal1").val(0);
                $("#txtSerieNumCompModal1").val("");
                $("#txtRucCompModal1").val("");
                $("#txtRSCompModal1").val("");
                $("#txtCodSofyaPCModal1").val("");
                $("#txtObsCompModal1").val("");
                $("#txtMontoCompModal1").val("");
            }
            else if (tabSeleccion == 2) {

                // 2. Planilla de Movilidad
                $("#txtNumPlanillaModal2").val("");
                $("#txtApeNomModal2").val("");
                $("#txtDNIModal2").val("");
                $("#txtCeCoModal2").val("");
                $("#txtOrgDstModal2").val("");
                $("#txtMotivoModal2").val("");
                $("#txtImporteModal2").val("");

                let tabla = $("#tblPlanillaMovilidad").DataTable();
                tabla.destroy();
                var tr = "";
                $("#tblPlanillaMovilidadContent").html(tr);
                $("#tblPlanillaMovilidad").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                    }
                );
            }
            else if (tabSeleccion == 3) {

                // 3. Declaración Jurada.


            }

            detComprobanteArray = [];
        }

        function validacionDetCmpbte(tabSeleccion) {
            let respuesta = false;

            if (tabSeleccion == 1) {

                if ($("#cbxTipoCpbteCompModal1").val().trim() == "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione un Tipo de Comprobante',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#cbxUM1").val() == "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione una unidad de medida por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtDescripcion1").val().trim() == "") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese la descripción por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtCantidad1").val().trim() == "" || $("#txtCantidad1").val() == null || typeof ($("#txtCantidad1").val()) == "undefined") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese la cantidad por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (parseFloat($("#txtCantidad1").val()) == 0 || parseFloat($("#txtCantidad1").val()) < 0 || parseFloat($("#txtCantidad1").val()) > 50) {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese una cantidad correcta por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtValorUnitario1").val().trim() == "" || $("#txtValorUnitario1").val() == null || typeof ($("#txtValorUnitario1").val()) == "undefined") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese el valor Unitario',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (parseFloat($("#txtValorUnitario1").val()) == 0 || parseFloat($("#txtValorUnitario1").val()) < 0 || parseFloat($("#txtValorUnitario1").val()) > 1500) {
                    respuesta = false;
                    Swal.fire({
                        title: 'Ingrese un Valor unitario correcto por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }
            else if (tabSeleccion == 2) {

                if ($("#txtNumPlanillaModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el número de planilla',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtApeNomModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese Apellidos y Nombres',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtDNIModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: "Ingrese el número de DNI",
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtApeNomModal2").val().trim() == "0 Ninguno" || $("#txtApeNomModal2").val().trim() == "0 Varios") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Colaborador no existe',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtOrgDstModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción de Origen/Destino',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtMotivoModal2").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción del motivo',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtImporteModal2").val().trim() == "" || $("#txtImporteModal2").val().trim() == "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el importe por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }
            }
            else if (tabSeleccion == 3) {

                if ($("#txtMotivoModal3").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingreso el Motivo por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#txtImporteModal3").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese el importe por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else {
                    respuesta = true;
                }
            }

            return respuesta;
        }

        function busquedaXDNI(dni, opcionModal) {

            if (dni == "") {
                Swal.fire({
                    title: 'Ingrese el número de DNI',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        // Planilla de Movilidad
                        if (opcionModal == 2) {
                            document.getElementById("txtDNIModal2").focus();
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            document.getElementById("txtDNIModal3").focus();
                        }
                    }
                });
            }
            else if (dni.length < 7) {
                Swal.fire({
                    title: 'Ingrese un número RUC valido por favor',
                    icon: 'warning',
                    showConfirmButton: true,
                    showCancelButton: false,
                    confirmButtonText: 'Ok',
                    cancelButtonText: 'Cancel',
                    focusConfirm: true
                }).then(result => {
                    if (result.value) {
                        // Planilla de Movilidad
                        if (opcionModal == 2) {
                            document.getElementById("txtDNIModal2").focus();
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            document.getElementById("txtDNIModal3").focus();
                        }
                    }
                });
            }
            else {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_BuscarColaboradorXDNI',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { dni: dni },
                    success: function (data) {

                        if (opcionModal == 2) {
                            // Planilla de Movilidad
                            $("#txtApeNomModal2").val(data.entidad.codcolaborador + " " + data.entidad.colaborador);
                        }
                        else if (opcionModal == 3) {
                            // Declaracion Jurada
                            $("#txtApeNomModal3").val(data.entidad.codcolaborador + " " + data.entidad.colaborador);
                        }

                        if (data.entidad.codcolaborador == "0") {

                            const Toast = Swal.mixin({
                                toast: true,
                                position: 'top-end',
                                showConfirmButton: false,
                                timer: 2500,
                                timerProgressBar: true,
                                didOpen: (toast) => {
                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                }
                            })

                            Toast.fire({
                                icon: 'warning',
                                title: data.entidad.mensaje
                            });

                            if (opcionModal == 2) {
                                // Planilla de Movilidad
                                document.getElementById("txtDNIModal2").focus();
                            }
                            else if (opcionModal == 3) {
                                // Declaracion Jurada
                                document.getElementById("txtDNIModal3").focus();
                            }
                        }
                        else {
                            if (opcionModal == 2) {
                                // Planilla de Movilidad
                                document.getElementById("txtOrgDstModal2").focus();
                            }
                            else if (opcionModal == 3) {
                                // Declaracion Jurada
                                // document.getElementById("txtDNIModal3").focus();
                            }
                        }
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }
        }

        function listarDetalle(idRendCompte) {

            $.ajax({
                url: "/finanzas/RG_RendicionDetalle",
                type: "GET",
                data: { idRendCompte: idRendCompte },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        let tabla = $("#tblPlanillaMovilidad").DataTable();

                        tabla.destroy();
                        var tr = "";

                        resultado.lista.forEach((obj) => {

                            tr += "<tr> "
                                + " <td> " + obj.fecha + "</td>"
                                + " <td> " + obj.detalle1 + "</td>"
                                + " <td> " + obj.detalle2 + "</td>"
                                + " <td> " + formatoNumero(obj.importe) + "</td>"
                                + " <td class='text-center'>"
                                + "     <button data-idRendCompteDet='" + obj.idRendCompteDet + "' data-toggle='collapse' class='btn btn-sm btn-danger cselectEliminar ml-1'><i class='fas fa-trash'></i></button>"
                                + "</td>"
                                + "</tr>";
                        });

                        $("#tblPlanillaMovilidadContent").html(tr);


                        $("#tblPlanillaMovilidad").DataTable(
                            {
                                'language': { 'url': '/libs/datatables/spanish.json' },
                                lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                            });
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });


        }

        function indicadorEstado(idEstado) {

            if (idEstado == 1) {
                // Pendiente
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-rend-completa");
                $("#estado-icon").removeClass("icon-rend-incompleta");
                $("#estado-icon").addClass("icon-pendiente");

                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-rend-completa");
                $("#estado-desc").removeClass("desc-est-rend-incompleta");
                $("#estado-desc").addClass("desc-est-pendiente");

            }
            else if (idEstado == 2) {
                // Liberado
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-rend-completa");
                $("#estado-icon").removeClass("icon-rend-incompleta");
                $("#estado-icon").addClass("icon-liberado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-rend-completa");
                $("#estado-desc").removeClass("desc-est-rend-incompleta");
                $("#estado-desc").addClass("desc-est-liberado");

            }
            else if (idEstado == 3) {
                // Aprobado
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-rend-completa");
                $("#estado-icon").removeClass("icon-rend-incompleta");
                $("#estado-icon").addClass("icon-aprobado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-rend-completa");
                $("#estado-desc").removeClass("desc-est-rend-incompleta");
                $("#estado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 4) {
                // Aprobado
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-rend-completa");
                $("#estado-icon").removeClass("icon-rend-incompleta");
                $("#estado-icon").addClass("icon-aprobado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-rend-completa");
                $("#estado-desc").removeClass("desc-est-rend-incompleta");
                $("#estado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 5) {
                // Rechazado
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").removeClass("icon-rend-completa");
                $("#estado-icon").removeClass("icon-rend-incompleta");
                $("#estado-icon").addClass("icon-rechazado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").removeClass("desc-est-rend-completa");
                $("#estado-desc").removeClass("desc-est-rend-incompleta");
                $("#estado-desc").addClass("desc-est-rechazado");
            }
            else if (idEstado == 6) {
                // Rendicion Completa
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-rend-incompleta");
                $("#estado-icon").addClass("icon-rend-completa");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-rend-incompleta");
                $("#estado-desc").addClass("desc-est-rend-completa");
            }
            else if (idEstado == 7) {
                // Rendicion Incompleta
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-rend-completa");
                $("#estado-icon").addClass("icon-rend-incompleta");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-rend-completa");
                $("#estado-desc").addClass("desc-est-rend-incompleta");
            }

        }

        function formatoNumero(x) {
            x = x.toFixed(2);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function armarTablaDetalle(lista) {

            console.log(lista);

            let tabla = $("#tblSolicitud").DataTable();

            tabla.destroy();
            var tr = "";

            lista.forEach((obj) => {

                tr += "<tr> "
                    + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                    + " <td> " + obj.secuencia + "</td>"
                    + " <td> " + obj.estadoDet + "</td>"
                    + " <td> " + obj.tipo + "</td>"
                    + " <td> " + obj.conceptoCab + "</td>"
                    + " <td> " + obj.conceptoDet + "</td>"
                    + " <td> " + obj.cantDias + "</td>"
                    + " <td> " + formatoNumero(obj.valor) + "</td>"
                    + " <td> " + obj.simbolo + " " + formatoNumero(obj.total) + "</td>"
                    + " <td class='text-center'>"
                    + "     <input type='checkbox' data-idsolicitud='" + obj.idSolicitud + "' data-secuencia='" + obj.secuencia + "' data-valor=" + obj.valor + " data-total=" + obj.total + "  class='seleccion' " + (obj.idEstadoDet == 5 ? " disabled " : " ") + ">"
                    + "</td>"
                    + "</tr>";
            });

            $("#tblSolicitudContent").html(tr);


            $("#tblSolicitud").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                });
        }


    </script>

}

