@{
    ViewBag.Title = "Solicitud de Gastos";
    ViewBag.Modulo = "Finanzas";
    Layout = "~/Views/Plantillas/_Layout.cshtml";
}


<div id="solgas" class="container-fluid">


    @*<div class="row d-flex flex-row-reverse m-1 mr-3">
            <div class="estado-solicitud  d-flex flex-row-reverse">
                <div id="estado-icon"></div>
                <h5 id="estado-desc"></h5>
            </div>
        </div>*@

    <div class="card">
        <div class="row m-2">


            <div class="col-2 p-1">
                <label for="idtxtcodigo">Codigo de Solicitud</label>
                <input class="form-control form-control-sm" type="text" id="idtxtcodigo" placeholder="Buscar" maxlength="10">
            </div>

            <div class="col-2 p-1">
                <label for="iddttFechaHora">Fecha</label>
                <input class="form-control form-control-sm" type="text" id="iddttFechaHora" disabled>
            </div>

            <div class="col-4 p-1">
                <label for="idusuario">Usuario</label>
                <input class="form-control form-control-sm" type="text" id="idusuario" disabled>
            </div>

            <div class="col-4 p-1 card estado-solicitud">
                <label style="text-align: center; color: #7F8C8D; font-size: 16px;">Estado Solicitud</label>
                <div class="d-flex justify-content-center align-content-center">
                    <div id="estado-icon"></div>
                    <h5 id="estado-desc"></h5>
                </div>
            </div>



            <div class="col-2 p-1">
                <label for="idCbxTipo">Tipo</label>
                <select class="form-control form-control-sm" id="idCbxTipo"></select>
            </div>

            <div class="col-1 p-1">
                <label for="idCbxSede">Sede</label>
                <select class="form-control form-control-sm" id="idCbxSede"></select>
            </div>

            <div class="col-1 p-1">
                <label for="idCbxTipoMod">Moneda</label>
                <select class="form-control form-control-sm" id="idCbxTipoMod"></select>
            </div>

            <div class="col-4 p-1">
                <label for="idtxtaobs">Motivo Glosa / Descripción Solicitud</label>
                <input type="text" class="form-control form-control-sm" placeholder="Ingrese una descripción de Solicitud" id="idtxtaobs" maxlength="300" />
            </div>

            <div class="col-4 p-1">
                <label for="">Buscar Colaborador - SOFYA (Beneficiario)</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <button type="button" id="btnBuscarColaborador" class="btn btn-warning btn-sm"><i class="fas fa-search"></i></button>
                    </div>
                    <input type="text" class="form-control form-control-sm" placeholder="Colaborador" id="txtcolaborador" aria-label="Username" disabled>
                </div>
            </div>




            <div class="col-12 p-2 d-flex justify-content-between">
                <div class="col-8 d-flex justify-content-between cbtn-acciones">

                    <div>
                        <button id="btnNuevo" type="button" class="btn btn-success btn-sm"><i class="fas fa-file"></i> Nuevo</button>
                        <button id="btnBuscarCodigo" type="button" class="btn btn-primary btn-sm"><i class="fas fa-search"></i> Buscar</button>
                    </div>
                    <div>
                        <button id="btnAnularSolicitud" type="button" class="btn btn-danger btn-sm ml-1 mr-1"><i class="fas fa-ban"></i> Anular Solicitud</button>
                        <button id="btnGuardarCabecera" type="button" class="btn btn-success btn-sm ml-1 mr-1"><i class="fas fa-save"></i> Generar Solicitud</button>
                        <button id="btnAgregarDetalle" type="button" data-toggle="modal" data-target="#modalSolicitudDetalle" class="btn btn-warning btn-sm"><i class="fas fa-plus"></i> Agregar Detalle</button>
                    </div>

                </div>


                <div class="col-3 ckpi-total d-flex justify-content-between">

                    <div class="ckpi-item">
                        <h5 id="kpi-cantidad">0</h5>
                        <span>Cantidad</span>
                    </div>

                    <div class="ckpi-item">
                        <h5 id="kpi-total">0</h5>
                        <span>Total</span>
                    </div>

                </div>

            </div>
        </div>
    </div>


    <div class="card card-body mt-2">

        <table class="table table-sm table-bordered table-hover display nowrap" id="tblDetalle" style="width: 100%">
            <thead class="thead-light">
                <tr>
                    <th class="ocultar-columna">idSolicitud</th>
                    <th>Codigo</th>
                    <th class="">Fecha</th>
                    <th class="">Tipo</th>
                    <th class="">Estados</th>
                    <th>Centro de Costo</th>
                    <th>Concepto</th>
                    <th class="">Moneda</th>
                    <th>Valor</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tblDetalleContent"></tbody>
        </table>
    </div>


</div>


@*  :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::     INSERTAR     ::::::::::::::::::::::::::::::::::::::::::::::.  *@


<div class="modal fade" id="modalSolDetInsertar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form>

                    <div class="row">
                        <div class="col-2">
                            <label for="idmcodigo">Codigo:</label>
                            <input type="text" class="form-control form-control-sm" id="idmcodigo" readonly>
                        </div>
                        <div class="col-4">
                            <label for="idmCbxConcepCab">Concepto:</label>
                            <select class="form-control form-control-sm" id="idmCbxConcepCab"></select>
                        </div>

                        <div class="col-6">
                            <label for="idmCbxCeCo">Centro de Costo:</label>
                            <select class="form-control form-control-sm" id="idmCbxCeCo" disabled></select>
                        </div> 
                    </div>


                    <div class="row p-2 mt-1 d-flex flex-row justify-content-between">

                        <div class="card col-9 p-2 d-flex flex-row justify-content-start">
                            <div class="d-flex justify-content-center align-items-center">
                                <input type='checkbox' id="seleccionar-todo" class="form-control form-control-sm">
                            </div>
                            <div class="d-flex justify-content-center align-items-center">
                                <div class="ml-2">Seleccionar Todo</div>
                            </div>
                        </div>

                        <div class="card col-2 p-2">
                            <div class="d-flex flex-column justify-content-center align-content-center">
                                <div class="cant-sum-total-det" id="sum-total-det">0.00</div>
                                <div class="subt-sum-total-det">Total</div>
                            </div>
                        </div>

                    </div>


                    <div class="container-fluid">
                        <div class="row">
                            <div class="col">
                                <ul class="list-group">

                                    <li class="list-group-item">
                                        <div class="row">
                                            <div class="col-1">
                                                <h6>Marcar</h6>
                                            </div>
                                            <div class="col-2">
                                                <h6>Concepto</h6>
                                            </div>
                                            <div class="col-1">
                                                <h6>Monto</h6>
                                            </div>
                                            <div class="col-3">
                                                <h6>Observación</h6>
                                            </div>
                                            <div class="col-3">
                                                <h6>Consideracion</h6>
                                            </div>
                                            <div class="col-1">
                                                <h6>Días</h6>
                                            </div>
                                            <div class="col-1">
                                                <h6>Total</h6>
                                            </div>
                                        </div>
                                    </li>

                                    <li class="list-group-item" id="detalleConceptoInsertarEditar">
                                    </li>

                                </ul>
                            </div>
                        </div>

                    </div>

                </form>

            </div>
            <div class="modal-footer">
                <button id="btnCancelar" type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button id="btnGuardarDetalle" type="button" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
</div>



@*  :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::     VISUALIZAR     ::::::::::::::::::::::::::::::::::::::::::::::.  *@

<div class="modal fade" id="modalSolDetVisualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Detalle de Solicitud</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form>
                    <div class="row">
                        <div class="col-2">
                            <label for="idmdCodigo">Codigo:</label>
                            <input type="text" class="form-control form-control-sm" id="idmdCodigo" readonly>
                        </div>
                        <div class="col-4">
                            <label for="idmdConcepCab">Concepto:</label>
                            <input class="form-control form-control-sm" id="idmdConcepCab" readonly>
                        </div>

                        <div class="col-6">
                            <label for="idmdCeCo">Centro de Costo:</label>
                            <input class="form-control form-control-sm" id="idmdCeCo" disabled>
                        </div>
                    </div>


                    <div class="container-fluid mt-4">

                        <div class="row">
                            <div class="col">
                                <ul class="list-group">

                                    <li class="list-group-item">
                                        <div class="row">
                                            @*<div class="col-1">
                                                    <h6>Marca</h6>
                                                </div>*@

                                            <div class="col-2">
                                                <h6>Concepto</h6>
                                            </div>
                                            <div class="col-1">
                                                <h6>Monto</h6>
                                            </div>

                                            <div class="col-4">
                                                <h6>Observacion</h6>
                                            </div>

                                            <div class="col-5">
                                                <h6>Consideracion</h6>
                                            </div>

                                        </div>
                                    </li>

                                    <li class="list-group-item" id="detalleConceptoVisualizar">
                                    </li>

                                </ul>
                            </div>
                        </div>

                    </div>

                </form>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>




@*  :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::     BUSQUEDA COLABORADOR BENEFICIERIO     ::::::::::::::::::::::::::::::::::::::::::::::.  *@

<div class="modal fade bd-example-modal-lg" id="modalColaboradorSofya" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Buscar Colaborador - SOFYA</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="form-group">
                    <input type="text" class="form-control form-control-sm" id="idBusquedaColaborador" placeholder="Buscar Colaborador <Presionar Enter>">
                </div>

                <table class="table table-sm table-bordered table-hover display nowrap" id="tblColaborador" style="width: 100%">
                    <thead class="thead-light">
                        <tr>
                            <th>Codigo SOFYA</th>
                            <th>Colaborador</th>
                            <th>Seleecionar</th>
                        </tr>
                    </thead>
                    <tbody id="tblColaboradorContent"></tbody>
                </table>

            </div>
        </div>
    </div>
</div>




<style>




    #modalSolDetInsertar .cant-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 18px;
    }


    #modalSolDetInsertar .subt-sum-total-det {
        text-align: center;
        font-weight: 600;
        font-size: 14px;
    }



    #solgas label {
        font-family: 'Roboto', sans-serif;
    }

    #modalSolicitudDetalle input, select, span, label {
        font-family: 'Roboto', sans-serif;
    }

    #solgas .idtxtcodigo-ok {
        background-color: #82E0AA !important;
    }


    #solgas table .ocultar-columna {
        display: none;
    }


    #solgas .cbtn-acciones {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #solgas .ckpi-total {
        border: 1px solid #D5D8DC;
        padding: 10px;
        border-radius: 5px;
    }

    #solgas .ckpi-item {
        background-color: #EBEDEF;
        width: 45%;
        margin: auto;
        padding: 4px;
        border-radius: 3px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }


    #solgas .kpi-cantidad {
    }

    #solgas #tblHistorial th {
        font-family: 'Roboto', sans-serif !important;
    }

    #solgas #tblHistorial td {
        font-family: 'Roboto', sans-serif !important;
        font-weight: 600;
    }

    #solgas #tblDetalle th {
        font-family: 'Roboto', sans-serif !important;
    }

    #solgas #tblDetalle td {
        font-family: 'Roboto', sans-serif !important;
    }

    #solgas #estado-desc {
        margin-right: 8px;
    }

    #modalSolicitudDetalle #idmConcepDetConsid {
        height: 100px !important;
    }


    #solgas .icon-pendiente::after {
        content: url(../../Public/icon-pend.png);
    }

    #solgas .icon-liberado::after {
        content: url(../../Public/icon-libe.png);
    }

    #solgas .icon-aprobado::after {
        content: url(../../Public/icon-apro.png);
    }

    #solgas .icon-rechazado::after {
        content: url(../../Public/icon-rech.png);
    }



    #solgas .desc-est-pendiente {
        color: #616A6B;
    }

    #solgas .desc-est-liberado {
        color: #F1C40F;
    }

    #solgas .desc-est-aprobado {
        color: #28B463;
    }

    #solgas .desc-est-rechazado {
        color: #C0392B;
    }


    #solgas #listDetalleConcept p {
        font-size: 13px !important;
        border: 1px solid #E5E8E8 !important;
        padding: 4px !important;
    }


    input[type="checkbox"] {
        position: relative;
        width: 2.2em;
        height: 2.2em;
        color: #000;
        border: 1px solid #D5D8DC;
        border-radius: 4px;
        appearance: none;
        outline: 0;
        cursor: pointer;
        transition: background 175ms cubic-bezier(0.1, 0.1, 0.25, 1);
    }

        input[type="checkbox"]::before {
            position: absolute;
            content: '';
            display: block;
            top: 3px;
            left: 8px;
            width: 10px;
            height: 16px;
            border-style: solid;
            border-color: #ffffff;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            opacity: 0;
        }


        input[type="checkbox"]:checked {
            color: #ffffff;
            border-color: #28B463;
            background: #28B463;
        }


        input[type="checkbox"]:before {
            opacity: 1;
        }


    #solgas .estado-solicitud {
        color: #28B463;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        padding: 5px;
        border-radius: 5px;
    }



    @@media (min-width: 320px) and (max-width: 479.98px) {
    }

    @@media (min-width: 480px) and (max-width: 767.98px) {
    }

    @@media (min-width: 768px) and (max-width: 991.98px) {
    }

    @@media (min-width: 992px) and (max-width: 1199.98px) {
    }

    @@media (min-width: 1200px) {
    }
</style>


@section scripts {
    <script>

        const NIVEL_INTERFAZ = 10;
        const USUARIO = "@Request.RequestContext.HttpContext.Session["usuario"]";
        const USUARIO_COMPLETO = "@Request.RequestContext.HttpContext.Session["usuario"]" + " - " + "@Request.RequestContext.HttpContext.Session["nombre"]";

        var switchInsertarEditar = 0; // 1: Insertar, 2: Editar

        var vIdSolicitud = 0;
        var vCodigo = "";
        var vIdTipoMod = 0;
        var vCodCeCo = 0;
        var vIdConcepCab = 0;
        var vIdConcepDet = 0;
        var vIdTipo = 0;
        var vCodSede = '';

        var vChecked = false;

        var diasArray = [];
        var entidadEditar = {};
        var diasArrayEditar = [];
        var conceptoDetArray = [];
        var tipoMonedaArray = [];

        var sumTotalDetalle = 0;

        var vCodColSofya = "";
        var vColaboradorSofya = "";

        var vctpava_bnfcol = "";
        var vcanvar_bnfcol = "";
        var vcolaborador = "";
        var vcodceco = 0;

        var tiposAnulacionCabArray = [];

        $(document).ready(function () {

            Inicializar();


            function Inicializar() {

                let parametros = { nivelInterfaz: NIVEL_INTERFAZ };
                getPermisosXCeCo(parametros);

                getTipoDeMoneda();

                getDias();
                getTiposAnulacionCabecera();
                getSede();

                limpiarCabecera();

                document.getElementById("idtxtcodigo").focus();

                document.getElementById("btnAgregarDetalle").disabled = true;
                $("#btnAgregarDetalle").removeClass("btn-warning");
                $("#btnAgregarDetalle").addClass("btn-secondary");

                document.getElementById("btnGuardarCabecera").disabled = true;
                $("#btnGuardarCabecera").removeClass("btn-success");
                $("#btnGuardarCabecera").addClass("btn-secondary");

                document.getElementById("btnAnularSolicitud").disabled = true;
                $("#btnAnularSolicitud").removeClass("btn-danger");
                $("#btnAnularSolicitud").addClass("btn-secondary");

                document.getElementById("btnBuscarCodigo").disabled = true;
                $("#btnBuscarCodigo").removeClass("btn-primary");
                $("#btnBuscarCodigo").addClass("btn-secondary");


                document.getElementById("idCbxTipo").disabled = true;
                document.getElementById("idCbxTipoMod").disabled = true;
                document.getElementById("idtxtaobs").disabled = true;
                document.getElementById("btnBuscarColaborador").disabled = true;
            }


            // Funcionalidades.

            function validacionCabecera() {
                var respuesta = false;

                if ($("#idtxtcodigo").val().trim() != "0") {
                    respuesta = false;

                    Swal.fire({
                        title: 'No puede generar una solicitud nueva',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else
                if (vIdTipoMod == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione un Tipo de Moneda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if ($("#idtxtaobs").val().trim() == "") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Ingrese una descripción de la solicitud por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (vIdTipo == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione el tipo de Solicitud, por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (vctpava_bnfcol == "" || vctpava_bnfcol == null || typeof (vctpava_bnfcol) == "undefined") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Registre el colaborador beneficierio',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else if (vCodSede == "" || vCodSede == null || typeof (vCodSede) == "undefined") {
                    respuesta = false;

                    Swal.fire({
                        title: 'Seleccione la sede por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    respuesta = true;
                }

                return respuesta;
            }

            function validacionDetalle() {
                let respuesta = true;
                let isFalseLoop = false;
                let cantConceptpDetArray = 0;

                cantConceptpDetArray = conceptoDetArray.filter(x => x.isChecked == true).length;

                if (vIdSolicitud == 0) {

                    Swal.fire({
                        title: 'Debe generar el codigo de solicitud para continuar',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'

                    });

                    return false;
                }
                else if (cantConceptpDetArray == 0 || cantConceptpDetArray == null || typeof (cantConceptpDetArray) == "undefined") {

                    Swal.fire({
                        title: 'Seleccione un concepto, por favor',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    return false;
                }
                else if (vCodCeCo == 0 || vCodCeCo == null) {

                    Swal.fire({
                        title: 'Seleccione un centro de costo',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                    return false;
                }

                $("#detalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {

                    let valorIngresado = $(obj).val();
                    let valorMaximoS = $(obj).attr("data-valor-maxs");
                    let valorMaximoD = $(obj).attr("data-valor-maxd");

                    let nombreID = obj.id;
                    let idConceptoDet = $(obj).attr("data-idconceptodet");

                    let estaSeleccionado = conceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);


                    if (typeof (estaSeleccionado) != "undefined") {

                        if (valorIngresado.toString().trim() == "" || valorIngresado == null || typeof (valorIngresado) == "undefined" || valorIngresado.toString().trim() == "0") {
                            Swal.fire({
                                title: 'Ingrese el monto por favor',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById(nombreID).focus();
                            isFalseLoop = true;
                            return false;

                        }
                        else if (parseFloat(valorIngresado) < 0) {

                            Swal.fire({
                                title: 'El monto ingresado no debe ser negativo',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById(nombreID).focus();
                            isFalseLoop = true;
                            return false;
                        }
                        else if (vIdTipoMod == 1) {

                            if (parseFloat(valorIngresado) > valorMaximoS) {
                                isFalseLoop = true;
                                return false;

                                $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                //$("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString() + "").val(0);

                                valorActual = 0;


                                Swal.fire({
                                    title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showConfirmButton: true,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                });

                                document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            }
                        }
                        else if (vIdTipoMod == 2) {
                            // DOLAR
                            if (parseFloat(valorIngresado) > valorMaximoD) {
                                isFalseLoop = true;
                                return false;

                                $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                //$("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString() + "").val(0);
                                valorActual = 0;

                                Swal.fire({
                                    title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showConfirmButton: true,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                });

                                document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            }

                        }
                    }

                });

                // Servicio
                if (vIdConcepCab == "5") {
                    $("#detalleConceptoInsertarEditar input.cobsdet").each(function (i, obj) {
                        let obsIngresado = $(this).val();

                        if (obsIngresado == "" || obsIngresado == null || typeof (obsIngresado) == "undefined") {
                            Swal.fire({
                                title: 'Debe ingresar una descripción para el tipo de Solicitud',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            isFalseLoop = true;
                            return false;
                        }
                    });
                }


                if (isFalseLoop) {
                    respuesta = false;
                }
                else {
                    respuesta = true;
                }

                return respuesta;

            }

            function getTiposAnulacionCabecera() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_TiposAnulacionCabecera',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        tiposAnulacionCabArray = data.lista;

                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }


            // Listados.

            function getSede() {

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_Sedes',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        $("#idCbxSede").empty();
                        $.each(data.lista, function () {
                            $("#idCbxSede").append($("<option/>").val(this.codSede).text(this.sede));
                        });
                        $("#idCbxSede").val("C");
                        vCodSede = "C";

                        getTipos();
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getPermisosXCeCo(parametros) {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_PermisosXCeCo',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: parametros,
                    success: function (data) {

                        let primerValorBool = true;
                        let primerValor = 0;

                        $("#idmCbxCeCo").empty();

                        $.each(data.lista, function () {

                            if (primerValorBool) {
                                primerValor = this.codCeCo;
                                primerValorBool = false;
                            }

                            $("#idmCbxCeCo").append($("<option/>").val(this.codCeCo).text(this.descripcion));
                        });

                        vCodCeCo = primerValor;
                        $("#idmCbxCeCo").val(vCodCeCo);
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getConceptoCab(idSolicitud) {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_ConceptoCab',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud },
                    success: function (data) {

                        let primerValorBool = true;
                        let primerValor = 0;

                        $("#idmCbxConcepCab").empty();

                        $.each(data.lista, function () {

                            if (primerValorBool) {
                                primerValor = this.idConceptoCab;
                                primerValorBool = false;
                            }

                            $("#idmCbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                        });

                        vIdConcepCab = primerValor;
                        $("#idmCbxConcepCab").val(primerValor);

                        getConceptoDet(vIdConcepCab);
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getDias() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_Dias',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        diasArray = [];

                        $.each(data.lista, function () {
                            diasArray.push({ codDia: this.codDia, dia: this.dia });
                        });
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getTipoDeMoneda() {
                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_TiposDeMoneda',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        tipoMonedaArray = [];
                        tipoMonedaArray = data.lista;

                        $("#idCbxTipoMod").empty();
                        $.each(data.lista, function () {
                            $("#idCbxTipoMod").append($("<option/>").val(this.idTipoMod).text(this.descripcion));
                        });
                        $("#idCbxTipoMod").val(1);

                        vIdTipoMod = 1;
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getTipos() {

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_Tipos',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        let primerValorBool = true;
                        let primerValor = 0;

                        $("#idCbxTipo").empty();

                        $.each(data.lista, function () {

                            if (primerValorBool) {
                                primerValor = this.idTipo;
                                primerValorBool = false;
                            }
                            $("#idCbxTipo").append($("<option/>").val(this.idTipo).text(this.tipo));
                        });
                        vIdTipo = primerValor;
                        $("#idCbxTipo").val(primerValor);


                        // Definir la sede
                        if (vIdTipo == 1) {
                            $("#idCbxSede").val("C");
                            vCodSede = "C";
                            document.getElementById("idCbxSede").disabled = true;
                        }
                        else if (vIdTipo == 2) {
                            $("#idCbxSede").val("L");
                            vCodSede = "L";
                            document.getElementById("idCbxSede").disabled = true;
                        }
                        else {
                            document.getElementById("idCbxSede").disabled = false;
                        }

                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            }

            function getListaDetalle(pidSolicitud) {

                $.ajax({
                    type: "GET",
                    url: '/finanzas/RG_SolicitudDet',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: pidSolicitud },
                    success: function (data) {

                        if (data.isRedirect) {
                            window.location.href = data.redirectUrl;
                        }
                        else {
                            generarTablaDetalle(data.lista);
                        }
                    },
                    failure: function () {

                        Swal.fire({
                            icon: 'error',
                            title: 'Error al mostrar datos',
                            text: 'Textile Sourcing Company',
                            showConfirmButton: false,
                            timer: 2500,
                        });

                    }
                });
            }

            function ajaxConceptoEdit(idSolicitud) {
                return $.ajax({
                    type: "GET",
                    url: "/Finanzas/RG_ConceptoCabEdit",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud }
                });
            }

            function ajaxDetalleEditar(idSolicitud, idConceptoCab) {
                return $.ajax({
                    type: "GET",
                    url: "/Finanzas/RG_DetalleEditar",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab }
                });
            }



            // Eventos Click

            $("#btnCancelar").click(function () {
                document.getElementById("idmCbxCeCo").focus();
            });

            $("#btnGuardarCabecera").click(function () {

                if (validacionCabecera()) {

                    let parametro = {
                        'opcion': 1,
                        'idSolicitud': 0,
                        'codigo': 0,
                        'idEmpresa': 1,
                        'idEstado': 10,
                        'idAnulado': 0,
                        'idTipoMod': vIdTipoMod,
                        'observacion': $("#idtxtaobs").val().trim(),

                        'codCeCo': vCodCeCo,
                        'idConceptoDet': vIdConcepDet,
                        'valor': 0,
                        'secuencia': 0,
                        'usuario': USUARIO,
                        'usuarioCompleto': USUARIO_COMPLETO,
                        'nivelInterfaz': 0,
                        'idTipo': vIdTipo,
                        'seleccionadoDet': 0,
                        'idConceptoCab': 0,

                        'cantDias': 0,
                        'montoSolicitado': 0,
                        'observacionDet': '',
                        'ctpava_bnf': vctpava_bnfcol,
                        'canvar_bnf': vcanvar_bnfcol,
                        'colaborador': vcolaborador,

                        'codSede': vCodSede
                    }

                    $.ajax({
                        url: "/finanzas/RG_SetRendicionGastos",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                if (resultado.status.idResponse > 0) {
                                    vIdSolicitud = resultado.status.idResponse;
                                    vCodigo = resultado.responseEntity.codigo;

                                    $("#iddttFechaHora").val(resultado.responseEntity.fechaEmision);
                                    $("#idtxtcodigo").val(resultado.responseEntity.codigo);
                                    $("#idtxtcodigo").addClass("idtxtcodigo-ok");

                                    document.getElementById("idtxtcodigo").disabled = false;
                                    document.getElementById("idCbxTipo").disabled = true;
                                    document.getElementById("idCbxTipoMod").disabled = true;
                                    document.getElementById("idtxtaobs").disabled = true;
                                    document.getElementById("btnBuscarColaborador").disabled = true;

                                    mensajePrincipal(true, resultado.status.statusResponse);
                                    estadoSolicitud(vIdSolicitud);

                                    $("#btnGuardarCabecera").removeClass("btn-success");
                                    $("#btnGuardarCabecera").addClass("btn-secondary");
                                    document.getElementById("btnGuardarCabecera").disabled = true;

                                    $("#btnAnularSolicitud").removeClass("btn-secondary");
                                    $("#btnAnularSolicitud").addClass("btn-danger");
                                    document.getElementById("btnAnularSolicitud").disabled = false;

                                    $("#btnAgregarDetalle").removeClass("btn-secondary");
                                    $("#btnAgregarDetalle").addClass("btn-warning");
                                    document.getElementById("btnAgregarDetalle").disabled = false;
                                    document.getElementById("btnAgregarDetalle").focus();

                                    $("#btnNuevo").removeClass("btn-success");
                                    $("#btnNuevo").addClass("btn-secondary");
                                    document.getElementById("btnNuevo").disabled = true;

                                }
                                else {
                                    mensajePrincipal(false, "Ocurrio un problema");
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }
            });

            function estadoSolicitud(pIdSolicitud) {
                $.ajax({
                    url: "/finanzas/RG_EstadoSolicitud",
                    type: "GET",
                    data: { idSolicitud: pIdSolicitud },
                    dataType: "json",
                    success: function (resultado) {

                        if (resultado.isRedirect) {
                            window.location.href = resultado.redirectUrl;
                        }
                        else {
                            $("#estado-desc").text(resultado.entidad.estado);
                            indicadorEstado(resultado.entidad.idEstado);
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                    }
                });
            }

            $("#btnAgregarDetalle").click(function () {
                if (validarAgregarDetalle()) {
                    switchInsertarEditar = 1; // 1: Insertar

                    let codigoGenerado = $("#idtxtcodigo").val();
                    getConceptoCab(vIdSolicitud);

                    $("#idmcodigo").val(codigoGenerado);
                    $('#modalSolDetInsertar').modal('show');
                }
            });

            function validarAgregarDetalle() {
                let respuesta = false;
                let codigoGenerado = $("#idtxtcodigo").val();

                if (vIdTipoMod == 0) {
                    respuesta = false;

                    Swal.fire({
                        title: 'Debe seleccionar el tipo de Moneda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else if (codigoGenerado == "" || codigoGenerado == null || typeof (codigoGenerado) == "undefined") {
                    respuesta = false;
                    Swal.fire({
                        title: 'Debe Generar la cabecera de la Solicitud para continuar',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Ok'
                    });

                }
                else {
                    respuesta = true;
                }

                return respuesta;
            }

            $("#btnGuardarDetalle").click(function () {

                if (validacionDetalle()) {

                    $("#detalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {
                        let idConceptoDet = $(obj).attr("data-idconceptodet");
                        let estaSeleccionado = conceptoDetArray.find(x => x.idConceptoDet == idConceptoDet && x.isChecked == true);
                        if (typeof (estaSeleccionado) != "undefined") {
                            for (var i = 0; i < conceptoDetArray.length; i++) {
                                if (conceptoDetArray[i].isChecked == true && conceptoDetArray[i].idConceptoDet == idConceptoDet) {
                                    conceptoDetArray[i].montoSolicitado = parseFloat($("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val());
                                    conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                                }
                            }
                        }
                    });

                    if (switchInsertarEditar == 1) {
                        // Insertar
                        conceptoDetArray = conceptoDetArray.filter(x => x.isChecked == true);
                    }


                    let parametro = {
                        'opcion': 2,
                        'idSolicitud': vIdSolicitud,
                        'codigo': 0,
                        'idEmpresa': 1,
                        'idEstado': 1,
                        'idAnulado': 0,
                        'idTipoMod': 0,
                        'observacion': '',
                        'codCeCo': vCodCeCo,
                        'idConceptoDet': vIdConcepDet,
                        'valor': $("#idmvalor").val(),
                        'secuencia': 0,
                        'usuario': USUARIO,
                        'usuarioCompleto': USUARIO_COMPLETO,
                        'nivelInterfaz': 0,
                        'idTipo': parseInt($("#idCbxTipo").val()),
                        'conceptoDetArray': conceptoDetArray
                    }

                    $.ajax({
                        url: "/finanzas/RG_SetRendicionGastosDet",
                        type: "post",
                        data: parametro,
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {

                                $('#modalSolDetInsertar').modal('hide');

                                if (resultado.status.idResponse > 0) {
                                    mensajePrincipal(true, "Actualizando Detalle");
                                }
                                else {
                                    mensajePrincipal(false, "Ocurrio un problema al agregar el motivo");
                                    console.log(status.resultado.statusResponse);
                                }

                                // Habilitar boton nuevo.
                                $("#btnNuevo").removeClass("btn-secondary");
                                $("#btnNuevo").addClass("btn-success");
                                document.getElementById("btnNuevo").disabled = false;

                                getListaDetalle(vIdSolicitud);
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });
                }
            });

            $("#btnNuevo").click(function () {
                resetControles();

                $("#idtxtcodigo").val("0");
                document.getElementById("idtxtcodigo").disabled = true;
                document.getElementById("idCbxTipo").focus();

                validarSedeYMonXTipo();
            });


            $("#tblDetalle").on('click', '.solicitudDetalleItem', function () {

                let idSolicitud = $(this).attr("data-idsolicitud");
                let idConceptoCab = $(this).attr("data-idconceptoCab");

                $.ajax({
                    type: "GET",
                    url: '/Finanzas/RG_SolicitudDetalle',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: { idSolicitud: idSolicitud, idConceptoCab: idConceptoCab },
                    success: function (data) {

                        if (data.isRedirect) {
                            window.location.href = data.redirectUrl;
                        }
                        else {

                            let detHTML = "";
                            let checkeHTML = "";

                            $("#detalleConceptoVisualizar").empty();

                            $("#idmdCodigo").val(data.entidad.codigo);
                            $("#idmdConcepCab").val(data.entidad.conceptoCab);
                            $("#idmdCeCo").val(data.entidad.ceco);


                            $.each(data.entidad.conceptoDetalle, function () {

                                detHTML += "<div class='row mt-1'>";

                                //if (this.existe == 0) {
                                //    checkeHTML = "<div class='col-1'>"
                                //        + "     <input type='checkbox' class='cseleccion' data-idConceptoDet=" + this.idConceptoDet + " disabled>"
                                //        + "</div>";
                                //}
                                //else {
                                //    checkeHTML = "<div class='col-1'>"
                                //        + "     <input type='checkbox' class='cseleccion' data-idConceptoDet=" + this.idConceptoDet + " readonly checked='checked'>"
                                //        + "</div>";
                                //}

                                detHTML = detHTML + checkeHTML;

                                detHTML = detHTML + "<div class='col-2'>"
                                    + "      <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                                    + "</div>"
                                    + "<div class='col-1'>"
                                    + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + formatoNumero(this.montoSolicitado) + "</p>"
                                    + "</div>"
                                    + "<div class='col-4'>"
                                    + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.observacionDet + "</p>"
                                    + "</div>"
                                    + "<div class='col-5'>"
                                    + "     <p style='padding: 3px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                                    + "</div> ";

                                detHTML = detHTML + "</div>";

                            });

                            $("#detalleConceptoVisualizar").html(detHTML);
                            $('#modalSolDetVisualizar').modal('show');
                        }
                    },
                    failure: function () {
                        console.error('error al cargar tipos periodos');
                    }
                });
            });

            $("#tblDetalle").on('click', '.solicitudEditarItem', function () {

                let idSolicitud = $(this).attr("data-idsolicitud");
                let idConceptoCab = $(this).attr("data-idconceptoCab");

                vIdConcepCab = idConceptoCab
                switchInsertarEditar = 2; // 2: Editar

                $.when(ajaxConceptoEdit(idSolicitud), ajaxDetalleEditar(idSolicitud, idConceptoCab)).done(function (dataConcepto, dataDetalle) {

                    entidadEditar = {};

                    if (dataConcepto.isRedirect) {
                        window.location.href = dataConcepto[0].redirectUrl;
                    }
                    else {

                        let detHTML = "";
                        let cbxDiasHTML = "";
                        let cantChecked = 0;
                        let primerLoopCbxDia = true;
                        let cantDiaSeleccionado = 0;

                        diasArrayEditar = [];
                        entidadEditar = dataDetalle[0].entidad;
                        vCodCeCo = dataDetalle[0].entidad.codCeCo;
                        vIdSolicitud = dataDetalle[0].entidad.idSolicitud;

                        $("#detalleConceptoInsertarEditar").empty();


                        // Concepto
                        $("#idmCbxConcepCab").empty();
                        $.each(dataConcepto[0].lista, function () {
                            $("#idmCbxConcepCab").append($("<option/>").val(this.idConceptoCab).text(this.conceptoCab));
                        });


                        // Detalle
                        $.each(diasArray, function () {

                            if (primerLoopCbxDia) {
                                cbxDiasHTML += "<option value='" + this.codDia + "' selected>" + this.dia + "</option>";
                                cantDiaSeleccionado = this.codDia;
                            }
                            else {
                                cbxDiasHTML += "<option value='" + this.codDia + "'>" + this.dia + "</option>";
                            }

                            primerLoopCbxDia = false;
                        });

                        $.each(dataDetalle[0].entidad.conceptoDetalle, function () {

                            detHTML += "<div class='row mt-1'>";

                            if (this.existe == 0) {
                                checkeHTML = "<div class='col-1'>"
                                    + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoSolicitado + " >"
                                    + "</div>";
                                conceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 0, codCeCo: vCodCeCo, isChecked: false, cantDias: this.cantDias, montoSolicitado: this.montoSolicitado, observacionDet : this.observacionDet });
                            }
                            else {
                                checkeHTML = "<div class='col-1'>"
                                    + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoSolicitado + "  checked='checked'>"
                                    + "</div>";
                                conceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 1, codCeCo: vCodCeCo, isChecked: true, cantDias: this.cantDias, montoSolicitado: this.montoSolicitado, observacionDet: this.observacionDet });

                                sumTotalDetalle = sumTotalDetalle + parseFloat(this.montoSolicitado * this.cantDias);
                                cantChecked++;
                            }

                            detHTML = detHTML + checkeHTML;

                            detHTML = detHTML
                                + "<div class='col-2'>"
                                + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                                + "</div>"

                                + "<div class='col-1'>"
                                + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + this.idConceptoDet + "' min='0' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd = '" + this.montoMaximoD + "'  data-idconceptodet='" + this.idConceptoDet + "' value='" + this.montoSolicitado + "'>"
                                + "</div>"

                                + "<div class='col-2'>"
                                + "     <input class='form-control form-control-sm cobsdet' type='text' id='txtObsDet" + this.idConceptoDet + "' data-idconceptodet='" + this.idConceptoDet + "' value='" + this.observacionDet + "'>"
                                + "</div>"

                                + "<div class='col-4'>"
                                + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                                + "</div> "

                                + "<div class='col-1'>"
                                + "   <select class='form-control form-control-sm cdias cbxDias" + this.idConceptoDet + "' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd = '" + this.montoMaximoD + "' data-id=" + this.idConceptoDet + "" + ((this.existe == 0 || idConceptoCab == 5) ? " disabled " : " ") + ">"
                                + cbxDiasHTML
                                + "</select>"
                                + "</div>"

                                + "<div class='col-1'>"
                                + "     <input class='form-control form-control-sm txtTotalPed" + this.idConceptoDet + "' type='text' disabled>"
                                + "</div>"
                                + "</div>"

                            diasArrayEditar.push({ idConceptoDet: this.idConceptoDet, cantDias: this.cantDias });

                        });

                        if (cantChecked == dataDetalle[0].entidad.conceptoDetalle.length) {
                            $("#seleccionar-todo").prop("checked", true);
                        }


                        let codigoGenerado = $("#idtxtcodigo").val();

                        $("#idmcodigo").val(codigoGenerado);
                        $("#idmCbxConcepCab").val(entidadEditar.idConceptoCab);
                        $("#idmCbxCeCo").val(entidadEditar.codCeCo);
                        vCodCeCo = entidadEditar.codCeCo;

                        $("#sum-total-det").text(formatoNumero(sumTotalDetalle * cantDiaSeleccionado));
                        $("#detalleConceptoInsertarEditar").html(detHTML);
                        $('#modalSolDetInsertar').modal('show');

                    }

                });

            });



            $("#tblDetalle").on('click', '.solicitudEliminarItem', function () {

                let idsolcitud = $(this).attr("data-idsolicitud");
                let idconceptocab = $(this).attr("data-idconceptocab");

                MostrarCarga("Eliminando registro...");

                Swal.fire({
                    title: '¿Esta seguro de eliminar el registro?',
                    text: "Textile Sourcing Company",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si',
                    cancelButtonText: 'No'
                }).then((result) => {

                    if (result.value) {

                        let parametro = {
                            'opcion': 3,
                            'idSolicitud': idsolcitud,
                            'codigo': 0,
                            'idEmpresa': 1,
                            'idEstado': 1,
                            'idAnulado': 0,
                            'idTipoMod': vIdTipoMod,
                            'observacion': '',

                            'codCeCo': vCodCeCo,
                            'idConceptoDet': vIdConcepDet,
                            'valor': 0,
                            'secuencia': 0,
                            'usuario': USUARIO,
                            'usuarioCompleto': USUARIO_COMPLETO,
                            'nivelInterfaz': 0,
                            'idTipo': vIdTipo,
                            'seleccionadoDet': 0,
                            'idConceptoCab': idconceptocab,
                            'observacionDet': "",
                            'ctpava_bnf':"",
                            'canvar_bnf': "",
                            'colaborador':""
                        }


                        $.ajax({
                            url: "/finanzas/RG_EliminarSolicitud",
                            type: "post",
                            data: parametro,
                            dataType: "json",
                            success: function (resultado) {
                                console.log(resultado);

                                if (resultado.isRedirect) {
                                    window.location.href = resultado.redirectUrl;
                                }
                                else {
                                    if (resultado.status.idResponse > 0) {
                                        mensajePrincipal(true, "Item Eliminado Correctamente");
                                    }
                                    else {
                                        mensajePrincipal(false, "Ocurrio un problema");
                                    }

                                    getListaDetalle(vIdSolicitud);

                                }
                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                            }
                        });

                        getListaDetalle(vIdSolicitud);
                    }
                })

            });

            $("#btnBuscar").click(function () {

                let fechaIni = $('#idfechaInicio').val();
                let fechaFin = $('#idfechaFin').val();

                if (fechaIni == null ||
                    fechaFin == null ||
                    typeof (fechaIni) == "undefined" ||
                    typeof (fechaFin) == "undefined" ||
                    fechaIni.trim() == "" ||
                    fechaFin.trim() == "") {

                    Swal.fire('Seleccione la fecha, por favor')
                }
                else {

                    var datos =
                    {
                        'fechaInicio': fechaIni,
                        'fechaFin': fechaFin
                    }

                    $.ajax({
                        type: "GET",
                        url: '/finanzas/RG_BuscarHistorial',
                        contentType: "application/json; charset=utf-8",
                        data: datos,
                        dataType: "json",
                        success: function (data) {

                            let tabla = $("#tblHistorial").DataTable();

                            tabla.destroy();
                            var tr = "";

                            data.lista.forEach((obj) => {

                                tr += "<tr> "
                                    + " <td class='ocultar-columna'>" + obj.idSolicitud + "</td>"
                                    + " <td> " + obj.fecha + "</td>"
                                    + " <td> " + obj.codigo + "</td>"
                                    + " <td> " + obj.observacion + "</td>"
                                    + " <td> " + obj.estado + "</td>"
                                    + " <td> " + obj.tipo + "</td>"
                                    + " <td> " + obj.nivelAprob + "</td>"
                                    + " <td> " + obj.moneda + "</td>"
                                    + " <td> " + formatoNumero(obj.valor) + "</td>"
                                    + "</tr>";
                            });

                            $("#tblHistorialContent").html(tr);


                            $("#tblHistorial").DataTable(
                                {
                                    dom: 'Bfrtip',
                                    buttons: [
                                        'copy', 'excel', 'pdf', 'print'
                                    ],
                                    'language': { 'url': '/libs/datatables/spanish.json' },
                                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                                });

                        },
                        failure: function () {
                            console.error('error al cargar los periodos');
                        }
                    });

                }

            });

            $("#btnBuscarCodigo").click(function () {
                limpiarCabecera();
                limpiarDetalle();

                document.getElementById("btnBuscarCodigo").disabled = true;
                $("#btnBuscarCodigo").removeClass("btn-primary");
                $("#btnBuscarCodigo").addClass("btn-secondary");

                document.getElementById("idCbxTipo").disabled = true;
                document.getElementById("idCbxTipoMod").disabled = true;
                document.getElementById("idtxtaobs").disabled = true;
                document.getElementById("btnBuscarColaborador").disabled = true;

                vIdSolicitud = 0;
                $("#idtxtcodigo").val("");

                $("#btnGuardarCabecera").removeClass("btn-success");
                $("#btnGuardarCabecera").addClass("btn-secondary");
                document.getElementById("btnGuardarCabecera").disabled = true;

                $("#btnAnularSolicitud").removeClass("btn-danger");
                $("#btnAnularSolicitud").addClass("btn-secondary");
                document.getElementById("btnAnularSolicitud").disabled = true;

                $("#btnAgregarDetalle").removeClass("btn-warning");
                $("#btnAgregarDetalle").addClass("btn-secondary");
                document.getElementById("btnAgregarDetalle").disabled = true;


                $("#btnNuevo").removeClass("btn-secondary");
                $("#btnNuevo").addClass("btn-success");
                document.getElementById("btnNuevo").disabled = false;

                let tabla = $("#tblDetalle").DataTable();
                tabla.destroy();
                var tr = "";
                $("#tblDetalleContent").html(tr);
                $("#tblDetalle").DataTable(
                    {
                        'language': { 'url': '/libs/datatables/spanish.json' },
                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                    }
                );

                $("#estado-desc").text("");

                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").removeClass("icon-pendiente");

                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").removeClass("desc-est-pendiente");

                document.getElementById("idtxtcodigo").disabled = false;
                document.getElementById("idtxtcodigo").focus();
            });

            $("#btnAnularSolicitud").click(function () {
                var options = {};

                $.map(tiposAnulacionCabArray,
                    function (o) {
                        options[o.id] = o.name;
                    });

                Swal.fire({
                    title: 'Seleccione el motivo de la Anulación de solicitud',
                    icon: 'info',
                    input: 'select',
                    inputOptions: options,
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Ok'

                }).then((result) => {

                    if (result.value) {

                        let parametro = {
                            'opcion': 8,
                            'opcionTipoAprob': 0,
                            'idSolicitud': parseInt(vIdSolicitud),
                            'secuencia': 0,
                            'valorEntrega': 0,
                            'usuario': USUARIO,
                            'nivelInterfaz': NIVEL_INTERFAZ,
                            'idAnulado': parseInt(result.value),
                            'idAnuladoDet': 0
                        };

                        $.ajax({
                            url: "/finanzas/RG_AnularSolicitud",
                            type: "post",
                            data: parametro,
                            dataType: "json",
                            success: function (resultado) {

                                if (resultado.isRedirect) {
                                    window.location.href = resultado.redirectUrl;
                                }
                                else {
                                    if (resultado.status.idResponse > 0) {
                                        mensajePrincipal(true, resultado.status.statusResponse);
                                    }
                                    else {
                                        mensajePrincipal(false, resultado.status.statusResponse);
                                    }

                                    document.getElementById("btnAgregarDetalle").disabled = true;
                                    $("#btnAgregarDetalle").removeClass("btn-warning");
                                    $("#btnAgregarDetalle").addClass("btn-secondary");

                                    MostrarCarga("Actualizando...");
                                    listarBusquedaXCodigo(vCodigo);
                                }
                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                            }
                        });
                    }

                });


            });



            // Otros Eventos

            $('#idCbxTipoMod').change(function () {
                var $option = $(this).find('option:selected');
                vIdTipoMod = parseInt($option.val());
            });

            $('#idCbxSede').change(function () {
                var $option = $(this).find('option:selected');
                vCodSede = parseInt($option.val());
            });



            $('#idmCbxCeCo').change(function () {
                var $option = $(this).find('option:selected');
                vCodCeCo = parseInt($option.val());
                for (var i = 0; i < conceptoDetArray.length; i++) {
                    conceptoDetArray[i].codCeCo = vCodCeCo;
                }
            });

            $('#idmCbxConcepDet').change(function () {
                let $option = $(this).find('option:selected');
                let consideracion = $option.attr("data-consideracion");

                vIdConcepDet = $option.val().toString();

                $("#idmConcepDetConsid").text(consideracion);
            });

            $('#idCbxTipo').change(function () {

                var $option = $(this).find('option:selected');
                vIdTipo = parseInt($option.val());

                validarSedeYMonXTipo();
            });


            function validarSedeYMonXTipo() {
                let vTipo = $("#idCbxTipo").val();

                // Definir el tipo de moneda
                if (vTipo.toString() == 1 || vTipo.toString() == 2) {
                    $("#idCbxTipoMod").val(1);
                    vIdTipoMod = $("#idCbxTipoMod").val();

                    document.getElementById("idCbxTipoMod").disabled = true;
                }
                else if (vTipo.toString() == 3) {
                    document.getElementById("idCbxTipoMod").disabled = false;
                }

                // Definir la sede
                if (vTipo.toString() == 1) {
                    $("#idCbxSede").val("C");
                    vCodSede = "C";
                    document.getElementById("idCbxSede").disabled = true;
                }
                else if (vTipo.toString() == 2) {
                    $("#idCbxSede").val("L");
                    vCodSede = "L";
                    document.getElementById("idCbxSede").disabled = true;
                }
                else {
                    document.getElementById("idCbxSede").disabled = false;
                }
            }


            $('#idtxtcodigo').keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);

                if (keycode == '13') {

                    let codigo = $("#idtxtcodigo").val().trim();

                    if (codigo == "") {
                        Swal.fire({
                            title: 'Ingrese un código',
                            text: "Textile Sourcing Company",
                            icon: 'warning',
                            showConfirmButton: true,
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'Cancel',
                            focusConfirm: true
                        }).then(result => {
                            if (result.value) {
                                document.getElementById("idtxtcodigo").focus();
                            }
                        });
                    }
                    else if (codigo.length < 10 || codigo.length > 10) {
                        Swal.fire({
                            title: 'Ingrese un código',
                            title: 'Ingrese un código valido por favor',
                            icon: 'warning',
                            showConfirmButton: true,
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'Cancel',
                            focusConfirm: true
                        }).then(result => {
                            if (result.value) {
                                document.getElementById("idtxtcodigo").focus();
                            }
                        });
                    }
                    else {

                        MostrarCarga("Buscando...");

                        listarBusquedaXCodigo(codigo);
                    }

                }
            });

            $('#modalSolDetInsertar').on('hidden.bs.modal', function (e) {
                limpiarDetalle();
            });

        });



        function resetControles() {
            limpiarCabecera();
            limpiarDetalle();

            document.getElementById("btnAnularSolicitud").disabled = true;
            $("#btnAnularSolicitud").removeClass("btn-danger");
            $("#btnAnularSolicitud").addClass("btn-secondary");

            document.getElementById("btnBuscarCodigo").disabled = false;
            $("#btnBuscarCodigo").removeClass("btn-secondary");
            $("#btnBuscarCodigo").addClass("btn-primary");

            document.getElementById("idCbxTipo").disabled = false;
            document.getElementById("idCbxTipoMod").disabled = false;
            document.getElementById("idtxtaobs").disabled = false;
            document.getElementById("btnBuscarColaborador").disabled = false;

            $("#idusuario").val(USUARIO_COMPLETO);

            let now = new Date();
            $("#iddttFechaHora").val(new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().substring(0, 19).toString());

            document.getElementById("btnGuardarCabecera").disabled = false;
            $("#btnGuardarCabecera").removeClass("btn-secondary");
            $("#btnGuardarCabecera").addClass("btn-success");

            document.getElementById("btnAgregarDetalle").disabled = true;
            $("#btnAgregarDetalle").removeClass("btn-warning");
            $("#btnAgregarDetalle").addClass("btn-secondary");

            $("#kpi-cantidad").text("0");
            $("#kpi-total").text("0");

            let tabla = $("#tblDetalle").DataTable();
            tabla.destroy();
            var tr = "";
            $("#tblDetalleContent").html(tr);
            $("#tblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                }
            );
            $("#estado-desc").text("");

            $("#estado-icon").removeClass("icon-liberado");
            $("#estado-icon").removeClass("icon-aprobado");
            $("#estado-icon").removeClass("icon-rechazado");
            $("#estado-icon").removeClass("icon-pendiente");

            $("#estado-desc").removeClass("desc-est-liberado");
            $("#estado-desc").removeClass("desc-est-aprobado");
            $("#estado-desc").removeClass("desc-est-rechazado");
            $("#estado-desc").removeClass("desc-est-pendiente");

        }

        function limpiarCabecera() {
            let now = new Date();

            $("#iddttFechaHora").val("");
            $("#idtxtcodigo").val("");
            $("#idtxtcodigo").removeClass("idtxtcodigo-ok");
            $("#idCbxTipoMod").val(1);
            $("#idtxtaobs").val("");
            $("#idusuario").val("");
            $("#txtcolaborador").val("");

            vctpava_bnfcol = "";
            vcanvar_bnfcol = "";
            $("#txtcolaborador").val("");
        }

        function limpiarDetalle() {

            $("#idmcodigo").val("");
            $("#idmCbxConcepCab").val("0");

            $("#idmCbxConcepDet").val(0);
            $("#idmConcepDetConsid").text("");

            $("#idmCbxConcepCab").prop("disabled", false);
            //$("#idmCbxCeCo").val(0);
            $("#idmCbxDias").val(1);
            $("#sum-total-det").text("0.00");

            $("#seleccionar-todo").prop("checked", false);

            $("#detalleConceptoInsertarEditar").empty();
            $("#listDetalleConcept").empty();

            conceptoDetArray = [];
            sumTotalDetalle = 0;
        }

        function generarTablaDetalle(lista, idEstado) {

            let vTotal = 0;
            let tabla = $("#tblDetalle").DataTable();
            tabla.destroy();
            var tr = "";

            lista.forEach((obj) => {

                vTotal = vTotal + obj.valor;

                tr += "<tr> "
                    + " <td class='ocultar-columna'> " + obj.idSolicitud + "</td> "
                    + " <td> " + obj.codigo + "</td> "
                    + " <td> " + obj.fecha + "</td>"
                    + " <td> " + obj.tipo + "</td>"
                    + " <td> " + obj.estados + "</td>"
                    + " <td> " + obj.ceco + "</td> "
                    + " <td> " + obj.conceptoCab + "</td>"
                    + " <td> " + obj.tipoMoneda + "</td> "
                    + " <td> " + formatoNumero(obj.valor) + "</td> "
                    + " <td class='text-center'>"
                    + "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-primary solicitudDetalleItem'><i class='fas fa-eye'></i></button>"
                    + "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-success ml-1 solicitudEditarItem'" + (idEstado > 10 ? " disabled " : " ") + "><i class='fas fa-edit'></i></button>"
                    + "     <button data-idsolicitud='" + obj.idSolicitud + "' data-idconceptocab='" + obj.idConceptoCab + "' data-toggle='collapse' class='btn btn-sm btn-danger ml-1 solicitudEliminarItem'" + (idEstado > 10 ? " disabled " : " ") + "><i class='fas fa-trash'></i></button>"
                    + " </td>"
                    + "</tr>";
            });


            $("#kpi-cantidad").text(lista.length.toString());
            $("#kpi-total").text(formatoNumero(vTotal).toString());

            $("#tblDetalleContent").html(tr);

            $("#tblDetalle").DataTable(
                {
                    'language': { 'url': '/libs/datatables/spanish.json' },
                    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                }
            );
        }

        function listarBusquedaXCodigo(codigo) {

            $.ajax({
                url: "/finanzas/RG_SolicitudXCodigo",
                type: "GET",
                data: { 'codigo': codigo },
                dataType: "json",
                success: function (resultado) {

                    if (resultado.isRedirect) {
                        window.location.href = resultado.redirectUrl;
                    }
                    else {
                        if (resultado.entidad.idSolicitud > 0) {

                            vIdSolicitud = resultado.entidad.idSolicitud;
                            vCodigo = resultado.entidad.codigo;
                            vIdTipoMod = resultado.entidad.idTipoMod;

                            $("#idtxtcodigo").val(resultado.entidad.codigo);
                            $("#idtxtcodigo").addClass("idtxtcodigo-ok");
                            $("#iddttFechaHora").val(resultado.entidad.fecha);
                            $("#idusuario").val(resultado.entidad.usuSolicitante);
                            $("#idCbxTipo").val(resultado.entidad.idTipo);
                            $("#idCbxTipoMod").val(resultado.entidad.idTipoMod);
                            $("#idtxtaobs").val(resultado.entidad.observacion);

                            vctpava_bnfcol = resultado.entidad.ctpava_bnf;
                            vcanvar_bnfcol = resultado.entidad.canvar_bnf;
                            vcolaborador = resultado.entidad.colaborador;

                            $("#txtcolaborador").val(resultado.entidad.colaborador);

                            $("#estado-desc").text(resultado.entidad.estado);

                            indicadorEstado(resultado.entidad.idEstado);

                            $("#btnGuardarCabecera").removeClass("btn-success");
                            $("#btnGuardarCabecera").addClass("btn-secondary");
                            document.getElementById("btnGuardarCabecera").disabled = true;


                            // Si tiene estado mayor a 0, tiene aprobación
                            if (resultado.entidad.idEstado > 10) {
                                document.getElementById("btnAgregarDetalle").disabled = true;
                                $("#btnAgregarDetalle").removeClass("btn-warning");
                                $("#btnAgregarDetalle").addClass("btn-secondary");

                                $("#btnAnularSolicitud").removeClass("btn-danger");
                                $("#btnAnularSolicitud").addClass("btn-secondary");
                                document.getElementById("btnAnularSolicitud").disabled = true;
                            }
                            else {

                                $("#btnAgregarDetalle").removeClass("btn-secondary");
                                $("#btnAgregarDetalle").addClass("btn-warning");
                                document.getElementById("btnAgregarDetalle").disabled = false;
                                document.getElementById("btnAgregarDetalle").focus();

                                $("#btnAnularSolicitud").removeClass("btn-secondary");
                                $("#btnAnularSolicitud").addClass("btn-danger");
                                document.getElementById("btnAnularSolicitud").disabled = false;
                            }

                            if (resultado.entidad.listaDetalle.length > 0) {
                                generarTablaDetalle(resultado.entidad.listaDetalle, resultado.entidad.idEstado);
                            }
                            else {
                                limpiarDetalle();

                                let tabla = $("#tblDetalle").DataTable();
                                tabla.destroy();
                                var tr = "";
                                $("#tblDetalleContent").html(tr);
                                $("#tblDetalle").DataTable(
                                    {
                                        'language': { 'url': '/libs/datatables/spanish.json' },
                                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                                    }
                                );

                                $("#kpi-cantidad").text("0");
                                $("#kpi-total").text("0");

                                sumTotalDetalle = 0;
                            }

                            mensajePrincipal(true, "Mostrando Solicitud");
                        }
                        else {
                            mensajePrincipal(false, "Solicitud no encontrada");

                            resetControles();

                            $("#idtxtcodigo").val("");
                            document.getElementById("idtxtcodigo").disabled = false;
                            document.getElementById("idCbxTipo").disabled = true;
                            document.getElementById("idCbxTipoMod").disabled = true;
                            document.getElementById("idtxtaobs").disabled = true;
                            document.getElementById("btnBuscarColaborador").disabled = true;

                            document.getElementById("btnGuardarCabecera").disabled = true;
                            $("#btnGuardarCabecera").removeClass("btn-success");
                            $("#btnGuardarCabecera").addClass("btn-secondary");

                            document.getElementById("btnBuscarCodigo").disabled = true;
                            $("#btnBuscarCodigo").removeClass("btn-primary");
                            $("#btnBuscarCodigo").addClass("btn-secondary");

                            document.getElementById("idtxtcodigo").focus();
                        }
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {

                }
            });

        }



        $('#detalleConceptoInsertarEditar').on('click', '.cseleccion', function (e) {

            let inputCheck = $(this);
            let idConceptoDet = $(this).attr("data-id");
            let valorPre = "";
            let valor = 0;

            if (inputCheck.is(":checked")) {


                for (var i = 0; i < conceptoDetArray.length; i++) {
                    if (conceptoDetArray[i].idConceptoDet == idConceptoDet) {

                        conceptoDetArray[i].seleccionadoDet = 1;
                        conceptoDetArray[i].isChecked = true;

                        // Servicio y Otros
                        if (conceptoDetArray[i].idConceptoDet == 10) {
                            $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                        }
                        else {
                            $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                        }

                        valorPre = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                        if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                            valor = 0;
                        }
                        else {
                            valor = parseFloat(valorPre);
                        }

                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val((valor * parseFloat(conceptoDetArray[i].cantDias)));
                        sumTotalDetalle = sumTotalDetalle + (valor * parseFloat(conceptoDetArray[i].cantDias));
                    }
                }

            } else {
                for (var i = 0; i < conceptoDetArray.length; i++) {


                    if (conceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        conceptoDetArray[i].seleccionadoDet = 0;
                        conceptoDetArray[i].isChecked = false;
                        conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();

                        valorPre = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                        if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                            valor = 0;
                        }
                        else {
                            valor = parseFloat(valorPre);
                        }

                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val("0");
                        sumTotalDetalle = sumTotalDetalle - valor * parseFloat(conceptoDetArray[i].cantDias);
                    }
                }

                $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
            }

            if (conceptoDetArray.filter(x => x.isChecked == true).length == conceptoDetArray.length) {
                $("#seleccionar-todo").prop("checked", true);
            }
            else {
                $("#seleccionar-todo").prop("checked", false);
            }

            $("#sum-total-det").text(formatoNumero(sumTotalDetalle));
        });

        $('#modalSolDetInsertar').on('click', '#seleccionar-todo', function (e) {
            let idConceptoDet = 0;
            var inputCheck = $(this);
            sumTotalDetalle = 0;

            let valorPre = "";
            let valor = 0;

            if (inputCheck.is(":checked")) {

                let valorXConceptDet = 0;

                $("#detalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                    idConceptoDet = $(this).attr("data-id");
                    valorXConceptDet = 0;

                    if (conceptoDetArray[i].idConceptoDet == idConceptoDet) {

                        conceptoDetArray[i].seleccionadoDet = 1;
                        conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                    }

                    conceptoDetArray[i].isChecked = true;

                    valorPre = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDet.toString() + "").val();

                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valor = 0;
                    }
                    else {
                        valor = parseFloat(valorPre);
                    }

                    $(this).prop("checked", true);

                    // Servicio y Otros
                    if (conceptoDetArray[i].idConceptoDet == 10) {
                        $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);
                    }
                    else {
                        $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", false);
                    }

                    valorXConceptDet = parseFloat(valor) * conceptoDetArray[i].cantDias;

                    sumTotalDetalle = sumTotalDetalle + valorXConceptDet;
                });

            } else {
                $("#detalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {
                    idConceptoDet = $(this).attr("data-id");

                    if (conceptoDetArray[i].idConceptoDet == idConceptoDet) {
                        conceptoDetArray[i].seleccionadoDet = 0;
                        conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDet.toString() + "").val();
                    }

                    conceptoDetArray[i].isChecked = false;
                    $(this).prop("checked", false);
                    $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").attr("disabled", true);

                    sumTotalDetalle = 0;
                });
            }

            $("#sum-total-det").text(formatoNumero(sumTotalDetalle));
        });

        $('#idmCbxConcepCab').change(function () {
            var $option = $(this).find('option:selected');
            vIdConcepCab = $option.val().toString();

            if (vIdConcepCab != 0 && vIdConcepCab != null && typeof (vIdConcepCab) != "undefined") {

                sumTotalDetalle = 0;
                conceptoDetArray = [];

                $("#sum-total-det").text(formatoNumero(sumTotalDetalle));
                getConceptoDet(vIdConcepCab);

            }
        });

        $('#detalleConceptoInsertarEditar').on('change', '.cdias', function (e) {

            sumTotalDetalle = 0;

            $("#detalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {

                let valorPre = "";
                let valorActual = 0;

                let idConceptoDetCheckbox = $(obj).attr("data-id");
                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                if (conceptoDetArray[i].isChecked == true) {

                    conceptoDetArray[i].seleccionadoDet = 1;
                    conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    conceptoDetArray[i].montoSolicitado = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();

                    valorPre = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valorActual = 0;
                    }
                    else {
                        valorActual = parseFloat(valorPre);
                    }

                    // SOLES
                    if (vIdTipoMod == 1) {

                        if (valorActual > parseFloat(valorMaximoS)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        sumTotalDetalle = sumTotalDetalle + (valorActual * parseFloat(conceptoDetArray[i].cantDias));
                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(conceptoDetArray[i].cantDias)));

                    }
                    else if (vIdTipoMod == 2) {
                        // DOLAR

                        if (valorActual > parseFloat(valorMaximoD)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        sumTotalDetalle = sumTotalDetalle + (valorActual * parseFloat(conceptoDetArray[i].cantDias));
                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(conceptoDetArray[i].cantDias)));
                    }
                }
                else {

                    conceptoDetArray[i].seleccionadoDet = 0;
                    conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();
                }
            });

            $("#sum-total-det").text(formatoNumero(sumTotalDetalle));

        });

        $('#modalSolDetInsertar').on('shown.bs.modal', function (e) {

            let idConceptoDet = 0;
            let primerCantDias = 0;
            let primerLoopCbxDia = true;

            if (switchInsertarEditar == 2) {

                $("#detalleConceptoInsertarEditar .cdias").each(function (i, obj) {
                    $("#idmCbxConcepCab").prop("disabled", true);
                    idConceptoDet = $(obj).attr("data-id");

                    $.each(diasArray, function () {
                        if (primerLoopCbxDia) {
                            primerCantDias = this.codDia;
                        }
                        primerLoopCbxDia = false;
                    });

                    let dias = diasArrayEditar.find(x => x.idConceptoDet == idConceptoDet).cantDias;

                    if (dias > 0) {
                        $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(dias);

                    }
                    else {
                        $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val(primerCantDias);
                    }
                });


                actualizarTotales();
            }

        });

        $("#detalleConceptoInsertarEditar").on("keyup", ".cmontosolicitar", function () {

            if ($(this).val().trim() != "" && $(this).val().trim() != "0") {
                sumTotalDetalle = 0;

                $("#detalleConceptoInsertarEditar input[type='number']").each(function (i, obj) {

                    idConceptoDet = $(obj).attr("data-idconceptodet");

                    if (conceptoDetArray[i].idConceptoDet.toString() == idConceptoDet && conceptoDetArray[i].isChecked == true) {

                        let valorMaximoS = $(obj).attr("data-valor-maxs");
                        let valorMaximoD = $(obj).attr("data-valor-maxd");
                        let cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDet.toString() + "").val();
                        let valorActual = 0;


                        if ($(obj).val() == null || typeof ($(obj).val()) == "undefined" || $(obj).val().trim() == "") {
                            valorActual = 0;
                        }
                        else {
                            valorActual = parseFloat($(obj).val());
                        }

                        // SOLES
                        if (vIdTipoMod == 1) {
                            if (valorActual > parseFloat(valorMaximoS)) {

                                $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                valorActual = 0;

                                Swal.fire({
                                    title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showConfirmButton: true,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                });

                                document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            }

                        }
                        else if (vIdTipoMod == 2) {
                            // DOLAR

                            if (valorActual > parseFloat(valorMaximoD)) {

                                $("#txtMontoSol" + idConceptoDet.toString() + "").val(0);
                                valorActual = 0;

                                Swal.fire({
                                    title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                    text: "Textile Sourcing Company",
                                    icon: 'warning',
                                    showConfirmButton: true,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                });

                                document.getElementById("txtMontoSol" + idConceptoDet.toString() + "").focus();
                            }
                        }

                        sumTotalDetalle = sumTotalDetalle + (valorActual * parseFloat(cantDias));
                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDet.toString()).val((valorActual * parseFloat(cantDias)));

                        $("#sum-total-det").text(formatoNumero(sumTotalDetalle));
                    }
                });

            }
        });

        $("#btnBuscarColaborador").click(function () {
            $("#modalColaboradorSofya").modal("show");
        });

        $('#idBusquedaColaborador').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);

            let filtro = $("#idBusquedaColaborador").val();

            if (keycode == '13') {

                if (filtro == "") {
                    Swal.fire({
                        title: 'Ingrese el filtro para la busqueda',
                        text: "Textile Sourcing Company",
                        icon: 'warning',
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'Cancel',
                        focusConfirm: true
                    }).then(result => {
                        if (result.value) {
                            document.getElementById("idBusquedaColaborador").focus();
                        }
                    });
                }
                else {

                    $.ajax({
                        url: "/finanzas/RG_ColaboradorSofya",
                        type: "GET",
                        data: { 'filtro': filtro, 'nivelInterfaz': NIVEL_INTERFAZ },
                        dataType: "json",
                        success: function (resultado) {

                            if (resultado.isRedirect) {
                                window.location.href = resultado.redirectUrl;
                            }
                            else {
                                let tabla = $("#tblColaborador").DataTable();

                                tabla.destroy();
                                var tr = "";

                                resultado.lista.forEach((obj) => {

                                    tr += "<tr> "
                                        + " <td> " + obj.codsofya + "</td>"
                                        + " <td> " + obj.colaborador + "</td>"
                                        + " <td class='text-center'>"
                                        + "     <button data-ctpava='" + obj.ctpava + "' data-canvar='" + obj.canvar + "' data-codsofya='" + obj.codsofya + "' data-colaborador='" + obj.colaborador + "' data-toggle='collapse' data-codceco = '" + obj.codceco + "'  class='btn btn-sm btn-success cseleccionar ml-1'><i class='fas fa-check'></i></button>"
                                        + "</td>"
                                        + "</tr>";
                                });

                                $("#tblColaboradorContent").html(tr);

                                $("#tblColaborador").DataTable(
                                    {
                                        searching: false,
                                        paging: false,
                                        info: false,
                                        "scrollY": "250px",
                                        "scrollCollapse": true,
                                        'language': { 'url': '/libs/datatables/spanish.json' },
                                        lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]
                                    });
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        }
                    });

                }

            }
        });

        $('#tblColaborador').on('click', '.cseleccionar', function (e) {

            vCodColSofya = $(this).attr("data-codsofya");
            vColaboradorSofya = $(this).attr("data-colaborador");
            vctpava_bnfcol = $(this).attr("data-ctpava");
            vcanvar_bnfcol = $(this).attr("data-canvar");
            vCodCeCo = $(this).attr("data-codceco");

            $("#idmCbxCeCo").val(vCodCeCo); 
            vcolaborador = $.trim(vColaboradorSofya);
            $("#txtcolaborador").val($.trim(vColaboradorSofya));

            $("#modalColaboradorSofya").modal("hide");
            document.getElementById("idmCbxCeCo").disabled = true;
        });

        function mensajePrincipal(estado, mensaje) {
            if (estado == true) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: mensaje
                });

            }
            else if (estado == false) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'error',
                    title: mensaje
                });

            }
        }



        // Funciones Generales

        function formatoNumero(x) {
            x = x.toFixed(2);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function getConceptoDet(idConceptoCab) {
            $.ajax({
                type: "GET",
                url: '/Finanzas/RG_ConceptoDetalleInsertar',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { idConceptoCab: idConceptoCab },
                success: function (data) {

                    $("#detalleConceptoInsertarEditar").empty();

                    let detHTML = "";
                    let cbxDiasHTML = "";

                    let primerLoopCbxDia = true;
                    let cantDiaSeleccionado = 0;

                    $.each(diasArray, function () {

                        if (primerLoopCbxDia) {
                            cbxDiasHTML += "<option value='" + this.codDia + "' selected>" + this.dia + "</option>";
                            cantDiaSeleccionado = this.codDia;
                        }
                        else {
                            cbxDiasHTML += "<option value='" + this.codDia + "'>" + this.dia + "</option>";
                        }

                        primerLoopCbxDia = false;
                    });


                    $.each(data.lista, function () {

                        detHTML += "<div class='row mt-1'>"
                            + "<div class='col-1'>"
                            + "     <input type='checkbox' class='cseleccion' data-id=" + this.idConceptoDet + " data-valor=" + this.montoMaximo + "  data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd='" + this.montoMaximoD + "'  >"
                            + "</div>"
                            + "<div class='col-2'>"
                            + "      <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.conceptoDet + "</p>"
                            + "</div>"
                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm cmontosolicitar' type='number' id='txtMontoSol" + this.idConceptoDet + "' min='0' max='" + this.montoMaximo + "' data-idconceptodet='" + this.idConceptoDet + "' data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd='" + this.montoMaximoD + "'>"
                            + "</div>"

                            + "<div class='col-2'>"
                            + "     <input class='form-control form-control-sm cobsdet' type='text' id='txtObsDet" + this.idConceptoDet + "' data-idconceptodet='" + this.idConceptoDet + "'>"
                            + "</div>"

                            + "<div class='col-4'>"
                            + "     <p style='padding: 4px; border:1px solid #CCD1D1; border-radius: 3px;'>" + this.consideracion + "</p>"
                            + "</div>"

                            + "<div class='col-1'>"
                            + "   <select class='form-control form-control-sm cdias cbxDias" + this.idConceptoDet + "' data-id=" + this.idConceptoDet + " data-valor-maxs = '" + this.montoMaximoS + "' data-valor-maxd='" + this.montoMaximoD + "' disabled>"
                            + cbxDiasHTML
                            + "</select>"
                            + "</div>"

                            + "<div class='col-1'>"
                            + "     <input class='form-control form-control-sm txtTotalPed" + this.idConceptoDet + "' type='text' disabled>"
                            + "</div>"


                            + "</div>";

                        //sumTotalDetalle = sumTotalDetalle + parseFloat(this.montoMaximo);
                        sumTotalDetalle = 0;
                        conceptoDetArray.push({ idConceptoDet: this.idConceptoDet, seleccionadoDet: 1, codCeCo: vCodCeCo, isChecked: false, cantDias: cantDiaSeleccionado, montoSolicitado: 0, observacionDet : this.observacionDet });
                    });

                    $("#seleccionar-todo").prop("checked", false);
                    $("#detalleConceptoInsertarEditar").html(detHTML);
                    $("#sum-total-det").text(formatoNumero(sumTotalDetalle * cantDiaSeleccionado));

                },
                failure: function () {
                    console.error('error al cargar tipos periodos');
                }
            });
        }


        function actualizarTotales() {
            // xxx


            sumTotalDetalle = 0;

            $("#detalleConceptoInsertarEditar input[type='checkbox']").each(function (i, obj) {

                let valorPre = "";
                let valorActual = 0;

                let idConceptoDetCheckbox = $(obj).attr("data-id");
                let valorMaximoS = $(obj).attr("data-valor-maxs");
                let valorMaximoD = $(obj).attr("data-valor-maxd");

                if (conceptoDetArray[i].isChecked == true) {

                    conceptoDetArray[i].seleccionadoDet = 1;
                    conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    conceptoDetArray[i].montoSolicitado = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();

                    valorPre = $("#detalleConceptoInsertarEditar #txtMontoSol" + idConceptoDetCheckbox.toString() + "").val();
                    if (valorPre == null || typeof (valorPre) == "undefined" || valorPre.trim() == "") {
                        valorActual = 0;
                    }
                    else {
                        valorActual = parseFloat(valorPre);
                    }

                    // SOLES
                    if (vIdTipoMod == 1) {

                        if (valorActual > parseFloat(valorMaximoS)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        sumTotalDetalle = sumTotalDetalle + (valorActual * parseFloat(conceptoDetArray[i].cantDias));
                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(conceptoDetArray[i].cantDias)));

                    }
                    else if (vIdTipoMod == 2) {
                        // DOLAR

                        if (valorActual > parseFloat(valorMaximoD)) {

                            $("#txtMontoSol" + idConceptoDetCheckbox.toString() + "").val(0);
                            valorActual = 0;

                            Swal.fire({
                                title: 'El monto ingresado no puede ser mayor al maximo permitido',
                                text: "Textile Sourcing Company",
                                icon: 'warning',
                                showConfirmButton: true,
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });

                            document.getElementById("txtMontoSol" + idConceptoDetCheckbox.toString() + "").focus();
                        }

                        sumTotalDetalle = sumTotalDetalle + (valorActual * parseFloat(conceptoDetArray[i].cantDias));
                        $("#detalleConceptoInsertarEditar .txtTotalPed" + idConceptoDetCheckbox.toString()).val((valorActual * parseFloat(conceptoDetArray[i].cantDias)));
                    }
                }
                else {

                    conceptoDetArray[i].seleccionadoDet = 0;
                    conceptoDetArray[i].cantDias = $("#detalleConceptoInsertarEditar .cbxDias" + idConceptoDetCheckbox.toString() + "").val();
                    conceptoDetArray[i].observacionDet = $("#detalleConceptoInsertarEditar #txtObsDet" + idConceptoDetCheckbox.toString() + "").val();
                }
            });

            $("#sum-total-det").text(formatoNumero(sumTotalDetalle));

        }





        function indicadorEstado(idEstado) {

            if (idEstado == 10) {
                // Pendiente
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").addClass("icon-pendiente");

                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").addClass("desc-est-pendiente");

            }
            else if (idEstado == 15) {
                // Liberado
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").addClass("icon-liberado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").addClass("desc-est-liberado");

            }
            else if (idEstado == 20 || idEstado == 25) {
                // Aprobado Total
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").addClass("icon-aprobado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 21) {
                // Aprobado Parcial
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-rechazado");
                $("#estado-icon").addClass("icon-aprobado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-rechazado");
                $("#estado-desc").addClass("desc-est-aprobado");

            }
            else if (idEstado == 16 || idEstado == 22 || idEstado == 30) {
                // Rechazado
                $("#estado-icon").removeClass("icon-pendiente");
                $("#estado-icon").removeClass("icon-liberado");
                $("#estado-icon").removeClass("icon-aprobado");
                $("#estado-icon").addClass("icon-rechazado");

                $("#estado-desc").removeClass("desc-est-pendiente");
                $("#estado-desc").removeClass("desc-est-liberado");
                $("#estado-desc").removeClass("desc-est-aprobado");
                $("#estado-desc").addClass("desc-est-rechazado");
            }



        }




    </script>

}


